(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd,dd,ed,fd,gd,hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,sd,td,ud,vd,wd,xd,yd,zd,Ad,Bd,Cd,Dd,Ed,Fd,Gd,Hd,Id,Jd,Kd,Ld,Md,Nd,Od,Pd,Qd,Rd,Sd,Td={}.hasOwnProperty,Ud=function(a,b){function c(){this.constructor=a}for(var d in b)Td.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},Vd=function(a,b){return function(){return a.apply(b,arguments)}},Wd=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};h=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={primary:null,secondary:null},b}(Backbone.Model),i=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={active:null,inactive:null},b}(Backbone.Model),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={service:""},b}(Backbone.Model),k=function(a){function b(){return this.setBehaviours=Vd(this.setBehaviours,this),this.setKeys=Vd(this.setKeys,this),b.__super__.constructor.call(this),this.setKeys(),this.setBehaviours(),null}return Ud(b,a),b.prototype.defaults={keys:null,behaviours:null},b.prototype.setKeys=function(){return this.set("keys",Sd.axe.startData.keys),null},b.prototype.setBehaviours=function(){var a,b,c,d,e;for(a={},e=Sd.axe.startData.behaviours,c=0,d=e.length;d>c;c++)b=e[c],a[b.behaviourStr]=b.weight.sites[b.behaviourStr];return this.set("behaviours",a),null},b}(Backbone.DeepModel),x=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults="",b}(Backbone.DeepModel),E=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={tweetId:0,text:"",classification:"",score:0},b}(Backbone.Model),I=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults="",b}(Backbone.DeepModel),M=function(a){function b(){return this.hideMarker=Vd(this.hideMarker,this),this.showMarker=Vd(this.showMarker,this),this.setup=Vd(this.setup,this),this.addToMap=Vd(this.addToMap,this),this.isInBounds=Vd(this.isInBounds,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.$markerEl=null,b.prototype.$name=null,b.prototype.marker=null,b.prototype.bounds=null,b.prototype.visible=null,b.prototype.hasSetup=!1,b.prototype.defaults={name:null,lat:null,lng:null,radius:null,woeid:null,trends:[]},b.prototype.isInBounds=function(a){var b;return b=this.bounds.getBounds(),b.contains(a)?!0:!1},b.prototype.addToMap=function(a){var b,c,d,e,f;return c={nameStr:this.get("name").toLowerCase().replace(" ","-")},e=_.template(Sd.axe.templates.get("city-marker")),d=e(c),f=new google.maps.LatLng(this.get("lat"),this.get("lng")),this.marker=new RichMarker({position:f,map:a,draggable:!1,flat:!0,anchor:RichMarkerPosition.BOTTOM_RIGHT,content:d,zIndex:0}),this.bounds=b=new google.maps.Circle({visible:!1,map:a,center:f,radius:2.73*1e3*this.get("radius")}),null},b.prototype.setup=function(){return this.$markerEl=this.$markerEl||$(this.marker.markerContent_.firstChild),this.$name=this.$name||this.$markerEl.find("[data-numtransition]"),this.$markerEl.parent().parent().css({"pointer-events":"none"}),Hc.setup(this.$name),this.hasSetup=!0,null},b.prototype.showMarker=function(a,b){var c;return this.hasSetup||this.setup(),c="left"===a?"BOTTOM_RIGHT":"TOP_LEFT",this.marker.setAnchor(RichMarkerPosition[c]),this.marker.setZIndex(501),this.$markerEl.addClass("show "+a).css({opacity:1,visibility:"visible"}),setTimeout(function(c){return function(){return Hc.update(c.$markerEl,c.get("name")),c.visible=a,"function"==typeof b?b():void 0}}(this),300),null},b.prototype.hideMarker=function(a){return this.$markerEl.addClass("hiding"),Hc.clear(this.$name),setTimeout(function(b){return function(){return b.$markerEl.removeClass("show"),setTimeout(function(){return b.$markerEl.removeClass("hiding left right").css({opacity:0,visibility:"hidden"}),b.visible=!1,"function"==typeof a?a():void 0},300)}}(this),500),null},b}(Backbone.DeepModel),Z=function(a){function b(a){return this.getUserCountry=Vd(this.getUserCountry,this),this.pointInBounds=Vd(this.pointInBounds,this),this.tweetInBounds=Vd(this.tweetInBounds,this),this.setTerritories=Vd(this.setTerritories,this),this.fetch({success:a}),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.url="/data/countries.json",b.prototype.map=null,b.prototype.active_country=null,b.prototype.setTerritories=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;this.map=a,l=this.toJSON();for(e in l){i=l[e],b={},g=[],m=i.territory;for(d in m){for(h=m[d],b[d]=[],j=0,k=h.length;k>j;j++)c=h[j],b[d].push(new google.maps.LatLng(c[0],c[1]));f=new google.maps.Polygon({paths:b[d],visible:!1}),f.setMap(this.map),g.push(f)}i.territory=g.concat(),i.tweetCount=0}return null},b.prototype.tweetInBounds=function(a){var b;return b=a.coordinates,this.pointInBounds(b[1],b[0])},b.prototype.pointInBounds=function(a,b){var c,d,e,f,g,h;g=this.toJSON();for(c in g){e=g[c],h=e.territory;for(d in h)if(f=h[d],f.containsLatLng(a,b))return!0}return!1},b.prototype.getUserCountry=function(){var a,b,c,d,e,f,g,h,i,j;if(c=null!=(h=Sd.axe.appData.GEO)?h.geo:void 0,!c)return!1;if(d=parseInt(c.lat,10),e=parseInt(c.lon,10),!this.pointInBounds(d,e))return!1;i=this.toJSON();for(a in i){f=i[a],j=f.territory;for(b in j)if(g=j[b],g.containsLatLng(d,e))return a}return!1},b}(Backbone.Model),lb=function(a){function b(){return this.axe=Vd(this.axe,this),this.isProtected=Vd(this.isProtected,this),this.onCrunchComplete=Vd(this.onCrunchComplete,this),this.setInfo=Vd(this.setInfo,this),this.scoreFail=Vd(this.scoreFail,this),this.scoreReceived=Vd(this.scoreReceived,this),this.postsReceived=Vd(this.postsReceived,this),this.profileReceived=Vd(this.profileReceived,this),this._getScore=Vd(this._getScore,this),this._getPosts=Vd(this._getPosts,this),this._getProfile=Vd(this._getProfile,this),this.getAllData=Vd(this.getAllData,this),this.initialize=Vd(this.initialize,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.service=null,b.prototype.defaults={service:null,id:null,name:null,username:null,avatar:null,data:null,score:null,following_me:!1,animateIn:!1,nonFriend:!1,IS_USER:!1,IS_ACTIVE:!1,crunchProgress:0},b.prototype.initialize=function(){return this.service=this.get("service"),this.on("crunchComplete",this.onCrunchComplete),null},b.prototype.getAllData=function(){return this.isProtected()?void 0:(this.trigger("beginCrunch"),this.infoReq=this._getProfile(this.service),this.dataReq=this._getPosts(this.service),$.when(this.infoReq,this.dataReq).done(function(a){return function(){return a._getScore(a.service)}}(this)),null)},b.prototype._getProfile=function(a){var b;return null==a&&(a=!0),b="fb"===this.service?ib.getUser({id:this.get("id"),done:function(b){return function(c){return b.profileReceived(c,a)}}(this)}):Tc.request({url:""+window.config.hostname+"/api/"+this.service+"/"+this.get("username")+"/info",type:"get",done:function(b){return function(c){return b.profileReceived(c,a)}}(this)})},b.prototype._getPosts=function(){var a,b;return"fb"===this.service?b=ib.getPosts({id:this.get("id"),done:function(a){return function(b){return a.postsReceived(b.data)}}(this)}):(a="tw"===this.service?"tweets":"posts",b=Tc.request({url:""+window.config.hostname+"/api/"+this.service+"/"+this.get("username")+"/"+a,type:"get",done:this.postsReceived})),b},b.prototype._getScore=function(){var a;return a=this.axe().appData.FRIENDS.cruncher["crunch_"+this.service]({userProfile:this.get("data.userProfile"),userPosts:this.get("data.userPosts")}),a.done(this.scoreReceived),a.fail(this.scoreFail),null},b.prototype.profileReceived=function(a,b){return this.set("data.userProfile",a),b&&this.set("crunchProgress",this.get("crunchProgress")+33),this.get("avatar")||this.setInfo(a),null},b.prototype.postsReceived=function(a){return this.set("crunchProgress",this.get("crunchProgress")+33),this.set("data.userPosts",a),null},b.prototype.scoreReceived=function(a){return this.set("crunchProgress",100),this.set("score",a.score),this.trigger("crunchComplete",this),null},b.prototype.scoreFail=function(){return this.trigger("error",1),null},b.prototype.setInfo=function(a){var b;return b={id:a.id,name:a.name||a.full_name,username:a.screen_name||a.username,avatar:a.profile_image_url||a.profile_picture||"http://graph.facebook.com/"+a.username+"/picture"},this.set(b),null},b.prototype.onCrunchComplete=function(){return this.trigger("friendScoreReceived",this),null},b.prototype.isProtected=function(){return this.get("data.userProfile.protected")||!1,null},b.prototype.axe=function(){return(window||document).axe},b}(Backbone.DeepModel),nb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={bullseye:{user:"user"},linegraph:{user:"user",others:[]},bubbles:{user:"user"}},b}(Backbone.DeepModel),tb=function(a){function b(){return this.initialize=Vd(this.initialize,this),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.defaults={tw:null,fb:null,ig:null},b.prototype.initialize=function(){return this.set("tw",new S([],{service:"tw"})),this.set("fb",new S([],{service:"fb"})),this.set("ig",new S([],{service:"ig"})),null},b}(Backbone.DeepModel),yb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={postCounters:{total:0,total_int:0,tth:0,el:0,nth:0,w_photos:0,w_hashtags:0,w_emotji:0,w_selfie:0},counters:{hashtags:0,scores:0},averages:{total:0,tth:0,el:0,nth:0},frequencies:{day:{total:0,el:0,non_el:0},second:{tth:0}},misc:{daysTilMoon:0,tthUser:null},time:{started:0,elapsed:0}},b}(Backbone.DeepModel),Hb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={active:!1,user:null,data:null},b}(Backbone.DeepModel),Pb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b}(Backbone.Model),jc=function(a){function b(){return this.getString=Vd(this.getString,this),this.get_language=Vd(this.get_language,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={code:null,language:null,strings:null},b.prototype.get_language=function(){return this.get("language")},b.prototype.getString=function(a){var b,c,d,e,f,g,h;c="strings",g=this.get(c);for(e in g){f=g[e],h=f[c];for(b in h)if(d=h[b],b===a)return d}return console.warn("Locales -> not found string: "+a)},b}(Backbone.Model),lc=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={data:null},b}(Backbone.DeepModel),Bc=function(a){function b(){return this.removeFromMap=Vd(this.removeFromMap,this),this.hideTweet=Vd(this.hideTweet,this),this.showTweet=Vd(this.showTweet,this),this.show=Vd(this.show,this),this.onClick=Vd(this.onClick,this),this.addToMap=Vd(this.addToMap,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.$el=null,b.prototype.circle=null,b.prototype.listener=null,b.prototype.MAX_WIDTH=70,b.prototype.MIN_WIDTH=10,b.prototype.defaults={coordinates:null,added:!1,active:!1,visible:!1},b.prototype.addToMap=function(a){var b,c,d,e,f;return this.mapCanvas=a.mapCanvas,this.map=a.map,e=this.get("woeid")===a.activeCity1||this.get("woeid")===a.activeCity2?!0:!1,f=this.get("score")<0?-1*this.get("score"):this.get("score"),this.set({latLng:new google.maps.LatLng(this.get("coordinates")[1],this.get("coordinates")[0]),radius:f/500*this.MAX_WIDTH+this.MIN_WIDTH,zIndex:parseInt(500-f,10)}),b={width:this.get("radius"),height:this.get("radius"),inCity:e,woeid:this.get("woeid"),judgement:this.get("judgement")},d=_.template(Sd.axe.templates.get("map-tweet-marker")),c=d(b),this.circle=new RichMarker({position:this.get("latLng"),map:this.map,draggable:!1,flat:!0,anchor:RichMarkerPosition.MIDDLE,shadow:"none",zIndex:this.get("zIndex"),content:c}),this.listener=google.maps.event.addListener(this.circle,"click",this.onClick),this.set("added",!0),null},b.prototype.onClick=function(){return this.get("active")?this.hideTweet():(this.showTweet(),Sd.axe.analytics.track("cities_click_tweet")),null},b.prototype.show=function(a){var b;return null==a&&(a=!1),this.$el=this.$el||$(null!=(b=this.circle)?b.markerContent_.firstChild:void 0),this.$el.length||a?(this.$el.addClass("show"),this.set("visible",!0),null):(setTimeout(function(a){return function(){return a.show(!0)}}(this),500),void 0)},b.prototype.showTweet=function(){var a;return this.mapCanvas.tweetVisible?setTimeout(this.showTweet,300):(this.set("active",!0),a=100/this.get("radius"),this.$el.addClass("active").find(".circle").css({width:100,height:100}).end().parent().parent().css({"z-index":501}),this.mapCanvas.showActiveTweet(this),null)},b.prototype.hideTweet=function(){return this.set("active",!1),this.$el.removeClass("active").find(".circle").css({width:this.get("radius"),height:this.get("radius")}).end().parent().parent().css({"z-index":this.get("zIndex")}),this.mapCanvas.hideActiveTweet(this),null},b.prototype.removeFromMap=function(a){var b;return null!=(b=this.$el)&&b.addClass("hide"),setTimeout(function(b){return function(){return b.circle.setMap(null),google.maps.event.removeListener(b.listener),"function"==typeof a?a():void 0}}(this),500),null},b}(Backbone.DeepModel),Dc=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={zoom:null},b}(Backbone.Model),ld=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={id:0,judgement:"",text:"",classification:"",score:0,imageUrl:"",action:""},b}(Backbone.Model),sd=function(a){function b(a){var b;return this.callback=a,this.onDataReceived=Vd(this.onDataReceived,this),b=Tc.request({url:this.url,type:"GET"}),b.done(this.onDataReceived),null}return Ud(b,a),b.prototype.url=""+window.config.hostname+"/api/start",b.prototype.onDataReceived=function(a){var b,c;for(b in a)c=a[b],this[b]="string"==typeof c?JSON.parse(c):c;return this.callback(),null},b}(Backbone.Model),yd=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={id:"",text:""},b}(Backbone.Model),Id=function(a){function b(){return this.getLoggedCount=Vd(this.getLoggedCount,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.defaults={tw:!1,fb:!1,ig:!1,any:!1},b.prototype.getLoggedCount=function(){var a,b,c,d;a=0,d=this.toJSON();for(b in d)c=d[b],"any"!==b&&c&&a++;return a},b}(Backbone.DeepModel),Jd=function(a){function b(){return this.axe=Vd(this.axe,this),this.removeSavedScores=Vd(this.removeSavedScores,this),this.getSavedScores=Vd(this.getSavedScores,this),this.setSavedScores=Vd(this.setSavedScores,this),this.getScoreDifference=Vd(this.getScoreDifference,this),this.updateTotalScore=Vd(this.updateTotalScore,this),this.setUserInfo=Vd(this.setUserInfo,this),this.setup=Vd(this.setup,this),b.__super__.constructor.call(this),this.setup(),this.trigger("updateUserData"),this.on("setSavedScores",this.setSavedScores),null}return Ud(b,a),b.prototype.defaults={logged:{tw:!1,ig:!1,fb:!1},info:{tw:{name:null,username:null,avatar:null},ig:{name:null,username:null,avatar:null},fb:{name:null,username:null,avatar:null}},data:{tw:null,ig:null,fb:null},scores:{total:{score:null},tw:{total:null},ig:{total:null},fb:{total:null}}},b.prototype.FIRST_SCORE_SET=!1,b.prototype.setup=function(){return this.setUserInfo(),this.getSavedScores(),this.updateTotalScore(!1),null},b.prototype.setUserInfo=function(a){var b,c,d,e;if(a=a||window.config.user,a.logged){c={tw:a.roles.indexOf("ROLE_TWEETER")>-1?!0:!1,ig:a.roles.indexOf("ROLE_INSTAGRAM")>-1?!0:!1,fb:a.roles.indexOf("ROLE_FACEBOOK")>-1?!0:!1},e=a.info;for(d in e)b=e[d],this.set("scores."+d+".total",b.score);this.set("logged",c),this.set("scores.total",a.score),this.set("info",a.info),this.FIRST_SCORE_SET||(this.set("scores.total.lastScore",a.score?a.score:!1),this.FIRST_SCORE_SET=!0)}else this.FIRST_SCORE_SET||(this.set("scores.total.lastScore",!1),this.FIRST_SCORE_SET=!0);return null},b.prototype.updateTotalScore=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;null==a&&(a=!0),h=this.get("scores"),g=0,k=0;for(i in h)f=h[i],"total"!==i&&f.total&&(g++,k+=Math.round(f.total));if(b=k/g){d=function(){switch(!1){case!(b>this.axe().SCORE_BOUND_UPPER):return"tryingTooHard";case!(b<this.axe().SCORE_BOUND_LOWER):return"notHardEnough";default:return"effortless"}}.call(this),c=this.get("scores.total.lastScore")?this.getScoreDifference(this.get("scores.total.lastScore"),b):!1,this.set("scores.total",{score:b,judgement:d,difference:c}),a&&this.trigger("setSavedScores"),e=0,l=this.get("logged");for(i in l)j=l[i],j&&e++;return e>1&&null!=(m=this.axe().appView.milestones)&&m.completeTask("multi_social_connect"),null}},b.prototype.getScoreDifference=function(a,b){return a=Math.round(a)+this.axe().SCORE_RANGE_UPPER,b=Math.round(b)+this.axe().SCORE_RANGE_UPPER,b>a?b-a:-1*(a-b)},b.prototype.setSavedScores=function(){var a,b,c,d,e,f,g;c={score:this.get("scores.total.score")},f=this.get("scores");for(d in f){e=f[d],"total"!==d&&e.total&&(c[d]=e.total);try{window.localStorage.setItem("userscore_"+d,JSON.stringify(e))}catch(h){if(b=h,22===b.code){console.error("Sorry, localStorage limit exceeded, removing saved friends' data and trying to save users' "+d+" data again..."),g=this.axe().appData.FRIENDS.model.toJSON();for(d in g)a=g[d],a.removeSavedFriends();return this.setSavedScores()}}}return Tc.request({url:""+window.config.hostname+"/api/user/score",type:"put",data:c}),null},b.prototype.getSavedScores=function(){var a,b,c;c=this.get("scores");for(b in c)a=c[b],window.localStorage.getItem("userscore_"+b)&&this.get("logged."+b)&&this.set("scores."+b,JSON.parse(window.localStorage.getItem("userscore_"+b)));return null},b.prototype.removeSavedScores=function(){var a,b,c;c=this.get("scores");for(b in c)a=c[b],window.localStorage.getItem("userscore_"+b)&&window.localStorage.removeItem("userscore_"+b);return null},b.prototype.axe=function(){return(window||document).axe},b}(Backbone.DeepModel),P=function(a){function b(){return this.setColors=Vd(this.setColors,this),this.initialize=Vd(this.initialize,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.model=Pb,b.prototype.colors=[13621869,6536607,4110546,15573334,14432581],b.prototype.initialize=function(){return this.on("add remove reset change",this.setColors,this)},b.prototype.setColors=function(){return _.each(this.first(5),function(a){return function(b,c){return b.set("color",a.colors[c])}}(this)),null},b}(Backbone.Collection),Q=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.model=E,b}(Backbone.Collection),R=function(a){function b(){return this.axe=Vd(this.axe,this),this.getTweetCity=Vd(this.getTweetCity,this),this.getRandomCity=Vd(this.getRandomCity,this),this.getUserCity=Vd(this.getUserCity,this),this.setInitialActiveCities=Vd(this.setInitialActiveCities,this),this.setTerritories=Vd(this.setTerritories,this),this.setTrends=Vd(this.setTrends,this),this.addTrends=Vd(this.addTrends,this),this.getCities=Vd(this.getCities,this),this.activeCities=new h,b.__super__.constructor.call(this),this.getCities(),null}return Ud(b,a),b.prototype.url=""+window.config.hostname+"/api/cities",b.prototype.model=M,b.prototype.fetched=!1,b.prototype.activeCities=null,b.prototype.gMap=null,b.prototype.defaultCities=["San Francisco","New York"],b.prototype.countries={usa:1,uk:2},b.prototype.getCities=function(){var a,b,c;c=Sd.axe.startData.cities;for(a in c)b=c[a],this.add(b.cities);return null},b.prototype.addTrends=function(a){return this.fetched?this.setTrends(a):this.on("ready",function(b){return function(){return b.setTrends(a)}}(this)),this},b.prototype.setTrends=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],b.trends.errors||this.findWhere({woeid:b.woeid}).set("trends",b.trends[0].trends);return this.activeCities.trigger("change:primary change:secondary"),null},b.prototype.setTerritories=function(a){var b,c,d,e;for(this.gMap=a,e=this.models,c=0,d=e.length;d>c;c++)b=e[c],b.addToMap(this.gMap);return this.activeCities.set({primary:this.findWhere({name:this.defaultCities[0]}),secondary:this.findWhere({name:this.defaultCities[1]})}),this.fetched=!0,this.trigger("ready"),null},b.prototype.setInitialActiveCities=function(){var a,b,c;return(a=this.axe().countries.getUserCountry())?(b=this.getUserCity(this.countries[a]),c=this.getRandomCity(this.countries[a],b),this.activeCities.set({primary:this.findWhere({name:b}),secondary:this.findWhere({name:c})}),null):void 0},b.prototype.getUserCity=function(a){var b,c,d,e,f,g,h,i,j;for(f=Sd.axe.appData.GEO.geo,g=parseInt(f.lat,10),h=parseInt(f.lon,10),d=this.where({country_id:a}),c={distance:9999999},i=0,j=d.length;j>i;i++)b=d[i],e=wb.distanceBetween(g,h,b.get("lat"),b.get("lng")),e<c.distance&&(c={model:b,distance:e});return c.model.get("name")},b.prototype.getRandomCity=function(a,b){var c;return c=_.filter(this.models,function(c){return c.get("country_id")===a&&c.get("name")!==b}),c[_.random(0,c.length-1)].get("name")},b.prototype.getTweetCity=function(a,b){var c,d,e,f,g;for(null==b&&(b=!1),d=new google.maps.LatLng(a.coordinates[1],a.coordinates[0]),e=b?[this.activeCities.get("primary"),this.activeCities.get("secondary")]:this.models,f=0,g=e.length;g>f;f++)if(c=e[f],c.isInBounds(d))return c.get("woeid");return!1},b.prototype.axe=function(){return(window||document).axe},b}(Backbone.Collection),S=function(a){function b(a,c){return this.axe=Vd(this.axe,this),this.removeSavedFriends=Vd(this.removeSavedFriends,this),this.getSavedFriends=Vd(this.getSavedFriends,this),this.userDataReady=Vd(this.userDataReady,this),this.setSavedFriends=Vd(this.setSavedFriends,this),this.onFriendScoreReceived=Vd(this.onFriendScoreReceived,this),this.addAllFriends=Vd(this.addAllFriends,this),this.sortFriends=Vd(this.sortFriends,this),this.fetch=Vd(this.fetch,this),b.__super__.constructor.call(this),this.service=c.service,this.url=""+window.config.hostname+"/api/"+this.service+"/friends",this.on("friendScoreReceived",this.onFriendScoreReceived),this.axe().appView.on("start",this.getSavedFriends),null}return Ud(b,a),b.prototype.CACHE_TIME=36e5,b.prototype.HAVE_FRIENDS=!1,b.prototype.model=lb,b.prototype.service=null,b.prototype.fetch=function(){var a;return a=Tc.request({url:this.url,type:"get"}),a.done(this.sortFriends),null},b.prototype.sortFriends=function(a){var b,c,d,e,f,g,h;for(d=a.logged_friends,e=_.shuffle(_.filter(a.not_logged_friends,function(a){return a.following_me})),f=_.shuffle(_.filter(a.not_logged_friends,function(a){return!a.following_me})),c=d.concat(e).concat(f),g=0,h=c.length;h>g;g++)b=c[g],b.service=this.service,b.username&&(b.username=b.username.toLowerCase()),"fb"===this.service&&(b.avatar="https://graph.facebook.com/"+b.id+"/picture?type=large");return this.addAllFriends(c),null},b.prototype.addAllFriends=function(a,b){return null==b&&(b=!0),this.add(a),b&&this.setSavedFriends(),this.HAVE_FRIENDS=!0,this.trigger("showFriends"),null},b.prototype.onFriendScoreReceived=function(a){return this.axe().appData.FRIENDS.scores.add(a),this.setSavedFriends(),null},b.prototype.setSavedFriends=function(){var a,b;a={timestamp:Date.now(),data:this.toJSON()};try{window.localStorage.setItem("friendsdata_"+this.service,JSON.stringify(a))}catch(c){b=c,console.error("Sorry, localStorage limit exceeded, unable to save any more friends' scores!")}return null},b.prototype.userDataReady=function(){return this.axe().appData.USER.model.get("info."+this.service+".name")&&(this.axe().appData.USER.model.off("updateUserData",this.userDataReady),this.fetch()),null},b.prototype.getSavedFriends=function(a){var b;return null==a&&(a=!0),a&&this.axe().appView.off("start",this.getSavedFriends),b=JSON.parse(window.localStorage.getItem("friendsdata_"+this.service)),b&&Date.now()-b.timestamp<this.CACHE_TIME?this.addAllFriends(b.data,!1):this.axe().appData.USER.model.get("info."+this.service+".name")?this.fetch():this.axe().appData.USER.model.on("updateUserData",this.userDataReady),this.axe().appData.FRIENDS.scores.initialUpdate(),null},b.prototype.removeSavedFriends=function(){return window.localStorage.removeItem("friendsdata_"+this.service),null},b.prototype.axe=function(){return(window||document).axe},b}(Backbone.Collection),T=function(a){function b(){return this.axe=Vd(this.axe,this),this.update=Vd(this.update,this),this.initialUpdate=Vd(this.initialUpdate,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.model=lb,b.prototype.services=["tw","fb","ig"],b.prototype.initialServicesRecd=0,b.prototype.initialUpdate=function(){return this.initialServicesRecd++,this.initialServicesRecd===this.services.length&&this.update(),null},b.prototype.update=function(){var a,b,c,d,e,f;for(a=[],f=this.services,d=0,e=f.length;e>d;d++)c=f[d],b=this.axe().appData.FRIENDS.model.get(c).filter(function(a){return a.get("score.total")}),a=a.concat(b);return this.add(a),null},b.prototype.axe=function(){return(window||document).axe},b}(Backbone.Collection),U=function(a){function b(){return this.getNotUserColorScheme=Vd(this.getNotUserColorScheme,this),this.deactivateModel=Vd(this.deactivateModel,this),this.activateModel=Vd(this.activateModel,this),this.maxCountReached=Vd(this.maxCountReached,this),this.getActive=Vd(this.getActive,this),this.addUser=Vd(this.addUser,this),this.initialize=Vd(this.initialize,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.model=Hb,b.prototype.maxActiveCount=3,b.prototype.colorSchemes=[{name:"turquoise",lineColor:createjs.Graphics.getRGB(50320),shapeArea:createjs.Graphics.getRGB(50320,.2),pointerColor:50320},{name:"orange",lineColor:createjs.Graphics.getRGB(16754982),shapeArea:createjs.Graphics.getRGB(16754982,.2),pointerColor:16754982},{name:"grey",lineColor:createjs.Graphics.getRGB(6052956),shapeArea:createjs.Graphics.getRGB(6052956,.2),pointerColor:6052956},{name:"pink",lineColor:createjs.Graphics.getRGB(15466722),shapeArea:createjs.Graphics.getRGB(15466722,.2),pointerColor:15466722},{name:"blue",lineColor:createjs.Graphics.getRGB(3409589),shapeArea:createjs.Graphics.getRGB(3409589,.2),pointerColor:3409589}],b.prototype.activeColorSchemes=null,b.prototype.initialize=function(){return this.activeColorSchemes=[],this.on("activate",this.activateModel,this),this.on("deactivate",this.deactivateModel,this)},b.prototype.addUser=function(a){var b,c;return c=this.add(new Hb(a)),b=this.activateModel(c),b?this.colorSchemes[b]:!1},b.prototype.getActive=function(){return this.filter(function(){return function(a){return a.get("active")===!0}}(this))},b.prototype.maxCountReached=function(){return this.getActive().length===this.maxActiveCount},b.prototype.activateModel=function(a){var b,c;return this.maxCountReached()?!1:(b=this.getNotUserColorScheme(),c=this.colorSchemes.indexOf(b),a.set({active:!0,colorScheme:c}),this.activeColorSchemes.push(c),this.trigger("activated",a,b),c)},b.prototype.deactivateModel=function(a){var b;return a.get("active")===!0?(b=this.activeColorSchemes.indexOf(a.get("colorScheme")),this.activeColorSchemes.splice(b,1),a.set({active:!1,colorScheme:null}),this.trigger("deactivated",a)):void 0},b.prototype.getNotUserColorScheme=function(){return _.filter(this.colorSchemes,function(a){return function(b,c){return Wd.call(a.activeColorSchemes,c)<0}}(this))[0]},b}(Backbone.Collection),V=function(a){function b(){return this._removeTweet=Vd(this._removeTweet,this),this.addTweet=Vd(this.addTweet,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.model=Bc,b.prototype.MAX_COUNT=100,b.prototype.addTweet=function(a,b){var c;return c=this.add(a),this.length>this.MAX_COUNT&&this._removeTweet(),b&&setTimeout(function(){return function(){return c.show()}}(this),0),null},b.prototype._removeTweet=function(){var a;return a=this.at(0),a.removeFromMap(function(b){return function(){return b.remove(a),b.length>b.MAX_COUNT?b._removeTweet():void 0}}(this)),null},b}(Backbone.Collection),W=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.model=ld,b}(Backbone.Collection),X=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.model=yd,b}(Backbone.Collection),a=function(){function a(){return this.axe=Vd(this.axe,this),_.extend(this,Backbone.Events),null}return a.prototype.axe=function(){return(window||document).axe},a}(),ab=function(a){function b(){return this.onError=Vd(this.onError,this),this.onResult=Vd(this.onResult,this),this.updateLocationStats=Vd(this.updateLocationStats,this),this.updateSiteStats=Vd(this.updateSiteStats,this),this.crunch_fb=Vd(this.crunch_fb,this),this.crunch_ig=Vd(this.crunch_ig,this),this.crunch_tweet=Vd(this.crunch_tweet,this),this.crunch_tw=Vd(this.crunch_tw,this),this.getCities=Vd(this.getCities,this),this.setCities=Vd(this.setCities,this),this.setAlgoData=Vd(this.setAlgoData,this),this.setAlgoStructure=Vd(this.setAlgoStructure,this),this.loadDependencies=Vd(this.loadDependencies,this),this.setEnvironment=Vd(this.setEnvironment,this),this.setupData=Vd(this.setupData,this),this.setupEvents=Vd(this.setupEvents,this),this.setupMessaging=Vd(this.setupMessaging,this),this.setup=Vd(this.setup,this),b.__super__.constructor.call(this),(!window.Worker||window.forceIframeWorker)&&window.fakeworker.install(),this.worker=new Worker(""+window.config.hostname+"/js/cruncher/cruncher.js"),this.setup(),null}return Ud(b,a),b.prototype.worker=null,b.prototype.task_counter=0,b.prototype.dfds={},b.prototype.ENV="axe.git.unit9.net"===window.location.host?"prototype":"production",b.prototype.ENV="prototype",b.prototype.DEPENDENCIES={underscore:""+window.config.hostname+"/js/vendor/merged/core/__underscore-1.5.2.js"},b.prototype.setup=function(){return this.setEnvironment(),this.loadDependencies(),this.setupData(),this.setupMessaging(),this.setupEvents(),null},b.prototype.setupMessaging=function(){return this.worker.onmessage=function(a){return function(b){switch(b.data.type){case"console":return console[b.data.action](b.data.msg);case"result":return a.trigger("result",{method:b.data.method,result:JSON.parse(b.data.data)});case"error":return a.trigger("error",{code:b.data.code,result:JSON.parse(b.data.data)});default:return console.log("unknown event - ",b)}}}(this),null},b.prototype.setupEvents=function(){return this.on("result",this.onResult),this.on("error",this.onError),null},b.prototype.setupData=function(){var a,b,c,d,e;a=this.axe().algorithm.toJSON(),d=a.behaviours;for(c in d)b=d[c],this.setAlgoStructure(c,b);e=a.keys;for(c in e)b=e[c],this.setAlgoData(c,b);return null},b.prototype.setEnvironment=function(){return this.worker.postMessage({type:"setEnvironment",data:this.ENV}),null},b.prototype.loadDependencies=function(){var a,b,c;c=this.DEPENDENCIES;for(a in c)b=c[a],this.worker.postMessage({type:"loadDependency",data:b});return null},b.prototype.setAlgoStructure=function(a,b){return this.worker.postMessage({type:"setAlgoStructure",site:a,data:JSON.stringify(b)}),null},b.prototype.setAlgoData=function(a,b){return this.worker.postMessage({type:"setAlgoData",site:a,data:JSON.stringify(b)}),null},b.prototype.setCities=function(a){return this.worker.postMessage({type:"setCities",data:JSON.stringify(a)}),null},b.prototype.getCities=function(){var a;
return a={task_id:this.task_counter++},this.worker.postMessage({type:"getCities",data:JSON.stringify(a)}),this.dfds[a.task_id]=$.Deferred(),null},b.prototype.crunch_tw=function(a){return a.task_id=this.task_counter++,this.worker.postMessage({type:"crunchTwitter",data:JSON.stringify(a)}),this.dfds[a.task_id]=$.Deferred()},b.prototype.crunch_tweet=function(a){return a.task_id=this.task_counter++,this.worker.postMessage({type:"crunchTweet",data:JSON.stringify(a)}),this.dfds[a.task_id]=$.Deferred()},b.prototype.crunch_ig=function(a){return a.task_id=this.task_counter++,this.worker.postMessage({type:"crunchInstagram",data:JSON.stringify(a)}),this.dfds[a.task_id]=$.Deferred()},b.prototype.crunch_fb=function(a){return a.task_id=this.task_counter++,this.worker.postMessage({type:"crunchFacebook",data:JSON.stringify(a)}),this.dfds[a.task_id]=$.Deferred()},b.prototype.updateSiteStats=function(a){return a.task_id=this.task_counter++,this.worker.postMessage({type:"updateSiteStats",data:JSON.stringify(a)}),this.dfds[a.task_id]=$.Deferred()},b.prototype.updateLocationStats=function(a){return a.task_id=this.task_counter++,this.worker.postMessage({type:"updateLocationStats",data:JSON.stringify(a)}),this.dfds[a.task_id]=$.Deferred()},b.prototype.onResult=function(a){var b;return null!=(b=this.dfds[a.result.task_id])&&b.resolve(a.result),delete this.dfds[a.result.task_id],null},b.prototype.onError=function(a){var b;return null!=(b=this.dfds[a.result.task_id])&&b.reject(a.code),delete this.dfds[a.result.task_id],null},b}(a),sb=function(a){function b(){return this.getFriends=Vd(this.getFriends,this),this.model=new tb,this.scores=new T,this.cruncher=this.axe().cruncher,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.model=null,b.prototype.cruncher=null,b.prototype.getFriends=function(a){return this.model.get(a).fetch(),null},b}(a),xb=function(a){function b(){return this.updateData=Vd(this.updateData,this),this.processTweets=Vd(this.processTweets,this),this.startTimer=Vd(this.startTimer,this),this.onSocketMsg=Vd(this.onSocketMsg,this),this.bindEvents=Vd(this.bindEvents,this),this.model=new yb,this.cruncher=this.axe().cruncher,b.__super__.constructor.call(this),this.bindEvents(),null}return Ud(b,a),b.prototype.model=null,b.prototype.cruncher=null,b.prototype.timer=null,b.prototype.tweetPool=[],b.prototype.INTERVAL=1500,b.prototype.SAMPLE_SIZE=.14285714285714285,b.prototype.DEEPVIEW_VISIBLE=!1,b.prototype.bindEvents=function(){return this.axe().socket.on("message",this.onSocketMsg),this.startTimer(),null},b.prototype.onSocketMsg=function(a){return this.tweetPool=this.tweetPool.concat(JSON.parse(a.data).tweets),null},b.prototype.startTimer=function(){return this.timer=setInterval(function(a){return function(){return a.processTweets()}}(this),this.INTERVAL),null},b.prototype.processTweets=function(){var a,b;return b=this.tweetPool.slice(0,Math.round(this.tweetPool.length*this.SAMPLE_SIZE)),a=this.cruncher.updateSiteStats({tweets:b}).done(this.updateData),this.tweetPool=[],null},b.prototype.updateData=function(a){return this.model.set(a.currentStats),null},b}(a),kc=function(a){function b(){return this.processTweet=Vd(this.processTweet,this),this.checkTweet=Vd(this.checkTweet,this),this.onSocketMsg=Vd(this.onSocketMsg,this),this.bindEvents=Vd(this.bindEvents,this),this.setup=Vd(this.setup,this),this.model=new lc,this.tweets=new V,this.cruncher=this.axe().cruncher,this.cities=this.axe().cities,b.__super__.constructor.call(this),this.cities.fetched?this.setup():this.cities.on("ready",this.setup),null}return Ud(b,a),b.prototype.model=null,b.prototype.tweets=null,b.prototype.cruncher=null,b.prototype.cities=null,b.prototype.DEEPVIEW_VISIBLE=!1,b.prototype.setup=function(){return this.cruncher.setCities(this.axe().cities.toJSON()),this.bindEvents(),null},b.prototype.bindEvents=function(){return this.axe().socket.on("message",this.onSocketMsg),null},b.prototype.onSocketMsg=function(a){var b,c,d,e;for(e=JSON.parse(a.data).tweets,c=0,d=e.length;d>c;c++)b=e[c],this.checkTweet(b);return null},b.prototype.checkTweet=function(a){return a.coordinates?(this.DEEPVIEW_VISIBLE||this.tweets.length<this.tweets.MAX_COUNT?this.axe().countries.tweetInBounds(a)&&(a.woeid=this.axe().cities.getTweetCity(a),this.processTweet(a)):(a.woeid=this.axe().cities.getTweetCity(a),a.woeid&&this.processTweet(a,!0)),null):void 0},b.prototype.processTweet=function(a,b){var c;return null==b&&(b=!1),c=a.woeid,c&&this.cruncher.updateLocationStats({tweet:a,woeid:c}).done(function(a){return function(b){return a.model.set(b.currentStats)}}(this)),b?void 0:(this.cruncher.crunch_tweet(a).done(function(a){return function(b){var d;return(d=b.score)?(d.woeid=c,a.tweets.addTweet(d,a.DEEPVIEW_VISIBLE)):void 0}}(this)),null)},b}(a),Hd=function(a){function b(){return this.isLogged=Vd(this.isLogged,this),this.isUser=Vd(this.isUser,this),this.scoreFail=Vd(this.scoreFail,this),this.scoreReceived=Vd(this.scoreReceived,this),this.postsReceived=Vd(this.postsReceived,this),this.userReceived=Vd(this.userReceived,this),this.profileReceived=Vd(this.profileReceived,this),this._getScore=Vd(this._getScore,this),this._getPosts=Vd(this._getPosts,this),this._getProfile=Vd(this._getProfile,this),this._getUser=Vd(this._getUser,this),this.getAllData=Vd(this.getAllData,this),this.onStatusChange=Vd(this.onStatusChange,this),this.checkInitialData=Vd(this.checkInitialData,this),this.bindEvents=Vd(this.bindEvents,this),this.model=new Jd,this.status=new Id,this.cruncher=this.axe().cruncher,b.__super__.constructor.call(this),this.bindEvents(),null}return Ud(b,a),b.prototype.model=null,b.prototype.cruncher=null,b.prototype.userReq=null,b.prototype.infoReq=null,b.prototype.dataReq=null,b.prototype.bindEvents=function(){return this.model.on("change:logged.* change:scores.*",this.onStatusChange),this.onStatusChange(),null},b.prototype.checkInitialData=function(){return window.config.user.logged&&!this.status.get("any")&&this.axe().auth.logout(),null},b.prototype.onStatusChange=function(){var a,b,c,d;a={any:!1},d=this.model.get("scores");for(c in d)b=d[c],"total"!==c&&b.total&&b.judgement&&(a[c]=!0,a.any=!0);return this.status.set(a),null},b.prototype.getAllData=function(a){return this.axe().appView.activeService.set("service",a),this.axe().appView.loader.show(),this.userReq=this._getUser(),this.infoReq=this._getProfile(a),this.dataReq=this._getPosts(a),$.when(this.userReq,this.infoReq,this.dataReq).done(function(b){return function(){return b._getScore(a)}}(this)),null},b.prototype._getUser=function(){var a;return a=Tc.request({url:""+window.config.hostname+"/api/user",type:"get"}),a.done(this.userReceived),a},b.prototype._getProfile=function(a){var b;return b="fb"===a?ib.getUser({id:"me",done:function(b){return function(c){return b.profileReceived(a,c)}}(this)}):Tc.request({url:""+window.config.hostname+"/api/"+a+"/me",type:"get",done:function(b){return function(c){return b.profileReceived(a,c)}}(this)})},b.prototype._getPosts=function(a){var b,c;return"fb"===a?c=ib.getPosts({id:"me",done:function(b){return function(c){return b.postsReceived(a,c.data)}}(this)}):(b="tw"===a?"tweets":"posts",c=Tc.request({url:""+window.config.hostname+"/api/"+a+"/"+b,type:"get",done:function(b){return function(c){return b.postsReceived(a,c)}}(this)})),c},b.prototype._getScore=function(a){var b;return b=this.cruncher["crunch_"+a]({userProfile:this.model.get("data."+a+".userProfile"),userPosts:this.model.get("data."+a+".userPosts")}),b.done(function(b){return function(c){return b.scoreReceived(a,c)}}(this)),b.fail(this.scoreFail),null},b.prototype.profileReceived=function(a,b){return this.model.set("data."+a+".userProfile",b),null},b.prototype.userReceived=function(a){return this.model.setUserInfo(a),this.axe().appView.loader.show("user"),null},b.prototype.postsReceived=function(a,b){return this.model.set("data."+a+".userPosts",b),null},b.prototype.scoreReceived=function(a,b){return this.model.set("scores."+a,b.score),this.model.updateTotalScore(),this.model.trigger("scoreUpdate",a),this.axe().appView.loader.show("score"),this.axe().appData.FRIENDS.getFriends(a),null},b.prototype.scoreFail=function(a){return console.log("FAIL",a),this.axe().appView.loader.show("error",1),null},b.prototype.isUser=function(a,b){return b.toLowerCase()===this.model.get("info."+a+".username").toLowerCase()?!0:!1},b.prototype.isLogged=function(){var a,b,c;c=this.model.get("logged");for(a in c)if(b=c[a])return!0;return!1},b}(a),m=function(a){function b(){return this.start=Vd(this.start,this),this.USER=new Hd,this.FRIENDS=new sb,this.GLOBAL_STATS=new xb,this.LOCATION_STATS=new kc,this.axe().IS_MOBILE||(this.TAGS=new Backbone.Collection(window.hashtags),this.ACTIVE_TAGS=new P(this.TAGS.first(_b.numOfCols)),this.ACTIVE_TAGS.setColors()),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.accepted_tc=!1,b.prototype.USER=null,b.prototype.FRIENDS=null,b.prototype.GLOBAL_STATS=null,b.prototype.LOCATION_STATS=null,b.prototype.LAST_TWEETS=null,b.prototype.TAGS=null,b.prototype.ACTIVE_TAGS=null,b.prototype.SHARE_DATA=null,b.prototype.API={LOCALE:""+window.config.hostname+"/api/l10n/",START:""+window.config.hostname+"/api/start"},b.prototype.start=function(a){return a=a||Sd.axe.startData,this.GEO=a.geo[0]||null,this.LAST_TWEETS=a.tweets||{},this.axe().cities.addTrends(a.trends).setInitialActiveCities(),this.trigger("startDataReceived"),null},b}(a),l=function(){function a(a,b){return this.callback=b,this.track=Vd(this.track,this),this.onTagsReceived=Vd(this.onTagsReceived,this),$.getJSON(a,this.onTagsReceived),null}return a.prototype.tags=null,a.prototype.started=!1,a.prototype.onTagsReceived=function(a){return this.tags=a.data,this.started=!0,"function"==typeof this.callback?this.callback():void 0},a.prototype.track=function(a){var b,c,d,e,f;if(this.started&&Sd.axe.LIVE){if(a&&(d=this.tags[a])){for(c=["send","event"],e=0,f=d.length;f>e;e++)b=d[e],c.push(b);ga.apply(null,c)}return null}},a}(),o=function(a){function b(a){return this.config=a,this.hideLoader=Vd(this.hideLoader,this),this.showLoader=Vd(this.showLoader,this),this.handleFbLoginResult=Vd(this.handleFbLoginResult,this),this.onLogoutDone=Vd(this.onLogoutDone,this),this.removeUser=Vd(this.removeUser,this),this.logout=Vd(this.logout,this),this.callback=Vd(this.callback,this),this.closeWindow=Vd(this.closeWindow,this),this.openWindow=Vd(this.openWindow,this),this.login=Vd(this.login,this),this.userData=this.axe().appData.USER,this.userModel=this.userData.model,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.config=null,b.prototype.userData=null,b.prototype.userModel=null,b.prototype.process=!1,b.prototype.$target=null,b.prototype.spinner=null,b.prototype.spinOpts={lines:17,length:0,width:3,radius:6,corners:0,rotate:0,trail:100,speed:2,color:"#fff",shadow:!1,direction:1,hwaccel:!0},b.prototype.login=function(a,b){var c;for(null!=(c=this.$target)&&c.removeClass("loading"),this.$target=b,this.showLoader(),this.process&&this.window&&this.window.focus();this.process;)return;if(this.activeService=a,this.retryCount=this.config.retry_count,this.userModel.get("logged."+a))return"fb"===a?ib.checkStatus(function(a){return function(b){return b?a.userData.getAllData("fb"):ib.login(!0,function(b){return"connected"!==b.status?a.hideLoader():void 0})}}(this)):this.userData.getAllData(a),void 0;switch(a){case"tw":this.openWindow(this.config.twitter_url);break;case"ig":this.openWindow(this.config.instagram_url);break;case"fb":ib.login(!0,function(a){return function(b){return"connected"!==b.status?a.hideLoader():void 0}}(this))}return this.process=!0,null},b.prototype.openWindow=function(a){var b,c,d,e,f,g;return this.currentUrl=a,g=680,b=540,c=screen.availWidth-g>>1,f=screen.availHeight-b>>1,d="width="+g+",height="+b+",top="+f+",left="+c+",location=0,menubar=0,scrollbars=0,status=0,toolbar=0,resizable=0",this.window=window.open(a,"loginWindow",d),e=setInterval(function(a){return function(){var b;return a.window.closed?(clearInterval(e),a.process=!1,a.hideLoader(),null!=(b=a.$target)?b.removeClass("loading"):void 0):void 0}}(this),1e3),null},b.prototype.closeWindow=function(){return this.window&&this.window.close(),null},b.prototype.callback=function(a,b){var c;return"facebook"!==a&&this.hideLoader(),a=function(){switch(a){case"twitter":return"tw";case"instagram":return"ig";case"facebook":return"fb"}}(),"fb"===a?this.handleFbLoginResult(b):(b.error&&this.retryCount>0&&(this.retryCount--,this.openWindow(this.currentUrl)),this.closeWindow(),b.logged?(this.userModel.set("logged."+a,!0),this.userData.getAllData(a),this.trigger("login",this.userData)):(c="tw"===a?1:3,this.axe().appView.showErrorModal(c)),this.process=!1,null)},b.prototype.logout=function(a){var b;return null==a&&(a=!1),b=Tc.request({url:""+this.axe().BASE_PATH+"/api/user/"+(a?"remove":"logout"),type:"get"}),b.done(function(a){return function(){return a.userModel.get("logged.fb")&&window.config.fb_access_token?ib.logout(a.onLogoutDone):a.onLogoutDone()}}(this)),null},b.prototype.removeUser=function(){return this.logout(!0),null},b.prototype.onLogoutDone=function(){var a,b,c,d;this.userModel.removeSavedScores(),c=this.axe().appData.FRIENDS.model.toJSON();for(b in c)a=c[b],a.removeSavedFriends();return null!=(d=this.axe().appView.milestones)&&d.reset(),window.location.href=window.config.hostname,null},b.prototype.handleFbLoginResult=function(a){return ib.getDataOnSuccess=!1,"connected"===a.status?$.getJSON("/api/user",function(a){return function(b){var c;return b.logged?(a.userModel.set("logged.fb",!0),a.userData.getAllData("fb"),a.trigger("login",a.userData),null!=(c=a.$target)&&c.removeClass("loading"),a.hideLoader()):a.axe().appView.showErrorModal(2)}}(this)):this.axe().appView.showErrorModal(2),null},b.prototype.showLoader=function(){var a;return null!=(a=this.spinner)&&a.stop(),this.spinner=new Spinner(this.spinOpts).spin(this.$target.find("[data-spin]")[0]),setTimeout(function(a){return function(){return a.$target.addClass("loading")}}(this),500),null},b.prototype.hideLoader=function(){return this.$target.removeClass("loading"),setTimeout(function(a){return function(){var b;return null!=(b=a.spinner)&&b.stop(),a.spinner=null}}(this),500),null},b}(a),bb=function(){function a(){}return a.key="axematteeffect",a.decode=function(b){var c,d;return d=""+window.config.hostname+"/view/",b.indexOf(d)>-1&&(b=b.split(d)[1]),c=window.GibberishAES.dec(b,a.key),c=$.deparam(c)},a.encode=function(b){var c,d;return d=decodeURIComponent($.param(b)),c=window.GibberishAES.enc(d,a.key),c=c.replace(/(\r\n|\n|\r)/gm,""),c=window.config.hostname+"/view/"+c},a}(),fb=function(){function a(){}return a.prototype.vh=null,a.prototype.vw=null,a.MAX_MOBILE_WIDTH=750,a.MAX_MOBILE_HEIGHT=800,a.MIN_DESKTOP_WIDTH=1024,a.viewportMetaFlex='<meta name="viewport" id="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />',a.viewportMetaFixed='<meta name="viewport" id="viewport" content="width=1024, user-scalable=no" />',a.isMobile=function(){return this.vw=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.vh=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,this.vw<this.MAX_MOBILE_WIDTH&&this.vh<this.MAX_MOBILE_HEIGHT||this.vw<this.MAX_MOBILE_HEIGHT&&this.vh<this.MAX_MOBILE_WIDTH?!0:!1},a.isSmallNonMobile=function(a){if(!a){if(this.vw<this.MIN_DESKTOP_WIDTH)return!0;if(window.hasOwnProperty("orientation")){if(0===window.orientation){if(this.vw<this.MIN_DESKTOP_WIDTH)return!0}else if((90===window.orientation||-90===window.orientation)&&this.vh<this.MIN_DESKTOP_WIDTH)return!0;return!1}return!1}},a.setViewportMeta=function(a){return a&&$("#viewport").replaceWith(this.viewportMetaFixed),null},a}(),ib=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.connected=!1,b.accessToken=null,b.permissions="friends_status, read_stream, user_friends, publish_actions",b.getDataOnSuccess=!1,b.init=function(){return FB.init({appId:window.config.fb_app_id,status:!0,xfbml:!0}),FB.Event.subscribe("auth.authResponseChange",function(a){var c;return b.accessToken=window.config.fb_access_token=null!=(c=a.authResponse)?c.accessToken:void 0,"connected"===a.status?FB.api("/me",function(c){var d;return d=Tc.request({url:""+window.config.hostname+"/api/user/fb/auth",type:"POST",data:{facebook_id:c.id,access_token:window.config.fb_access_token}}),d.done(function(c){return b.accessToken=window.config.fb_access_token=c.access_token,b.getDataOnSuccess?window.axe.auth.callback("facebook",a):void 0}),d.fail(function(){return Sd.axe.appView.showErrorModal(2)})}):void 0}),null},b.login=function(a,c){return b.getDataOnSuccess=null!=a?a:!1,null==c&&(c=null),FB.login(function(a){return"function"==typeof c&&c(a),window.axe.auth.process=!1},{scope:b.permissions}),null},b.logout=function(a){return null==a&&(a=null),FB.logout(a),null},b.checkStatus=function(a){return null==a&&(a=null),FB.getLoginStatus(function(b){var c;return c="connected"===b.status?!0:!1,a(c)})},b.getUser=function(a){var b;return null==a&&(a={id:"me",done:"callback"}),b=$.Deferred(),FB.api("/"+a.id,function(c){return a.done(c),b.resolve(c)}),b},b.getPosts=function(a){var b;return null==a&&(a={id:"me",done:"callback"}),b=$.Deferred(),FB.api("/"+a.id+"/posts",{limit:100},function(c){return a.done(c),b.resolve(c)}),b},b.getFriends=function(a){var b;return null==a&&(a={id:"me",done:"callback"}),b=$.Deferred(),FB.api("/"+a.id+"/friends",function(c){return a.done(c),b.resolve(c)}),b},b.getUserAvatar=function(a,b){var c;return null==b&&(b={}),b={redirect:b.redirect||!1,height:b.height||"500",width:b.width||"500",type:b.type||"normal"},c=$.Deferred(),FB.api("/"+a+"/picture",b,function(a){return c.resolve(a.data.url)}),c},b.postImage=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;for(c=a.authToken||window.config.fb_access_token,e=a.filename||"Axe Social Effort Scale",j=a.mimeType||"image/png",h=a.imageData,i=a.message,k=a.tags?"&tags="+a.tags:"",d="----ThisIsTheBoundary1234567890",f="--"+d+"\r\n",f+='Content-Disposition: form-data; name="source"; filename="'+e+'"\r\n',f+="Content-Type: "+j+"\r\n\r\n",g=m=0,n=h.length;n>=0?n>m:m>n;g=n>=0?++m:--m)f+=String.fromCharCode(255&h[g]);return f+="\r\n",f+="--"+d+"\r\n",f+='Content-Disposition: form-data; name="message"\r\n\r\n',f+=i+"\r\n",f+="--"+d+"--\r\n",l=new XMLHttpRequest,l.open("POST","https://graph.facebook.com/me/photos?access_token="+c+k,!0),l.onload=function(){return b.resolve(l.responseText)},l.onerror=l.onabort=function(){return b.reject(l.responseText)},l.setRequestHeader("Content-Type","multipart/form-data; boundary="+d),l.sendAsBinary(f),null},b.share=function(a,b){return FB.ui({method:a.method||"feed",name:a.name||"",link:a.link||"",picture:a.picture||"",caption:a.caption||"",description:a.description||""},function(a){return"function"==typeof b?b(a):void 0}),null},b}(a),ib.init(),wb=function(){function a(){}return a.distanceBetween=function(a,b,c,d){var e,f,g,h,i,j;return e=6371,i=Ic.toRadians(c-a),j=Ic.toRadians(d-b),a=Ic.toRadians(a),c=Ic.toRadians(c),f=Math.sin(i/2)*Math.sin(i/2)+Math.sin(j/2)*Math.sin(j/2)*Math.cos(a)*Math.cos(c),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=e*g},a}(),Xb=function(){function a(){}return a.trimCanvasData=function(b,c,d){var e,f,g,h;return g=$.Deferred(),e=document.createElement("canvas"),e.width=c,e.height=d,f=e.getContext("2d"),h=new Image,h.onload=function(){var b;return f.drawImage(h,0,0),b=a.trimCanvas(e),g.resolve(b)},h.src=b,g},a.trimCanvas=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(d=a.getContext("2d"),c=document.createElement("canvas").getContext("2d"),g=d.getImageData(0,0,a.width,a.height),f=g.data.length,e=null,k=null,l=null,b={top:null,left:null,right:null,bottom:null},e=m=0;f>m;e=m+=4)0!==g.data[e+3]&&(k=e/4%a.width,l=~~(e/4/a.width),null===b.top&&(b.top=l),null===b.left?b.left=k:k<b.left&&(b.left=k),null===b.right?b.right=k:b.right<k&&(b.right=k),null===b.bottom?b.bottom=l:b.bottom<l&&(b.bottom=l));return h=b.bottom-b.top,i=b.right-b.left,j=d.getImageData(b.left,b.top,i,h),c.canvas.width=i,c.canvas.height=h,c.putImageData(j,0,0),c.canvas.toDataURL("image/png")},a}(),ic=function(){function a(a,b){this.getLocaleImage=Vd(this.getLocaleImage,this),this.get=Vd(this.get,this),this.loadBackup=Vd(this.loadBackup,this),this.onSuccess=Vd(this.onSuccess,this),this.getLang=Vd(this.getLang,this),this.callback=b,this.backup=a,this.lang=this.getLang(),$.ajax({url:window.config.hostname+"/api/l10n/"+this.lang,dataType:"json",success:this.onSuccess,error:this.loadBackup})}return a.prototype.lang=null,a.prototype.data=null,a.prototype.callback=null,a.prototype.backup=null,a.prototype.getLang=function(){var a;return a=window.location.search&&window.location.search.match("locale=")?window.location.search.split("locale=")[1].split("&")[0]:window.config.localeCode?window.config.localeCode:"en_gb"},a.prototype.onSuccess=function(a){var b;return b=null,b=a.responseText?JSON.parse(a.responseText):a,this.data=new jc(b),"function"==typeof this.callback&&this.callback(),null},a.prototype.loadBackup=function(){return $.ajax({url:this.backup,dataType:"text",complete:this.onSuccess,error:function(){return function(){return console.log("error on loading backup")}}(this)}),null},a.prototype.get=function(a){return this.data.getString(a)},a.prototype.getLocaleImage=function(a){return window.config.CDN+"/images/locale/"+window.config.localeCode+"/"+a},a}(),Ec=function(){function a(){this.axe=Vd(this.axe,this),this.reset=Vd(this.reset,this),this.saveTasksStatus=Vd(this.saveTasksStatus,this),this.getTasksStatus=Vd(this.getTasksStatus,this),this.checkTask=Vd(this.checkTask,this),this.getNextTask=Vd(this.getNextTask,this),this.completeTask=Vd(this.completeTask,this);var a;return a=JSON.parse(this.getTasksStatus()),a&&(this.tasks=a.tasks),null}return a.prototype.tasks=[{name:"friend_click",status:!1},{name:"compare_multi_friends",status:!1},{name:"dashboard_scroll",status:!1},{name:"shared",status:!1},{name:"seen_breakdown",status:!1},{name:"multi_social_connect",status:!1},{name:"seen_city_compare",status:!1}],a.prototype.completeTask=function(a){var b;return b=_.findWhere(this.tasks,{name:a}),b.status||(b.status=!0,this.saveTasksStatus()),null},a.prototype.getNextTask=function(){var a,b,c,d;for(d=this.tasks,b=0,c=d.length;c>b;b++)if(a=d[b],!a.status)return this.checkTask(a.name)?a.name:(this.completeTask(a.name),this.getNextTask());return!1},a.prototype.checkTask=function(a){return"friend_click"===a&&"fb"===this.axe().appView.activeService.get("service")?!1:"compare_multi_friends"===a&&"fb"===this.axe().appView.activeService.get("service")?!1:!0},a.prototype.getTasksStatus=function(){return window.localStorage?window.localStorage.getItem("user_milestones"):void 0},a.prototype.saveTasksStatus=function(){var a;if(window.localStorage)return a={timestamp:{timestamp:Date.now()},tasks:this.tasks},window.localStorage.setItem("user_milestones",JSON.stringify(a)),null},a.prototype.reset=function(){return window.localStorage.getItem("user_milestones")?window.localStorage.removeItem("user_milestones"):void 0},a.prototype.axe=function(){return(window||document).axe},a}(),Ic=function(){function a(){}return a.MATH_COS=Math.cos,a.MATH_SIN=Math.sin,a.MATH_RANDOM=Math.random,a.MATH_ABS=Math.abs,a.MATH_ATAN2=Math.atan2,a.limit=function(a,b,c){return Math.min(Math.max(b,a),c)},a.map=function(a,b,c,d,e,f,g,h){var i,j;return null==f&&(f=!1),null==g&&(g=!0),null==h&&(h=!0),g&&b>a?d:h&&a>c?e:(i=(a-b)/(c-b),j=i*(e-d)+d,f?Math.round(j):j)},a.getNiceScore=function(a){return a>0?"+"+Math.round(a):Math.round(a)},a.getRandomColor=function(){var a,b,c,d;for(c="0123456789ABCDEF".split(""),a="#",b=d=0;6>d;b=++d)a+=c[Math.round(15*Math.random())];return a},a.getTimeStampDiff=function(a,b){var c,d,e;return d=a-b,c=Math.floor(d/86400),e={},0===c?60>d?e.seconds=0:120>d?e.minutes=1:3600>d?e.minutes=Math.floor(d/60):7200>d?e.hours=1:86400>d&&(e.hours=Math.floor(d/3600)):e.days=c,e},a.map=function(a,b,c,d,e,f,g,h){var i,j;return null==f&&(f=!1),null==g&&(g=!0),null==h&&(h=!0),g&&b>a?d:h&&a>c?e:(i=(a-b)/(c-b),j=i*(e-d)+d,f?Math.round(j):j)},a.toRadians=function(a){return a*(Math.PI/180)},a.toDegree=function(a){return a*(180/Math.PI)},a.isInRange=function(a,b,c,d){return d?a>=b&&c>=a:a>=b&&c>=a},a}(),Hc=function(){function a(){}return a.TRANSITION=.3,a.MAX_DELAY=150,a.setup=function(b,c){var d;return null==c&&(c=!1),d=c||b.text().split(""),b.html(a.wrap(d,b.data("numtransition"))),null},a.update=function(b,c){var d,e;return d=b.find(".char"),e=a.wrap(c.toString(),b.data("numtransition")),d.each(function(b){return d.eq(b).text()!==e.eq(b).text()?a.updateChar(d.eq(b),e.eq(b).text()):void 0}),null},a.clear=function(b){var c;return c=b.find(".char"),c.each(function(b){return a.clearChar(c.eq(b))}),null},a.wrap=function(a,b){var c,d,e,f,g;if(f=function(){var b,d,e;for(e=[],b=0,d=a.length;d>b;b++)c=a[b],e.push('<span class="char"><span class="old">'+c+"</span></span>");return e}(),d=b-a.length,d>0)for(e=g=0;d>=0?d>g:g>d;e=d>=0?++g:--g)f.unshift('<span class="char"><span class="old"></span></span>');return $(f.join(""))},a.updateChar=function(b,c){var d,e,f,g,h;return g=" "===c?" space":"",b.append('<span class="new'+g+'">'+c+"</span>"),d=b.find(".new"),f=d.height(),h=d.width(),e=_.random(0,a.MAX_DELAY)/1e3,TweenLite.to(b.find(".old"),a.TRANSITION,{delay:e+.1,top:-f,ease:Back.easeInOut,onComplete:a.removeOldChar,onCompleteParams:[b]}),TweenLite.to(b.find(".new"),a.TRANSITION,{delay:e+.1,top:"0",opacity:1,ease:Back.easeInOut}),TweenLite.to(b,.1,{delay:e,width:h,height:f}),null},a.clearChar=function(b){var c,d,e,f;return c=b.find(".old"),e=c.height(),f=c.width(),d=_.random(0,a.MAX_DELAY)/1e3,TweenLite.to(c,a.TRANSITION,{delay:d+.1,top:e,ease:Back.easeInOut,onComplete:a.removeOldChar,onCompleteParams:[b]}),null},a.removeOldChar=function(a){return a.find(".old").remove().end().find(".new").removeClass("new").addClass("old"),null},a}(),Pc=function(){function a(){}return a.getRichText=function(b,c){var d;return d=function(){switch(!0){case"twitter"===b:return a._getRichText_TW(c);case"instagram"===b:return a._getRichText_IG(c)}}()},a._getRichText_TW=function(a){var b;return b=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,a=a.replace(b,"<a href='$1' target='_blank'>$1</a>"),b=/#(\w+)/g,a=a.replace(b,"<a href='http://twitter.com/search?q=%23$1' target='_blank'>#$1</a>"),b=/@(\w+)/g,a=a.replace(b,"<a href='http://www.twitter.com/$1' target='_blank'>@$1</a>"),a=minEmoji(a)},a._getRichText_IG=function(a){var b;return b=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,a=a.replace(b,"<a href='$1' target='_blank'>$1</a>"),b=/@(\w+)/g,a=a.replace(b,"<a href='http://www.instagram.com/$1' target='_blank'>@$1</a>"),a=minEmoji(a)},a.getNameLink=function(b,c){var d;return d=function(){switch(!0){case"twitter"===b:return a._getNameLink_TW(c);case"instagram"===b:return a._getNameLink_IG(c)}}()},a._getNameLink_TW=function(a){return'<a href="http://twitter.com/'+a.user.screen_name+'" target="_blank">'+a.user.name+"</a>"},a._getNameLink_IG=function(a){return'<a href="http://instagram.com/'+a.user.username+'" target="_blank">'+a.user.full_name+"</a>"},a.getUsernameLink=function(b,c){var d;return d=function(){switch(!0){case"twitter"===b:return a._getUsernameLink_TW(c);case"instagram"===b:return a._getUsernameLink_IG(c)}}()},a._getUsernameLink_TW=function(a){return'<a href="http://twitter.com/'+a.user.screen_name+'" target="_blank">@'+a.user.screen_name+"</a>"},a._getUsernameLink_IG=function(a){return'<a href="http://instagram.com/'+a.user.username+'" target="_blank">@'+a.user.username+"</a>"},a.getDateLink=function(b,c){var d;return d=function(){switch(!0){case"twitter"===b:return a._getDateLink_TW(c);case"instagram"===b:return a._getDateLink_IG(c)}}()},a._getDateLink_TW=function(b){return'<a href="'+b.source.twitter+'" target="_blank">'+a.getTimeAgo(b.created)+"</a>"},a._getDateLink_IG=function(b){return'<a href="'+b.source.instagram+'" target="_blank">'+a.getTimeAgo(b.created)+"</a>"},a.getTimeAgo=function(a){var b,c,d,e,f,g,h,i,j;if(j=null,i=null,h=null,g=Date.now(),d=g-a,6e4>d)j=Math.round(d/1e3),i="second";else if(36e5>d)j=Math.round(d/1e3/60),i="minute";else if(864e5>d)j=Math.round(d/1e3/60/60),i="hour";else{if(!(6048e5>d))return c=new Date(a),f=c.getMinutes(),f=10>f?"0"+f:f,e=c.getHours(),b=e>11?"pm":"am",e=e>11?e-12:e,e=0===e?12:e,""+e+":"+f+b+", "+c.toDateString();j=Math.round(d/1e3/60/60/24),i="day"}return h=j>1?"s":"",""+j+" "+i+h+" ago"},a}(),Tc=function(){function a(){}return a.requests=[],a.request=function(a){var b;return b=$.ajax({url:a.url,type:a.type?a.type:"POST",data:a.data?a.data:null,dataType:a.dataType?a.dataType:"json",contentType:a.contentType?a.contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:null!==a.processData&&void 0!==a.processData?a.processData:!0}),b.done(a.done),b.fail(a.fail),b},a.send=function(a,b){var c,d,e,f;c=new FormData;for(d in b)e=b[d],c.append(d,e);return f=new XMLHttpRequest,f.open("POST",a,!0),f.onload=function(a){return console.log(a)},f.send(c),null},a.addImage=function(b,c,d){return a.request({url:"/api/images/",type:"POST",data:{image_base64:encodeURI(b)},done:c,fail:d}),null},a.deleteImage=function(b,c,d){return a.request({url:"/api/images/"+b,type:"DELETE",done:c,fail:d}),null},a}(),Wc=function(){function a(){}return a.openWin=function(a,b,c){var d,e;return d=screen.availWidth-b>>1,e=screen.availHeight-c>>1,window.open(a,"","top="+e+",left="+d+",width="+b+",height="+c+",location=no,menubar=no"),null},a.plus=function(b){return b=b||(window||document).axe.BASE_PATH,a.openWin("https://plus.google.com/share?url="+encodeURI(b+"?l10n="+window.__localeCode),650,385),null},a.pinterest=function(b,c,d){return b=encodeURIComponent(b),c=encodeURIComponent(c),d=encodeURIComponent(d),a.openWin("http://www.pinterest.com/pin/create/button/?url="+b+"&media="+c+"&description="+d,735,310),null},a.tumblr=function(b,c,d){return b=encodeURIComponent(b),c=encodeURIComponent(c),d=encodeURIComponent(d),a.openWin("http://www.tumblr.com/share/photo?source="+c+"&caption="+d+"&click_thru="+b,450,430),null},a.facebook=function(b,c){var d;return null==c&&(c=""),b=b||(window||document).axe.BASE_PATH,d=encodeURIComponent(c),a.openWin("http://www.facebook.com/share.php?u="+encodeURI(""+b+"?l10n="+window.__localeCode)+("&t="+d),600,300),null},a.twitter=function(b,c){var d;return null==c&&(c=""),b=b||(window||document).axe.BASE_PATH,d=encodeURIComponent(c),a.openWin("http://twitter.com/intent/tweet/?text="+d+"&url="+b,600,300),null},a.renren=function(b){return a.openWin("http://share.renren.com/share/buttonshare.do?link="+b,600,300),null},a.weibo=function(b){return a.openWin("http://service.weibo.com/share/share.php?url="+b+"&language=zh_cn",600,300),null},a}(),_c=function(){function a(a,b){this.save=Vd(this.save,this),this.getBase64=Vd(this.getBase64,this),this.create=Vd(this.create,this),this.build=Vd(this.build,this),this.fitText=Vd(this.fitText,this),this.addPost=Vd(this.addPost,this),this.addBottomLegend=Vd(this.addBottomLegend,this),this.addDoubleLegend=Vd(this.addDoubleLegend,this),this.addDoubleLegendPart=Vd(this.addDoubleLegendPart,this),this.addLineLegend=Vd(this.addLineLegend,this),this.addSingleLegend=Vd(this.addSingleLegend,this),this.addMainImages=Vd(this.addMainImages,this),this.addImageBase64=Vd(this.addImageBase64,this),this.addLineLegendElement=Vd(this.addLineLegendElement,this),this.addLegendElement=Vd(this.addLegendElement,this),this.addCircle=Vd(this.addCircle,this),this.createPercetages=Vd(this.createPercetages,this),this.loadSpecificAssets=Vd(this.loadSpecificAssets,this),this.loadedAssets=Vd(this.loadedAssets,this),this.loadAssets=Vd(this.loadAssets,this),this.userLine=Vd(this.userLine,this),this.getScoreText=Vd(this.getScoreText,this),this.createHeader=Vd(this.createHeader,this),this.getEffortLevel=Vd(this.getEffortLevel,this),this.getScoreStr=Vd(this.getScoreStr,this),this.getScoreColour=Vd(this.getScoreColour,this),this.axe=Vd(this.axe,this);
var c;c={useImageMargins:!0},this.data=_.extend(c,a),this.totalLoadedAssets=[],this.assetsToLoad=[],this.onReady=b,this.loadSpecificAssets([{id:"tw",src:""+window.config.hostname+"/static/images/shareables/tw.png"},{id:"fb",src:""+window.config.hostname+"/static/images/shareables/fb.png"},{id:"ig",src:""+window.config.hostname+"/static/images/shareables/ig.png"},{id:"logo",src:""+window.config.hostname+"/static/images/shareables/logo.png"},{id:"line_scores",src:""+window.config.hostname+"/static/images/shareables/line_scores.png"}])}return a.ImageDisplayType={Single:"single",DoubleEqual:"double-equal",DoubleBiased:"double-biased"},a.prototype.colours={tth:"#D3444A",tthBack:"#e48788",tthLineLegend:"#f8dedf",neutral:"#8F649D",neutralBack:"#b5a5c2",neutralLineLegend:"#ebe6ee",nth:"#74C5DC",nthBack:"#a6daea",nthLineLegend:"#d1eff9",background:"#ffffff"},a.prototype.size=[800,820],a.prototype.mainImageSize=[800,564],a.prototype.mainImageMargins=[35,25,25,25],a.prototype.doubleImageSizeFactor=.74,a.prototype.stage=null,a.prototype.ranges=null,a.prototype.header={colours:{border:"rgba(0,0,0,.15)",fill:"#f7f7f7",scoreInactive:"#9c9c9c"},rects:{height:68,logoSize:[461,34],nameSize:[525,96],panelsSize:[125,96],panelScore:126,panelEffort:149,panelEffortLineWidth:110}},a.prototype.post={size:{width:220},margin:21,marginTop:20,effortLevelLineWidth:116,imageMaxSize:[176,176]},a.prototype.totalAssetsToLoad=0,a.prototype.totalLoadedAssets=null,a.prototype.onReady=null,a.prototype.axe=function(){return(window||document).axe},a.prototype.getScoreColour=function(a){switch(!0){case-200>a:return this.colours.nth;case a>-200&&200>a:return this.colours.neutral;case a>200:return this.colours.tth}},a.prototype.getScoreStr=function(a){return null===a?"-":0>a?""+Math.round(a):"+"+Math.round(a)},a.prototype.getEffortLevel=function(a){switch(!0){case-200>a:return this.axe().locale.get("graph_label_nthe");case a>-200&&200>a:return this.axe().locale.get("graph_label_effortless");case a>200:return this.axe().locale.get("graph_label_tth")}},a.prototype.initForm=function(){var a,b,c,d,e;return c=new cjs.Container,e=new cjs.Shape,e.graphics.beginStroke(this.header.colours.border).moveTo(0,0).drawRect(0,0,this.size[0],this.size[1]).endStroke(),c.addChild(e),d=new cjs.Bitmap(_.where(this.assetsToLoad,{id:"logo"})[0].img),c.addChild(d),d.snapToPixel=!0,d.x=(this.size[0]-this.header.rects.logoSize[0])/2,d.y=(this.header.rects.height-this.header.rects.logoSize[1])/2,this.data.forService&&(b=new cjs.Text("FOR","39px tungstenmedium","#9c9c9c"),c.addChild(b),b.textAlign="left",b.x=698,b.y=14,a=new cjs.Bitmap(_.where(this.assetsToLoad,{id:"for_icon_"+this.data.forService})[0].img),a.x=751,a.y=19,c.addChild(a)),c},a.prototype.getScoreText=function(a,b){return null==b&&(b=!1),a=new cjs.Text(this.getScoreStr(a),"35px tungstensemibold",b?this.getScoreColour(a):this.header.colours.scoreInactive),a.lineWidth=54,a.textAlign="center",a},a.prototype.userLine=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;null==b&&(b=0),g=new cjs.Container,g.y=b,s=new cjs.Shape,s.graphics.moveTo(this.header.rects.nameSize[0],0).beginFill(this.header.colours.fill).drawRect(this.header.rects.nameSize[0],0,this.header.rects.panelsSize[0],this.header.rects.panelsSize[1]).endFill().beginStroke(this.header.colours.border).moveTo(0,0).lineTo(this.size[0],0).moveTo(.5,this.header.rects.nameSize[1]).lineTo(this.size[0],this.header.rects.nameSize[1]).moveTo(this.header.rects.nameSize[0]+.5,0).lineTo(this.header.rects.nameSize[0]+.5,this.header.rects.nameSize[1]).moveTo(this.header.rects.nameSize[0]+.5+this.header.rects.panelScore,0).lineTo(this.header.rects.nameSize[0]+.5+this.header.rects.panelScore,this.header.rects.nameSize[1]).endStroke().closePath(),g.addChild(s),h=0,A=this.axe().appData.USER.model.get("logged");for(r in A)u=A[r],u&&h++;for(o=this.axe().locale.get(h>1?"header_user_score_average":"header_user_score_total").toUpperCase(),x=new cjs.Text(o,"17px tungstenbook","#a6a6a6"),g.addChild(x),x.x=this.header.rects.nameSize[0]+(this.header.rects.panelScore-x.getBounds().width)/2,x.y=20,w=new cjs.Text(this.getScoreStr(a.scores.total),"50px tungstensemibold",this.getScoreColour(a.scores.total)),w.lineWidth=this.header.rects.panelScore,g.addChild(w),w.x=this.header.rects.nameSize[0]+(this.header.rects.panelScore-w.getBounds().width)/2-6,w.y=32,f=new cjs.Text(this.axe().locale.get("header_user_effort").toUpperCase(),"17px tungstenbook","#a6a6a6"),g.addChild(f),f.x=this.header.rects.nameSize[0]+this.header.rects.panelScore+19,f.y=20,d=new cjs.Text(this.getEffortLevel(a.scores.total),"25px tungstensemibold",this.getScoreColour(a.scores.total)),d.lineWidth=a.scores.total>200?70:this.header.rects.panelEffortLineWidth,d.lineHeight=23,d.textAlign="left",g.addChild(d),d.x=this.header.rects.nameSize[0]+this.header.rects.panelScore+19,d.y=35,a.border&&(c=new cjs.Shape,c.x=60,c.y=49,c.graphics.beginFill(a.border).drawCircle(0,0,37),g.addChild(c)),n=new cjs.Container,m=new cjs.Bitmap(a.avatar),m.x=m.image.width/-2,m.y=m.image.height/-2,n.addChild(m),n.scaleX=n.scaleY=62/Math.min(m.image.width,m.image.height),n.x=60,n.y=49,i=n.addChild(new cjs.Shape),i.graphics.f("#000").drawCircle(0,0,Math.min(m.image.width,m.image.height)/2),i.compositeOperation="destination-in",n.cache(m.image.width/-2,m.image.height/-2,m.image.width,m.image.height),g.addChild(n),k=111,l="tw"===this.data.service?19:37,a.name&&(j=new cjs.Text(a.name.toUpperCase(),"28px tungstensemibold","0"),j.x=117,j.y=l,g.addChild(j),k=j.x+j.getBounds().width),"tw"===this.data.service&&(e=new cjs.Text("@"+a.username,"20px tungstenbook","#6f6f6f"),e.x=117,e.y=52,g.addChild(e)),t=new cjs.Bitmap(_.where(this.assetsToLoad,{id:this.data.service})[0].img),t.x=k+10,t.y=l+("tw"===this.data.service?3:4),g.addChild(t),q=new cjs.Bitmap(_.where(this.assetsToLoad,{id:"line_scores"})[0].img),q.x=365,q.y=23,g.addChild(q),B=[{name:"tw",x:367},{name:"fb",x:421},{name:"ig",x:474}],y=0,z=B.length;z>y;y++)p=B[y],v=this.getScoreText(a.scores[p.name]||null,this.data.service===p.name),v.x=p.x,v.y=38,g.addChild(v);return g},a.prototype.loadAssets=function(){var a,b,c,d,e;for(d=this.assetsToLoad,e=[],b=0,c=d.length;c>b;b++)a=d[b],0===_.where(this.totalLoadedAssets,a.id).length?(a.img=new Image,a.img.onload=this.loadedAssets,a.img.id=a.id,e.push(a.img.src=a.src)):e.push(void 0);return e},a.prototype.loadedAssets=function(a){return this.totalLoadedAssets.push(a.target.id),this.totalLoadedAssets.length===this.totalAssetsToLoad&&this.onReady(),null},a.prototype.loadSpecificAssets=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],this.assetsToLoad.push(b);return this.totalAssetsToLoad+=a.length,this.loadAssets(),null},a.prototype.createPercetages=function(a,b,c,d,e,f){return null==e&&(e=0),null==f&&(f=0),a.graphics.moveTo(e,f).beginFill(b).arc(0,0,c,-Math.PI/2,2*Math.PI*d-Math.PI/2,!1).endFill()},a.prototype.addCircle=function(a,b,c,d,e,f){var g;return null==f&&(f=17),g=new cjs.Shape,g.graphics.beginFill(c).drawCircle(0,0,f).endFill(),this.createPercetages(g,b,f,a),g.x=d,g.y=e,g},a.prototype.addLegendElement=function(a,b,c,d,e,f,g){var h,i,j,k;return null==g&&(g={}),g=_.extend({effortTxt:{lineWidth:65,fontSize:22,lineHeight:19},valueTxt:{fontSize:48},pie:{radius:17},labelPosition:"right"},g),i=new createjs.Container,h=this.addCircle(a,b,c,0,0,g.pie.radius),i.addChild(h),k=new cjs.Text(""+Math.round(100*a)+"%",""+g.valueTxt.fontSize+"px tungstenbook",b),k.lineWidth=60,i.addChild(k),j=new cjs.Text(d,""+g.effortTxt.fontSize+"px tungstensemibold",b),j.lineWidth=g.effortTxt.lineWidth,j.lineHeight=g.effortTxt.lineHeight,g.effortTxt.textAlign&&(j.textAlign=g.effortTxt.textAlign),i.addChild(j),"right"===g.labelPosition?(k.x=25,k.y=-24,j.x=95,j.y=-20):(k.x=0,h.x=-20,j.x=0,k.y=-15,j.y=20),i.x=e,i.y=f,i},a.prototype.addLineLegendElement=function(a,b,c,d,e){var f,g,h;return f=new createjs.Container,h=new cjs.Shape,h.graphics.beginFill(b).drawRect(0,0,22,22).endFill(),f.addChild(h),g=new cjs.Text(c,"23px tungstensemibold",a),g.lineHeight=19,f.addChild(g),g.x=36,f.x=d,f.y=e,f},a.prototype.addImageBase64=function(a){var b,c;return b=$.Deferred(),c=new Image,c.onload=function(a){return function(){var d;return d=new cjs.Bitmap(c),a.stage.addChild(d),b.resolve(d)}}(this),c.src=a,b},a.prototype.addMainImages=function(b){var c,d,e,f;switch(null==b&&(b=165),e=this.data.post?this.post.size.width:0,d=_.clone(this.mainImageSize),b>165&&(d[1]-=b-165),this.data.useImageMargins&&(b+=this.mainImageMargins[0],e+=this.mainImageMargins[3],d[0]-=this.mainImageMargins[3],d[1]-=this.mainImageMargins[0]+this.mainImageMargins[2]),f=function(){return function(a,c,d,f){var g,h;return null==f&&(f=0),h=a.image.width/a.image.height,g=c/d,a.scaleX=a.scaleY=h>=g?c/a.image.width:d/a.image.height,a.x=e+f+(c-a.image.width*a.scaleX)/2,a.y=b+(d-a.image.height*a.scaleX)/2}}(this),c=$.Deferred(),this.data.imageDisplayType){case a.ImageDisplayType.Single:this.addImageBase64(this.data.image).done(function(){return function(a){return f(a,d[0]-e,d[1]),c.resolve()}}(this));break;case a.ImageDisplayType.DoubleEqual:$.when(this.addImageBase64(this.data.image),this.addImageBase64(this.data.imageSec)).done(function(){return function(a,b){return f(a,.5*(d[0]-e),d[1]),f(b,.5*(d[0]-e),d[1],.5*(d[0]-e)),c.resolve()}}(this));break;case a.ImageDisplayType.DoubleBiased:$.when(this.addImageBase64(this.data.image),this.addImageBase64(this.data.imageSec)).done(function(a){return function(b,g){return f(b,(d[0]-e)*a.doubleImageSizeFactor,d[1]),f(g,(d[0]-e)*(1-a.doubleImageSizeFactor),d[1],(d[0]-e)*a.doubleImageSizeFactor),g.y=b.y,c.resolve()}}(this))}return c},a.prototype.addSingleLegend=function(a){var b,c;return b=new cjs.Container,c=this.addLegendElement(a.tth,this.colours.tth,this.colours.tthBack,this.getEffortLevel(500).toUpperCase(),this.size[0]/2-326,0),b.addChild(c),c=this.addLegendElement(a.neutral,this.colours.neutral,this.colours.neutralBack,this.getEffortLevel(0).toUpperCase(),this.size[0]/2-91,0),b.addChild(c),c=this.addLegendElement(a.nth,this.colours.nth,this.colours.nthBack,this.getEffortLevel(-500).toUpperCase(),this.size[0]/2+149,0,{effortTxt:{lineWidth:90,fontSize:22,lineHeight:19}}),b.addChild(c),b},a.prototype.addLineLegend=function(){var a,b;return a=new cjs.Container,b=this.addLineLegendElement(this.colours.tth,this.colours.tthLineLegend,this.getEffortLevel(500).toUpperCase(),35,2),a.addChild(b),b=this.addLineLegendElement(this.colours.neutral,this.colours.neutralLineLegend,this.getEffortLevel(0).toUpperCase(),280,2),a.addChild(b),b=this.addLineLegendElement(this.colours.nth,this.colours.nthLineLegend,this.getEffortLevel(-500).toUpperCase(),472,2),a.addChild(b),this.stage.addChild(a),a},a.prototype.addDoubleLegendPart=function(a,b){var c,d,e;return e=new cjs.Container,c={effortTxt:{lineWidth:92,fontSize:14,lineHeight:12,textAlign:"center"},valueTxt:{fontSize:30},pie:{radius:10},labelPosition:"bottom"},d=this.addLegendElement(a.tth,this.colours.tth,this.colours.tthBack,this.getEffortLevel(500).toUpperCase(),b/6,0,c),e.addChild(d),d=this.addLegendElement(a.neutral,this.colours.neutral,this.colours.neutralBack,this.getEffortLevel(0).toUpperCase(),3*(b/6),0,c),e.addChild(d),c.effortTxt.lineWidth=60,d=this.addLegendElement(a.nth,this.colours.nth,this.colours.nthBack,this.getEffortLevel(-500).toUpperCase(),5*(b/6),0,c),e.addChild(d),e},a.prototype.addDoubleLegend=function(a){var b,c,d,e,f,g;for(d=new cjs.Container,c=f=0,g=a.length;g>f;c=++f)b=a[c],e=this.addDoubleLegendPart(b,.4*this.size[0]),d.addChild(e),e.x=this.size[0]*(.05*(c+1+c%2)+.4*c),e.y=-10;return d},a.prototype.addBottomLegend=function(a){var b;return null==a&&(a=this.data.legend),b=1===a.length?this.addSingleLegend(a[0]):this.addDoubleLegend(a),this.stage.addChild(b),b},a.prototype.addPost=function(a,b,c,d){var e,f,g,h,i,j,k,l,m;return i=new cjs.Container,e=new cjs.Shape,e.graphics.beginFill("#fff").drawRect(0,0,this.post.size.width,d).endFill(),i.addChild(e),m=new cjs.Text(this.getScoreStr(a.score),"39px tungstensemibold",this.getScoreColour(a.score)),i.addChild(m),m.x=this.post.margin,m.y=this.post.marginTop,h=new cjs.Text(this.getEffortLevel(a.score),"17px tungstensemibold",this.getScoreColour(a.score)),h.lineWidth=this.post.effortLevelLineWidth,i.addChild(h),h.x=this.post.margin+62,h.y=this.post.marginTop,f=this.post.marginTop+47,a.photo&&(k=_.where(this.assetsToLoad,{id:"post-photo"})[0].img,k=new cjs.Bitmap(k),l=k.image.width>=k.image.height?this.post.imageMaxSize[0]/k.image.width:this.post.imageMaxSize[1]/k.image.height,k.scaleX=k.scaleY=l,k.x=this.post.size.width/2-k.image.width*l/2,k.y=f,f+=k.image.height*l+20,i.addChild(k)),j=this.fitText(this.post.size.width-2*this.post.margin,a.text),j.lineHeight=25,i.addChild(j),j.x=this.post.margin,j.y=f,g=new cjs.Text(Pc.getTimeAgo(a.created),"15px tungstenbook","#9c9c9c"),i.addChild(g),g.x=this.post.margin,g.y=d-20,i.x=b,i.y=c,i},a.prototype.fitText=function(a,b){var c,d,e,f,g;for(e=new cjs.Text(b,"21px tungstenmedium","#000000"),e.lineWidth=a;e.getMeasuredWidth()>a;){for(c=_.max(b.split(" "),function(a){return a.length}),d=c.split(""),g=new cjs.Text("","21px tungstenmedium","#000000"),f="";a>=g.getMeasuredWidth();)f+=d.shift();f+="\n"+d.join(""),b.replace(c,f)}return e},a.prototype.build=function(){return this.onReady=function(a){return function(){var b,c,d,e,f;return d=a.initForm(),a.stage.addChild(d),a.data.loggedUser.avatar=_.where(a.assetsToLoad,{id:"profile1"})[0].img,e=a.userLine(a.data.loggedUser,a.header.rects.height+.5),a.stage.addChild(e),c=164.5,a.data.comparedUser&&(a.data.comparedUser.avatar=_.where(a.assetsToLoad,{id:"profile2"})[0].img,f=a.userLine(a.data.comparedUser,c),a.stage.addChild(f),c+=a.header.rects.panelsSize[1]+.5),c=a.data.comparedUser?261:165,b=a.addMainImages(c),b.done(function(){return a.data.post&&(a.postContainer=a.addPost(a.data.post,0,c,468),a.stage.addChild(a.postContainer)),_.isArray(a.data.legend)?a.legend=a.addBottomLegend():(a.legend=a.addLineLegend(),a.stage.addChild(a.legend)),a.legend.x=0,a.legend.y=c+a.mainImageSize[1]+32-(c-165),a.stage.update(),a.readyCallback?a.readyCallback():void 0})}}(this)},a.prototype.create=function(a){var b,c,d;return this.readyCallback=a,this.canvas=document.createElement("canvas"),this.canvas.width=this.size[0],this.canvas.height=this.size[1],this.canvas.style.backgroundColor="#FFFFFF",this.stage=new cjs.Stage(this.canvas),this.bg=new cjs.Shape,this.bg.graphics.beginFill(this.colours.background).drawRect(0,0,this.size[0],this.size[1]),this.stage.addChild(this.bg),this.build(),c=function(){return function(a){return/\/image\.php\?img=/.test(a)||(a=""+window.config.hostname+"/image.php?img="+a),a}}(this),b=[{id:"profile1",src:c(this.data.loggedUser.avatar)}],this.data.comparedUser&&b.push({id:"profile2",src:c(this.data.comparedUser.avatar)}),(null!=(d=this.data.post)?d.photo:void 0)&&b.push({id:"post-photo",src:c(this.data.post.photo)}),this.data.forService&&b.push({id:"for_icon_"+this.data.forService,src:""+window.config.hostname+"/static/images/shareables/for_icon_"+this.data.forService+".png"}),this.loadSpecificAssets(b),this.stage},a.prototype.getBase64=function(){return this.canvas.toDataURL("image/jpeg",.9)},a.prototype.save=function(a,b){return $.post(""+window.config.hostname+"/api/call/shareImage",{image:(""+a).substr(22)},function(){return function(a){return b(a.url)}}(this))},a}(),bd=function(){function a(a,b){this.wsUrl=a,this.longpollUrl=b,this.close=Vd(this.close,this),this.readStatus=Vd(this.readStatus,this),this.triggerEvent=Vd(this.triggerEvent,this),_.extend(this,Backbone.Events),this.isFallback=!1,"WebSocket"in window?(this.ws=new WebSocket(this.wsUrl),this.ws.onmessage=this.triggerEvent("message"),this.ws.onclose=this.triggerEvent("close"),this.ws.onerror=this.triggerEvent("error"),this.ws.onopen=this.triggerEvent("open"),this.readyState=this.ws.readyState):(this.fallbackWs=new cd(this.longpollUrl),this.fallbackWs.on("message",function(a){return function(b){return a.trigger("message",b)}}(this)),this.isFallback=!0,this.readyState=this.StatusEstablished,this.trigger("open",null,this))}return a.longpollTimeout=4e3,a.StatusNotEstablished=0,a.StatusEstablished=1,a.StatusClosing=2,a.StatusClosedOrError=4,a.prototype.readyState=a.StatusNotEstablished,a.prototype.triggerEvent=function(a){return function(b){return function(c){return b.trigger(a,c,b)}}(this)},a.prototype.readStatus=function(){return this.isFallback&&(this.readyState=this.ws.readyState),this.readyState},a.prototype.close=function(){return this.isFallback?(this.readyState=this.fallbackWs.readyState=this.StatusClosedOrError,this.trigger("close",null,this)):this.ws.close()},a}(),cd=function(){function a(a){this.longpollUrl=a,this.emit=Vd(this.emit,this),this.addResponseToBuffor=Vd(this.addResponseToBuffor,this),this.loop=Vd(this.loop,this),_.extend(this,Backbone.Events),this.readyState=bd.StatusEstablished,this.loop()}return a.prototype.lastPackageId=-1,a.prototype.buffor=[],a.prototype.longpollTimeout=4e3,a.prototype.timeout=null,a.prototype.delay=2e3,a.prototype.startTime=4e3,a.prototype.messagesPerEmit=5,a.prototype.loop=function(){var a,b;return b=(new Date).getTime(),(a=function(c){return function(){return $.ajax({url:c.longpollUrl+(c.lastPackageId+1),cache:!1,success:function(a){var d;if(a&&a.id)return d=0===c.lastPackageId?c.startTime:(new Date).getTime()-b,c.addResponseToBuffor(a,d),b=(new Date).getTime()},dataType:"json",timeout:c.longpollTimeout,complete:function(){return c.readyState===bd.StatusEstablished?setTimeout(a,c.delay):void 0}})}}(this))(),null},a.prototype.addResponseToBuffor=function(a,b){var c;return this.lastPackageId=parseInt(a.id),a.tweets||(a.tweets=[]),c=b/(a.tweets.length+1)*this.messagesPerEmit,this.buffor.push({data:a,freq:c}),1===this.buffor.length?this.emit():void 0},a.prototype.emit=function(){var a,b,c,d;if(0!==this.buffor.length){for(a=c=1,d=this.messagesPerEmit;(d>=1?d>=c:c>=d)&&0!==this.buffor[0].data.tweets.length;a=d>=1?++c:--c)b=this.buffor[0].data.tweets.shift(),this.trigger("message",b);return 0===this.buffor[0].data.tweets.length&&this.buffor.shift(),this.buffor.length>0?setTimeout(this.emit,this.buffor[0].freq):void 0}},a}(),dd=function(){function a(b,c){this.pool=b,this.longpollUrl=c,this.onConnectionUp=Vd(this.onConnectionUp,this),this.onConnectionDown=Vd(this.onConnectionDown,this),this.onSocketOpen=Vd(this.onSocketOpen,this),this.retry=Vd(this.retry,this),this.onMessage=Vd(this.onMessage,this),this.onSocketError=Vd(this.onSocketError,this),this.disconnectSocket=Vd(this.disconnectSocket,this),this.setActiveSocket=Vd(this.setActiveSocket,this),this.start=Vd(this.start,this),this.retrying=!1,this.status=a.STATUS_UP,this.poolArray=this.pool.slice(0),this.deadSockets=[],_.extend(this,Backbone.Events),this.pool=_.shuffle(this.pool)}return a.STATUS_UP="up",a.STATUS_DOWN="down",a.prototype.start=function(){return this.setActiveSocket(new bd(this.pool.shift(),this.longpollUrl)),window.addEventListener("offline",this.onConnectionDown,!1),window.addEventListener("online",this.onConnectionUp,!1)},a.prototype.setActiveSocket=function(a){return this.activeSocket=a,this.listenTo(a,"message",this.onMessage,this),this.listenTo(a,"error",this.onSocketError,this),this.listenTo(a,"close",this.onSocketError,this),this.listenTo(a,"open",this.onSocketOpen,this)},a.prototype.disconnectSocket=function(a){return a.readStatus()===bd.StatusEstablished&&a.close(),this.stopListening(a)},a.prototype.onSocketError=function(b,c){var d;return this.deadSockets.push(c),this.disconnectSocket(c),d=this.pool.indexOf(c.wsUrl),d>0&&this.pool.splice(0,d),0===this.pool.length?(this.status=a.STATUS_DOWN,this.trigger("connection:down"),this.retry()):this.setActiveSocket(new bd(this.pool.shift(),this.longpoll))},a.prototype.onMessage=function(a){return this.retrying&&this.onSocketOpen(),this.trigger("message",a),null},a.prototype.retry=function(){return this.retrying=!0,this.pool=_.shuffle(this.poolArray.slice(0)),this.deadSockets=[],setTimeout(function(a){return function(){return a.setActiveSocket(new bd(a.pool.shift(),a.longpollUrl))}}(this),1500)},a.prototype.onSocketOpen=function(){return this.retrying?(this.retrying=!1,this.status=a.STATUS_UP,this.trigger("connection:up")):void 0},a.prototype.onConnectionDown=function(){return this.retrying?void 0:(this.retrying=!0,this.status=a.STATUS_DOWN,this.trigger("connection:down"))},a.prototype.onConnectionUp=function(){return this.retrying?void 0:(this.status=a.STATUS_UP,this.trigger("connection:up"))},a}(),zd=function(){function a(a,b){this.get=Vd(this.get,this),this.parseXML=Vd(this.parseXML,this),this.cb=b,$.ajax({url:a,success:this.parseXML})}return a.prototype.templates=null,a.prototype.cb=null,a.prototype.parseXML=function(a){var b;return b=[],$(a).find("template").each(function(a,c){return b.push(new yd({id:$(c).attr("id").toString(),text:$.trim($(c).text())}))}),this.templates=new X(b),"function"==typeof this.cb&&this.cb(),null},a.prototype.get=function(a){var b;return b=this.templates.where({id:a}),b=b[0].get("text"),$.trim(b)},a}(),g=function(a){function b(){return this.removeAllChildren=Vd(this.removeAllChildren,this),this.axe=Vd(this.axe,this),this.dispose=Vd(this.dispose,this),this.getPostTmpl=Vd(this.getPostTmpl,this),this.muteAll=Vd(this.muteAll,this),this.unMuteAll=Vd(this.unMuteAll,this),this.mouseEnabled=Vd(this.mouseEnabled,this),this.show=Vd(this.show,this),this.hide=Vd(this.hide,this),this.onResize=Vd(this.onResize,this),this.remove=Vd(this.remove,this),this.replace=Vd(this.replace,this),this.addChild=Vd(this.addChild,this),this.render=Vd(this.render,this),this.update=Vd(this.update,this),this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.id=null,b.prototype.children=null,b.prototype.template=null,b.prototype.templateVars=null,b.prototype.postTmpl=null,b.prototype.initialize=function(){var a;return this.children=[],this.template&&(a=_.template(this.axe().templates.get(this.template)),this.setElement(a(this.templateVars))),this.id&&this.$el.attr("id",this.id),this.className&&this.$el.addClass(this.className),this.postTmpl=_.template(this.axe().templates.get("post")),this.init(),this.paused=!1,null},b.prototype.init=function(){return null},b.prototype.update=function(){return null},b.prototype.render=function(){return null},b.prototype.addChild=function(a,b){var c,d;return null==b&&(b=!1),a.el&&this.children.push(a),d=this.addToSelector?this.$el.find(this.addToSelector).eq(0):this.$el,c=a.el?a.$el:a,b?d.prepend(c):d.append(c),this},b.prototype.replace=function(a,b){var c;return b.el&&this.children.push(b),c=b.el?b.$el:b,this.$el.children(a).replaceWith(c),null},b.prototype.remove=function(a){var b;if(null!=a)return b=a.el?a.$el:$(a),b&&a.dispose&&a.dispose(),b&&-1!==this.children.indexOf(a)&&this.children.splice(this.children.indexOf(a),1),b.remove(),null},b.prototype.onResize=function(){var a,b,c,d;for(d=this.children,b=0,c=d.length;c>b;b++)a=d[b],a.onResize&&a.onResize();return null},b.prototype.hide=function(a,b,c,d,e){return null==a&&(a=!1),null==b&&(b=null),null==c&&(c=400),null==d&&(d="linear"),null==e&&(e=!1),this.visible=!1,a?this.$el.stop().animate({opacity:0},{duration:c,ease:d,complete:function(a){return function(){return"function"==typeof b&&b(),e?a.$el.css({visibility:"hidden"}):void 0}}(this)}):(this.$el.css({opacity:0}),e&&this.$el.css({visibility:"hidden"})),null},b.prototype.show=function(a,b,c,d){return null==a&&(a=!1),null==b&&(b=null),null==c&&(c=400),null==d&&(d="linear"),this.visible=!0,this.$el.css({visibility:"visible"}),a?this.$el.stop().animate({opacity:1},c,d,function(){return function(){return"function"==typeof b?b():void 0}}(this)):this.$el.css({opacity:1}),null},b.prototype.mouseEnabled=function(a){return this.$el.css({"pointer-events":a?"auto":"none"}),null},b.prototype.unMuteAll=function(){var a,b,c,d;for(d=this.children,b=0,c=d.length;c>b;b++)a=d[b],"function"==typeof a.unMute&&a.unMute(),a.children.length&&a.unMuteAll();return null},b.prototype.muteAll=function(){var a,b,c,d;for(d=this.children,b=0,c=d.length;c>b;b++)a=d[b],"function"==typeof a.mute&&a.mute(),a.children.length&&a.muteAll();return null},b.prototype.supplantString=function(a,b){return a.replace(/{{ ([^{}]*) }}/g,function(a,c){var d;return d=b[c],"string"==typeof d||"number"==typeof d?d:a})},b.prototype.getPostTmpl=function(a){var b,c;return c=Modernizr.svg?"svg":"jpg",b={logoURL:this.axe().locale.getLocaleImage("logo_AME."+c),label_tth:this.axe().locale.get("graph_label_tth"),label_el:this.axe().locale.get("graph_label_effortless"),label_nth:this.axe().locale.get("graph_label_nthe"),post:a.post,user:a.user||!1,share:a.share||!1},this.postTmpl(b)},b.prototype.dispose=function(){return null},b.prototype.axe=function(){return(window||document).axe},b.prototype.removeAllChildren=function(){var a,b,c,d,e;for(d=this.children,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.remove(a));return e},b}(Backbone.View),cb=function(a){function b(a){return this.wrapper=a,this.getView=Vd(this.getView,this),this.setNavLinks=Vd(this.setNavLinks,this),this.addModules=Vd(this.addModules,this),this.createModules=Vd(this.createModules,this),this.onScroll=Vd(this.onScroll,this),this.scaleDashboard=Vd(this.scaleDashboard,this),this.stop=Vd(this.stop,this),this.start=Vd(this.start,this),this.updateDims=Vd(this.updateDims,this),this.bindEvents=Vd(this.bindEvents,this),this.init=Vd(this.init,this),b.__super__.constructor.call(this),this.onScroll=_.debounce(this.onScroll,300),null}return Ud(b,a),b.prototype.id="dashboard",b.prototype.tagName="section",b.prototype.className="dashboard",b.prototype.$window=null,b.prototype.wrapper=null,b.prototype.modules=null,b.prototype.scaled=!1,b.prototype.scrollDone=!1,b.prototype.EVENTS_ON=!1,b.prototype.FULL_HEIGHT=2492,b.prototype.MIN_WIDTH=1024,b.prototype.MIN_PADDING=10,b.prototype.init=function(){return this.$window=$(window),this.createModules(),this.addModules(),this.axe().appView.on("start",this.bindEvents),null},b.prototype.bindEvents=function(){return this.axe().appView.off("start",this.bindEvents),this.axe().appView.on("showDashboardEnd",this.start),this.axe().appView.on("hideDashboardStart",this.stop),this.axe().appView.on("updateDims",this.updateDims),null},b.prototype.updateDims=function(){return this.axe().appView.dashboardVisible?this.scaleDashboard(!0):this.scaled=!1,null},b.prototype.start=function(){return this.EVENTS_ON?void 0:(this.scaleDashboard(),this.scrollDone||this.$window.on("scroll",this.onScroll),this.EVENTS_ON=!0,null)},b.prototype.stop=function(){return this.EVENTS_ON?(this.scrollDone||this.$window.off("scroll",this.onScroll),this.EVENTS_ON=!1,null):void 0},b.prototype.scaleDashboard=function(a){var b;return null==a&&(a=!1),!this.scaled||a?(this.scaled=!0,this.$el.css({transform:"",height:""}),this.axe().appView.dims.w<this.MIN_WIDTH&&(b=this.axe().appView.dims.w/(this.MIN_WIDTH+2*this.MIN_PADDING),this.$el.css({transform:"scale("+b+")",height:this.FULL_HEIGHT*b})),null):void 0},b.prototype.onScroll=function(){var a;return null!=(a=this.axe().appView.milestones)&&a.completeTask("dashboard_scroll"),this.scrollDone=!0,this.$window.off("scroll",this.onScroll),null},b.prototype.createModules=function(){return this.mainGraphsModule=new qc,this.tipsModule=new Ad,this.shareModule=new $c,this.globalStatsModule=new zb,this.locationStatsModule=new mc,this.videoModule=new Ld,this.leaderboardModule=new gc,this.hashtagsModule=new Qb,this.calledOutModule=new J,this.SiteFooterModule=new ad,null},b.prototype.addModules=function(){var a,b,c,d;for(this.modules=[{view:this.mainGraphsModule,route:this.axe().nav.sections.PROFILE},{view:this.tipsModule,route:null},{view:this.shareModule,route:null},{view:this.globalStatsModule,route:this.axe().nav.sections.GLOBAL_STATS},{view:this.locationStatsModule,route:this.axe().nav.sections.LOCATION_STATS},{view:this.videoModule,route:this.axe().nav.sections.FUN_FACTS},{view:this.leaderboardModule,route:null},{view:this.hashtagsModule,route:this.axe().nav.sections.LANDING},{view:this.calledOutModule,route:this.axe().nav.sections.LATEST},{view:this.SiteFooterModule,route:null}],d=this.modules,b=0,c=d.length;c>b;b++)a=d[b],this.addChild(a.view),this.setNavLinks(a);return setTimeout(function(a){return function(){return a.wrapper.dashboardDfd.resolve()}}(this),1),null},b.prototype.setNavLinks=function(a){var b;return b=null!==a.route?"/"+a.route:!1,b=a.route===this.axe().nav.sections.LANDING?"/":b,a.view.setNavLinks(b),null},b.prototype.getView=function(a){var b,c,d,e;for(e=this.modules,c=0,d=e.length;d>c;c++)if(b=e[c],b.route===a)return b.view;return""},b}(g),db=function(a){function b(a){return this.wrapper=a,this.getView=Vd(this.getView,this),this.setNavLinks=Vd(this.setNavLinks,this),this.addModules=Vd(this.addModules,this),this.createModules=Vd(this.createModules,this),this.init=Vd(this.init,this),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.id="dashboard",b.prototype.tagName="section",b.prototype.className="dashboard",b.prototype.wrapper=null,b.prototype.modules=null,b.prototype.init=function(){return this.createModules(),this.addModules(),null},b.prototype.createModules=function(){return this.mainGraphsModule=new qc,null},b.prototype.addModules=function(){var a,b,c,d;for(this.modules=[{view:this.mainGraphsModule,route:this.axe().nav.sections.PROFILE}],d=this.modules,b=0,c=d.length;c>b;b++)a=d[b],this.addChild(a.view),this.setNavLinks(a);return setTimeout(function(a){return function(){return a.wrapper.dashboardDfd.resolve()}}(this),1),null},b.prototype.setNavLinks=function(a){var b,c;return b="/"+this.axe().nav.sections.HOME,c=null!==a.route?"/"+a.route:!1,c=a.route===this.axe().nav.sections.LANDING?"/":c,a.view.setNavLinks(b,c),null},b.prototype.getView=function(a){var b,c,d,e;for(e=this.modules,c=0,d=e.length;d>c;c++)if(b=e[c],b.route===a)return b.view;return""},b}(g),eb=function(a){function b(a){return this.wrapper=a,this.getView=Vd(this.getView,this),this.addSections=Vd(this.addSections,this),this.createSections=Vd(this.createSections,this),this.init=Vd(this.init,this),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.id="deepviews",b.prototype.tagName="div",b.prototype.className="deepviews",b.prototype.wrapper=null,b.prototype.sections=null,b.prototype.init=function(){return this.createSections(),this.addSections(),null},b.prototype.createSections=function(){return this.profileSection=new Qc,this.globalStatsSection=new Ab,this.locationStatsSection=new nc,this.landingSection=new $b,this.funFactsSection=new ub,this.latestPostsSection=new fc,this.shareDeeplinkSection=new Yc,null},b.prototype.addSections=function(){var a,b,c,d;for(this.sections=[{view:this.profileSection,route:this.axe().nav.sections.PROFILE},{view:this.globalStatsSection,route:this.axe().nav.sections.GLOBAL_STATS},{view:this.locationStatsSection,route:this.axe().nav.sections.LOCATION_STATS},{view:this.landingSection,route:this.axe().nav.sections.LANDING},{view:this.funFactsSection,route:this.axe().nav.sections.FUN_FACTS},{view:this.latestPostsSection,route:this.axe().nav.sections.LATEST},{view:this.shareDeeplinkSection,route:this.axe().nav.sections.SHARE_DEEPLINK}],d=this.sections,b=0,c=d.length;c>b;b++)a=d[b],this.addChild(a.view);return this.wrapper.deepViewsDfd.resolve(),null},b.prototype.getView=function(a){var b,c,d,e;for(e=this.sections,c=0,d=e.length;d>c;c++)if(b=e[c],b.route===a)return b.view;return null},b}(g),Rb=function(a){function b(){this.track=Vd(this.track,this),this.onServiceClick=Vd(this.onServiceClick,this),this.onMenuBtnClick=Vd(this.onMenuBtnClick,this),this.closeDropdown=Vd(this.closeDropdown,this),this.openDropdown=Vd(this.openDropdown,this),this.toggleDropdown=Vd(this.toggleDropdown,this),this.onCloseClick=Vd(this.onCloseClick,this),this.onLogoClick=Vd(this.onLogoClick,this),this.getScoreLabel=Vd(this.getScoreLabel,this),this.getServiceLabel=Vd(this.getServiceLabel,this),this.removeUserData=Vd(this.removeUserData,this),this.setUserData=Vd(this.setUserData,this),this.updateLinkCount=Vd(this.updateLinkCount,this),this.setActiveLink=Vd(this.setActiveLink,this),this.unHide=Vd(this.unHide,this),this.hide=Vd(this.hide,this),this.canShowHeader=Vd(this.canShowHeader,this),this.onLoggedChange=Vd(this.onLoggedChange,this),this.onHashChange=Vd(this.onHashChange,this),this.setListeners=Vd(this.setListeners,this),this.getRouteModule=Vd(this.getRouteModule,this),this.setupLinks=Vd(this.setupLinks,this),this.start=Vd(this.start,this),this.init=Vd(this.init,this);
var a;return this.router=this.axe().router,this.userModel=this.axe().appData.USER.model,this.activeService=this.axe().appView.activeService,a=Modernizr.svg?"svg":"jpg",this.templateVars={logoSRC:this.axe().IS_MOBILE?this.axe().locale.getLocaleImage("logo_mobile."+a):this.axe().locale.getLocaleImage("logo_header."+a),siteTitle:this.axe().locale.get("seo_og_title"),label_home:this.axe().locale.get("desktop_dropdown_label_home"),label_fun_facts:this.axe().locale.get("desktop_dropdown_label_fun_facts"),label_global_stats:this.axe().locale.get("desktop_dropdown_label_global_stats"),label_latest_posts:this.axe().locale.get("desktop_dropdown_label_latest_posts"),label_compare_cities:this.axe().locale.get("desktop_dropdown_label_compare_cities"),label_trending_hashtags:this.axe().locale.get("desktop_dropdown_label_trending_hashtags")},b.__super__.constructor.call(this),this.userDataTpl=_.template(this.axe().templates.get("header-user-data")),null}return Ud(b,a),b.prototype.router=null,b.prototype.userModel=null,b.prototype.activeService=null,b.prototype.userDataTpl=null,b.prototype.$userData=null,b.prototype.$logo=null,b.prototype.$homeBtn=null,b.prototype.$dropdownBtn=null,b.prototype.$dropdown=null,b.prototype.$btns=null,b.prototype.$ui=null,b.prototype.scroller=null,b.prototype.template="header",b.prototype.listening=null,b.prototype.DROPDOWN_OPEN=!1,b.prototype.init=function(){return this.$userData=this.$el.find("[data-user-data]"),this.$logo=this.$el.find("[data-logo]"),this.$homeBtn=this.$el.find("[data-home-btn]"),this.$dropdownBtn=this.$el.find("[data-dropdown-btn]"),this.$dropdown=this.$el.find("[data-dropdown]"),this.$btns=this.$el.find("[data-menu-btn]"),this.$ui=this.$dropdownBtn.add(this.$dropdown),this.axe().appView.on("start",this.start),null},b.prototype.start=function(){return this.axe().appView.off("start",this.start),this.setupLinks(),this.setListeners("on"),this.onLoggedChange(),null},b.prototype.setupLinks=function(){var a;return a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,this.$btns.each(function(b){return function(c,d){var e,f,g,h,i,j;return e=$(d),j=e.data("menu-btn"),i=b.axe().nav.sections[j],i=i===b.axe().nav.sections.LANDING?"":i,i!==b.axe().nav.sections.HOME&&(g=b.getRouteModule(j),f=g.$el.height(),h=g.$el.offset().top-a/2+f/2,e.data("module",g).data("offset",h)),j?e.attr("data-menu-btn",i):void 0}}(this)),null},b.prototype.getRouteModule=function(a){var b,c,d,e,f,g;for(a=a||this.axe().nav.sections.LANDING,d=this.axe().nav.sections[a],g=this.axe().appView.wrapper.dashboard.modules,e=0,f=g.length;f>e;e++)b=g[e],d===b.route&&(c=b.view);return c},b.prototype.setListeners=function(a){return this.listening!==a?(this.listening=a,this.router[a](Uc.EVENT_HASH_CHANGED,this.onHashChange),this.userModel[a]("change:logged.*",this.onLoggedChange),this.$el[a]("click","[data-logo]",this.onLogoClick),this.$el[a]("click","[data-dropdown-btn]",this.toggleDropdown),this.$el[a]("click","[data-menu-btn]",this.onMenuBtnClick),this.$el[a]("click","[data-close-btn]",this.onCloseClick),this.$el[a]("click","[data-service]",this.onServiceClick),null):void 0},b.prototype.onHashChange=function(){var a;return a=this.axe().nav.currentView,a!==this.axe().nav.sections.HOME?(this.$el.addClass("in-deepview"),this.removeUserData(),this.setUserData()):this.$el.removeClass("show-user-data in-deepview"),this.canShowHeader(a)?this.unHide():this.hide(),setTimeout(function(a){return function(){var b;return b=a.axe().nav.currentView===a.axe().nav.sections.LANDING?"":a.axe().nav.currentView,a.setActiveLink(b),a.updateLinkCount(b)}}(this),400),null},b.prototype.onLoggedChange=function(){var a;return a=this.axe().appData.USER.isLogged()?"removeClass":"addClass",this.$el[a]("not-logged"),null},b.prototype.canShowHeader=function(a){return(this.axe().appData.USER.isLogged()||a!==this.axe().nav.sections.LANDING&&a)&&a!==this.axe().nav.sections.SHARE_DEEPLINK?!0:!1},b.prototype.hide=function(){return this.$el.addClass("hide"),null},b.prototype.unHide=function(){return this.$el.removeClass("hide"),null},b.prototype.setActiveLink=function(a){var b;return b='[data-menu-btn="'+a+'"]',this.$btns.filter(".active").removeClass("active").end().filter(b).addClass("active"),null},b.prototype.updateLinkCount=function(a){var b;return b=a===this.axe().nav.sections.PROFILE?"addClass":"removeClass",this.$el[b]("six-btns"),null},b.prototype.setUserData=function(){var a,b;if(this.axe().appData.USER.isLogged())return a=this.activeService.get("service"),b={avatar:this.userModel.get("info."+a+".avatar")||!1,name:this.userModel.get("info."+a+".name")||!1,username:this.userModel.get("info."+a+".username"),score_tw_judgement:this.userModel.get("scores.tw.judgement")||"",score_label_tw:this.getServiceLabel("tw"),score_tw:this.userModel.get("scores.tw.total")?Ic.getNiceScore(this.userModel.get("scores.tw.total")):"&#8212;",score_fb_judgement:this.userModel.get("scores.fb.judgement")||"",score_label_fb:this.getServiceLabel("fb"),score_fb:this.userModel.get("scores.fb.total")?Ic.getNiceScore(this.userModel.get("scores.fb.total")):"&#8212;",score_ig_judgement:this.userModel.get("scores.ig.judgement")||"",score_label_ig:this.getServiceLabel("ig"),score_ig:this.userModel.get("scores.ig.total")?Ic.getNiceScore(this.userModel.get("scores.ig.total")):"&#8212;",score_total_judgement:this.userModel.get("scores.total.judgement"),score_label_total:this.getScoreLabel(),score_total:this.userModel.get("scores.total.score")?Ic.getNiceScore(this.userModel.get("scores.total.score")):!1},this.$userData.removeClass("active-service-tw active-service-fb active-service-ig").addClass("active-service-"+a).html(this.userDataTpl(b)),setTimeout(function(a){return function(){return a.$el.addClass("show-user-data")}}(this),100),null},b.prototype.removeUserData=function(){return this.$userData.empty(),null},b.prototype.getServiceLabel=function(a){var b;return b=function(){switch(a){case"tw":return"Twitter";case"fb":return"Facebook";case"ig":return"Instagram"}}()},b.prototype.getScoreLabel=function(){var a,b,c,d;a=0,d=this.userModel.get("logged");for(b in d)c=d[b],c&&a++;return a>1?this.axe().locale.get("header_user_score_average"):this.axe().locale.get("header_user_score_total")},b.prototype.onLogoClick=function(){return this.DROPDOWN_OPEN&&this.closeDropdown(),this.axe().nav.currentView===this.axe().nav.sections.HOME?TweenLite.to(window,.4,{scrollTo:{y:0},ease:Cubic.easeInOut}):this.router.navigateTo(this.axe().nav.sections.HOME),null},b.prototype.onCloseClick=function(){return this.router.navigateTo(this.axe().nav.sections.HOME),null},b.prototype.toggleDropdown=function(a){return a&&a.stopPropagation(),this.DROPDOWN_OPEN?this.closeDropdown():this.openDropdown(),null},b.prototype.openDropdown=function(){return this.$ui.addClass("open"),this.DROPDOWN_OPEN=!0,this.axe().appView.$el.on("click",this.closeDropdown),this.$btns.each(function(){return function(a,b){return setTimeout(function(){return $(b).addClass("show")},400+50*a)}}(this)),null},b.prototype.closeDropdown=function(){return this.$ui.removeClass("open"),this.DROPDOWN_OPEN=!1,this.axe().appView.$el.off("click",this.closeDropdown),this.$btns.removeClass("show"),null},b.prototype.onMenuBtnClick=function(a){var b,c,d;return this.DROPDOWN_OPEN&&this.closeDropdown(),b=$(a.currentTarget),d=b.attr("data-menu-btn"),c=b.data("offset")||0,this.axe().nav.currentView!==this.axe().nav.sections.HOME||this.axe().IS_SMALL_NON_MOBILE?this.router.navigateTo(d):(TweenLite.to(window,.5,{scrollTo:{y:c},ease:Cubic.easeInOut}),setTimeout(function(a){return function(){return a.router.navigateTo(d)}}(this),800)),this.track(d),null},b.prototype.onServiceClick=function(a){return this.router.navigateTo(this.axe().nav.sections.HOME),TweenLite.to(window,.5,{delay:1,scrollTo:{y:0},ease:Cubic.easeInOut,onComplete:function(b){return function(){return b.axe().appView.activeService.set("service",$(a.currentTarget).attr("data-service"))}}(this)}),null},b.prototype.track=function(a){var b;return b=function(){switch(!0){case a===this.axe().nav.sections.HOME:return"dashboard";case a===this.axe().nav.sections.FUN_FACTS:return"fun";case a===this.axe().nav.sections.GLOBAL_STATS:return"global_stats";case a===this.axe().nav.sections.LATEST:return"callout";case a===this.axe().nav.sections.LOCATION_STATS:return"cities";case a===this.axe().nav.sections.LANDING:return"trending"}}.call(this),this.axe().analytics.track("burger_"+b),null},b}(g),Sb=function(a){function b(){return this.getScoreLabel=Vd(this.getScoreLabel,this),this.getUsername=Vd(this.getUsername,this),this.removeUserData=Vd(this.removeUserData,this),this.setUserData=Vd(this.setUserData,this),this.onServiceChange=Vd(this.onServiceChange,this),this.hideMenuLabel=Vd(this.hideMenuLabel,this),this.onHashChange=Vd(this.onHashChange,this),this.onMenuBtnClick=Vd(this.onMenuBtnClick,this),this.hideByScroll=Vd(this.hideByScroll,this),this.unHide=Vd(this.unHide,this),this.hide=Vd(this.hide,this),this.setListeners=Vd(this.setListeners,this),this.start=Vd(this.start,this),this.init=Vd(this.init,this),this.router=this.axe().router,this.userModel=this.axe().appData.USER.model,this.activeService=this.axe().appView.activeService,b.__super__.constructor.call(this),this.userDataTpl=_.template(this.axe().templates.get("header-mobile-user-data")),null}return Ud(b,a),b.prototype.router=null,b.prototype.userModel=null,b.prototype.activeService=null,b.prototype.userDataTpl=null,b.prototype.$window=null,b.prototype.$userData=null,b.prototype.seenMenuLabel=!1,b.prototype.HEIGHT=40,b.prototype.template="header-mobile",b.prototype.init=function(){return this.$window=$(window),this.$userData=this.$el.find("[data-user-data]"),this.axe().appView.on("start",this.start),null},b.prototype.start=function(){return this.axe().appView.off("start",this.start),this.setListeners("on"),this.onHashChange(),this.onServiceChange(),null},b.prototype.setListeners=function(a){return this.$el.find("[data-mobile-menu-toggle]")[a]("click",this.onMenuBtnClick),this.router[a](Uc.EVENT_HASH_CHANGED,this.onHashChange),this.activeService[a]("change",this.onServiceChange),this.userModel[a]("updateUserData",this.onServiceChange),this.axe().appView[a]("updateUserScores",this.onServiceChange),null},b.prototype.hide=function(){return this.$el.addClass("hide-header"),null},b.prototype.unHide=function(){return this.$el.removeClass("hide-header"),null},b.prototype.hideByScroll=function(){return this.$window.scrollTop(this.HEIGHT),null},b.prototype.onMenuBtnClick=function(a){var b,c;return a.preventDefault(),c=this.axe().appView.navigationMobile,b=c.IS_OPEN?"close":"open",c[b](),"open"!==b||this.seenMenuLabel||this.hideMenuLabel(!1),null},b.prototype.onHashChange=function(){var a,b;return b=this.axe().nav.currentView,a=b!==this.axe().nav.sections.HOME?"addClass":"removeClass",this.$el[a]("hide-user-data"),this.axe().appData.USER.isLogged()||b!==this.axe().nav.sections.LANDING&&b!==this.axe().nav.sections.SHARE_DEEPLINK&&b?this.unHide():this.hide(),this.seenMenuLabel||b===this.axe().nav.sections.LANDING||!b?!1:(this.hideMenuLabel(),null)},b.prototype.hideMenuLabel=function(a){return null==a&&(a=!0),setTimeout(function(a){return function(){return a.$el.addClass("menu-label-seen"),a.seenMenuLabel=!0}}(this),a?5e3:0),null},b.prototype.onServiceChange=function(){var a;return a=this.activeService.get("service"),this.userModel.get("info."+a)?this.setUserData(a):this.removeUserData(),null},b.prototype.setUserData=function(a){var b,c;if(this.userModel.get("info."+a))return c=function(){switch(a){case"tw":return"Twitter";case"fb":return"Facebook";case"ig":return"Instagram"}}(),b={avatar:this.userModel.get("info."+a+".avatar")||!1,name:this.userModel.get("info."+a+".name")||!1,username:this.getUsername(a),service:a,score_service_judgement:this.userModel.get("scores."+a+".judgement")||"",score_label_service:c,score_service:Ic.getNiceScore(this.userModel.get("scores."+a+".total")),score_total_judgement:this.userModel.get("scores.total.judgement"),score_label_total:this.getScoreLabel(),score_total:this.userModel.get("scores.total.score")?Ic.getNiceScore(this.userModel.get("scores.total.score")):!1},this.$userData.html(this.userDataTpl(b)),null},b.prototype.removeUserData=function(){return this.$userData.empty(),null},b.prototype.getUsername=function(a){return"fb"===a?this.userModel.get("info."+a+".username"):"@"+this.userModel.get("info."+a+".username")},b.prototype.getScoreLabel=function(){var a,b,c,d;a=0,d=this.userModel.get("logged");for(b in d)c=d[b],c&&a++;return a>1?this.axe().locale.get("mobile_header_average_score"):this.axe().locale.get("mobile_header_total_score")},b}(g),Gc=function(a){function b(){return this.onTouchMove=Vd(this.onTouchMove,this),this.enableTouch=Vd(this.enableTouch,this),this.disableTouch=Vd(this.disableTouch,this),this.showLogout=Vd(this.showLogout,this),this.close=Vd(this.close,this),this.open=Vd(this.open,this),this.setActiveLink=Vd(this.setActiveLink,this),this.onServiceChange=Vd(this.onServiceChange,this),this.getScoreLabel=Vd(this.getScoreLabel,this),this.getEffortLevel=Vd(this.getEffortLevel,this),this.getUsername=Vd(this.getUsername,this),this.setUserScores=Vd(this.setUserScores,this),this.setUserData=Vd(this.setUserData,this),this.updateUserData=Vd(this.updateUserData,this),this.onRefreshClick=Vd(this.onRefreshClick,this),this.onNavLinkClick=Vd(this.onNavLinkClick,this),this.onServiceClick=Vd(this.onServiceClick,this),this.refreshScroller=Vd(this.refreshScroller,this),this.setListeners=Vd(this.setListeners,this),this.start=Vd(this.start,this),this.setupScroller=Vd(this.setupScroller,this),this.setupOverlay=Vd(this.setupOverlay,this),this.setupDims=Vd(this.setupDims,this),this.init=Vd(this.init,this),this.router=this.axe().router,this.userModel=this.axe().appData.USER.model,this.userStatus=this.axe().appData.USER.status,this.activeService=this.axe().appView.activeService,this.interaction=Modernizr.touch?"touchend":"click",this.templateVars={label_tw:this.axe().locale.get("mobile_navigation_label_tw"),label_fb:this.axe().locale.get("mobile_navigation_label_fb"),label_ig:this.axe().locale.get("mobile_navigation_label_ig"),label_tips:this.axe().locale.get("mobile_navigation_label_tips"),url_tips:this.axe().locale.get("mobile_navigation_url_tips"),label_location_stats:this.axe().locale.get("mobile_navigation_label_location_stats"),label_fun_facts:this.axe().locale.get("mobile_navigation_label_fun_facts"),label_global_stats:this.axe().locale.get("mobile_navigation_label_global_stats"),label_latest:this.axe().locale.get("mobile_navigation_label_latest"),label_logout:this.axe().locale.get("mobile_navigation_label_logout")},b.__super__.constructor.call(this),this.userDataTpl=_.template(this.axe().templates.get("navigation-mobile-user-data")),null}return Ud(b,a),b.prototype.template="navigation-mobile",b.prototype.router=null,b.prototype.userModel=null,b.prototype.userStatus=null,b.prototype.activeService=null,b.prototype.interaction=null,b.prototype.$window=null,b.prototype.$html=null,b.prototype.$overlay=null,b.prototype.$userData=null,b.prototype.$navLinks=null,b.prototype.$serviceBtns=null,b.prototype.scroller=null,b.prototype.userDataTpl=null,b.prototype.WIDTH=280,b.prototype.TRANSITION=400,b.prototype.IS_OPEN=!1,b.prototype.init=function(){return this.$window=$(window),this.$html=$("html").eq(0),this.$overlay=this.$el.find("[data-overlay]"),this.$userData=this.$el.find("[data-user-data]"),this.$navLinks=this.$el.find(".nav-link"),this.$serviceBtns=this.$navLinks.filter("[data-service]"),this.axe().appView.on("start",this.start),b.__super__.init.call(this),this.setupScroller(),this.setupDims(),null},b.prototype.setupDims=function(a){return a=a||this.axe().appView.dims,this.$el.css({height:a.h}),this.refreshScroller(),null},b.prototype.setupOverlay=function(){return this.$overlay.detach(),this.$overlay.insertAfter(this.$el),null},b.prototype.setupScroller=function(){return this.scroller=new IScroll(this.$el[0],{scrollX:!1,scrollY:!0,mouseWheel:!0,tap:!0}),null},b.prototype.start=function(){return this.axe().appView.off("start",this.start),this.setupOverlay(),this.setListeners("on"),this.updateUserData(),null},b.prototype.setListeners=function(a){return this.$el[a]("tap","[data-service]",this.onServiceClick),this.$el[a]("tap","[data-navlink]",this.onNavLinkClick),this.$el[a]("tap","[data-refresh]",this.onRefreshClick),this.$el[a]("tap","[data-logout]",this.showLogout),this.axe().appView[a]("updateDims",this.setupDims),this.router[a](Uc.EVENT_HASH_CHANGED,this.setActiveLink),this.activeService[a]("change",this.onServiceChange),this.userModel[a]("updateUserData",this.updateUserData),this.axe().appView[a]("updateUserScores",this.updateUserData),this.axe().appView[a]("updateDims",this.setupDims),null},b.prototype.refreshScroller=function(){return setTimeout(function(a){return function(){return a.scroller.refresh()}}(this),50),null},b.prototype.onServiceClick=function(a){var b;return a.preventDefault(),b=$(a.currentTarget).data("service"),this.axe().nav.currentView!==this.axe().nav.sections.HOME?(this.axe().router.navigateTo(this.axe().nav.sections.HOME),this.activeService.set("service",b)):this.close(function(a){return function(){return a.activeService.set("service",b)}}(this)),!1},b.prototype.onNavLinkClick=function(a){return this.axe().appView.linkManager(a),null},b.prototype.onRefreshClick=function(a){var b;return a.preventDefault(),b=$(a.currentTarget).data("refresh"),this.close(function(a){return function(){return a.axe().appData.USER.getAllData(b)}}(this)),!1},b.prototype.updateUserData=function(){return this.setUserData(),this.setUserScores(),null},b.prototype.setUserData=function(){var a,b,c;return this.$userData.empty(),this.userStatus.get("any")||this.axe().appData.USER.isLogged()?(this.$el.removeClass("not-logged"),b=this.activeService.get("service"),c=this.userModel.get("scores.total.score")?Ic.getNiceScore(this.userModel.get("scores.total.score")):"",a={avatar:this.userModel.get("info."+b+".avatar")||!1,name:this.userModel.get("info."+b+".name")||!1,username:this.getUsername(b),score_total_judgement:this.userModel.get("scores.total.judgement")||"",effort_level_label:this.axe().locale.get("mobile_navigation_effort_level_label"),effort_level:this.getEffortLevel(this.userModel.get("scores.total.judgement")),score_label_total:this.getScoreLabel(),score_total:c},this.$userData.html(this.userDataTpl(a)),null):this.$el.addClass("not-logged")},b.prototype.setUserScores=function(){var a,b,c,d,e,f,g;for(g=["tw","fb","ig"],e=0,f=g.length;f>e;e++)d=g[e],a=this.$navLinks.filter('[data-service="'+d+'"]'),a.removeClass("not-logged"),this.userModel.get("logged."+d)?(c=this.userModel.get("scores."+d+".total")?Ic.getNiceScore(this.userModel.get("scores."+d+".total")):"",b=this.userModel.get("scores."+d+".judgement")||"",a.attr("data-judgement",b).find("[data-label]").text(this.axe().locale.get("mobile_navigation_label_"+d)).end().find("[data-score]").text(c)):a.addClass("not-logged").find("[data-label]").text(this.axe().locale.get("mobile_navigation_label_not_analysed"));return null},b.prototype.getUsername=function(a){return"fb"===a?this.userModel.get("info."+a+".username"):"@"+this.userModel.get("info."+a+".username")},b.prototype.getEffortLevel=function(a){switch(a){case"tryingTooHard":return this.axe().locale.get("mobile_navigation_label_tth");case"effortless":return this.axe().locale.get("mobile_navigation_label_el");case"notHardEnough":return this.axe().locale.get("mobile_navigation_label_nth")}},b.prototype.getScoreLabel=function(){var a,b,c,d;a=0,d=this.userModel.get("logged");for(b in d)c=d[b],c&&a++;return a>1?this.axe().locale.get("mobile_navigation_average_score_label"):this.axe().locale.get("mobile_navigation_total_score_label")},b.prototype.onServiceChange=function(){return this.setActiveLink(),this.updateUserData(),null},b.prototype.setActiveLink=function(){var a,b;return this.axe().nav.currentView===this.axe().nav.sections.HOME?a='[data-service="'+this.activeService.get("service")+'"]':(b=this.axe().nav.currentView===this.axe().nav.sections.LANDING?"":this.axe().nav.currentView,a='[href="/'+b+'"]'),this.$navLinks.filter(".active").removeClass("active").end().filter(a).addClass("active"),null},b.prototype.open=function(a){return this.IS_OPEN?void 0:(this.$html.addClass("show-mobile-menu"),this.$window.scrollTop(0),this.refreshScroller(),this.disableTouch(),setTimeout(function(b){return function(){return b.IS_OPEN=!0,b.$overlay.on(b.interaction,b.close),"function"==typeof a?a():void 0}}(this),this.TRANSITION),null)},b.prototype.close=function(a){return this.$html.removeClass("show-mobile-menu"),setTimeout(function(b){return function(){return b.IS_OPEN=!1,b.$overlay.off(b.interaction,b.close),b.scroller.scrollTo(0,0,0),b.enableTouch(),"function"==typeof a?a():void 0}}(this),this.TRANSITION),null},b.prototype.showLogout=function(a){return a.preventDefault(),this.axe().appView.logoutModal?!1:(this.close(function(a){return function(){return a.axe().appView.logoutModal=new pc(a.activeService.get("service"))}}(this)),!1)},b.prototype.disableTouch=function(){return this.$overlay.on("touchmove",this.onTouchMove),null},b.prototype.enableTouch=function(){return this.$overlay.off("touchmove",this.onTouchMove),null},b.prototype.onTouchMove=function(a){return a.preventDefault(),null},b}(g),Kc=function(a){function b(a){return this.wrapper=a,this.zoomOutDone=Vd(this.zoomOutDone,this),this.zoomOut=Vd(this.zoomOut,this),this.zoomInDone=Vd(this.zoomInDone,this),this.zoomIn=Vd(this.zoomIn,this),this.go=Vd(this.go,this),this.firstViewing=Vd(this.firstViewing,this),this.getRouteData=Vd(this.getRouteData,this),this.isInViewport=Vd(this.isInViewport,this),this.setPageScroll=Vd(this.setPageScroll,this),this.getPageScroll=Vd(this.getPageScroll,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.dashboard=this.wrapper.dashboard,null}return Ud(b,a),b.prototype.wrapper=null,b.prototype.dashboard=null,b.prototype.from=null,b.prototype.to=null,b.prototype.$window=null,b.prototype.$body=null,b.prototype.$html=null,b.prototype.$modules=null,b.prototype.$header=null,b.prototype.vw=null,b.prototype.vh=null,b.prototype.containerWidth=null,b.prototype.containerHeight=null,b.prototype.headerHeight=null,b.prototype.headerOffset=null,b.prototype.moduleSelector=".dashboard-module",b.prototype.activeDeepView=null,b.prototype.activeModule=null,b.prototype.scrollTop=null,b.prototype.zooming=!1,b.prototype.open=!1,b.prototype.init=function(){var a;return this.$window=$(window),this.$body=$("body"),this.$html=$("html"),this.$modules=this.wrapper.dashboard.$el.find(this.moduleSelector),this.$header=this.$body.find("#site-header"),this.headerHeight=parseInt(this.$header.outerHeight(),10),this.headerOffset=parseInt(this.wrapper.dashboard.$el.css("marginTop"),10),this.setup(),a=_.debounce(this.setup,300),this.axe().appView.on("updateDims",a),this.axe().appView.on("showDashboardEnd",function(a){return function(){return setTimeout(a.setup,500)}}(this)),null},b.prototype.setup=function(){return this.zooming?void 0:(this.wrapper.$el.css({minHeight:0}),this.activeDeepView&&this.activeDeepView.$el.css({minHeight:0}),this.wrapper.$el.css("min-height",$(window).height()),this.vw=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.vh=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,this.containerWidth=this.wrapper.dashboard.$el.outerWidth(),this.containerHeight=this.wrapper.dashboard.$el.outerHeight(),this.activeDeepView&&this.activeDeepView.$el.css({width:this.vw,minHeight:this.vh,left:-(this.vw-this.containerWidth)/2}),this.$modules.each(function(a){return function(b,c){var d,e,f,g,h,i,j;return d=$(c),d.attr("style",""),i=d.position().top,f=parseInt(d.css("left"),10),g=a.containerWidth/2-f,h=a.containerHeight/2-i,j=d.outerWidth(),e=d.outerHeight(),d.data("initiated")&&a.activeDeepView||d.data("width",j).data("height",e).data("top",i).data("left",f).data("transform",""+g+"px "+h+"px").css("transform-origin",""+g+"px "+h+"px").find(".inner").css({width:j,height:e,marginTop:-(e/2),marginLeft:-(j/2)}),d.data("initiated",!0)}}(this)),null)},b.prototype.getPageScroll=function(){return window.pageYOffset},b.prototype.setPageScroll=function(a){return this.$window.scrollTop(a),null},b.prototype.isInViewport=function(a){var b;return b=this.getPageScroll(),a.data("top")+a.data("height")>b&&a.data("top")<b+this.vh?!0:!1},b.prototype.getRouteData=function(a,b){var c,d;return c={deeplink:a,type:a===this.axe().nav.sections.HOME?"dashboard":"deepViews"},d="dashboard"===c.type?b:a,c.view=this.wrapper[c.type].getView(d),"dashboard"!==c.type||c.view||(c.view=this.wrapper.dashboard.mainGraphsModule),c},b.prototype.firstViewing=function(a){var b;return a!==this.axe().nav.sections.HOME?(b=this.wrapper.deepViews.getView(a),this.zoomIn("",b)):(this.axe().appView.trigger("showDashboardStart"),this.axe().appView.trigger("showDashboardEnd")),null},b.prototype.go=function(a,b){var c,d,e;return this.from=this.getRouteData(a,b),this.to=this.getRouteData(b,a),this.dims=this.axe().appView.dims,"deepViews"===this.from.type&&"deepViews"===this.to.type?(e=this.getRouteData(a,this.axe().nav.sections.HOME),c=this.getRouteData(this.axe().nav.sections.HOME,b),d=c.view.$el.data("top")-c.view.$el.data("height")/2,d=d>this.dashboard.FULL_HEIGHT-this.dims.h?this.dashboard.FULL_HEIGHT-this.dims.h:d,this.from.view.hide(function(a){return function(){return a.zoomOut(a.from.view,e.view),TweenLite.to(window,.5,{delay:1,scrollTo:{y:d},ease:Cubic.easeInOut}),setTimeout(function(){return a.zoomIn(c.view,a.to.view)},1500)}}(this))):"dashboard"===this.from.type?this.zoomIn(this.from.view,this.to.view):"deepViews"===this.from.type&&this.from.view.hide(function(a){return function(){return a.zoomOut(a.from.view,a.to.view)}}(this)),null},b.prototype.zoomIn=function(a,b){var c;return this.zooming=!0,this.activeModule=a,this.activeDeepView=b,this.viewportScrollTop=this.getPageScroll(),this.$body.css({overflow:"hidden"}),null!=(c=this.activeModule.$el)&&c.css({transformOrigin:"50% 50%",zIndex:10}),this.activeDeepView.$el.css({width:this.vw,minHeight:this.vh,maxHeight:"none",top:0,left:-(this.vw-this.containerWidth)/2<0?-(this.vw-this.containerWidth)/2:0,position:"relative",visibility:"hidden"}),this.axe().appView.trigger("hideDashboardStart"),this.wrapper.dashboard.$el.css({"perspective-origin":"50% "+(this.viewportScrollTop+this.vh/2)+"px"}),this.activeModule.$el?(TweenLite.to(this.$modules,.5,{scale:.8}),TweenLite.to(this.$modules.not(this.activeModule.$el),.5,{scale:.8,opacity:0}),TweenLite.to(this.activeModule.$el.find(".inner"),.3,{opacity:0,ease:Cubic.easeInOut}),TweenLite.to(this.activeModule.$el,.4,{delay:.15,width:this.vw,height:this.vh,top:this.viewportScrollTop-this.headerOffset,left:-(this.vw-this.containerWidth)/2,ease:Cubic.easeInOut}),TweenLite.to(this.activeModule.$el,.9,{delay:.15,transform:"none",ease:Cubic.easeInOut,onComplete:this.zoomInDone})):(TweenLite.to(this.$modules,.5,{opacity:0}),this.zoomInDone()),null},b.prototype.zoomInDone=function(){return this.setPageScroll(0),this.$modules.css({visibility:"hidden"}),this.axe().appView.trigger("hideDashboardEnd"),this.$body.css({overflow:""}),this.wrapper.dashboard.$el.css({position:"absolute",visibility:"hidden",height:0,overflow:"hidden"}),this.activeDeepView.$el.css({visibility:"visible"}),this.activeDeepView.trigger("show"),this.zooming=!1,this.open=!0,null},b.prototype.zoomOut=function(a,b){return this.activeDeepView=this.activeDeepView||a,this.activeModule=this.activeModule||b,this.$body.css({overflow:"hidden"}),this.wrapper.dashboard.$el.css({position:"relative",visibility:"visible",height:"",overflow:""}),this.setPageScroll(this.viewportScrollTop),this.activeDeepView.$el.css({visibility:"hidden","max-height":0,position:"absolute"}),this.axe().appView.trigger("showDashboardStart"),this.activeModule?(this.$modules.not(this.activeModule.$el).css({visibility:"visible"}),this.activeModule.$el.css({visibility:"visible"}),TweenLite.to(this.activeModule.$el,.4,{width:this.activeModule.$el.data("width"),height:this.activeModule.$el.data("height"),top:this.activeModule.$el.data("top"),left:this.activeModule.$el.data("left"),ease:Cubic.easeInOut}),TweenLite.to(this.$modules,.5,{scale:1,opacity:1}),TweenLite.to(this.activeModule.$el.find(".inner"),.8,{delay:.5,opacity:1,ease:Cubic.easeInOut,onComplete:this.zoomOutDone})):this.zoomOutDone(),null},b.prototype.zoomOutDone=function(){var a,b;return this.$body.css({overflow:""}),null!=(a=this.activeModule.$el)&&a.css({transformOrigin:this.activeModule.$el.data("transform"),position:"absolute",zIndex:""}),null!=(b=this.activeDeepView.$el)&&b.removeClass("active-section"),this.axe().appView.trigger("showDashboardEnd"),this.zooming||(this.activeModule=null,this.activeDeepView=null,this.open=!1),null},b}(g),Lc=function(a){function b(a){return this.wrapper=a,this.showView=Vd(this.showView,this),this.hideView=Vd(this.hideView,this),this.go=Vd(this.go,this),this.firstViewing=Vd(this.firstViewing,this),this.getRouteData=Vd(this.getRouteData,this),this.setPageScroll=Vd(this.setPageScroll,this),this.getPageScroll=Vd(this.getPageScroll,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),null}return Ud(b,a),b.prototype.$window=null,b.prototype.$body=null,b.prototype.$html=null,b.prototype.$modules=null,b.prototype.$header=null,b.prototype.activeView=null,b.prototype.vw=null,b.prototype.vh=null,b.prototype.headerHeight=null,b.prototype.LANDSCAPE_BUFFER=130,b.prototype.moduleSelector=".dashboard-module",b.prototype.init=function(){var a;return this.$window=$(window),this.$body=$("body"),this.$html=$("html"),this.$header=this.$body.find("#site-header-mobile"),this.setup(),a=_.debounce(this.setup,300),this.$window.on("resize",a),this.axe().appView.on("updateDims",this.setup),null},b.prototype.setup=function(){return this.$modules=this.wrapper.dashboard.$el.find(this.moduleSelector),this.vw=this.axe().appView.dims.w||window.innerWidth,this.vh=this.axe().appView.dims.h||window.innerHeight,this.headerHeight=this.headerHeight||this.$header.height(),this.activeView&&this.showView(this.activeView,!0),null},b.prototype.getPageScroll=function(){return window.pageYOffset},b.prototype.setPageScroll=function(a){return this.$window.scrollTop(a),null},b.prototype.getRouteData=function(a){var b;return b=a===this.axe().nav.sections.HOME?{type:"dashboard",view:this.wrapper.dashboard.mainGraphsModule}:{type:"deepViews",view:this.wrapper.deepViews.getView(a)}},b.prototype.firstViewing=function(a){var b;return b=this.getRouteData(a),this.showView(b),null},b.prototype.go=function(a,b){var c;return c=this.axe().appView.navigationMobile,a=this.getRouteData(a),b=this.getRouteData(b),c.IS_OPEN?c.close(function(c){return function(){return a.view.hide(function(){return c.hideView(a),c.showView(b)})}}(this)):a.view.hide(function(c){return function(){return c.hideView(a),c.showView(b)}}(this)),null},b.prototype.hideView=function(a){var b;return b=a.view,b.$el.css({"min-height":"none","max-height":0,visibility:"hidden",position:"absolute"}).removeClass("active-section"),"dashboard"===a.type&&this.axe().appView.trigger("hideDashboardStart"),null},b.prototype.showView=function(a,b){var c,d;return null==b&&(b=!1),d=a.view,this.activeView=a,c="portrait"===this.axe().appView.dims.o?0:this.LANDSCAPE_BUFFER,d.$el.css({"min-height":this.vh+c,"max-height":"none",visibility:"visible",position:"relative"}).addClass("active-section").find(".inner").css("opacity",1),b||d.trigger("show"),"dashboard"===a.type&&this.axe().appView.trigger("showDashboardEnd"),null},b}(g),Mc=function(a){function b(a){return this.wrapper=a,this.zoomOutDone=Vd(this.zoomOutDone,this),this.zoomOut=Vd(this.zoomOut,this),this.zoomInDone=Vd(this.zoomInDone,this),this.zoomIn=Vd(this.zoomIn,this),this.go=Vd(this.go,this),this.firstViewing=Vd(this.firstViewing,this),this.getRouteData=Vd(this.getRouteData,this),this.setPageScroll=Vd(this.setPageScroll,this),this.getPageScroll=Vd(this.getPageScroll,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),null
}return Ud(b,a),b.prototype.$window=null,b.prototype.$body=null,b.prototype.$html=null,b.prototype.$deepviews=null,b.prototype.$modules=null,b.prototype.$header=null,b.prototype.activeView=null,b.prototype.vw=null,b.prototype.vh=null,b.prototype.headerHeight=null,b.prototype.moduleSelector=".dashboard-module",b.prototype.init=function(){var a;return this.$window=$(window),this.$body=$("body"),this.$html=$("html"),this.$deepviews=$("#deepviews"),this.$header=this.$body.find("#site-header-mobile"),this.setup(),a=_.debounce(this.setup,300),this.$window.on("resize",a),this.axe().appView.on("updateDims",this.setup),null},b.prototype.setup=function(){return this.wrapper.$el.css({minHeight:0}),this.activeDeepView&&this.activeDeepView.$el.css({minHeight:0}),this.wrapper.$el.css("min-height",$(window).height()),this.$modules=this.wrapper.dashboard.$el.find(this.moduleSelector),this.$header=this.$body.find("#site-header"),this.vw=this.axe().appView.dims.w||window.innerWidth,this.vh=this.axe().appView.dims.h||window.innerHeight,this.activeDeepView&&this.activeDeepView.$el.css({width:this.vw,minHeight:this.vh}),this.containerWidth=this.wrapper.dashboard.$el.outerWidth(),this.containerHeight=this.wrapper.dashboard.$el.outerHeight(),this.headerHeight=this.headerHeight||this.$header.height(),this.headerOffset=parseInt(this.wrapper.dashboard.$el.css("marginTop"),10),this.$deepviews.css({width:this.vw,left:-(this.vw-this.containerWidth)/2<0?-(this.vw-this.containerWidth)/2:0}),null},b.prototype.getPageScroll=function(){return window.pageYOffset},b.prototype.setPageScroll=function(a){return this.$window.scrollTop(a),null},b.prototype.getRouteData=function(a,b){var c,d;return c={deeplink:a,type:a===this.axe().nav.sections.HOME?"dashboard":"deepViews"},d="dashboard"===c.type?b:a,c.view=this.wrapper[c.type].getView(d),"dashboard"!==c.type||c.view||(c.view=this.wrapper.dashboard.mainGraphsModule),c},b.prototype.firstViewing=function(a){var b;return a!==this.axe().nav.sections.HOME?(b=this.wrapper.deepViews.getView(a),this.zoomIn("",b)):(this.axe().appView.trigger("showDashboardStart"),this.axe().appView.trigger("showDashboardEnd")),null},b.prototype.go=function(a,b){return this.from=this.getRouteData(a,b),this.to=this.getRouteData(b,a),"deepViews"===this.from.type&&"deepViews"===this.to.type?(this.$html.addClass("deepview-to-deepview"),this.from.view.hide(function(a){return function(){return a.zoomOut(a.from.view,""),a.zoomIn("",a.to.view)}}(this))):"dashboard"===this.from.type?this.zoomIn(this.from.view,this.to.view):"deepViews"===this.from.type&&this.from.view.hide(function(a){return function(){return a.zoomOut(a.from.view,a.to.view)}}(this)),null},b.prototype.zoomIn=function(a,b){return this.zooming=!0,this.activeModule=a,this.activeDeepView=b,this.viewportScrollTop=this.getPageScroll(),this.$body.css({overflow:"hidden"}),this.activeDeepView.$el.css({minHeight:this.vh,maxHeight:"none",top:0,position:"relative",visibility:"hidden"}),this.axe().appView.trigger("hideDashboardStart"),TweenLite.to(this.$modules,.5,{opacity:0,onComplete:this.zoomInDone}),null},b.prototype.zoomInDone=function(){return this.setPageScroll(0),this.$modules.css({visibility:"hidden"}),this.axe().appView.trigger("hideDashboardEnd"),this.$html.removeClass("deepview-to-deepview"),this.$body.css({overflow:""}),this.wrapper.dashboard.$el.css({position:"absolute",visibility:"hidden",height:0,overflow:"hidden"}),this.activeDeepView.$el.css({visibility:"visible"}),this.activeDeepView.trigger("show"),this.zooming=!1,this.open=!0,null},b.prototype.zoomOut=function(a,b){return this.activeDeepView=this.activeDeepView||a,this.activeModule=this.activeModule||b,this.$modules.css({visibility:"visible"}),this.$body.css({overflow:"hidden"}),this.wrapper.dashboard.$el.css({position:"relative",visibility:"visible",height:"",overflow:""}),this.setPageScroll(this.viewportScrollTop),this.activeDeepView.$el.css({visibility:"hidden","min-height":0,"max-height":0,position:"absolute"}),this.axe().appView.trigger("showDashboardStart"),TweenLite.to(this.$modules,.5,{opacity:1,onComplete:this.zoomOutDone}),null},b.prototype.zoomOutDone=function(){var a;return this.$body.css({overflow:""}),null!=(a=this.activeDeepView.$el)&&a.removeClass("active-section"),this.axe().appView.trigger("showDashboardEnd"),this.zooming||(this.activeModule=null,this.activeDeepView=null,this.open=!1),null},b}(g),Md=function(a){function b(){return this.onResize=Vd(this.onResize,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.id="wrapper",b.prototype.tagName="div",b.prototype.className="wrapper",b.prototype.dashboardDfd=null,b.prototype.deepViewsDfd=null,b.prototype.dashboard=null,b.prototype.deepViews=null,b.prototype.transitioner=null,b.prototype.init=function(){return this.dashboardDfd=$.Deferred(),this.deepViewsDfd=$.Deferred(),$.when(this.dashboardDfd,this.deepViewsDfd).done(function(a){return function(){return a.axe().appView.trigger("allRendered")}}(this)),this.axe().IS_MOBILE?(this.dashboard=new db(this),this.addChild(this.dashboard)):(this.dashboard=new cb(this),this.promptManager=new Rc(this),this.addChild(this.dashboard).addChild(this.promptManager)),this.transitioner=this.axe().IS_MOBILE?new Lc(this):this.axe().IS_SMALL_NON_MOBILE?new Mc(this):new Kc(this),this.deepViews=new eb(this),this.addChild(this.deepViews),this.onResize(),null},b.prototype.setup=function(){return this.$el.css("min-height",$(window).height()),null},b.prototype.onResize=function(){return this.setup(),null},b}(g),b=function(a){function b(){return this.onResize=Vd(this.onResize,this),this.animate=Vd(this.animate,this),this.render=Vd(this.render,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.className="graph",b.prototype.innerSize=null,b.prototype.colour=16777215,b.prototype.stageId="",b.prototype.size=null,b.prototype.scene=null,b.prototype.updatable=!1,b.prototype.init=function(){return this.canvas=$("<canvas/>"),this.stage=new createjs.Stage(this.canvas.get(0)),this.setup(),null},b.prototype.setup=function(){var a,b;return b=$(window).innerWidth(),a=$(window).innerHeight(),this.innerSize=[b,a],this.render(),null},b.prototype.render=function(){return this.onResize(),this.updatable&&createjs.Ticker.addEventListener("tick",this.animate),null},b.prototype.initGraph=function(a,b){this.scene=new Mb(a,b)},b.prototype.animate=function(){return this.scene&&this.updatable&&this.scene.update(),null},b.prototype.onResize=function(){var a;return this.innerSize=[$(window).innerWidth(),$(window).innerHeight()],a=this.canvas.get(0),a.width=this.innerSize[0],a.height=this.innerSize[1],null},b}(g),K=function(a){function b(){return this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.init=function(){var a;return a="https://twitter.com/intent/tweet",window.twttr.events.bind("tweet",function(){return console.log("tweet, tweet")})},b}(g),Y=function(a){function b(a,c,d){null==a&&(a=null),null==c&&(c=!1),null==d&&(d="real_time_connection_error_desc"),this.goToDashboard=Vd(this.goToDashboard,this),this.animateOut=Vd(this.animateOut,this),this.animateIn=Vd(this.animateIn,this),this.setListeners=Vd(this.setListeners,this),this.hide=Vd(this.hide,this),this.show=Vd(this.show,this),this.init=Vd(this.init,this),a&&(this.templateVars.title=this.axe().locale.get(a)),d&&(this.templateVars.desc=this.axe().locale.get(d)),this.templateVars.go_to_dashboard=this.axe().locale.get("go_to_dashboard"),this.templateVars.showBtn=c,b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.template="connection-error",b.prototype.templateVars={title:"",desc:"",go_to_dashboard:"",showBtn:!1},b.prototype.events={"click .btn":"goToDashboard"},b.prototype.init=function(){return this.setListeners("on"),null},b.prototype.show=function(){return this.animateIn()},b.prototype.hide=function(){return this.animateOut(function(a){return function(){return a.axe().appView.remove(a),a.setListeners("off"),a.trigger("close")}}(this)),null},b.prototype.setListeners=function(a){return this.axe().socket[a]("connection:up",this.hide),null},b.prototype.animateIn=function(){return TweenLite.to(this.$el,.3,{visibility:"visible",opacity:1,ease:Quad.easeOut}),TweenLite.to(this.$el.find(".inner"),.3,{delay:.15,transform:"scale(1)",visibility:"visible",opacity:1,ease:Back.easeOut}),null},b.prototype.animateOut=function(a){return TweenLite.to(this.$el,.3,{delay:.15,opacity:0,ease:Quad.easeOut,onComplete:a}),TweenLite.to(this.$el.find(".inner"),.3,{transform:"scale(0.8)",opacity:0,ease:Back.easeIn}),null},b.prototype.goToDashboard=function(a){return a.preventDefault(),this.axe().router.navigateTo("home")},b}(g),gb=function(a){function b(a){this.getErrorMsg=Vd(this.getErrorMsg,this),this.onKeyUp=Vd(this.onKeyUp,this),this.onCloseClick=Vd(this.onCloseClick,this),this.animateOut=Vd(this.animateOut,this),this.animateIn=Vd(this.animateIn,this),this.setListeners=Vd(this.setListeners,this),this.dispose=Vd(this.dispose,this),this.hide=Vd(this.hide,this),this.init=Vd(this.init,this);var c;return c=Modernizr.svg?"svg":"jpg",this.templateVars={logoSRC:this.axe().locale.getLocaleImage("logo_header."+c),msg:this.getErrorMsg(a)},b.__super__.constructor.call(this),this.axe().appView.addChild(this),null}return Ud(b,a),b.prototype.template="error-modal",b.prototype.codes={0:"error_modal_generic_msg",1:"error_modal_msg_login_fail_tw",2:"error_modal_msg_login_fail_fb",3:"error_modal_msg_login_fail_ig"},b.prototype.init=function(){return this.setListeners("on"),this.animateIn(),null},b.prototype.hide=function(){return this.animateOut(function(a){return function(){return a.axe().appView.remove(a)}}(this)),null},b.prototype.dispose=function(){return this.setListeners("off"),this.axe().appView.errorModal=null,null},b.prototype.setListeners=function(a){return this.$el.find("[data-close]")[a]("click",this.onCloseClick),$(window)[a]("keyup",this.onKeyUp),null},b.prototype.animateIn=function(){return TweenLite.to(this.$el,.3,{visibility:"visible",opacity:1,ease:Quad.easeOut}),TweenLite.to(this.$el.find(".inner"),.3,{delay:.15,transform:"scale(1)",visibility:"visible",opacity:1,ease:Back.easeOut}),null},b.prototype.animateOut=function(a){return TweenLite.to(this.$el,.3,{delay:.15,opacity:0,ease:Quad.easeOut,onComplete:a}),TweenLite.to(this.$el.find(".inner"),.3,{transform:"scale(0.8)",opacity:0,ease:Back.easeIn}),null},b.prototype.onCloseClick=function(){return this.hide(),null},b.prototype.onKeyUp=function(a){return 27===a.keyCode&&this.hide(),null},b.prototype.getErrorMsg=function(a){var b;return b=this.codes[a]?this.codes[a]:this.codes[0],this.axe().locale.get(b)},b}(g),vb=function(a){function b(){this.dispose=Vd(this.dispose,this),this.onHideDone=Vd(this.onHideDone,this),this.hide=Vd(this.hide,this),this.show=Vd(this.show,this),this.onSubmit=Vd(this.onSubmit,this),this.onSelectBlur=Vd(this.onSelectBlur,this),this.onSelectChange=Vd(this.onSelectChange,this),this.onTermsLinkClick=Vd(this.onTermsLinkClick,this),this.onTermsCheckboxChange=Vd(this.onTermsCheckboxChange,this),this.setListeners=Vd(this.setListeners,this),this.setupSelect=Vd(this.setupSelect,this),this.init=Vd(this.init,this);var a;return this.MIN_AGE=parseInt(this.axe().locale.get("age_gate_minimum_age_required"),10),a=Modernizr.svg?"svg":"jpg",this.templateVars={IS_MOBILE:this.axe().IS_MOBILE,logoSRC:this.axe().locale.getLocaleImage("logo_header."+a),age_gate_title:this.axe().locale.get("age_gate_title"),age_gate_description:this.axe().locale.get("age_gate_description"),agree_terms:this.axe().locale.get("agree_terms"),terms_link:this.axe().locale.get("terms_link"),terms_btn_text:this.axe().locale.get("terms_btn_text"),privacy_policy_link:this.axe().locale.get("privacy_policy_link"),privacy_policy_btn_text:this.axe().locale.get("privacy_policy_btn_text"),age_question:this.axe().locale.get("age_question"),age_gate_year_label:this.axe().locale.get("age_gate_year_label"),age_gate_button_yes:this.axe().locale.get("age_gate_button_yes"),no_button_url:this.axe().locale.get("no_button_url"),years:this.YEARS},b.__super__.constructor.call(this),null}var c,d;return Ud(b,a),b.prototype.$html=null,b.prototype.$form=null,b.prototype.$ageSelect=null,b.prototype.$submitBtn=null,b.prototype.$termsCheckbox=null,b.prototype.$termsLabel=null,b.prototype.$termsLink=null,b.prototype.template="gate",b.prototype.currentYear=(new Date).getFullYear(),b.prototype.selectedAge=null,b.prototype.MIN_AGE=null,b.prototype.YEARS=function(){d=[];for(var a=c=(new Date).getFullYear();1900>=c?1900>=a:a>=1900;1900>=c?a++:a--)d.push(a);return d}.apply(this),b.prototype.init=function(){return this.$html=$("html").eq(0),this.$form=this.$el.find("[data-gate-form]"),this.$ageSelect=this.$el.find("[data-age-select]"),this.$submitBtn=this.$el.find("[data-submit-btn]"),this.$termsCheckbox=this.$el.find("#gate-terms"),this.$termsLabel=this.$el.find("#gate-terms-label"),this.$termsLink=this.$el.find("[data-terms-link]"),this.axe().IS_MOBILE||this.setupSelect(),this.setListeners("on"),window.localStorage.getItem("accepted_tc")?this.hide():this.axe().appView.rendered?this.show():this.axe().appView.on("allRendered",this.show),null},b.prototype.setupSelect=function(){return this.$ageSelect.select2({width:120,allowClear:!1,placeholder:this.axe().locale.get("age_gate_year_label")})},b.prototype.setListeners=function(a){return this.$form[a]("submit",this.onSubmit),this.$ageSelect[a]("change",this.onSelectChange),this.$termsCheckbox[a]("change",this.onTermsCheckboxChange),this.$termsLink[a]("click",this.onTermsLinkClick),this.axe().IS_MOBILE&&this.$ageSelect[a]("blur",this.onSelectBlur),null},b.prototype.onTermsCheckboxChange=function(){return this.$termsCheckbox.is(":checked")&&(this.$termsLabel.removeClass("error"),this.$termsCheckbox.removeClass("error"),this.axe().analytics.track("toggle_tc")),null},b.prototype.onTermsLinkClick=function(){return this.axe().analytics.track("tc_external_link"),null},b.prototype.onSelectChange=function(){var a,b;return b=this.$ageSelect.val()||this.currentYear,this.selectedAge=this.currentYear-b,a=this.selectedAge<this.MIN_AGE?"addClass":"removeClass",this.$form[a]("error"),null},b.prototype.onSelectBlur=function(){return this.$el.css("position","relative"),setTimeout(function(a){return function(){return a.$el.css("position","fixed")}}(this),0),null},b.prototype.onSubmit=function(a){return null!=a&&"function"==typeof a.preventDefault&&a.preventDefault(),this.onSelectChange(),this.selectedAge<this.MIN_AGE?void 0:this.$termsCheckbox.prop("checked")?(window.localStorage.setItem("accepted_tc",1),this.hide(),null):(this.$termsLabel.addClass("error"),this.$termsCheckbox.addClass("error"),void 0)},b.prototype.show=function(){return this.$html.addClass("overlay-on"),this.$el.css({display:"block"}),TweenLite.fromTo(this.$el,.5,{transform:"scale(1.3)",opacity:0},{delay:.5,transform:"scale(1)",opacity:1,ease:Back.easeOut}),null},b.prototype.hide=function(){return $(window).scrollTop(0),this.axe().appData.accepted_tc=!0,this.$html.removeClass("overlay-on"),TweenLite.fromTo(this.$el,.3,{transform:"scale(1)",opacity:1},{transform:"scale(1.3)",opacity:0,ease:Back.easeIn,onComplete:this.onHideDone}),null},b.prototype.onHideDone=function(){return this.axe().appView.remove(this),null},b.prototype.dispose=function(){return this.setListeners("off"),this.axe().appView.gate=null,null},b}(g),Mb=function(){function a(a,b){this.resize=Vd(this.resize,this),this.update=Vd(this.update,this),this.children=[],this.width=a,this.height=b,this.canvasEl=document.createElement("canvas"),this.stage=new createjs.Stage(this.canvasEl),this.stage.canvas.setAttribute("width",this.width),this.stage.canvas.setAttribute("height",this.height),this.stage.enableMouseOver(20),createjs.Touch.enable(this.stage)}return a.prototype.stage=null,a.prototype.children=null,a.prototype.canvasEl=null,a.prototype.width=0,a.prototype.height=0,a.prototype.isInit=!1,a.prototype.addChild=function(a){this.children.push(a),this.stage.addChild(a)},a.prototype.removeChild=function(a){this.stage.removeChild(a)},a.prototype.removeAllChild=function(){var a,b,c,d;for(d=this.children,b=0,c=d.length;c>b;b++)a=d[b],this.stage.removeChild(a);this.children=[]},a.prototype.update=function(){this.stage.update()},a.prototype.render=function(){},a.prototype.resize=function(a,b){return this.width=a,this.height=b,this.stage.width=this.width,this.stage.height=this.height,this.stage.canvas.setAttribute("width",this.width),this.stage.canvas.setAttribute("height",this.height),null},a.prototype.dispose=function(){this.removeAllChild(),this.children=null,this.stage=null,this.container=null,this.updatable=!1},a}(),Zb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.template="landing-header",b}(Rb),_b=function(a){function b(a,c){this.tags=a,this.buffer=c,this.onBodyClick=Vd(this.onBodyClick,this),this.listenToBody=Vd(this.listenToBody,this),this.unMute=Vd(this.unMute,this),this.mute=Vd(this.mute,this),this.onOpenedParticleClose=Vd(this.onOpenedParticleClose,this),this.onParticleAutoOpen=Vd(this.onParticleAutoOpen,this),this.onParticleOpen=Vd(this.onParticleOpen,this),this.updateColumnsOrder=Vd(this.updateColumnsOrder,this),this.addTag=Vd(this.addTag,this),this.removeTag=Vd(this.removeTag,this),this.appendTweet=Vd(this.appendTweet,this),this.bindBackground=Vd(this.bindBackground,this),this.appendBackground=Vd(this.appendBackground,this),this.resize=Vd(this.resize,this),this.stopLoop=Vd(this.stopLoop,this),this.startLoop=Vd(this.startLoop,this),this.setup=Vd(this.setup,this),this.calculateCanvasDimensions=Vd(this.calculateCanvasDimensions,this),this.devicePixelRatio=window.devicePixelRatio||1,b.__super__.constructor.call(this),this.listenTo(this.tags,"add",this.addTag),this.listenTo(this.tags,"remove",this.removeTag),b.cruncher=this.axe().cruncher}return Ud(b,a),b.prototype.tagName="div",b.prototype.bunny=null,b.prototype.className="landing-viz",b.prototype.margins={desktop:{marginTop:171,marginBottom:115},mobile:{portrait:{marginTop:180,marginBottom:75},landscape:{marginTop:10,marginBottom:55}}},b.prototype.updatable=!1,b.prototype.canvasMargin=.05,b.canvasDim=null,b.numOfCols=5,b.prototype.columnZIndexes={1:0,2:2,3:4,4:3,5:1},b.prototype.loop=null,b.cruncher=null,b.prototype.autoOpenCounter=0,b.prototype.autoOpenCount=100,b.prototype.backgroundColor=16777215,b.prototype.hideFirstLastEdge=780,b.prototype.calculateCanvasDimensions=function(){var a,c,d,e,f;return e=this.margins.desktop.marginTop,d=this.margins.desktop.marginBottom,c=$(window).innerWidth(),a=$(window).innerHeight(),this.axe().IS_MOBILE?(f=c>=a?"landscape":"portrait",e=this.margins.mobile[f].marginTop,d=this.margins.mobile[f].marginBottom):c<=this.hideFirstLastEdge&&a>c&&(e+=130),this.innerSize=[c*(1-2*this.canvasMargin)*this.devicePixelRatio,(a-e-d)*this.devicePixelRatio],b.canvasDim||(b.canvasDim=new Backbone.Model),b.canvasDim.set("width",this.innerSize[0]),b.canvasDim.set("height",this.innerSize[1])},b.prototype.setup=function(){return this.calculateCanvasDimensions(),this.initGraph(this.innerSize[0],this.innerSize[1]),this.scene.stage.interactive=!0,this.appendBackground(),this.columnsContainer=new createjs.Container,this.scene.stage.addChild(this.columnsContainer),this.tags.each(function(a){return function(b){var c;return c=new dc(b,a.buffer),c.landingVizEl=a.$el,b.set("vizColumn",c),c.on("particle:open",a.onParticleOpen),c.on("particle:autoopen",a.onParticleAutoOpen),a.columnsContainer.addChild(c.element)}}(this)),this.updateColumnsOrder(!1),this.listenToBody("on"),this.addChild(this.scene.canvasEl),$(this.scene.canvasEl).on("click",function(){return function(a){return a.stopPropagation()}}(this)),this.render(),null},b.prototype.startLoop=function(){return this.loop||(this.loop=setInterval(function(a){return function(){return a.appendTweet()}}(this),100)),null},b.prototype.stopLoop=function(){return clearInterval(this.loop),this.loop=null,null},b.prototype.resize=function(){var a,b;return b=_.clone(this.innerSize),this.calculateCanvasDimensions(),this.innerSize[0]!==b[0]||this.innerSize[1]!==b[1]?(a=this.scene.canvasEl,a.width=this.innerSize[0],a.height=this.innerSize[1],this.updateColumnsOrder(!1),this.opened&&this.opened.onResize(),null):void 0},b.prototype.appendBackground=function(){var a;return a=createjs.Graphics.getRGB(this.backgroundColor),this.backgroundLayer=new createjs.Shape,this.backgroundLayer.graphics.beginFill(a).drawRect(0,0,b.canvasDim.get("width"),b.canvasDim.get("height")),this.bindBackground(),this.scene.stage.addChild(this.backgroundLayer)},b.prototype.bindBackground=function(){return this.backgroundLayer.addEventListener("click",function(a){return function(b){return b.stopPropagation(),a.opened?a.opened.close():void 0}}(this))},b.prototype.appendTweet=function(){var a,b;return b=this.tags.at(Math.round(Math.random()*(this.tags.length-1))),b.get("vizColumn")?(a=!1,!this.opened&&this.autoOpenCounter===this.autoOpenCount&&this.buffer.hasTweetForTag(b)?(this.autoOpenCounter=0,a=!0):this.autoOpenCounter!==this.autoOpenCount&&this.autoOpenCounter++,b.get("vizColumn").addParticle(a)):void 0},b.prototype.removeTag=function(a){var b;return b=a.get("vizColumn"),b.element.removeAllChildren(),this.stopListening(b),this.scene.stage.removeChild(b.element),this.opened&&this.opened.tag===a&&this.opened.close(),a.set("vizColumn",null)},b.prototype.addTag=function(a){var c;return c=new dc(a,this.buffer),c.landingVizEl=this.$el,c.element.x=b.canvasDim.get("width")/2,c.on("particle:open",this.onParticleOpen),c.on("particle:autoopen",this.onParticleAutoOpen),a.set("vizColumn",c),this.columnsContainer.addChild(c.element),this.updateColumnsOrder()},b.prototype.updateColumnsOrder=function(a){var c,d;return null==a&&(a=!0),d=window.innerWidth<=this.hideFirstLastEdge,c=b.canvasDim.get("width")/(this.tags.length-(d?2:0)),this.tags.each(function(b){return function(e,f){var g,h,i;return g=e.get("vizColumn"),!d||0!==f&&4!==f?(g.setVisible(!0),h=f-(d?1:0),i=(.5+h)*c,a?(b.opened&&b.opened.tag===e&&b.opened.updatePos(i-g.element.x),createjs.Tween.get(g.element).to({x:i},800,createjs.Ease.quadOut).call(g.updateCol)):(g.element.x=i,g.updateCol()),0===h&&g.setLeftBound(-.5*c),h===b.tags.length-1?g.setRightBound(.5*c):void 0):(g.setVisible(!1),void 0)}}(this)),_.each(this.columnZIndexes,function(a){return function(b,c){return a.columnsContainer.setChildIndex(a.tags.at(c-1).get("vizColumn").element,b)}}(this))},b.prototype.onParticleOpen=function(a,b){return this.opened&&this.opened.close(),this.tags.each(function(c){return function(d){var e,f,g;return f=d.get("vizColumn"),f===b?(g={x:a.element.x/c.devicePixelRatio,y:(b.element.y+a.element.y)/c.devicePixelRatio,radius:a.getRadius()},e=$(c.scene.canvasEl),c.opened=new ac(a.tweetData,g,d,e.height()),c.opened.on("closed",c.onOpenedParticleClose,c),c.$el.append(c.opened.$el),c.opened.onAttach()):void 0}}(this))},b.prototype.onParticleAutoOpen=function(a){return this.opened||a.trigger("open",a),null},b.prototype.onOpenedParticleClose=function(a){return this.opened===a?this.opened=null:void 0},b.prototype.mute=function(){return this.listenToBody("off"),this.updatable=!1,createjs.Ticker.removeEventListener("tick",this.animate),this.stopLoop()},b.prototype.unMute=function(){return this.listenToBody("on"),this.updatable=!0,createjs.Ticker.addEventListener("tick",this.animate),this.startLoop()},b.prototype.listenToBody=function(a){return $("body")[a]("click",this.onBodyClick)},b.prototype.onBodyClick=function(a){return a.stopPropagation(),this.opened?this.opened.close():void 0},b}(b),cc=function(){function a(a,b,c,d){this.tag=a,this.horizontalFactor=b,this.col=c,null==d&&(d={}),this.updateCursor=Vd(this.updateCursor,this),this.getRadius=Vd(this.getRadius,this),this.closeParticle=Vd(this.closeParticle,this),this.openScore=Vd(this.openScore,this),this.startSlow=Vd(this.startSlow,this),this.stopSlow=Vd(this.stopSlow,this),this.setRightBound=Vd(this.setRightBound,this),this.setLeftBound=Vd(this.setLeftBound,this),this.endAnimation=Vd(this.endAnimation,this),this.startTweens=Vd(this.startTweens,this),this.onCanvasSizeChange=Vd(this.onCanvasSizeChange,this),this.drawBgCircles=Vd(this.drawBgCircles,this),this.removeClosedCircle=Vd(this.removeClosedCircle,this),this.drawClosedCircle=Vd(this.drawClosedCircle,this),this.redrawClosedCircle=Vd(this.redrawClosedCircle,this),this.initClosedCircle=Vd(this.initClosedCircle,this),this.changeColor=Vd(this.changeColor,this),this.redrawCircle=Vd(this.redrawCircle,this),_.extend(this,Backbone.Events),this.options=_.extend({leftBound:-999999,rightBound:999999},d),this.horizontalFactor=Math.min(this.horizontalFactor/10,1),this.horizontalFactor*=Math.random()-.5,this.verticalFactor=1-function(){switch(this.col){case 0:case 4:return.6;case 1:case 3:return.8;default:return 1}}.call(this),this.radius=this.minRadius+(this.maxRadius-this.minRadius)*Math.random(),this.element=new createjs.Container,this.element.addEventListener("click",function(a){return function(b){return b.stopPropagation(),window.axe.IS_MOBILE&&"portrait"===window.axe.appView.dims.o?(window.axe.appView.showOrientationOverlay(function(){return window.axe.appView.header.hideByScroll()}),void 0):(a.trigger("open",a),window.axe.analytics.track("tweet_bubble"),null)}}(this)),this.initClosedCircle(),this.random=Math.random(),this.startTweens(),this.listenTo(this.tag,"change:color",this.changeColor),this.listenTo(_b.canvasDim,"change",_.debounce(this.onCanvasSizeChange,100))}return a.prototype.maxRadius=.03*(window.devicePixelRatio||1),a.prototype.minRadius=.015*(window.devicePixelRatio||1),a.prototype.alpha=.6,a.prototype.minTopPoint=.3,a.prototype.maxHorizontalVariation=.25,a.prototype.paused=!1,a.prototype.opened=!1,a.prototype.devicePixelRatio=window.devicePixelRatio||1,a.prototype.redrawCircle=function(){return this.redrawClosedCircle()},a.prototype.changeColor=function(){return this.redrawCircle()},a.prototype.initClosedCircle=function(){return this.closedCircleShape=new createjs.Shape,this.closedCircleShape.alpha=this.alpha,this.element.addChild(this.closedCircleShape),this.drawClosedCircle()},a.prototype.redrawClosedCircle=function(){return this.closedCircleShape.graphics.clear(),this.drawClosedCircle()},a.prototype.drawClosedCircle=function(){var a,b;return a=createjs.Graphics.getRGB(this.tag.get("color")),b=this.radius*_b.canvasDim.get("width"),this.closedCircleShape.graphics.beginFill(a).drawCircle(0,0,b),this.closedCircleShape.cache(-b,-b,2*b,2*b)},a.prototype.removeClosedCircle=function(){return this.element.removeChild(this.closedCircleShape)},a.prototype.drawBgCircles=function(){var a;return a=createjs.Graphics.getRGB(this.tag.get("color")),this.bgCircleBigShape.graphics.beginFill(a).drawCircle(0,0,this.openedRadius)},a.prototype.onCanvasSizeChange=function(){var a;return this.timeline.setPaused(!0),a=this.timeline.position,this.redrawCircle(),this.startTweens(),this.timeline.setPosition(a)},a.prototype.startTweens=function(){var a,b,c,d,e,f,g,h,i,j;return c=_b.canvasDim.get("height"),d=_b.canvasDim.get("width"),this.element.x=0,this.element.y=c,g=(1-this.minTopPoint)*c,j=g+(this.verticalFactor*c-g)*this.random,f=this.radius*d,i={y:j-f>=0?j:f},a={y:Math.min(i.y+.4*c,c)-f},this.randomHorizontalVariation=this.maxHorizontalVariation*d*this.horizontalFactor,this.randomHorizontalVariation>0?(this.randomHorizontalVariation+f>this.options.rightBound&&(this.randomHorizontalVariation=this.options.rightBound-f),this.element.left-f>this.options.rightBound&&(this.element.left=this.options.rightBound-f)):(this.randomHorizontalVariation-f<this.options.leftBound&&(this.randomHorizontalVariation=this.options.leftBound+f),this.element<this.options.leftBound&&(this.element.left=this.options.leftBound)),this.timeline=new createjs.Timeline,b=1500,h=2e3,e=1500,this.element.scaleX=this.element.scaleY=0,this.timeline.addTween(createjs.Tween.get(this.element,{override:!0}).to({y:i.y,scaleX:1,scaleY:1},b,createjs.Ease.quadOut).call(function(a){return function(){return!a.options.autoOpen||window.axe.IS_MOBILE&&"portrait"===window.axe.appView.dims.o?void 0:a.trigger("autoopen",a)}}(this)).to({y:a.y,scaleX:.5,scaleY:.5,alpha:0},h,createjs.Ease.quartIn).call(this.endAnimation)),this.timeline.addTween(createjs.Tween.get(this.element).to({x:this.randomHorizontalVariation},e,createjs.Ease.quadOut))},a.prototype.endAnimation=function(){return this.trigger("animation:end",this)},a.prototype.setLeftBound=function(a){return this.options.leftBound=a,this.onCanvasSizeChange(),this},a.prototype.setRightBound=function(a){return this.options.rightBound=a,this.onCanvasSizeChange(),this},a.prototype.stopSlow=function(a,b){var c;return this.paused?void 0:(this.paused=!0,this.timeline.setPaused(this.paused),c={time:this.timeline.position},this.slowAnimation=createjs.Tween.get(c,{override:!0}).to({time:c.time+200},a,createjs.Ease.quadOut).call(function(){return function(){return b?b():void 0}}(this)).addEventListener("change",function(a){return function(){return a.timeline.setPosition(c.time)}}(this)))},a.prototype.startSlow=function(a,b){var c;return this.paused?(this.paused=!1,c={time:this.timeline.position},this.slowAnimation=createjs.Tween.get(c,{override:!0}).to({time:c.time+200},a,createjs.Ease.quadIn).call(function(a){return function(){return b&&b(),a.timeline.setPaused(a.paused)}}(this)).addEventListener("change",function(a){return function(){return a.timeline.setPosition(c.time)}}(this))):void 0},a.prototype.openScore=function(a){var b;return this.textView.setScore(a.score.score),b=new createjs.Timeline,b.addTween(createjs.Tween.get(this.bgCircleSmallShape).to({scaleX:1,scaleY:1},500,createjs.Ease.quadInOut)),b.addTween(createjs.Tween.get(this.whiteCircleSmallShape).to({scaleX:1,scaleY:1},500,createjs.Ease.quadInOut))},a.prototype.closeParticle=function(a){var b;return this.textView&&TweenLite.to(this.textView.$el.get(0),.2,{scale:0,autoAlpha:0,ease:Quad.easeInOut}),b=new createjs.Timeline,b.addTween(createjs.Tween.get(this.bgCircleSmallShape).to({scaleX:0,scaleY:0},300,createjs.Ease.quadInOut)),b.addTween(createjs.Tween.get(this.whiteCircleSmallShape).to({scaleX:0,scaleY:0},300,createjs.Ease.quadInOut)),b.addTween(createjs.Tween.get(this.bgCircle).wait(300).to({scaleX:0,scaleY:0},500,createjs.Ease.backOut)),b.addTween(createjs.Tween.get(this.innerCircle).wait(300).to({scaleX:0,scaleY:0},500,createjs.Ease.backOut).call(function(b){return function(){return b.detach(),a?a():void 0}}(this)))},a.prototype.getRadius=function(){return this.radius*_b.canvasDim.get("width")},a.prototype.updateCursor=function(a){return this.element.cursor=a?"pointer":null},a}(),dc=function(){function a(a,b){this.tag=a,this.buffer=b,this.populateBufferLength=Vd(this.populateBufferLength,this),this.setVisible=Vd(this.setVisible,this),this.startSlow=Vd(this.startSlow,this),this.stopSlow=Vd(this.stopSlow,this),this.onParticleOpen=Vd(this.onParticleOpen,this),this.onParticleAutoOpen=Vd(this.onParticleAutoOpen,this),this.setRightBound=Vd(this.setRightBound,this),this.setLeftBound=Vd(this.setLeftBound,this),this.updateCol=Vd(this.updateCol,this),this.getWidth=Vd(this.getWidth,this),this.endParticleAnimation=Vd(this.endParticleAnimation,this),this.addParticle=Vd(this.addParticle,this),_.extend(this,Backbone.Events),this.element=new createjs.Container,this.particles=[],this.col=3,this.cursor=this.buffer.hasTweetForTag(this.tag),this.listenTo(this.buffer,"insert:"+this.tag.get("name")+" empty:"+this.tag.get("name"),this.populateBufferLength)}return a.prototype.opened=null,a.prototype.landingVizEl=null,a.prototype.addParticle=function(a){var b,c;return a&=!(window.axe.IS_MOBILE&&"portrait"===window.axe.appView.dims.o)&&this.element.visible,b={autoOpen:a},this.leftBound&&(b.leftBound=this.leftBound),this.rightBound&&(b.rightBound=this.rightBound),c=new cc(this.tag,this.particles.length+1,this.col,b),c.landingVizEl=this.landingVizEl,this.cursorPointer&&(c.element.cursor="pointer"),this.element.addChild(c.element),c.on("animation:end",this.endParticleAnimation),c.on("open",this.onParticleOpen),c.on("autoopen",this.onParticleAutoOpen),c.on("close",this.onParticleClose),this.particles.push(c)
},a.prototype.endParticleAnimation=function(a){var b;return this.element.contains(a.element)&&this.element.removeChild(a.element),b=this.particles.indexOf(a),b>=0&&this.particles.splice(b,1),a.stopListening(_b.canvasDim)},a.prototype.getWidth=function(){return _b.canvasDim.get("width")/_b.numOfCols},a.prototype.updateCol=function(){var a;return a=this.getWidth(),this.col=Math.round((this.element.x-.5*a)/a)},a.prototype.setLeftBound=function(a){return this.leftBound=a,_.invoke(this.particles,"setLeftBound",a)},a.prototype.setRightBound=function(a){return this.rightBound=a,_.invoke(this.particles,"setRightBound",a)},a.prototype.onParticleAutoOpen=function(a){return this.trigger("particle:autoopen",a,this)},a.prototype.onParticleOpen=function(a){var b;return b=this.buffer.get(this.tag),b?a.stopSlow(400,function(c){return function(){return a.tweetData=b,c.element.removeChild(a.element),c.trigger("particle:open",a,c),a.endAnimation()}}(this)):void 0},a.prototype.stopSlow=function(a){return _.invoke(this.particles,"stopSlow",a)},a.prototype.startSlow=function(a){return _.invoke(this.particles,"startSlow",a)},a.prototype.setVisible=function(a){return this.element.visible=a},a.prototype.populateBufferLength=function(){var a;return a=this.buffer.hasTweetForTag(this.tag),this.cursorPointer!==a?_.invoke(this.particles,"updateCursor",this.cursorPointer=a):void 0},a}(),ec=function(){function a(a,b){this.tagsCollection=a,this.socket=b,this.wakeup=Vd(this.wakeup,this),this.sleep=Vd(this.sleep,this),this.setListeners=Vd(this.setListeners,this),this.initFill=Vd(this.initFill,this),this.insert=Vd(this.insert,this),this.hasTweetForTag=Vd(this.hasTweetForTag,this),this.get=Vd(this.get,this),this.onMessage=Vd(this.onMessage,this),_.extend(this,Backbone.Events),this.tagsCollection.each(function(a){return function(b){return b.get("name")?a.buffer.push({name:b.get("name"),stack:[]}):void 0}}(this))}return a.prototype.buffer=[],a.bufferElementMaxStackLength=7,a.prototype.onMessage=function(a){var b,c,d,e;if(a.data){for(c=JSON.parse(a.data).tweets,d=0,e=c.length;e>d;d++)b=c[d],this.insert(b);return null}},a.prototype.get=function(a){var b,c;return(b=_.find(this.buffer,function(b){return b.name===a.get("name")}))?(c=b.stack.shift(),0===b.stack.length&&this.trigger("empty:"+b.name),c):void 0},a.prototype.hasTweetForTag=function(a){var b;return b=_.find(this.buffer,function(b){return b.name===a.get("name")}),null!=b&&b.stack.length>0},a.prototype.insert=function(b){return b.entities.hashtags.length>0&&_.each(this.buffer,function(c){return function(d){var e;return _.some(b.entities.hashtags,function(a){return a.text===d.name})?(e=d.stack.unshift(b),a.bufferElementMaxStackLength<e&&d.stack.pop(),c.trigger("insert:"+d.name,d.stack.length)):void 0}}(this),this),null},a.prototype.initFill=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],this.insert(b);return null},a.prototype.setListeners=function(a){return this.socket[a]("message",this.onMessage)},a.prototype.sleep=function(){return this.setListeners("off")},a.prototype.wakeup=function(){return this.setListeners("on")},a}(),oc=function(a){function b(){this.setLogged=Vd(this.setLogged,this),this.render=Vd(this.render,this),this.templateVars={login_tw:this.axe().locale.get("login_tw"),login_fb:this.axe().locale.get("login_fb"),login_ig:this.axe().locale.get("login_ig"),logoURL:this.axe().locale.getLocaleImage("logo.gif"),home_description:this.axe().locale.get("landing_page_desc"),home_trending_hashtags_title:this.axe().locale.get("landing_page_title")},this.logged=!1,b.__super__.constructor.call(this),this.render()}return Ud(b,a),b.prototype.template="landing-login",b.prototype.className="landing-login",b.prototype.render=function(){return this.twitterBtn=this.$el.find(".login-twitter"),this.instagramBtn=this.$el.find(".login-instagram"),this.facebookBtn=this.$el.find(".login-facebook"),this.twitterBtn.css({"background-image":"url("+this.axe().locale.getLocaleImage("btn_login_twitter.png")+")"}),this.instagramBtn.css({"background-image":"url("+this.axe().locale.getLocaleImage("btn_login_instagram.png")+")"}),this.facebookBtn.css({"background-image":"url("+this.axe().locale.getLocaleImage("btn_login_facebook.png")+")"}),null},b.prototype.setLogged=function(a){return this.logged=a,this.$el.toggleClass("user-logged",this.logged)},b}(g),Vc=function(a){function b(a,c){this.tags=a,this.activeTags=c,this.setTag=Vd(this.setTag,this),this.reinitSearch=Vd(this.reinitSearch,this),this.initSearch=Vd(this.initSearch,this),this.render=Vd(this.render,this),this.init=Vd(this.init,this),b.__super__.constructor.call(this),this.onActiveTagsChangeDebounced=_.debounce(this.reinitSearch,100),this.listenTo(this.activeTags,"add remove",this.onActiveTagsChangeDebounced)}return Ud(b,a),b.prototype.template="landing-search",b.prototype.className="landing-tags-item",b.prototype.init=function(){return this.render()},b.prototype.render=function(){return this.searchBox=this.$el.find('input[name="search"]'),this.initSearch(),null},b.prototype.initSearch=function(){return this.tagsArr=[],this.tags.each(function(a){return function(b,c){return _.contains(a.activeTags.without(a.activeTags.at(2)),b)?void 0:a.tagsArr.push({id:c+1,name:"#"+b.get("name")})}}(this)),this.searchBox.select2({data:{results:this.tagsArr,text:"name"},formatResult:function(a){return a.name},formatSelection:function(a){return a.name},allowClear:!1,placeholder:"",minimumResultsForSearch:window.innerWidth<=800||window.devicePixelRatio>1?-1:0,landing:!0}),(window.innerWidth<=800||window.devicePixelRatio>1)&&this.$el.find(".select2-container input").remove(),this.searchBox.select2("val",this.tags.indexOf(this.activeTags.at(2))+1),this.searchBox.on("select2-selecting",function(a){return function(b){return a.trigger("selectHashtag",_.find(a.tagsArr,function(a){return a.id===b.val})),null}}(this)),this.searchBox.on("select2-open",function(a){return function(){return $(".select2-results").each(function(){return $(this).niceScroll({cursorcolor:"#DEDEDE",cursorborder:"none"})}),$(a).select2("positionDropdown")}}(this))},b.prototype.reinitSearch=function(){return this.searchBox.select2("destroy"),this.initSearch(),null},b.prototype.setTag=function(){},b}(g),vd=function(a){function b(){this.render=Vd(this.render,this),this.setTag=Vd(this.setTag,this),this.click=Vd(this.click,this),this.templateVars={tag:"",tagColor:""},b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.className="landing-tags-item",b.prototype.template="landing-tags-item",b.prototype.events={click:"click"},b.prototype.click=function(a){return a.preventDefault(),!1},b.prototype.setTag=function(a){return this.tag=a,this.render()},b.prototype.render=function(){var a;return this.templateVars={tag:this.tag.get("name"),tagColor:this.tag.get("color")},a=_.template(this.axe().templates.get(this.template)),this.$el.html(a(this.templateVars)),null},b}(g),wd=function(a){function b(a,c,d){this.allTags=a,this.activeTags=c,this.displayMenu=null!=d?d:!0,this.populateTagPositions=Vd(this.populateTagPositions,this),this.init=Vd(this.init,this),b.__super__.constructor.call(this),this.listenTo(this.activeTags,"add",this.populateTagPositions)}return Ud(b,a),b.prototype.tagName="div",b.prototype.className="landing-tags",b.prototype.init=function(){var a,b;for(a=b=0;4>=b;a=++b)2===a&&this.displayMenu?(this.search=new Vc(this.allTags,this.activeTags),this.addChild(this.search)):this.addChild(new vd);return this.populateTagPositions(),null},b.prototype.populateTagPositions=function(){return this.activeTags.each(function(a){return function(b,c){return a.children[c].setTag(b)}}(this))},b}(g),ac=function(a){function b(a,c,d,e){this.tweetData=a,this.closedParticle=c,this.tag=d,this.maxTopPosition=e,this.openTweet=Vd(this.openTweet,this),this.updatePos=Vd(this.updatePos,this),this.startAnimation=Vd(this.startAnimation,this),this.close=Vd(this.close,this),this.openScore=Vd(this.openScore,this),this.onResize=Vd(this.onResize,this),this.onAttach=Vd(this.onAttach,this),this.setListeners=Vd(this.setListeners,this),this.setScore=Vd(this.setScore,this),this.templateVars=_.extend(this.tweetData,{text:minEmoji(this.tweetData.text)}),this.canvas=$("<canvas/>"),this.stage=new createjs.Stage(this.canvas.get(0)),this.stage.interactive=!0,this.openScoreSync=_.after(2,this.openScore),b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.template="landing-particle-content",b.prototype.className="particle-content",b.prototype.devicePixelRatio=window.devicePixelRatio||1,b.prototype.events={"click .innerText":"openTweet"},b.prototype.setScore=function(a){var b;return this.scoreElement=this.$el.find(".score"),b={score:a.toFixed()},TweenLite.from(b,1,{score:0,ease:Power2.easeInOut,onUpdate:function(a){return function(){return a.scoreElement.html((b.score>0?"+":"")+b.score.toFixed())}}(this)}),TweenLite.from(this.scoreElement,1,{alpha:0,ease:Quad.easeInOut})},b.prototype.setListeners=function(a){return $(window)[a]("orientationchange",function(a){return function(){return a.close()}}(this))},b.prototype.onAttach=function(){var a,b,c;return this.size={width:this.$el.width(),height:this.$el.height()},this.canvasSize=Math.sqrt(Math.pow(this.size.width,2)+Math.pow(this.size.height,2)),this.initGraph(this.canvasSize*this.devicePixelRatio,this.canvasSize*this.devicePixelRatio),this.$el.css({width:this.canvasSize,height:this.canvasSize}),b=this.tag.get("vizColumn").element.x/this.devicePixelRatio,this.startLeft=b+this.closedParticle.x-this.canvasSize/2+.05*window.innerWidth,this.startTop=this.closedParticle.y-this.canvasSize/2-(window.axe.IS_MOBILE?0:39),this.$el.css({left:this.startLeft,top:this.startTop}),a=!1,(this.startLeft<0||this.startLeft+this.canvasSize>window.innerWidth)&&(a=!0,c={left:window.innerWidth-this.canvasSize},this.startLeft<0&&(c.left=0)),this.xPos=this.closedParticle.x/b,this.innerText=this.$el.find(".innerText"),this.innerText.css({top:(this.canvasSize-this.size.height)/2}),this.addChild(this.scene.canvasEl,!0),this.animation=new bc(this.canvasSize*this.devicePixelRatio,this.closedParticle.radius,this.tag),this.scene.stage.addChild(this.animation.container),this.animation.container.addEventListener("click",function(a){return function(){return a.openTweet()}}(this)),this.animation.onUpdate=this.scene.update,this.animation.startAnimation(),a&&TweenLite.to(this.$el,.5,_.extend(c,{ease:Quad.easeInOut})),TweenLite.from(this.innerText,.5,{alpha:1,autoAlpha:0,ease:Quad.easeInOut,delay:.25,onComplete:function(a){return function(){return a.openScoreSync(),a.startAnimation()}}(this)}),_b.cruncher.crunch_tweet(this.tweetData).done(function(a){return function(b){return a.score=b.score.score,a.scoreData=b,a.$el.attr("data-judgement",b.score.judgement),a.openScoreSync()}}(this)),this.setListeners("on")},b.prototype.onResize=function(){var a,b;if(this.xPos)return a=this.tag.get("vizColumn"),b=a.element.x/this.devicePixelRatio,this.$el.css({left:b+this.xPos*a.getWidth()/this.devicePixelRatio-this.canvasSize/2+.05*window.innerWidth})},b.prototype.openScore=function(){return this.animation.setScore(this.score,function(a){return function(){return a.setScore(a.score)}}(this))},b.prototype.close=function(a){var b;return b=[this.innerText],this.scoreElement&&b.push(this.scoreElement),TweenLite.to(b,.1,{scale:0,autoAlpha:0,ease:Quad.easeInOut}),this.animation.close(function(b){return function(){return a&&a(),b.$el.remove(),b.setListeners("off"),b.trigger("closed",b)}}(this))},b.prototype.startAnimation=function(){var a;return a=Math.min(parseInt(this.$el.css("top"))+100,this.maxTopPosition-this.canvasSize-20),TweenLite.to(this.$el,5,{top:a,ease:Quad.easeInOut,onComplete:this.close})},b.prototype.updatePos=function(a){var b;return b=this.$el.position().left+a,0>b?b=0:b+this.canvasSize>window.innerWidth&&(b=window.innerWidth-this.canvasSize),TweenLite.to(this.$el,.8,{left:b,ease:Power4.easeOutQuad})},b.prototype.openTweet=function(){return this.scoreData?window.open(this.scoreData.score.source.twitter):void 0},b}(b),bc=function(){function a(a,b,c){this.size=a,this.startRadius=b,this.tag=c,this.changeColor=Vd(this.changeColor,this),this.openScore=Vd(this.openScore,this),this.close=Vd(this.close,this),this.drawScoreBubble=Vd(this.drawScoreBubble,this),this.initScoreBubble=Vd(this.initScoreBubble,this),this.initInnerCircle=Vd(this.initInnerCircle,this),this.drawBgCircles=Vd(this.drawBgCircles,this),this.initBgCircle=Vd(this.initBgCircle,this),this.setScore=Vd(this.setScore,this),this.onRsize=Vd(this.onRsize,this),this.startAnimation=Vd(this.startAnimation,this),this.calculateRadius=Vd(this.calculateRadius,this),this.init=Vd(this.init,this),_.extend(this,Backbone.Events),this.init()}return a.prototype.alpha=.6,a.prototype.smallBubbleRadius=34,a.prototype.devicePixelRatio=window.devicePixelRatio||1,a.prototype.init=function(){return this.container=new createjs.Container,this.container.x=this.container.y=this.size/2-.5,this.container.cursor="pointer",this.calculateRadius(),this.initBgCircle(),this.initInnerCircle()},a.prototype.calculateRadius=function(){return this.openedRadius=this.size/2},a.prototype.startAnimation=function(){var a;return this.listenTo(this.tag,"change:color",this.changeColor),a=new TimelineLite({paused:!0,onUpdate:function(a){return function(){return a.onUpdate?a.onUpdate():void 0}}(this)}),a.to(this.bgCircle,.5,{scaleX:1,scaleY:1,ease:Power4.easeOut},"main"),a.to(this.innerCircle,.5,{scaleX:1,scaleY:1,ease:Power4.easeInOut},"main"),a.play()},a.prototype.onRsize=function(){return null},a.prototype.setScore=function(a,b){return this.initScoreBubble(),this.openScore(b)},a.prototype.initBgCircle=function(){return this.bgCircle=new createjs.Container,this.bgCircle.alpha=this.alpha,this.bgCircle.scaleX=this.bgCircle.scaleY=this.startRadius/this.openedRadius,this.container.addChild(this.bgCircle),this.bgCircleBigShape=new createjs.Shape,this.bgCircle.addChild(this.bgCircleBigShape),this.drawBgCircles()},a.prototype.drawBgCircles=function(){var a;return a=createjs.Graphics.getRGB(this.tag.get("color")),this.bgCircleBigShape.graphics.beginFill(a).drawCircle(0,0,this.openedRadius),this.bgCircleBigShape.cache(-this.openedRadius,-this.openedRadius,2*this.openedRadius,2*this.openedRadius)},a.prototype.initInnerCircle=function(){var a,b;return this.innerCircle=new createjs.Shape,this.container.addChild(this.innerCircle),a=this.innerCircle.graphics,b=this.openedRadius-5*this.devicePixelRatio,a.beginFill(createjs.Graphics.getRGB(16777215)).drawCircle(0,0,b),this.innerCircle.cache(-b,-b,2*b,2*b),this.innerCircle.scaleX=this.innerCircle.scaleY=0},a.prototype.initScoreBubble=function(){var a,b,c,d;return this.scoreBubble=new createjs.Container,b=this.openedRadius,c=(b-5*this.devicePixelRatio)/1.42,a=new createjs.Shape,a.graphics.drawRect(-b,-b,2*b,2*b).arc(0,0,b,0,2*Math.PI,!0),this.bgCircleSmallShape=new createjs.Shape,this.drawScoreBubble(),this.bgCircleSmallShape.mask=a,this.scoreBubble.addChild(this.bgCircleSmallShape),d=new createjs.Shape,d.graphics.drawRect(-b,-b,2*b,2*b).arc(0,0,this.smallBubbleRadius*this.devicePixelRatio,0,2*Math.PI,!0),this.whiteCircleSmallShape=new createjs.Shape,this.whiteCircleSmallShape.graphics.beginFill(createjs.Graphics.getRGB(16777215)).drawCircle(c,c,(this.smallBubbleRadius-5)*this.devicePixelRatio),this.scoreBubble.addChild(this.whiteCircleSmallShape),this.bgCircleSmallShape.scaleX=this.bgCircleSmallShape.scaleY=this.whiteCircleSmallShape.scaleX=this.whiteCircleSmallShape.scaleY=0,this.container.addChild(this.scoreBubble)},a.prototype.drawScoreBubble=function(){var a,b,c;return b=this.openedRadius,c=(b-5*this.devicePixelRatio)/1.42,a=createjs.Graphics.getRGB(this.tag.get("color"),this.alpha),b=this.smallBubbleRadius*this.devicePixelRatio,this.bgCircleSmallShape.graphics.beginFill(a).drawCircle(c,c,b),this.bgCircleSmallShape.cache(c-b,c-b,2*b,2*b)},a.prototype.close=function(a){var b;return b=new TimelineLite({paused:!0,onUpdate:function(a){return function(){return a.onUpdate?a.onUpdate():void 0}}(this),onComplete:function(){return function(){return a?a():void 0}}(this)}),b.to([this.bgCircleSmallShape,this.whiteCircleSmallShape],.2,{scaleX:0,scaleY:0,ease:Power4.easeInOutQuad},"main"),b.to([this.bgCircle,this.innerCircle],.4,{scaleX:0,scaleY:0,ease:Back.easeOut},"main"),b.play()},a.prototype.openScore=function(a){var b;return b=new TimelineLite({paused:!0,onUpdate:function(a){return function(){return a.onUpdate?a.onUpdate():void 0}}(this)}),b.to([this.bgCircleSmallShape,this.whiteCircleSmallShape],.5,{scaleX:1,scaleY:1,ease:Power4.easeInOutQuad,onComplete:a},"main"),b.play()},a.prototype.changeColor=function(){return this.bgCircleBigShape&&(this.bgCircleBigShape.graphics.clear(),this.drawBgCircles()),this.bgCircleSmallShape&&(this.bgCircleSmallShape.graphics.clear(),this.drawScoreBubble()),this.onUpdate?this.onUpdate():void 0},a}(),hc=function(a){function b(){this.onHideComplete=Vd(this.onHideComplete,this),this.hideLoader=Vd(this.hideLoader,this),this.hideResult=Vd(this.hideResult,this),this.ignorePrompt=Vd(this.ignorePrompt,this),this.hidePrompt=Vd(this.hidePrompt,this),this.showPrompt=Vd(this.showPrompt,this),this.animateScore=Vd(this.animateScore,this),this.loadAvatar=Vd(this.loadAvatar,this),this.postCounterAnimation=Vd(this.postCounterAnimation,this),this.onAnimationDone=Vd(this.onAnimationDone,this),this.onAnimationHiding=Vd(this.onAnimationHiding,this),this.finishAnimation=Vd(this.finishAnimation,this),this.startAnimation=Vd(this.startAnimation,this),this.getVerdict=Vd(this.getVerdict,this),this._showError=Vd(this._showError,this),this._showScore=Vd(this._showScore,this),this._showUser=Vd(this._showUser,this),this._showLoader=Vd(this._showLoader,this),this.show=Vd(this.show,this),this.setListeners=Vd(this.setListeners,this),this.init=Vd(this.init,this),this.getScoreLabel=Vd(this.getScoreLabel,this);var a;return this.userModel=this.axe().appData.USER.model,a=Modernizr.svg?"svg":"jpg",this.templateVars={logoSRC:this.axe().locale.getLocaleImage("logo_header."+a),login_prompt:this.axe().locale.get("loader_login_prompt_text"),dismiss_prompt:this.axe().locale.get("loader_dismiss_prompt_btn"),login_tw:this.axe().locale.get("login_tw"),login_ig:this.axe().locale.get("login_ig"),continueText:this.axe().locale.get("loader_continue_to_site_btn"),IS_MOBILE:this.axe().IS_MOBILE},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="loader",b.prototype.canvas=null,b.prototype.stage=null,b.prototype.animation=null,b.prototype.userModel=null,b.prototype.service=null,b.prototype.$window=null,b.prototype.$canvas=null,b.prototype.$progress=null,b.prototype.$postCounter=null,b.prototype.$postType=null,b.prototype.$avatar=null,b.prototype.$username=null,b.prototype.$total=null,b.prototype.$score=null,b.prototype.$verdict=null,b.prototype.$circle=null,b.prototype.$fadeEls=null,b.prototype.timer=null,b.prototype.done=null,b.prototype.HIDE_DELAY=1e4,b.prototype.getScoreLabel=function(){var a;return a=function(){switch(this.service){case"tw":return"Twitter";case"fb":return"Facebook";case"ig":return"Instagram"}}.call(this),""+a+" score"},b.prototype.init=function(){return this.$window=$(window),this.$canvas=this.$el.find("#animation"),this.canvas=this.$canvas[0],this.$logo=this.$el.find("[data-logo]"),this.$progress=this.$el.find("[data-progress]"),this.$postCounter=this.$el.find("[data-post-counter]"),this.$postType=this.$el.find("[data-post-type]"),this.$avatar=this.$el.find("[data-avatar]"),this.$username=this.$el.find("[data-username]"),this.$result=this.$el.find("[data-result]"),this.$total=this.$el.find("[data-total]"),this.$score=this.$el.find("[data-score]"),this.$circle=this.$el.find("[data-circle]"),this.$verdict=this.$el.find("[data-verdict]"),this.$continueBtn=this.$el.find("[data-continue]"),this.$prompt=this.$el.find("[data-prompt]"),this.$fadeEls=this.$logo.add(this.$progress).add(this.$total).add(this.$score).add(this.$circle).add(this.$verdict).add(this.$continueBtn),null},b.prototype.setListeners=function(a){return this.$el[a]("click","[data-ignore-prompt]",this.ignorePrompt),this.$continueBtn[a]("click",this.hideResult),null},b.prototype.show=function(a,b){switch(this.done=!1,a){case"user":this._showUser();break;case"score":this._showScore();break;case"error":this._showError(b);break;default:this._showLoader()}return this},b.prototype._showLoader=function(){return this.setListeners("on"),this.axe().IS_MOBILE&&this.$window.scrollTop(0),this.service=this.axe().appView.activeService.get("service"),this.hidePrompt(),this.$el.css({display:"block"}),this.$fadeEls.css({opacity:0}),this.$progress.attr("data-progress","getting-user-data"),TweenLite.fromTo(this.$progress,.4,{transform:"translate(-30px, 0px)",opacity:0},{delay:.4,transform:"none",opacity:1,ease:Quad.easeOut}),TweenLite.fromTo(this.$logo,.4,{transform:"translate(30px, 0px)",opacity:0},{delay:.4,transform:"none",opacity:1,ease:Quad.easeOut}),TweenLite.to(this.$el,.3,{delay:.1,opacity:1,visibility:"visible"}),null},b.prototype._showUser=function(){var a,b,c;return c="tw"===this.service?"tweets":"posts",b="fb"!==this.service?"@"+this.userModel.get("info."+this.service+".username"):this.userModel.get("info."+this.service+".name"),a=this.userModel.get("info."+this.service+".avatar"),this.stage=new createjs.Stage(this.canvas),createjs.Ticker.addEventListener("tick",this.stage),this.startAnimation(),this.$postCounter.text(0),this.$postType.text(c),this.$username.text(b),this.$avatar.css({opacity:0,transform:"scale(0.8)","background-image":"url("+a+")"}),this.loadAvatar(a),this.$progress.attr("data-progress","getting-posts"),this.postCounterAnimation(),null},b.prototype._showScore=function(){var a,b;return b=Math.round(this.userModel.get("scores."+this.service+".total")),a=Ic.getNiceScore(b),this.$total.text(this.getScoreLabel()),this.$score.text(a),this.$verdict.html(this.getVerdict(b)),this.finishAnimation(),this.userModel.trigger("updateUserData"),null},b.prototype._showError=function(){return null},b.prototype.getVerdict=function(a){var b;return b=function(){switch(!0){case a>400:return this.axe().locale.get("loader_verdict_tth_high_"+_.random(1,2));case a>300:return this.axe().locale.get("loader_verdict_tth_med_"+_.random(1,3));case a>200:return this.axe().locale.get("loader_verdict_tth_low_"+_.random(1,2));case-200>a:return this.axe().locale.get("loader_verdict_nth_low_1");case-300>a:return this.axe().locale.get("loader_verdict_nth_med_1");case-400>a:return this.axe().locale.get("loader_verdict_nth_high_"+_.random(1,3));default:return this.axe().locale.get("loader_verdict_el_"+_.random(1,3))}}.call(this)},b.prototype.startAnimation=function(){return TweenLite.to(this.$canvas,.3,{scale:1,opacity:1,ease:Quad.easeIn}),this.animation=new LoaderLib.LoaderFlash(this.done,this.onAnimationHiding,this.onAnimationDone),this.stage.addChild(this.animation),this.stage.update(),null},b.prototype.finishAnimation=function(){return this.animation.finish(),null},b.prototype.onAnimationHiding=function(){return TweenLite.to(this.$canvas,.3,{scale:.6,opacity:0,ease:Quad.easeIn}),TweenLite.fromTo(this.$total,.4,{transform:"translate(-30px, 0px)",opacity:0},{delay:.15,transform:"none",opacity:1,ease:Quad.easeOut}),this.animateScore(),TweenLite.fromTo(this.$verdict,.4,{transform:"translate(-30px, 0px)",opacity:0},{delay:.55,transform:"none",opacity:1,ease:Quad.easeOut}),TweenLite.fromTo(this.$continueBtn,.4,{transform:"translate(-30px, 0px)",opacity:0},{delay:2,transform:"none",opacity:1,ease:Quad.easeOut}),null},b.prototype.onAnimationDone=function(){return this.timer=setTimeout(function(a){return function(){return a.hideResult()}}(this),this.HIDE_DELAY+.6),null},b.prototype.postCounterAnimation=function(){var a,b,c;for(b=function(a){return function(b){return setTimeout(function(){return a.$postCounter.text(b)},25*b)}}(this),a=c=1;100>=c;a=++c)b(a);return null},b.prototype.loadAvatar=function(a){var b;return b=new Image,b.onload=function(a){return function(){return a.$avatar.css({opacity:1,transform:"none"})}}(this),b.src=a,null},b.prototype.animateScore=function(){var a,b,c;return c=this.userModel.get("scores."+this.service+".judgement"),this.$result.attr("data-result",c),this.$continueBtn.attr("data-judgement",c),this.$score.css({opacity:1}),this.$score.html(function(){var b,c,d,e;for(d=this.$score.text(),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push('<span class="hidden">'+a+"</span>");return e}.call(this).join("")),b=this.$score.find("span"),b.each(function(){return function(a){return function(a){return TweenLite.to(b.eq(a),.4,{delay:.05*a+.55,transform:"translate(0,0)",ease:Bounce.easeOut})}(a)}}(this)),TweenLite.fromTo(this.$circle,.4,{transform:"scale(0.5)",opacity:0},{delay:.05*b.length+.55,transform:"translate(0,0)",opacity:1,ease:Bounce.easeOut}),null},b.prototype.showPrompt=function(){return this.$prompt.css({zIndex:2,display:"block"}),TweenLite.to(this.$prompt,.3,{delay:.1,transform:"scale(1) translate(0, -50%)",opacity:1,ease:Back.easeOut}),null},b.prototype.hidePrompt=function(a){return null==a&&(a=null),this.$prompt.css({zIndex:""}),TweenLite.to(this.$prompt,.3,{transform:"scale(1.3) translate(0, -50%)",opacity:0,ease:Back.easeIn,onComplete:a}),setTimeout(function(a){return function(){return a.$prompt.css({display:"none"})}}(this),400),null},b.prototype.ignorePrompt=function(a){return a.preventDefault(),this.hidePrompt(this.hideLoader),null},b.prototype.hideResult=function(){var a;return clearTimeout(this.timer),a=this.userModel.get("logged.tw")||this.userModel.get("logged.ig")?this.hideLoader:this.showPrompt,this.$fadeEls.each(function(b){return function(c){return function(c){var d;return d={delay:.05*c,opacity:0},c===b.$fadeEls.length-1&&(d.onComplete=a),TweenLite.to(b.$fadeEls.eq(c),.2,d)}(c)}}(this)),!1},b.prototype.hideLoader=function(){return TweenLite.to(this.$el,.3,{delay:.4,opacity:0,onComplete:this.onHideComplete}),this.$window.scrollTop(0),this.axe().router.navigateTo(this.axe().nav.sections.HOME),this.axe().appView.trigger("showDashboardStart loaderHideStart"),null},b.prototype.onHideComplete=function(){return this.$el.css({visibility:"hidden",display:"none"}),this.$circle.css({transform:"scale(0.5)"}),this.axe().appView.trigger("showDashboardEnd loaderHideEnd updateUserScores"),createjs.Ticker.removeEventListener("tick",this.stage),this.setListeners("off"),null},b}(g),pc=function(a){function b(a){this.onKeyUp=Vd(this.onKeyUp,this),this.onCloseClick=Vd(this.onCloseClick,this),this.onRemoveClick=Vd(this.onRemoveClick,this),this.onLogoutClick=Vd(this.onLogoutClick,this),this.removeUser=Vd(this.removeUser,this),this.showRemoveConfirm=Vd(this.showRemoveConfirm,this),this.animateOut=Vd(this.animateOut,this),this.animateIn=Vd(this.animateIn,this),this.setListeners=Vd(this.setListeners,this),this.dispose=Vd(this.dispose,this),this.hide=Vd(this.hide,this),this.init=Vd(this.init,this);var c;return c=this.axe().appData.USER.model,this.templateVars={name:"fb"===a?c.get("info."+a+".name"):"@"+c.get("info."+a+".username"),avatar:c.get("info."+a+".avatar"),logout_text:this.axe().locale.get("logout_text"),logout_btn:this.axe().locale.get("logout_btn"),logout_remove_btn:this.axe().locale.get("logout_remove_btn"),logout_remove_text:this.axe().locale.get("logout_remove_text"),logout_remove_yes:this.axe().locale.get("logout_remove_yes"),logout_remove_no:this.axe().locale.get("logout_remove_no")},b.__super__.constructor.call(this),this.axe().appView.addChild(this),null}return Ud(b,a),b.prototype.template="logout",b.prototype.init=function(){return this.setListeners("on"),this.animateIn(),null},b.prototype.hide=function(){return this.animateOut(function(a){return function(){return a.axe().appView.remove(a)}}(this)),null},b.prototype.dispose=function(){return this.setListeners("off"),this.axe().appView.logoutModal=null,null},b.prototype.setListeners=function(a){return this.$el.find("[data-logout]")[a]("click",this.onLogoutClick),this.$el.find("[data-remove]")[a]("click",this.onRemoveClick),this.$el.find("[data-close]")[a]("click",this.onCloseClick),$(window)[a]("keyup",this.onKeyUp),null},b.prototype.animateIn=function(){return TweenLite.to(this.$el,.3,{visibility:"visible",opacity:1,ease:Quad.easeOut}),TweenLite.to(this.$el.find(".inner"),.3,{delay:.15,transform:"scale(1)",visibility:"visible",opacity:1,ease:Back.easeOut}),null},b.prototype.animateOut=function(a){return TweenLite.to(this.$el,.3,{delay:.15,opacity:0,ease:Quad.easeOut,onComplete:a}),TweenLite.to(this.$el.find(".inner"),.3,{transform:"scale(0.8)",opacity:0,ease:Back.easeIn}),null},b.prototype.showRemoveConfirm=function(){return TweenLite.to(this.$el.find(".logout-options"),.3,{height:"0",opacity:0}),TweenLite.to(this.$el.find("[data-remove-confirm]"),.3,{maxHeight:"250px",opacity:1}),null},b.prototype.removeUser=function(){return this.$el.find('[data-remove="yes"]').text("Removing account..."),this.axe().auth.removeUser(),this.axe().analytics.track("dashboard_click_remove_acc"),null},b.prototype.onLogoutClick=function(){return this.$el.find("[data-logout]").text("Logging out...").addClass("logging-out"),this.axe().auth.logout(),this.axe().analytics.track("dashboard_click_logout"),null},b.prototype.onRemoveClick=function(a){switch($(a.currentTarget).data("remove")){case"yes":this.removeUser();break;case"no":this.hide();break;default:this.showRemoveConfirm()}return null},b.prototype.onCloseClick=function(){return this.hide(),null},b.prototype.onKeyUp=function(a){return 27===a.keyCode&&this.hide(),null},b}(g),rc=function(a){function b(){return this.positionMap=Vd(this.positionMap,this),this.hideMap=Vd(this.hideMap,this),this.showMap=Vd(this.showMap,this),this.resetMap=Vd(this.resetMap,this),this.onCityChange=Vd(this.onCityChange,this),this.onHide=Vd(this.onHide,this),this.onShow=Vd(this.onShow,this),this.hideActiveCities=Vd(this.hideActiveCities,this),this.showActiveCities=Vd(this.showActiveCities,this),this.hideTweetContent=Vd(this.hideTweetContent,this),this.hideActiveTweet=Vd(this.hideActiveTweet,this),this.showTweetContent=Vd(this.showTweetContent,this),this.showActiveTweet=Vd(this.showActiveTweet,this),this.showAllTweets=Vd(this.showAllTweets,this),this.onNewTweet=Vd(this.onNewTweet,this),this.onStartDataReceived=Vd(this.onStartDataReceived,this),this.setListeners=Vd(this.setListeners,this),this.bindEvents=Vd(this.bindEvents,this),this.setMobileDims=Vd(this.setMobileDims,this),this.setMapDefaults=Vd(this.setMapDefaults,this),this.buildZoomControls=Vd(this.buildZoomControls,this),this.buildMap=Vd(this.buildMap,this),this.init=Vd(this.init,this),this.statsData=this.axe().appData.LOCATION_STATS,this.statsModel=this.statsData.model,this.tweetsData=this.statsData.tweets,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="map-canvas",b.prototype.countries=null,b.prototype.cities=null,b.prototype.statsData=null,b.prototype.statsModel=null,b.prototype.tweetsData=null,b.prototype.$mapEl=null,b.prototype.map=null,b.prototype.$tweetMarks=null,b.prototype.tweetVisible=null,b.prototype.tweetContainer=null,b.prototype.mapListener=null,b.prototype.zoom=null,b.prototype.center=null,b.prototype.MAX_ZOOM=8,b.prototype.ZOOM_LEVELS_L={usa:4,uk:6},b.prototype.ZOOM_LEVELS_M={usa:4,uk:5},b.prototype.ZOOM_LEVELS_S={usa:3,uk:4},b.prototype.MOBILE_CONTROLS_HEIGHT=50,b.prototype.init=function(){return this.countries=this.axe().countries,this.cities=this.axe().cities,this.tweetContainer=new Nc(this),this.addChild(this.tweetContainer),this.buildMap(),this.axe().IS_MOBILE||this.buildZoomControls(),this.bindEvents(),null},b.prototype.buildMap=function(){var a;return this.$mapEl=this.$el.find("#map-canvas"),this.setMapDefaults("usa"),a={zoom:this.zoom,maxZoom:this.MAX_ZOOM,center:this.center,disableDefaultUI:!0,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:window.gmapStyles},this.map=new google.maps.Map(this.$mapEl[0],a),this.countries.setTerritories(this.map),this.cities.setTerritories(this.map),null},b.prototype.buildZoomControls=function(){return this.zoomControls=new Cc(this,this.zoom),this.addChild(this.zoomControls),null
},b.prototype.setMapDefaults=function(a){var b,c;return(a=a||this.countries.getUserCountry())?(c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,b=function(){switch(!0){case 750>c:return"S";case 1024>c:return"M";default:return"L"}}(),this.center=new google.maps.LatLng(this.countries.get(a).center[0],this.countries.get(a).center[1]),this.zoom=this["ZOOM_LEVELS_"+b][a],this.map&&this.resetMap(),null):void 0},b.prototype.setMobileDims=function(){return"landscape"===this.axe().appView.dims.o?this.$el.css({height:this.axe().appView.dims.h-this.MOBILE_CONTROLS_HEIGHT}):this.$el.css({height:""}),null},b.prototype.bindEvents=function(){return this.axe().appData.on("startDataReceived",this.onStartDataReceived),this.on("show",this.onShow),this.on("hide",this.onHide),null},b.prototype.setListeners=function(a){return this.cities.activeCities[a]("change",this.onCityChange),this.tweetsData[a]("add",this.onNewTweet),null},b.prototype.onStartDataReceived=function(){return this.setMapDefaults(),this.axe().appData.off("startDataReceived",this.onStartDataReceived),null},b.prototype.onNewTweet=function(a){return a.addToMap({mapCanvas:this,map:this.map,activeCity1:this.cities.activeCities.get("primary").get("woeid"),activeCity2:this.cities.activeCities.get("secondary").get("woeid")}),setTimeout(function(a){return function(){return a.$tweetMarks=a.$el.find(".map-tweet-marker")}}(this),0),null},b.prototype.showAllTweets=function(a){var b,c,d,e,f;for(null==a&&(a=!0),f=this.tweetsData.models,b=d=0,e=f.length;e>d;b=++d)c=f[b],c.get("visible")||!function(a){return function(b,c){return b.get("added")?setTimeout(function(){return b.show()},50*c):a.onNewTweet(b)}}(this)(c,b);return a&&setTimeout(function(a){return function(){return a.showAllTweets(!1)}}(this),500),null},b.prototype.showActiveTweet=function(a){return this.$el.addClass("tweet-active"),this.hideActiveCities(),this.tweetVisible=a,setTimeout(function(b){return function(){return a.get("latLng").equals(b.map.getCenter())?b.showTweetContent():(google.maps.event.addListenerOnce(b.map,"idle",b.showTweetContent),b.map.panTo(a.get("latLng")))}}(this),700),null},b.prototype.showTweetContent=function(){return this.tweetContainer.show(this.tweetVisible),this.mapListener=google.maps.event.addListener(this.map,"click",function(a){return function(){return a.tweetVisible.hideTweet(),a.hideActiveTweet(a.tweetVisible)}}(this)),null},b.prototype.hideActiveTweet=function(){return this.$el.removeClass("tweet-active"),this.hideTweetContent(),setTimeout(this.showActiveCities,700),this.tweetVisible=null,google.maps.event.removeListener(this.mapListener),this.mapListener=null,null},b.prototype.hideTweetContent=function(){return this.tweetContainer.hide(),null},b.prototype.showActiveCities=function(){var a,b,c,d;return a=this.cities.activeCities.get("primary"),c=this.cities.activeCities.get("secondary"),b=a.get("lng")<c.get("lng")?"left":"right",d=a.get("lng")<c.get("lng")?"right":"left",a.visible===d?a.hideMarker(function(){return function(){return a.showMarker(b)}}(this)):a.showMarker(b),c.visible===b?c.hideMarker(function(){return function(){return c.showMarker(d)}}(this)):c.showMarker(d),null},b.prototype.hideActiveCities=function(){return this.cities.activeCities.get("primary").hideMarker(),this.cities.activeCities.get("secondary").hideMarker(),null},b.prototype.onShow=function(){return this.setListeners("on"),this.axe().IS_MOBILE&&this.setMobileDims(),this.showMap(),setTimeout(function(a){return function(){return a.showAllTweets(),a.showActiveCities()}}(this),500),null},b.prototype.onHide=function(){return this.hideMap(),this.tweetVisible&&(this.tweetVisible.hideTweet(),this.hideActiveTweet(this.tweetVisible)),this.setListeners("off"),null},b.prototype.onCityChange=function(a){var b,c,d,e,f,g,h,i;if(b=a.get("primary"),c=a.get("secondary"),d=b.get("woeid"),e=c.get("woeid"),this.statsData.DEEPVIEW_VISIBLE){h=a.changed;for(f in h)g=h[f],a.previous(f).visible?a.previous(f).hideMarker(this.showActiveCities):this.showActiveCities()}return null!=(i=this.$tweetMarks)&&i.each(function(){return function(a,b){var c,f,g;return c=$(b),f=c.data("city-id"),g=f===d||f===e?"addClass":"removeClass",c[g]("in-active-city")}}(this)),this.statsData.DEEPVIEW_VISIBLE&&this.positionMap(b.get("lat"),b.get("lng"),c.get("lat"),c.get("lng")),null},b.prototype.resetMap=function(){return google.maps.event.trigger(this.map,"resize"),this.center&&this.map.setCenter(this.center),this.zoom&&this.map.setZoom(this.zoom),null},b.prototype.showMap=function(){return this.$mapEl.removeClass("map-hidden"),this.resetMap(),TweenLite.to(this.$mapEl,.3,{delay:.3,opacity:1,ease:Cubic.easeInOut}),null},b.prototype.hideMap=function(){return TweenLite.to(this.$mapEl,.3,{opacity:0,ease:Cubic.easeInOut,onComplete:function(a){return function(){return a.$mapEl.addClass("map-hidden")}}(this)}),null},b.prototype.positionMap=function(a,b,c,d){var e,f,g;return f=new google.maps.LatLng(a,b),g=new google.maps.LatLng(c,d),e=new google.maps.LatLngBounds,e.extend(f),e.extend(g),this.map.fitBounds(e),null},b}(g),sc=function(a){function b(a){this.side=a,this.updateSelect=Vd(this.updateSelect,this),this.onSelectChange=Vd(this.onSelectChange,this),this.setListeners=Vd(this.setListeners,this),this.format=Vd(this.format,this),this.setupSelect=Vd(this.setupSelect,this),this.onHide=Vd(this.onHide,this),this.onShow=Vd(this.onShow,this),this.setupEvents=Vd(this.setupEvents,this),this.init=Vd(this.init,this),window.HEYYY=this,this.otherSide="primary"===this.side?"secondary":"primary",this.cities=this.axe().cities,this.activeCities=this.cities.activeCities,this.templateVars={cities:this.cities.toJSON(),side:this.side,activeCity:this.activeCities.get(this.side).get("woeid")},b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.template="map-city-dropdown",b.prototype.side=null,b.prototype.otherSide=null,b.prototype.cities=null,b.prototype.activeCities=null,b.prototype.init=function(){return this.$select=this.$el.find("select"),this.setupSelect(),this.setupEvents(),null},b.prototype.setupEvents=function(){return this.on("show",this.onShow),this.on("hide",this.onHide),null},b.prototype.onShow=function(){return this.setListeners("on"),null},b.prototype.onHide=function(){return this.setListeners("off"),null},b.prototype.setupSelect=function(){return this.$select.select2({width:200,allowClear:!1,formatSelection:this.format,formatResult:this.format}),null},b.prototype.format=function(a){return parseInt(a.id,10)===this.activeCities.get(this.otherSide).get("woeid")?'<span class="active-city">'+a.text+"</span>":a.text},b.prototype.setListeners=function(a){return this.$select[a]("change",this.onSelectChange),this.activeCities[a]("change",this.updateSelect),null},b.prototype.onSelectChange=function(){var a;return a=parseInt(this.$select.val(),10),a===this.activeCities.get(this.otherSide).get("woeid")?(this.$select.select2("val",this.activeCities.get(this.side).get("woeid")),void 0):(this.activeCities.set(this.side,this.cities.findWhere({woeid:a})),this.axe().analytics.track("cities_change_city_"+this.side),null)},b.prototype.updateSelect=function(){return this.$select.select2("val",this.activeCities.get(this.side).get("woeid")),null},b}(g),tc=function(a){function b(a){this.side=a,this.onStatsChange=Vd(this.onStatsChange,this),this.setListeners=Vd(this.setListeners,this),this.setup=Vd(this.setup,this),this.onHide=Vd(this.onHide,this),this.onShow=Vd(this.onShow,this),this.setupEvents=Vd(this.setupEvents,this),this.init=Vd(this.init,this),this.templateVars={side:this.side},this.otherSide="primary"===this.side?"secondary":"primary",this.locationStats=this.axe().appData.LOCATION_STATS.model,this.activeCities=this.axe().cities.activeCities,b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.template="map-city-percentages",b.prototype.locationStats=null,b.prototype.activeCities=null,b.prototype.$tthCir=null,b.prototype.$tthTxt=null,b.prototype.$elCir=null,b.prototype.$elTxt=null,b.prototype.$nthCir=null,b.prototype.$nthTxt=null,b.prototype.init=function(){return this.$tthTxt=this.$el.find('[data-percentage="tth"]'),this.$tthCir=this.$el.find('[data-circle="tth"]'),this.$elTxt=this.$el.find('[data-percentage="el"]'),this.$elCir=this.$el.find('[data-circle="el"]'),this.$nthTxt=this.$el.find('[data-percentage="nth"]'),this.$nthCir=this.$el.find('[data-circle="nth"]'),this.setupEvents(),null},b.prototype.setupEvents=function(){return this.on("show",this.onShow),this.on("hide",this.onHide),null},b.prototype.onShow=function(){return this.onStatsChange(!1),this.setListeners("on"),null},b.prototype.onHide=function(){return this.setListeners("off"),null},b.prototype.setup=function(){return this.$el.find("[data-numtransition]").each(function(a,b){return Hc.setup($(b))}),null},b.prototype.setListeners=function(a){return this.locationStats[a]("change",this.onStatsChange),this.activeCities[a]("change",this.onStatsChange),null},b.prototype.onStatsChange=function(a){var b,c;return null==a&&(a=!0),c=this.locationStats.toJSON(),(c=c[this.activeCities.get(this.side).get("woeid")])?(b=a?"update":"setup",0===c.averages.tth&&(c.averages.tth="0%"),this.$tthCir.css({width:c.averages.tth,height:c.averages.tth}),Hc[b](this.$tthTxt,c.averages.tth),0===c.averages.el&&(c.averages.el="0%"),this.$elCir.css({width:c.averages.el,height:c.averages.el}),Hc[b](this.$elTxt,c.averages.el),0===c.averages.nth&&(c.averages.nth="0%"),this.$nthCir.css({width:c.averages.nth,height:c.averages.nth}),Hc[b](this.$nthTxt,c.averages.nth),null):void 0},b}(g),uc=function(a){function b(){return this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.template="map-city-selector",b.prototype.primary=null,b.prototype.secondary=null,b.prototype.init=function(){return this.header=new hb("deepview_comparecities_title2","deepview_comparecities_description2"),this.primary=new sc("primary"),this.secondary=new sc("secondary"),this.$el.append(this.axe().templates.get("map-city-dropdown-separator")),this.addChild(this.primary,!0).addChild(this.header,!0).addChild(this.secondary),null},b}(g),vc=function(a){function b(a){this.side=a,this.onCityChange=Vd(this.onCityChange,this),this.setListeners=Vd(this.setListeners,this),this.init=Vd(this.init,this),this.otherSide="primary"===this.side?"secondary":"primary",this.listTmpl=_.template(this.axe().templates.get("map-city-trends-list")),this.cities=this.axe().cities,this.activeCities=this.cities.activeCities,this.templateVars={side:this.side},b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.template="map-city-trends-list-holder",b.prototype.side=null,b.prototype.otherSide=null,b.prototype.listTmpl=null,b.prototype.init=function(){return this.setListeners("on"),this.onCityChange(),null},b.prototype.setListeners=function(a){return this.activeCities[a]("change:"+this.side,this.onCityChange),null},b.prototype.onCityChange=function(){var a,b,c,d,e,f;for(d=[],c=this.activeCities.get(this.side).get("trends"),e=0,f=c.length;f>e;e++)b=c[e],d.push({name:b.name.replace(" ","&nbsp;"),link:"#"===b.name.substr(0,1)?"http://twitter.com/search?q="+encodeURIComponent(b.name):"http://twitter.com/search?q="+encodeURIComponent('"'+b.name+'"')});return a={name:this.activeCities.get(this.side).get("name"),trendsData:d},this.$el.empty(),this.$el.append(this.listTmpl(a)),null},b}(g),wc=function(a){function b(a){this.mapCanvas=a,this.onToggleClick=Vd(this.onToggleClick,this),this.setListeners=Vd(this.setListeners,this),this.init=Vd(this.init,this),this.templateVars={graph_label_tth:this.axe().locale.get("deepview_comparecities_tth_label"),graph_label_el:this.axe().locale.get("deepview_comparecities_eff_label"),graph_label_nth:this.axe().locale.get("deepview_comparecities_nth_label")},b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.template="map-controller",b.prototype.mapCanvas=null,b.prototype.init=function(){return this.setListeners("on"),null},b.prototype.setListeners=function(a){return this.$el[a]("click","[data-show-on-map]",this.onToggleClick),null},b.prototype.onToggleClick=function(a){var b,c,d;return b=$(a.currentTarget),c=b.data("show-on-map"),b.toggleClass("on"),this.mapCanvas.$el.toggleClass("hide-"+c),null!=(d=this.mapCanvas.tweetVisible)&&d.hideTweet(),this.axe().analytics.track("cities_toggle_"+c),null},b}(g),xc=function(a){function b(){return this.setupMobile=Vd(this.setupMobile,this),this.onMaskClick=Vd(this.onMaskClick,this),this.setListeners=Vd(this.setListeners,this),this.onHide=Vd(this.onHide,this),this.onShow=Vd(this.onShow,this),this.bindEvents=Vd(this.bindEvents,this),this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.template="map-interface-module",b.prototype.mapCanvas=null,b.prototype.mapController=null,b.prototype.$window=null,b.prototype.$mapMask=null,b.prototype.init=function(){return this.$window=$(window),this.$mapMask=this.$el.find("[data-map-mask]"),this.mapCanvas=new rc,this.mapController=new wc(this.mapCanvas),this.addChild(this.mapCanvas).addChild(this.mapController),this.bindEvents(),null},b.prototype.bindEvents=function(){return this.on("show",this.onShow),this.on("hide",this.onHide),null},b.prototype.onShow=function(){return this.axe().IS_MOBILE&&this.setupMobile(),this.setListeners("on"),null},b.prototype.onHide=function(){return this.setListeners("off"),null},b.prototype.setListeners=function(a){return this.axe().IS_MOBILE&&(this.$mapMask[a]("click",this.onMaskClick),this.axe().appView[a]("updateDims",this.setupMobile)),null},b.prototype.onMaskClick=function(){return"portrait"===this.axe().appView.dims.o?this.axe().appView.showOrientationOverlay(function(a){return function(){return a.mapCanvas.setMobileDims(),a.$window.scrollTop(a.mapCanvas.$mapEl.offset().top),a.$mapMask.css({display:"none"})}}(this)):this.$mapMask.css({display:"none"}),null},b.prototype.setupMobile=function(a){return a=a||this.axe().appView.dims,this.axe().IS_MOBILE&&"portrait"===a.o?this.$mapMask.css({display:"block"}):this.$mapMask.css({display:"none"}),null},b}(g),yc=function(a){function b(){return this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.template="map-versus",b.prototype.primary=null,b.prototype.secondary=null,b.prototype.init=function(){var a,b;return a={tth:this.axe().locale.get("deepview_comparecities_tth_label"),el:this.axe().locale.get("deepview_comparecities_eff_label"),nth:this.axe().locale.get("deepview_comparecities_nth_label")},this.primary=new tc("primary"),this.secondary=new tc("secondary"),b=_.template(this.axe().templates.get("map-city-percentages-separator")),this.$el.append(b(a)),this.addChild(this.primary,!0).addChild(this.secondary),null},b}(g),zc=function(a){function b(){return this.onChange=Vd(this.onChange,this),this.setListeners=Vd(this.setListeners,this),this.onHide=Vd(this.onHide,this),this.onShow=Vd(this.onShow,this),this.setupEvents=Vd(this.setupEvents,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.model=this.axe().appData.GLOBAL_STATS.model,this.templateVars={realtime_label:this.axe().locale.get("deepview_comparecities_realtime_tweets")},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="map-counter",b.prototype.$counter=null,b.prototype.model=null,b.prototype.init=function(){return this.$counter=this.$el.find("[data-realtime-tweets]"),this.setup(),this.setupEvents(),null},b.prototype.setup=function(){return Hc.setup(this.$counter),null},b.prototype.setupEvents=function(){return this.on("show",this.onShow),this.on("hide",this.onHide),null},b.prototype.onShow=function(){return this.setup(),this.setListeners("on"),null},b.prototype.onHide=function(){return this.setListeners("off"),null},b.prototype.setListeners=function(a){return this.model[a]("change:postCounters.total_int",this.onChange),null},b.prototype.onChange=function(){var a;return a=this.model.get("postCounters.total_int").toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."),Hc.update(this.$counter,a),null},b}(g),Ac=function(a){function b(){return this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.template="map-trends",b.prototype.primary=null,b.prototype.secondary=null,b.prototype.init=function(){var a;return this.header=new hb("deepview_comparecities_mostusedhashtags_title","deepview_comparecities_mostusedhashtags_description"),this.primary=new vc("primary"),this.secondary=new vc("secondary"),a=_.template(this.axe().templates.get("map-city-trends-separator")),this.$el.append(a({list:[1,2,3,4,5,6,7,8,9,10]})),this.addChild(this.primary,!0).addChild(this.header,!0).addChild(this.secondary),null},b}(g),Cc=function(a){function b(a,c){return this.mapCanvas=a,this.initialZoom=c,this.updateIndicator=Vd(this.updateIndicator,this),this.onSliderSlide=Vd(this.onSliderSlide,this),this.onBtnClick=Vd(this.onBtnClick,this),this.zoom=Vd(this.zoom,this),this.onModelChange=Vd(this.onModelChange,this),this.onMapZoomChange=Vd(this.onMapZoomChange,this),this.setListeners=Vd(this.setListeners,this),this.bindEvents=Vd(this.bindEvents,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.map=this.mapCanvas.map,this.zoomModel=new Dc,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="map-zoom-controls",b.prototype.mapCanvas=null,b.prototype.map=null,b.prototype.initialZoom=null,b.prototype.mapListenter=null,b.prototype.$indicator=null,b.prototype.MIN_ZOOM=0,b.prototype.MAX_ZOOM=8,b.prototype.init=function(){return this.setup(),this.bindEvents(),this.zoomModel.set("zoom",this.initialZoom),null},b.prototype.setup=function(){return this.$slider=this.$el.find(".zoom-slider"),this.$slider.noUiSlider({range:[this.MIN_ZOOM,this.MAX_ZOOM],start:4,step:1,handles:1,direction:"rtl",orientation:"vertical",behaviour:"tap-drag",slide:this.onSliderSlide}),null},b.prototype.bindEvents=function(){return this.zoomModel.on("change",this.onModelChange),this.setListeners("on")},b.prototype.setListeners=function(a){return this.$el.on("click","[data-zoom-btn]",this.onBtnClick),"on"===a&&(this.mapListenter=google.maps.event.addListener(this.map,"zoom_changed",this.onMapZoomChange)),null},b.prototype.onMapZoomChange=function(){return this.zoomModel.set("zoom",this.map.getZoom()),null},b.prototype.onModelChange=function(a){var b;return b=a.get("zoom"),this.map.setZoom(b),this.updateIndicator(b),null},b.prototype.zoom=function(a){var b,c;return b=this.zoomModel.get("zoom"),"in"===a&&b===this.MAX_ZOOM||"out"===a&&b===this.MIN_ZOOM?void 0:(c="in"===a?b+1:b-1,this.zoomModel.set("zoom",c),null)},b.prototype.onBtnClick=function(a){var b;return b=$(a.currentTarget).data("zoom-btn"),this.zoom(b),null},b.prototype.onSliderSlide=function(){return this.zoomModel.set("zoom",parseInt(this.$slider.val())),null},b.prototype.updateIndicator=function(a){return this.$slider.val(a),null},b}(g),Jc=function(a){function b(a){return this.cb=a,this.onUpdateDims=Vd(this.onUpdateDims,this),this.animateOut=Vd(this.animateOut,this),this.animateIn=Vd(this.animateIn,this),this.setListeners=Vd(this.setListeners,this),this.dispose=Vd(this.dispose,this),this.hide=Vd(this.hide,this),this.init=Vd(this.init,this),this.templateVars={orientation_overlay_header:this.axe().locale.get("orientation_overlay_header"),orientation_overlay_message:this.axe().locale.get("orientation_overlay_message"),orientation_overlay_90deg:this.axe().locale.get("orientation_overlay_90deg")},b.__super__.constructor.call(this),this.axe().appView.addChild(this),null}return Ud(b,a),b.prototype.cb=null,b.prototype.template="orientation-overlay",b.prototype.init=function(){return this.setListeners("on"),this.animateIn(),null},b.prototype.hide=function(a){return null==a&&(a=!0),this.animateOut(function(b){return function(){return b.axe().appView.remove(b),a?void 0:"function"==typeof b.cb?b.cb():void 0}}(this)),null},b.prototype.dispose=function(){return this.setListeners("off"),this.axe().appView.orientationOverlay=null,null},b.prototype.setListeners=function(a){return this.axe().appView[a]("updateDims",this.onUpdateDims),this.$el[a]("touchend click",this.hide),null},b.prototype.animateIn=function(){return TweenLite.to(this.$el,.3,{visibility:"visible",opacity:1,ease:Quad.easeOut}),TweenLite.to(this.$el.find(".inner"),.3,{delay:.15,transform:"scale(1)",visibility:"visible",opacity:1,ease:Back.easeOut}),null},b.prototype.animateOut=function(a){return TweenLite.to(this.$el,.3,{delay:.15,opacity:0,ease:Quad.easeOut,onComplete:a}),TweenLite.to(this.$el.find(".inner"),.3,{transform:"scale(0.8)",opacity:0,ease:Back.easeIn}),null},b.prototype.onUpdateDims=function(a){return"landscape"===a.o&&this.hide(!1),null},b}(g),Nc=function(a){function b(){return this.onModalShowComplete=Vd(this.onModalShowComplete,this),this.listenForShow=Vd(this.listenForShow,this),this.share=Vd(this.share,this),this.onShareClick=Vd(this.onShareClick,this),this.openMediaModal=Vd(this.openMediaModal,this),this.setupListeners=Vd(this.setupListeners,this),this.loadImage=Vd(this.loadImage,this),this.closeClick=Vd(this.closeClick,this),this.hideTweet=Vd(this.hideTweet,this),this.hide=Vd(this.hide,this),this.showTweet=Vd(this.showTweet,this),this.show=Vd(this.show,this),this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.template="post-container",b.prototype.postModel=null,b.prototype.tweetTmpl=null,b.prototype.events={"click [data-close-btn]":"closeClick","click [data-share]":"onShareClick"},b.prototype.init=function(){return this.tweetTmpl=_.template(this.axe().templates.get("graph-info")),null},b.prototype.show=function(a,b){var c,d,e,f,g,h,i;return null==b&&(b=!1),this.postModel=a,this.$el.empty(),f=Modernizr.svg?"svg":"jpg",i=a.get("type"),f=Modernizr.svg?"svg":"jpg",i=a.get("type"),g=function(){switch(!0){case"twitter"===i:return"tw";case"facebook"===i:return"fb";case"instagram"===i:return"ig"}}(),d=$.extend({},a.toJSON()),h=this.axe().appData.USER.isLogged()?"tw"===g?d.user.screen_name.toLowerCase()===this.axe().appData.USER.model.get("info."+g+".username").toLowerCase()?!1:!0:"ig"===g?d.user.username.toLowerCase()===this.axe().appData.USER.model.get("info."+g+".username").toLowerCase()?!1:!0:!1:!0,c=d.user.profile_image,e=_.extend(d,{graph_label_tth:this.axe().locale.get("graph_label_tth"),graph_label_el:this.axe().locale.get("graph_label_effortless"),graph_label_nth:this.axe().locale.get("graph_label_nthe"),txt_share:this.axe().locale.get("graph_post_share"),nameLink:Pc.getNameLink(i,d),usernameLink:Pc.getUsernameLink(i,d),dateLink:Pc.getDateLink(i,d),text:Pc.getRichText(i,d.text),logoSRC:this.axe().locale.getLocaleImage("logo_AME."+f),logoURL:this.axe().locale.get("home_tips_cta_url"),logoLabel:this.axe().locale.get("graph_logo_label"),showUser:h,avatar:c,shareable:!1,fadeIn:b}),this.$el.append(this.tweetTmpl(e)).addClass("show"),this.loadImage(),null},b.prototype.showTweet=function(){return null},b.prototype.hide=function(){return this.setupListeners("off"),this.$el.removeClass("show"),this.postModel=null,null},b.prototype.hideTweet=function(){return null},b.prototype.closeClick=function(a){return a.preventDefault(),this.postModel.hideTweet(),null},b.prototype.loadImage=function(){var a,b;return(b=this.postModel.get("photo"))?(this.imageHolder=this.$el.find("[data-image-holder]"),a=new Image,a.onload=a.onerror=a.onabort=function(a){return function(){return a.imageHolder.addClass("image-loaded"),a.setupListeners("on")}}(this),a.src=b,null):void 0},b.prototype.setupListeners=function(a){var b;return null!=(b=this.imageHolder)?b[a]("click",this.openMediaModal):void 0},b.prototype.openMediaModal=function(){return this.axe().appView.postMediaModal?void 0:this.axe().appView.postMediaModal=new Oc(this.postModel.toJSON())},b.prototype.onShareClick=function(a){return this.$shareBtn=$(a.currentTarget),this.$shareBtn.addClass("loading"),this.share(),this.listenForShow(),this.axe().analytics.track("dashboard_bullseye_ind_post_share"),null},b.prototype.share=function(){return this.axe().appView.shareModal=new Zc({service:this.service,shareTo:this.service,postData:this.postModel.toJSON()}),null},b.prototype.listenForShow=function(){return this.axe().appView.shareModal.on("onShowComplete",this.onModalShowComplete),null},b.prototype.onModalShowComplete=function(){return this.$shareBtn.removeClass("loading"),this.axe().appView.shareModal.off("onShowComplete",this.onModalShowComplete),null},b}(g),Oc=function(a){function b(a){return this.postData=a,this.loadImage=Vd(this.loadImage,this),this.onKeyup=Vd(this.onKeyup,this),this.onCloseClick=Vd(this.onCloseClick,this),this.animateOut=Vd(this.animateOut,this),this.animateIn=Vd(this.animateIn,this),this.setListeners=Vd(this.setListeners,this),this.dispose=Vd(this.dispose,this),this.hide=Vd(this.hide,this),this.init=Vd(this.init,this),this.vid=_.uniqueId("media-video"),this.templateVars={photo:this.postData.photo,videos:this.postData.videos||!1,videoId:this.vid},b.__super__.constructor.call(this),this.axe().appView.addChild(this),null}return Ud(b,a),b.prototype.template="post-media-modal",b.prototype.init=function(){return this.setListeners("on"),this.animateIn(),this.postData.videos?(this.videoContainer=this.$el.find(".video-container"),require(["videojs"],function(a){return function(){return a.player=videojs(a.$el.find("#"+a.vid).get(0),{plugins:{resolutionSelector:{force_types:["video/mp4"],default_res:"HD"}}}),a.videoContainer=a.$el.find(".video-container").css({width:a.postData.videos.standard_resolution.width,height:a.postData.videos.standard_resolution.height,"margin-left":-a.postData.videos.standard_resolution.width/2,"margin-top":-a.postData.videos.standard_resolution.height/2})}}(this))):this.loadImage(),null},b.prototype.hide=function(){var a,b,c;return this.player&&("html5"===this.player.techName&&(this.player.tag.src="",null!=(b=this.player.tech)&&b.removeTriggers(),this.player.load()),null!=(c=this.player.tech)&&"function"==typeof c.destroy&&c.destroy(),"function"==typeof(a=this.player).destroy&&a.destroy(),$(this.player.el).remove()),this.animateOut(function(a){return function(){return a.axe().appView.remove(a)}}(this)),null},b.prototype.dispose=function(){return this.setListeners("off"),this.axe().appView.postMediaModal=null,null},b.prototype.setListeners=function(a){return this.$el.find("[data-close]")[a]("click",this.onCloseClick),this.$el.find(".post-image-holder")[a]("click",function(a){return a.stopImmediatePropagation()}),$(window)[a]("keyup",this.onKeyup),null},b.prototype.animateIn=function(){return TweenLite.to(this.$el,.3,{visibility:"visible",opacity:1,ease:Quad.easeOut}),TweenLite.to(this.$el.find(".inner"),.3,{delay:.15,transform:"scale(1)",visibility:"visible",opacity:1,ease:Back.easeOut}),null},b.prototype.animateOut=function(a){return TweenLite.to(this.$el,.3,{delay:.15,opacity:0,ease:Quad.easeOut,onComplete:a}),TweenLite.to(this.$el.find(".inner"),.3,{transform:"scale(0.8)",opacity:0,ease:Back.easeIn}),null},b.prototype.onCloseClick=function(){return this.hide(),null},b.prototype.onKeyup=function(a){return 27===a.keyCode&&this.hide(),null},b.prototype.loadImage=function(){var a,b,c;return(c=this.postData.photo)?(a=this.$el.find("[data-image-holder]"),b=new Image,b.onload=b.onerror=b.onabort=function(){return function(){return a.css({"max-width":b.width,"max-height":b.height}),a.addClass("image-loaded")}}(this),b.src=c,null):void 0},b}(g),Rc=function(a){function b(a){return this.wrapper=a,this.toggleGraphs=Vd(this.toggleGraphs,this),this.onActionClick=Vd(this.onActionClick,this),this.setClickEvents=Vd(this.setClickEvents,this),this.hideMsg=Vd(this.hideMsg,this),this.showMsg=Vd(this.showMsg,this),this.selectMsg=Vd(this.selectMsg,this),this.stopTimer=Vd(this.stopTimer,this),this.startShowTimer=Vd(this.startShowTimer,this),this.stop=Vd(this.stop,this),this.start=Vd(this.start,this),this.bindEvents=Vd(this.bindEvents,this),this.init=Vd(this.init,this),b.__super__.constructor.call(this),this.msgTmpl=_.template(this.axe().templates.get("prompt-container-prompt")),null}return Ud(b,a),b.prototype.wrapper=null,b.prototype.showMsgTimer=null,b.prototype.msgTmpl=null,b.prototype.template="prompt-container",b.prototype.EVENTS_ON=!1,b.prototype.PROMPT_VISIBLE=!1,b.prototype.ALL_PROMPTS_SEEN=!1,b.prototype.SHOW_DELAY_TIME=15e3,b.prototype.init=function(){return this.bindEvents(),null},b.prototype.bindEvents=function(){return this.axe().appView.on("showDashboardEnd",this.start),this.axe().appView.on("hideDashboardStart",this.stop),null},b.prototype.start=function(){return this.EVENTS_ON||this.ALL_PROMPTS_SEEN?void 0:(this.startShowTimer(),this.EVENTS_ON=!0,null)},b.prototype.stop=function(a){return null==a&&(a=!1),this.EVENTS_ON&&!this.ALL_PROMPTS_SEEN?(this.stopTimer(this.showMsgTimer),this.EVENTS_ON=!1,a&&(this.ALL_PROMPTS_SEEN=!0),null):void 0},b.prototype.startShowTimer=function(){return this.showMsgTimer=setTimeout(this.selectMsg,this.SHOW_DELAY_TIME),null},b.prototype.stopTimer=function(a){return clearTimeout(a),null},b.prototype.selectMsg=function(){var a;return(a=this.axe().appView.milestones.getNextTask())?(this.showMsg(a,this.axe().locale.get("prompt_manager_"+a)),null):this.stop(!0)},b.prototype.showMsg=function(a,b){return this.$el.attr("data-task",a).html(this.msgTmpl({msg:b})),this.PROMPT_VISIBLE=!0,this.stopTimer(this.showMsgTimer),this.setClickEvents("on"),setTimeout(function(a){return function(){return a.$el.addClass("show-prompt")}}(this),100),null},b.prototype.hideMsg=function(){return this.$el.removeClass("show-prompt"),this.PROMPT_VISIBLE=!1,this.stopTimer(this.hideMsgTimer),this.startShowTimer(),this.setClickEvents("off"),this.axe().appView.milestones.completeTask(this.$el.attr("data-task")),null},b.prototype.setClickEvents=function(a){return this.$el[a]("click",this.hideMsg),this.$el[a]("click","[data-action]",this.onActionClick),null},b.prototype.onActionClick=function(){var a;switch(a=this.$el.attr("data-task")){case"friend_click":this.toggleGraphs();break;case"seen_breakdown":this.axe().router.navigateTo(this.axe().nav.sections.PROFILE);break;case"seen_city_compare":this.axe().router.navigateTo(this.axe().nav.sections.LOCATION_STATS)}return null},b.prototype.toggleGraphs=function(){return TweenLite.to(window,.5,{scrollTo:{y:0},ease:Cubic.easeInOut}),setTimeout(function(a){return function(){var b,c,d;return b=a.axe().appView.activeService.get("service"),c=a.wrapper.dashboard.mainGraphsModule.viz["_"+b].graphControls,c.HAS_TOGGLE?null!=(d=c.toggle)?d.toggleGraphs():void 0:a.hideMsg()}}(this),500),null},b}(g),f=function(a){function b(a,c){return this.modal=a,this.data=c,this.hideLoading=Vd(this.hideLoading,this),this.showLoading=Vd(this.showLoading,this),this.getMessage=Vd(this.getMessage,this),this.getSupplantedString=Vd(this.getSupplantedString,this),this.getPredefinedVals=Vd(this.getPredefinedVals,this),this.getJudgement=Vd(this.getJudgement,this),this.getPredefinedMsg=Vd(this.getPredefinedMsg,this),this.textWrap=Vd(this.textWrap,this),this.share=Vd(this.share,this),this.setupForcedMsg=Vd(this.setupForcedMsg,this),this.onInputBlur=Vd(this.onInputBlur,this),this.onInputFocus=Vd(this.onInputFocus,this),this.focusInput=Vd(this.focusInput,this),this.unBindEvents=Vd(this.unBindEvents,this),this.bindEvents=Vd(this.bindEvents,this),this.init=Vd(this.init,this),this.data.templateVars&&(this.templateVars=_.extend(this.data.templateVars,this.templateVars||{})),this.templateVars.predefined_msg=this.getPredefinedMsg(),this.originalActionText=this.templateVars.cta_text="tw"===this.modal.shareTo&&this.modal.callingOut?this.axe().locale.get("share_modal_tw_cta_callout"):this.axe().locale.get("share_modal_"+this.modal.shareTo+"_cta"),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.modal=null,b.prototype.data=null,b.prototype.$shareBtn=null,b.prototype.$actionText=null,b.prototype.$msgContainer=null,b.prototype.$msgInput=null,b.prototype.originalActionText=null,b.prototype.loading=!1,b.prototype.init=function(){return this.$shareBtn=this.$el.find("[data-share-btn]"),this.$actionText=this.$el.find("[data-action-text]"),this.$msgContainer=this.$el.find("[data-msg-container]"),this.$msgContent=this.$el.find("[data-msg-content]"),this.$msgInput=this.$el.find("[data-msg-input]"),this.bindEvents(),null
},b.prototype.bindEvents=function(){return this.$shareBtn.on("click",this.share),this.on("shared",this.hideLoading),this.$msgContainer.length&&(this.$msgContainer.on("click",this.focusInput),this.$msgInput.on("focus",this.onInputFocus),this.$msgInput.on("blur",this.onInputBlur)),null},b.prototype.unBindEvents=function(){return this.$shareBtn.off("click",this.share),this.off("shared",this.hideLoading),this.$msgContainer.length&&(this.$msgContainer.off("click",this.focusInput),this.$msgInput.off("focus",this.onInputFocus),this.$msgInput.off("blur",this.onInputBlur)),null},b.prototype.focusInput=function(){return this.$msgInput.focus(),null},b.prototype.onInputFocus=function(){return this.$msgContainer.addClass("focused"),null},b.prototype.onInputBlur=function(){return this.$msgContainer.removeClass("focused"),null},b.prototype.setupForcedMsg=function(){var a,b,c,d;return c=this.modal.service===this.modal.shareTo?!0:!1,d=c&&"tw"===this.modal.service?!0:!1,this.modal.callingOut&&c&&d?(a=this.supplantString(this.axe().locale.get("share_modal_tw_greeting_callout"),{friend_name:"@"+this.modal.data.comparedUser.username}),b='<span class="forced-msg">'+a+"</span>",this.$msgContent.prepend(b),this.charsAvailable&&(this.charsAvailable-=a.length),null):void 0},b.prototype.share=function(){return this.trigger("shared"),null},b.prototype.textWrap=function(a){var b;return b=/#(\w+)/g,a=a.replace(b,'<span class="blue">#$1</span>'),("tw"===this.modal.shareTo||"fb"===this.modal.shareTo)&&(b=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,a=a.replace(b,'<span class="blue">$1</span>')),("tw"===this.modal.shareTo||"ig"===this.modal.shareTo)&&(b=/@(\w+)/g,a=a.replace(b,'<span class="blue">@$1</span>')),a},b.prototype.getPredefinedMsg=function(){return"ig"===this.modal.shareTo?this.modal.friendModel?this.getSupplantedString("share_modal_msg_comment_ig_friend_",this.getJudgement("post"),this.getPredefinedVals(!0,!0)):this.getSupplantedString("share_modal_msg_comment_ig_self_",this.getJudgement("post"),this.getPredefinedVals(!0,!1)):this.modal.friendModel&&"custom"===this.modal.modalType?this.modal.friendModel?this.data.post?this.getSupplantedString("share_modal_msg_callout_friend_",this.getJudgement("post"),this.getPredefinedVals(!0,!0)):this.getSupplantedString("share_modal_msg_compare_",this.getJudgement("friend"),this.getPredefinedVals(!1,!0)):"":this.data.post?this.getSupplantedString("share_modal_msg_callout_self_",this.getJudgement("post"),this.getPredefinedVals(!0,!1)):this.getSupplantedString("share_modal_msg_single_",this.getJudgement("user"),this.getPredefinedVals(!1,!1))},b.prototype.getJudgement=function(a){var b,c,d;return b=this.modal.shareable.data,"user"===a?d=b.loggedUser.scores.total:"friend"===a?d=b.comparedUser.scores.total:"post"===a&&(d=b.post.score),c=function(){switch(!0){case-200>d:return"nth";case d>200:return"tth";default:return"el"}}()},b.prototype.getPredefinedVals=function(a,b){var c,d,e,f;return c=this.modal.shareable.data,d=this.modal.service===this.modal.shareTo?!0:!1,e=!d||"tw"!==this.modal.service&&"ig"!==this.modal.service?!1:!0,f={user_name:e?"@"+c.loggedUser.username:c.loggedUser.name,user_score:Ic.getNiceScore(c.loggedUser.scores.total)},a&&(f.post_score=Ic.getNiceScore(c.post.score)),b&&(f.friend_name=e?"@"+c.comparedUser.username:c.comparedUser.name,f.friend_score=Ic.getNiceScore(c.comparedUser.scores.total)),f},b.prototype.getSupplantedString=function(a,b,c){return this.supplantString(this.axe().locale.get(""+a+b),c)},b.prototype.getMessage=function(a){var b,c,d,e;return c=$.trim(this.$msgContent.text()),this.modal.shareDeepLinkUrl?(e={image:this.modal.shareImgUrl,from:this.axe().appData.USER.model.get("info."+this.modal.service+".name")||"@"+this.axe().appData.USER.model.get("info."+this.modal.service+".username"),to:this.modal.friendModel.get("name")||"@"+this.modal.friendModel.get("username")},b=bb.encode(e),d=Tc.request({url:""+this.axe().BASE_PATH+"/api/url",type:"post",data:{url:b}}),d.done(function(b){return function(d){var e;return e=""+b.axe().BASE_PATH+d.url,a(""+c+" "+e)}}(this))):a(c),null},b.prototype.showLoading=function(){return this.loading=!0,this.originalActionText=this.originalActionText||this.$actionText.text(),this.modal.$el.addClass("loading"),this.$actionText.text(this.axe().locale.get("share_modal_"+this.modal.shareTo+"_loading_text")),null},b.prototype.hideLoading=function(){return this.modal.callingOut?void 0:(this.unBindEvents(),this.loading=!1,this.modal.$el.removeClass("loading"),this.originalActionText&&this.$actionText.text(this.originalActionText),null)},b}(g),jb=function(a){function b(){return this.getTagPositions=Vd(this.getTagPositions,this),this.getUserTags=Vd(this.getUserTags,this),this.share=Vd(this.share,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.template="share-modal-fb",b.prototype.share=function(){var a;return a=$.Deferred(),this.showLoading(),this.getMessage(function(b){return function(c){var d,e;return d={filename:"Axe Social Effort Scale",imageData:Base64Binary.decode(b.data.imgBase64.substr(22)),message:c},b.modal.shareTo===(e=b.modal.service)&&"fb"===e&&(d.tags=b.getUserTags()),a.done(function(){return b.trigger("shared")}),a.fail(function(a){return console.error("failed facebook image share",a)}),ib.postImage(d,a)}}(this)),null},b.prototype.getUserTags=function(){var a,b,c;return b=this.getTagPositions(),c=[{tag_uid:parseInt(FB.getUserID(),10),x:b.user.x,y:b.user.y}],"fb"===this.data.templateVars.service&&this.modal.friendModel&&"fb"===this.modal.friendModel.get("service")&&(a=this.modal.friendModel.get("id"),c.push({tag_uid:parseInt(a,10),x:b.friend.x,y:b.friend.y})),JSON.stringify(c).replace(/"/g,"")},b.prototype.getTagPositions=function(){var a;switch(this.modal.shareable.data.imageDisplayType){case _c.ImageDisplayType.Single:a={user:{x:50,y:50}};break;case _c.ImageDisplayType.DoubleEqual:a={user:{x:25,y:60},friend:{x:75,y:60}};break;case _c.ImageDisplayType.DoubleBiased:a={user:{x:50,y:50},friend:{x:50,y:50}}}return a},b}(f),kb=function(a){function b(a,c){return this.modal=a,this.data=c,this.share=Vd(this.share,this),this.generateContentDone=Vd(this.generateContentDone,this),this.generateContent=Vd(this.generateContent,this),this.init=Vd(this.init,this),this.templateVars=_.extend(this.templateVars||{},{btn_txt:this.axe().locale.get("share_modal_fb_generating_graph_text")}),b.__super__.constructor.apply(this,arguments),null}return Ud(b,a),b.prototype.contentReady=!1,b.prototype.template="share-modal-default",b.prototype.init=function(){return b.__super__.init.call(this),this.generateContent(),null},b.prototype.generateContent=function(){return this.modal.imageSaveRequired&&!this.modal.shareImgUrl?this.modal.on("imageUrlReceived",this.generateContentDone):(this.generateContentDone(),null)},b.prototype.generateContentDone=function(){return this.$shareBtn.removeClass("disabled"),this.$actionText.text(this.axe().locale.get("share_modal_fb_cta")),this.contentReady=!0,null},b.prototype.share=function(){return this.contentReady?(ib.share({name:axe.locale.get("seo_og_title"),link:this.axe().BASE_PATH,picture:this.modal.shareImgUrl,caption:axe.locale.get("seo_og_description"),description:this.templateVars.predefined_msg}),setTimeout(function(a){return function(){return a.trigger("shared")}}(this),1e3),null):void 0},b}(f),Wb=function(a){function b(a,c){var d,e;this.modal=a,this.data=c,this.share=Vd(this.share,this),this.init=Vd(this.init,this),e="tw"===this.modal.service?"twitter":"instagram",this.data.post&&this.modal.service===this.modal.shareTo&&(d="tw"===this.modal.shareTo?this.data.post.user.screen_name:this.data.post.user.username,this.templateVars=_.extend(this.templateVars||{},{post:{avatar:this.data.post.user.profile_picture,photo:this.data.post.photo,nameLink:Pc.getNameLink(e,this.data.post),usernameLink:Pc.getUsernameLink(e,this.data.post),text:Pc.getRichText(e,this.data.post.text),graph_label_tth:this.axe().locale.get("graph_label_tth"),graph_label_el:this.axe().locale.get("graph_label_effortless"),graph_label_nth:this.axe().locale.get("graph_label_nthe"),dateLink:Pc.getDateLink(e,this.data.post),judgement:this.data.post.judgement,score:this.data.post.score,fromLoggedUser:this.axe().appData.USER.isUser("ig",d)?!0:!1}})),b.__super__.constructor.call(this,this.modal,this.data)}return Ud(b,a),b.prototype.template="share-modal-tw-ig",b.prototype.className="shareModuleIg",b.prototype.init=function(){return b.__super__.init.call(this),null},b.prototype.share=function(){return this.showLoading(),alert("Awaiting developer access to API!!"),this.trigger("shared"),null},b}(f),Sc=function(a){function b(a,c){return this.modal=a,this.data=c,this.share=Vd(this.share,this),this.generateContentDone=Vd(this.generateContentDone,this),this.generateContent=Vd(this.generateContent,this),this.init=Vd(this.init,this),this.templateVars=_.extend(this.templateVars||{},{btn_txt:this.axe().locale.get("share_modal_pt_generating_graph_text")}),b.__super__.constructor.apply(this,arguments),null}return Ud(b,a),b.prototype.contentReady=!1,b.prototype.template="share-modal-default",b.prototype.init=function(){return b.__super__.init.call(this),this.generateContent(),null},b.prototype.generateContent=function(){return this.modal.imageSaveRequired&&!this.modal.shareImgUrl?this.modal.on("imageUrlReceived",this.generateContentDone):(this.generateContentDone(),null)},b.prototype.generateContentDone=function(){return this.$shareBtn.removeClass("disabled"),this.$actionText.text(this.axe().locale.get("share_modal_pt_cta")),this.contentReady=!0,null},b.prototype.share=function(){var a,b,c;if(this.contentReady)return c=this.axe().BASE_PATH,b=this.modal.shareImgUrl,a=this.templateVars.predefined_msg,Wc.pinterest(c,b,a),setTimeout(function(a){return function(){return a.trigger("shared")}}(this),1e3),null},b}(f),xd=function(a){function b(a,c){return this.modal=a,this.data=c,this.share=Vd(this.share,this),this.generateContentDone=Vd(this.generateContentDone,this),this.generateContent=Vd(this.generateContent,this),this.init=Vd(this.init,this),this.templateVars=_.extend(this.templateVars||{},{btn_txt:this.axe().locale.get("share_modal_tb_generating_graph_text")}),b.__super__.constructor.apply(this,arguments),null}return Ud(b,a),b.prototype.contentReady=!1,b.prototype.template="share-modal-default",b.prototype.init=function(){return b.__super__.init.call(this),this.generateContent(),null},b.prototype.generateContent=function(){return this.modal.imageSaveRequired&&!this.modal.shareImgUrl?this.modal.on("imageUrlReceived",this.generateContentDone):(this.generateContentDone(),null)},b.prototype.generateContentDone=function(){return this.$shareBtn.removeClass("disabled"),this.$actionText.text(this.axe().locale.get("share_modal_tb_cta")),this.contentReady=!0,null},b.prototype.share=function(){var a,b,c;if(this.contentReady)return c=this.axe().BASE_PATH,b=this.modal.shareImgUrl,a=this.templateVars.predefined_msg,Wc.tumblr(c,b,a),setTimeout(function(a){return function(){return a.trigger("shared")}}(this),1e3),null},b}(f),Bd=function(a){function b(a,c){var d,e;return this.modal=a,this.data=c,this.shareError=Vd(this.shareError,this),this.shareSuccess=Vd(this.shareSuccess,this),this.share=Vd(this.share,this),this.isReplyToFriend=Vd(this.isReplyToFriend,this),this.setCharCount=Vd(this.setCharCount,this),this.onKeyup=Vd(this.onKeyup,this),this.unBindEvents=Vd(this.unBindEvents,this),this.bindEvents=Vd(this.bindEvents,this),this.setupCharCounter=Vd(this.setupCharCounter,this),this.init=Vd(this.init,this),e="tw"===this.modal.service?"twitter":"instagram",this.data.post&&this.modal.service===this.modal.shareTo&&(d="tw"===this.modal.service?this.data.post.user.screen_name:this.data.post.user.username,this.templateVars=_.extend(this.templateVars||{},{post:{avatar:this.data.post.user.profile_image_url,nameLink:Pc.getNameLink(e,this.data.post),usernameLink:Pc.getUsernameLink(e,this.data.post),text:Pc.getRichText(e,this.data.post.text),graph_label_tth:this.axe().locale.get("graph_label_tth"),graph_label_el:this.axe().locale.get("graph_label_effortless"),graph_label_nth:this.axe().locale.get("graph_label_nthe"),dateLink:Pc.getDateLink(e,this.data.post),judgement:this.data.post.judgement,score:this.data.post.score,fromLoggedUser:this.axe().appData.USER.isUser("tw",d)?!0:!1}})),b.__super__.constructor.call(this,this.modal,this.data),null}return Ud(b,a),b.prototype.template="share-modal-tw-ig",b.prototype.className="shareModuleTw",b.prototype.RTre=new RegExp("\\brt\\b"),b.prototype.$charCounter=null,b.prototype.charCount=0,b.prototype.charsAvailable=117,b.prototype.canPost=!0,b.prototype.init=function(){return b.__super__.init.call(this),this.setupCharCounter(),this.setupForcedMsg(),null},b.prototype.setupCharCounter=function(){return this.modal.shareDeepLinkUrl&&(this.charsAvailable-=23),this.$charCounter=$('<span class="char-counter"></span'),this.$msgContainer.append(this.$charCounter),this.setCharCount(),null},b.prototype.bindEvents=function(){return b.__super__.bindEvents.call(this),this.$msgInput.on("keyup",this.onKeyup),null},b.prototype.unBindEvents=function(){return b.__super__.unBindEvents.call(this),this.$msgInput.off("keyup",this.onKeyup),null},b.prototype.onKeyup=function(){return this.setCharCount(),null},b.prototype.setCharCount=function(){return this.charCount=this.charsAvailable-this.$msgInput.text().length,this.charCount<0?(this.$msgContainer.addClass("error"),this.$charCounter.addClass("error").text(this.charCount),this.$shareBtn.addClass("disabled").find(this.$actionText).text(this.axe().locale.get("share_modal_tw_too_many_chars")),this.canPost=!1):(this.$msgContainer.removeClass("error"),this.$charCounter.removeClass("error").text(this.charCount),this.$shareBtn.removeClass("disabled").find(this.$actionText).text(this.originalActionText),this.canPost=!0),null},b.prototype.isReplyToFriend=function(){var a;return this.data.post&&(a="tw"===this.modal.service?this.data.post.user.screen_name:this.data.post.user.username,this.data.post&&"tw"===this.modal.shareTo&&"tw"===this.modal.service&&!this.axe().appData.USER.isUser("tw",a)&&!this.RTre.test(this.data.post.text.toLowerCase()))?!0:!1},b.prototype.share=function(){return this.canPost?(this.showLoading(),this.modal.imageSaveRequired&&!this.modal.shareImgUrl?this.modal.on("imageUrlReceived",this.share):(this.getMessage(function(a){return function(b){var c,d;return c={status:b,media:a.data.imgBase64.substr(22)},a.isReplyToFriend()&&(c.in_reply_to_status=a.data.post.id),d=Tc.request({url:""+a.axe().BASE_PATH+"/api/tw/post",type:"post",data:c}),d.done(a.shareSuccess),d.fail(a.shareError)}}(this)),null)):void 0},b.prototype.shareSuccess=function(){return this.trigger("shared"),null},b.prototype.shareError=function(a){return console.log("ERROR",a),null},b}(f),Cd=function(a){function b(a,c){return this.modal=a,this.data=c,this.share=Vd(this.share,this),this.generateContentDone=Vd(this.generateContentDone,this),this.generateContent=Vd(this.generateContent,this),this.init=Vd(this.init,this),this.templateVars=_.extend(this.templateVars||{},{btn_txt:this.axe().locale.get("share_modal_tw_generating_graph_text")}),b.__super__.constructor.apply(this,arguments),null}return Ud(b,a),b.prototype.contentReady=!1,b.prototype.shortLink=null,b.prototype.template="share-modal-default",b.prototype.init=function(){return b.__super__.init.call(this),this.generateContent(),null},b.prototype.generateContent=function(){return this.modal.imageSaveRequired&&!this.modal.shareImgUrl?this.modal.on("imageUrlReceived",this.generateContentDone):(this.generateContentDone(),null)},b.prototype.generateContentDone=function(){var a;return a=Tc.request({url:""+this.axe().BASE_PATH+"/api/url",type:"post",data:{url:this.modal.shareImgUrl}}),a.done(function(a){return function(b){return a.shortLink=""+a.axe().BASE_PATH+b.url,a.$shareBtn.removeClass("disabled"),a.$actionText.text(a.axe().locale.get("share_modal_tw_cta")),a.contentReady=!0}}(this)),null},b.prototype.share=function(){var a,b;if(this.contentReady)return b=this.axe().BASE_PATH,a=this.templateVars.predefined_msg+(" "+b)+(" "+this.shortLink),Wc.twitter(b,a),setTimeout(function(a){return function(){return a.trigger("shared")}}(this),1e3),null},b}(f),Zc=function(a){function b(a){return this.postCallOut=Vd(this.postCallOut,this),this.initShareable=Vd(this.initShareable,this),this.setFriendModel=Vd(this.setFriendModel,this),this.canUploadImage=Vd(this.canUploadImage,this),this.getModule=Vd(this.getModule,this),this.onKeyUp=Vd(this.onKeyUp,this),this.onCloseClick=Vd(this.onCloseClick,this),this.onShared=Vd(this.onShared,this),this.animateOut=Vd(this.animateOut,this),this.onShowComplete=Vd(this.onShowComplete,this),this.animateIn=Vd(this.animateIn,this),this.setListeners=Vd(this.setListeners,this),this.dispose=Vd(this.dispose,this),this.hide=Vd(this.hide,this),this.getImgEl=Vd(this.getImgEl,this),this.showModule=Vd(this.showModule,this),this.init=Vd(this.init,this),this.getModalType=Vd(this.getModalType,this),this.axe().appView.shareModal?void 0:(this.userModel=this.axe().appData.USER.model,this.service=a.service,this.shareTo=a.shareTo,this.postData=a.postData||null,this.modalType=this.getModalType(),this.templateVars={txt_share_the_result:this.axe().locale.get("share_modal_"+this.shareTo+"_title"),name:this.userModel.get("info."+this.shareTo)?this.userModel.get("info."+this.shareTo+".name"):"",username:this.userModel.get("info."+this.shareTo)?this.userModel.get("info."+this.shareTo+".username"):"",avatar:this.userModel.get("info."+this.shareTo)?this.userModel.get("info."+this.shareTo+".avatar"):"",service:this.service,shareTo:this.shareTo,modalType:this.modalType},this.postData&&(this.templateVars.post=this.postData),b.__super__.constructor.call(this),this.axe().appView.addChild(this),null)}return Ud(b,a),b.prototype.service=null,b.prototype.shareTo=null,b.prototype.postData=null,b.prototype.modalType=null,b.prototype.userModel=null,b.prototype.friendModel=null,b.prototype.imageSaveRequired=null,b.prototype.shareImgUrl=null,b.prototype.shareDeepLinkUrl=!1,b.prototype.callingOut=!1,b.prototype.callOutPosted=!1,b.prototype.template="share-modal",b.prototype.getModalType=function(){return("tw"===this.shareTo||"fb"===this.shareTo||"ig"===this.shareTo)&&this.userModel.get("logged."+this.shareTo)&&this.canUploadImage()?"custom":"default"},b.prototype.init=function(){return this.initShareable(function(a){return function(){var b;return a.imageBase64=a.shareable.getBase64(),a.postData&&(b="tw"===a.service?a.postData.user.screen_name:a.postData.user.username,a.callingOut=a.axe().appData.USER.isUser(a.service,b)?!1:!0),a.imageSaveRequired&&a.service===a.shareTo&&(a.shareDeepLinkUrl=!0),a.showModule()}}(this)),null},b.prototype.showModule=function(){var a;return null!=(a=this.axe().appView.milestones)&&a.completeTask("shared"),this.imageContainer=this.$el.find(".img-col"),this.imageContainer.append($(this.getImgEl())),this.moduleContainer=this.$el.find(".module-container"),this.module=this.getModule(this.shareTo,{imgBase64:this.imageBase64,templateVars:this.templateVars,post:this.postData}),this.moduleContainer.append(this.module.$el),this.setListeners("on"),this.animateIn(),null},b.prototype.getImgEl=function(){var a;return"ig"===this.shareTo?(a=this.postData.photo,'<span class="ig-photo" style="background-image: url('+a+');"></span>'):(a=this.imageBase64,'<img src="'+a+'"/>')},b.prototype.hide=function(){return this.animateOut(function(a){return function(){return a.axe().appView.remove(a)}}(this)),null},b.prototype.dispose=function(){return this.setListeners("off"),this.axe().appView.shareModal=null,null},b.prototype.setListeners=function(a){return this.$el.find("[data-close]")[a]("click",this.onCloseClick),$(window)[a]("keyup",this.onKeyUp),this.module[a]("shared",this.onShared),null},b.prototype.animateIn=function(){return TweenLite.to(this.$el,.3,{visibility:"visible",opacity:1,ease:Quad.easeOut}),TweenLite.to(this.$el.find(".inner"),.3,{delay:.15,transform:"none",opacity:1,ease:Back.easeOut,onComplete:this.onShowComplete}),null},b.prototype.onShowComplete=function(){return this.trigger("onShowComplete"),this.imageSaveRequired?(this.shareable.save(this.imageBase64,function(a){return function(b){return a.shareImgUrl=""+a.axe().BASE_PATH+"/"+b,a.imageContainer.find("img").attr("src",a.shareImgUrl),a.trigger("imageUrlReceived"),a.callingOut?a.module.on("shared",a.postCallOut):void 0}}(this)),null):void 0},b.prototype.animateOut=function(a){return TweenLite.to(this.$el,.3,{delay:.15,opacity:0,ease:Quad.easeOut,onComplete:a}),TweenLite.to(this.$el.find(".inner"),.3,{transform:"scale(0.8)",opacity:0,ease:Back.easeIn}),null},b.prototype.onShared=function(){return this.axe().analytics.track("dashboard_share_"+this.service+"_graph_"+this.shareTo),this.onCloseClick(),null},b.prototype.onCloseClick=function(a){return a&&a.currentTarget&&$(a.currentTarget).hasClass("close-btn")&&this.hide(),this.callingOut&&!this.callOutPosted?!1:(this.hide(),!1)},b.prototype.onKeyUp=function(a){return 27===a.keyCode&&this.hide(),null},b.prototype.getModule=function(a,b){var c;switch(c=this.userModel.get("logged."+a)?!0:!1,a){case"fb":return c&&this.canUploadImage()?new jb(this,b):new kb(this,b);case"tw":return c?new Bd(this,b):new Cd(this,b);case"ig":return new Wb(this,b);case"tb":return new xd(this,b);case"pt":return new Sc(this,b)}},b.prototype.canUploadImage=function(){var a;return a=$("html").eq(0),"fb"===this.shareTo&&a.hasClass("ie9")?!1:!0},b.prototype.setFriendModel=function(a){return a.comparedUser?this.axe().appData.FRIENDS.model.get(""+this.service).findWhere({id:a.comparedUser.id}):!1},b.prototype.initShareable=function(a){var b,c;return this.activeGraph=this.axe().appView.wrapper.dashboard.mainGraphsModule.viz["_"+this.service].graphControls.activeGraph,b=this.activeGraph.get("active"),c=b.GRAPH_TYPE,b.getShareableData().done(function(b){return function(c){return b.data=c,b.postData=b.data.post||null,b.friendModel=b.setFriendModel(b.data),b.imageSaveRequired="ig"===b.shareTo||"default"!==b.modalType&&!b.friendModel?!1:!0,b.data.service=b.service,b.data.forService=b.service,b.shareable=new _c(b.data,function(){var c;return c=b.shareable.create(function(){return a()})})}}(this)),null},b.prototype.postCallOut=function(){var a;return a={social:this.service,post_id:this.postData.id,status:this.postData.text,name:"tw"===this.service?this.postData.user.name:this.postData.user.full_name,username:"tw"===this.service?this.postData.user.screen_name:this.postData.user.username,avatar:"tw"===this.service?this.postData.user.profile_image_url:this.postData.user.profile_picture,media:this.postData.photo,created:this.postData.created,score:this.postData.score,judgement:this.postData.judgement,link:this.postData.source[this.postData.type]},$.post(""+this.axe().BASE_PATH+"/api/callout",a,function(a){return function(){return a.callOutPosted=!0,a.onCloseClick()}}(this)),null},b}(g),td=function(a){function b(a,c){return this.statsData=a,this.model=c,this.setCircleAngle=Vd(this.setCircleAngle,this),this.getCircleSpeed=Vd(this.getCircleSpeed,this),this.updateCircles=Vd(this.updateCircles,this),this.onChange=Vd(this.onChange,this),this.setListeners=Vd(this.setListeners,this),this.onHide=Vd(this.onHide,this),this.onShow=Vd(this.onShow,this),this.setupEvents=Vd(this.setupEvents,this),this.setupCircles=Vd(this.setupCircles,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.templateVars={grid:{width:"5"},total_label:this.axe().locale.get("deepview_global_stats_bar_posts"),tth_label:this.axe().locale.get("deepview_global_stats_bar_tth"),el_label:this.axe().locale.get("deepview_global_stats_bar_effortless"),nth_label:this.axe().locale.get("deepview_global_stats_bar_nth"),average_label:this.axe().locale.get("deepview_global_stats_bar_score"),IS_MOBILE:this.axe().IS_MOBILE},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="global-stats-main-header",b.prototype.$total=null,b.prototype.$av_tth=null,b.prototype.$av_el=null,b.prototype.$av_nth=null,b.prototype.$av_total=null,b.prototype.statsData=null,b.prototype.model=null,b.prototype.PI=Math.PI,b.prototype.circles=null,b.prototype.init=function(){return this.$total=this.$el.find('[data-value="total"]'),this.$av_tth=this.$el.find('[data-value="tth"]'),this.$av_el=this.$el.find('[data-value="el"]'),this.$av_nth=this.$el.find('[data-value="nth"]'),this.$av_total=this.$el.find('[data-value="average"]'),this.setup(),this.setupCircles(),this.setupEvents(),null},b.prototype.setup=function(){return this.$el.find("[data-numtransition]").each(function(a,b){return Hc.setup($(b))}),null},b.prototype.setupCircles=function(){var a,b,c,d;this.circles=[{judgement:"tth",el:document.getElementById("tth_circle"),currentAngle:0},{judgement:"el",el:document.getElementById("el_circle"),currentAngle:0},{judgement:"nth",el:document.getElementById("nth_circle"),currentAngle:0}],a=this.model,Hc.update(this.$total,a.get("postCounters.total")),d=a.attributes.averages;for(c in d)b=d[c],Hc.update(this["$av_"+c],b);return null},b.prototype.setupEvents=function(){return this.on("show",this.onShow),this.on("hide",this.onHide),null},b.prototype.onShow=function(){return this.setup(),this.setListeners("on"),null},b.prototype.onHide=function(){return this.setListeners("off"),null},b.prototype.setListeners=function(a){var b;return this.model[a]("change:averages, change:postCounters.total",this.onChange),b="on"===a?"addEventListener":"removeEventListener",createjs.Ticker[b]("tick",this.updateCircles),null},b.prototype.onChange=function(a){var b,c,d;a=a||this.model,Hc.update(this.$total,a.get("postCounters.total")),d=a.changed.averages;for(c in d)b=d[c],Hc.update(this["$av_"+c],b);return this.updateCircles(a),null},b.prototype.updateCircles=function(){var a,b,c,d,e,f;if(!this.circles[0].el)return this.setupCircles(),void 0;for(f=this.circles,d=0,e=f.length;e>d;d++)a=f[d],c=360*(parseInt(this.model.get("averages."+a.judgement),10)/100),b=a.currentAngle,c!==Math.round(b)&&(a.currentAngle+=this.getCircleSpeed(c,b),this.setCircleAngle(a.el,a.currentAngle));return null},b.prototype.getCircleSpeed=function(a,b){return(a-b)/5},b.prototype.setCircleAngle=function(a,b){var c,d,e,f,g;return b%=360,e=b*this.PI/180,f=125*Math.sin(e),g=-125*Math.cos(e),d=b>180?1:0,c="M 0 0 v -125 A 125 125 1 "+d+" 1 "+f+" "+g+" z",a.setAttribute("d",c),null},b}(g),ud=function(a){function b(a,c){var d;return this.statsData=a,this.model=c,this.onChange=Vd(this.onChange,this),this.onTick=Vd(this.onTick,this),this.onScroll=Vd(this.onScroll,this),this.updateDims=Vd(this.updateDims,this),this.setListeners=Vd(this.setListeners,this),this.stop=Vd(this.stop,this),this.start=Vd(this.start,this),this.setupEvents=Vd(this.setupEvents,this),this.scaleIcons=Vd(this.scaleIcons,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),d=Modernizr.svg?"svg":"jpg",this.templateVars={spriteURL:this.axe().BASE_PATH+("/static/images/ss/icons."+d)},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="global-stats-main-modules",b.$window=null,b.prototype.$cnt_hash=null,b.prototype.$cnt_emoj=null,b.prototype.$cnt_phot=null,b.prototype.$cnt_self=null,b.prototype.$freq_tth=null,b.prototype.$freq_day=null,b.prototype.$msc_moon=null,b.prototype.$icons=null,b.prototype.statsData=null,b.prototype.model=null,b.prototype.scrolling=!1,b.prototype.canUpdate=!0,b.prototype.init=function(){return this.$window=$(window),this.$cnt_hash=this.$el.find('[data-value="counters-hashtags"]'),this.$cnt_emoj=this.$el.find('[data-value="counters-emoji"]'),this.$cnt_phot=this.$el.find('[data-value="postcounter-photo"]'),this.$cnt_self=this.$el.find('[data-value="postcounter-selfie"]'),this.$freq_tth=this.$el.find('[data-value="freq-tth"]'),this.$freq_day=this.$el.find('[data-value="freq-day-total"]'),this.$msc_moon=this.$el.find('[data-value="misc-moon"]'),this.$icons=this.$el.find("[data-icon]"),this.setup(),this.setupEvents(),null},b.prototype.setup=function(){return this.$el.find("[data-numtransition]").each(function(a,b){return Hc.setup($(b))}),null},b.prototype.scaleIcons=function(){return this.$icons.each(function(){return function(a,b){var c,d,e;return c=$(b),d=c.closest(".graphic").width(),e=d/parseInt(c.css("width"),10),c.css({transform:"scale("+e+")"})}}(this)),null},b.prototype.setupEvents=function(){return this.on("show",this.start),this.on("hide",this.stop),null},b.prototype.start=function(){return this.scaleIcons(),this.setup(),this.setListeners("on"),null},b.prototype.stop=function(){return this.setListeners("off"),null},b.prototype.setListeners=function(a){var b;return this.model[a]("change",this.onChange),this.$window[a]("scroll",this.onScroll),b="on"===a?"addEventListener":"removeEventListener",createjs.Ticker[b]("tick",this.onTick),this.axe().appView[a]("updateDims",this.updateDims),null},b.prototype.updateDims=function(){return setTimeout(this.scaleIcons,300),null},b.prototype.onScroll=function(){return this.scrolling=!0,null},b.prototype.onTick=function(){return this.canUpdate=this.scrolling?!1:!0,this.scrolling=!1,null},b.prototype.onChange=function(){return this.canUpdate?(this.$cnt_phot.each(function(a){return function(b,c){return Hc.update($(c),a.model.get("postCounters.w_photos"))}}(this)),this.$cnt_self.each(function(a){return function(b,c){return Hc.update($(c),a.model.get("postCounters.w_selfie"))}}(this)),this.$freq_tth.each(function(a){return function(b,c){return Hc.update($(c),a.model.get("frequencies.second.tth"))}}(this)),this.$freq_day.each(function(a){return function(b,c){return Hc.update($(c),a.model.get("frequencies.day.total"))}}(this)),Hc.update(this.$cnt_hash,this.model.get("counters.hashtags")),Hc.update(this.$cnt_emoj,this.model.get("postCounters.w_emotji")),Hc.update(this.$msc_moon,this.model.get("misc.daysTilMoon")),null):void 0},b}(g),d=function(a){function b(){return this.track=Vd(this.track,this),this.removeConnectionErrorOverlay=Vd(this.removeConnectionErrorOverlay,this),this.appendConnectionErrorOverlay=Vd(this.appendConnectionErrorOverlay,this),this.onConnectionUp=Vd(this.onConnectionUp,this),this.onConnectionDown=Vd(this.onConnectionDown,this),this.listen2Socket=Vd(this.listen2Socket,this),this.onElClick=Vd(this.onElClick,this),this.setNavLinks=Vd(this.setNavLinks,this),this.initialize=Vd(this.initialize,this),b.__super__.constructor.call(this),this.connectionStatus=!0,this.$el.on("click",this.onElClick),this.disableOnConnectionDown&&this.listen2Socket("on"),null}return Ud(b,a),b.prototype.template="module-abstract",b.prototype.addToSelector=".inner",b.prototype.dataList=null,b.prototype.model=null,b.prototype.HAS_DEEPVIEW=!1,b.prototype.disableOnConnectionDown=!1,b.prototype.connectionErrorVars=null,b.prototype.offlineClass="module-offline",b.prototype.initialize=function(){var a,c,d,e;if(null!=this.dataList&&null!=this.model)for(e=this.dataList,c=0,d=e.length;d>c;c++)a=e[c],this.model.bind("change:"+a,this.update);return b.__super__.initialize.call(this),null},b.prototype.setNavLinks=function(a){return a?(this.$el.find("[data-expand-btn]").attr("href",a),a!=="/"+this.axe().nav.sections.PROFILE&&(this.$el.addClass("has-deepview"),this.HAS_DEEPVIEW=!0)):this.$el.find("[data-expand-btn]").remove(),null},b.prototype.onElClick=function(){var a;return this.HAS_DEEPVIEW&&this.connectionStatus&&(a=this.$el.find("[data-expand-btn]").attr("href"),this.axe().router.navigateTo(a),this.track(a.replace("/",""))),null},b.prototype.listen2Socket=function(a){var b;return b=this.axe().socket,b[a]("connection:up",this.onConnectionUp),b[a]("connection:down",this.onConnectionDown),"on"===a&&b.status===dd.STATUS_DOWN&&this.onConnectionDown(),null},b.prototype.onConnectionDown=function(){return this.connectionStatus=!1,this.$el.addClass(this.offlineClass),this.appendConnectionErrorOverlay(),null},b.prototype.onConnectionUp=function(){return this.connectionStatus=!0,this.$el.removeClass(this.offlineClass),this.removeConnectionErrorOverlay(),null
},b.prototype.appendConnectionErrorOverlay=function(){var a;return this.errorMessage||(a=_.extend({descKey:"real_time_connection_error_desc"},this.connectionErrorVars),this.errorMessage=new Y(a.titleKey,!1,a.descKey),this.addChild(this.errorMessage),this.errorMessage.on("close",function(a){return function(){return a.remove(a.errorMessage),a.errorMessage=null}}(this)),this.errorMessage.show()),null},b.prototype.removeConnectionErrorOverlay=function(){return null},b.prototype.track=function(a){var b;return b=function(){switch(!0){case a===this.axe().nav.sections.FUN_FACTS:return"fun";case a===this.axe().nav.sections.GLOBAL_STATS:return"global_stats";case a===this.axe().nav.sections.LATEST:return"callout";case a===this.axe().nav.sections.LOCATION_STATS:return"cities";case a===this.axe().nav.sections.LANDING:return"trending"}}.call(this),this.axe().analytics.track("dashboard_click_open_"+b),null},b}(g),J=function(a){function b(){this.loadPosts=Vd(this.loadPosts,this);var a;return this.templateVars.i10n.title=this.axe().locale.get("home_called_out_title"),b.__super__.constructor.call(this),this.tpl=_.template(this.axe().templates.get("latest-called-out-module-content")),a=Tc.request({url:""+this.axe().BASE_PATH+"/api/callout",type:"get"}),a.done(function(a){return function(b){return a.loadPosts(b)}}(this)),null}return Ud(b,a),b.prototype.templateVars={i10n:{},name:"latest-called-out",grid:{size:"2-2",x:"1",y:"9-5"}},b.prototype.loadPosts=function(a){var b,c,d,e,f;for(a=_.shuffle(a),f=[],d=e=0;2>e;d=++e)b=_.extend(a[d]),b.dateLink=b.created?Pc.getDateLink(b):null,c=$(this.tpl({data:b})),c.attr("data-judgement",b.judgement),f.push(this.addChild(c));return f},b}(d),hb=function(a){function b(a,c){this.templateVars={title:this.axe().locale.get(a),descr:this.axe().locale.get(c)},b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.template="expanded-module-header",b.prototype.className="expanded-module-header",b}(g),zb=function(a){function b(){this.onChange=Vd(this.onChange,this),this.setListeners=Vd(this.setListeners,this),this.stop=Vd(this.stop,this),this.start=Vd(this.start,this),this.bindEvents=Vd(this.bindEvents,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.statsData=this.axe().appData.GLOBAL_STATS,this.model=this.statsData.model,this.templateVars.i10n.title=this.axe().locale.get("global_stats_title"),this.contentVars={total_label:this.axe().locale.get("global_stats_efforts"),tth_label:this.axe().locale.get("global_stats_tth"),el_label:this.axe().locale.get("global_stats_effortless"),nth_label:this.axe().locale.get("global_stats_nth"),average_label:this.axe().locale.get("global_stats_avg_score")},this.tmpHTML=_.template(this.axe().templates.get("global-stats-module-content")),b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.templateVars={i10n:{},name:"global-stats",grid:{size:"4-1",x:"0",y:"4"}},b.prototype.statsData=null,b.prototype.model=null,b.prototype.contentVars=null,b.prototype.tmpHTML=null,b.prototype.disableOnConnectionDown=!0,b.prototype.connectionErrorVars={titleKey:"global_stats_title"},b.prototype.EVENTS_ON=!1,b.prototype.init=function(){return this.addChild(this.tmpHTML(this.contentVars)),this.$total=this.$el.find('[data-value="total"]'),this.$av_tth=this.$el.find('[data-value="tth"]'),this.$av_el=this.$el.find('[data-value="el"]'),this.$av_nth=this.$el.find('[data-value="nth"]'),this.$av_total=this.$el.find('[data-value="average"]'),this.setup(),this.bindEvents(),null},b.prototype.setup=function(){return this.$el.find("[data-numtransition]").each(function(a,b){return Hc.setup($(b))}),null},b.prototype.bindEvents=function(){return this.axe().appView.on("showDashboardEnd",this.start),this.axe().appView.on("hideDashboardStart",this.stop),null},b.prototype.start=function(){return this.EVENTS_ON?void 0:(this.setup(),this.setListeners("on"),this.EVENTS_ON=!0,null)},b.prototype.stop=function(){return this.EVENTS_ON?(this.setListeners("off"),this.EVENTS_ON=!1,null):void 0},b.prototype.setListeners=function(a){return this.model[a]("change:averages, change:postCounters.total",this.onChange),null},b.prototype.onChange=function(a){var b,c,d;a=a||this.model,Hc.update(this.$total,a.get("postCounters.total")),d=a.changed.averages;for(c in d)b=d[c],Hc.update(this["$av_"+c],b);return null},b}(d),Qb=function(a){function b(){var a;return this.templateVars.i10n.title=this.axe().locale.get("home_trending_hashtags_title"),a={},b.__super__.constructor.call(this),this.addChild('<div class="hashtags-placeholder"></div>'),this.tags=new wd(this.axe().appData.TAGS,this.axe().appData.ACTIVE_TAGS,!1),this.addChild(this.tags),null}return Ud(b,a),b.prototype.templateVars={i10n:{},name:"hashtags",grid:{size:"2-2",x:"0",y:"9-5"}},b}(d),gc=function(a){function b(){return this.getUserName=Vd(this.getUserName,this),this.getLargestImage=Vd(this.getLargestImage,this),this.getUserImage=Vd(this.getUserImage,this),this.getUserData=Vd(this.getUserData,this),this.loadData=Vd(this.loadData,this),this.appendEl=Vd(this.appendEl,this),this.onClick=Vd(this.onClick,this),this.setListeners=Vd(this.setListeners,this),this.stop=Vd(this.stop,this),this.start=Vd(this.start,this),this.bindEvents=Vd(this.bindEvents,this),this.init=Vd(this.init,this),this.elTpl=_.template(this.axe().templates.get(this.elTplName)),b.__super__.constructor.call(this),this.loadData(Sd.axe.startData.toplist),null}return Ud(b,a),b.prototype.templateVars={i10n:{},name:"leaderboard",grid:{size:"4-1-5",x:"0",y:"8"}},b.prototype.elTplName="module-leaderboard-element",b.prototype.sections=[{judgement:"tryingTooHard",caption:"hardest_tryier",key:"top"},{judgement:"effortless",caption:"most_effortless",key:"mid"},{judgement:"notHardEnough",caption:"not_trying_at_all",key:"low"}],b.prototype.EVENTS_ON=!1,b.prototype.init=function(){return this.bindEvents(),null},b.prototype.bindEvents=function(){return this.axe().appView.on("showDashboardEnd",this.start),this.axe().appView.on("hideDashboardStart",this.stop),null},b.prototype.start=function(){return this.EVENTS_ON?void 0:(this.setListeners("on"),this.EVENTS_ON=!0,null)},b.prototype.stop=function(){return this.EVENTS_ON?(this.setListeners("off"),this.EVENTS_ON=!1,null):void 0},b.prototype.setListeners=function(a){return this.$el[a]("click","[data-judgement]",this.onClick),null},b.prototype.onClick=function(a){return a.preventDefault(),$(a.currentTarget).data("profileurl")&&window.open($(a.currentTarget).data("profileurl"),"_blank"),null},b.prototype.appendEl=function(a){var b;return b=$(this.elTpl(a)),a.image&&(b.data("profileurl",a.profileURL),b.find(".img-holder").css("background-image","url("+a.image+")")),b.attr("data-judgement",a.judgement),this.addChild(b)},b.prototype.loadData=function(a){var b,c,d,e,f;for(f=this.sections,b=d=0,e=f.length;e>d;b=++d)c=f[b],this.getUserData(a[c.key][0],c);return null},b.prototype.getUserData=function(a,b){var c,d,e,f;return a?(f=$.Deferred(),c=this.getUserImage(a,f),d=a.score,f.done(function(c){return function(e){var f,g;return g=c.getUserName(a.info[e.service],e.service),g.score=d,f={image:e.src,judgement:b.judgement,service:e.service,caption:c.axe().locale.get(b.caption),user:g},f.profileURL=function(){switch(e.service){case"tw":return"http://twitter.com/"+a.info[e.service].username;case"fb":return"http://facebook.com/"+a.info[e.service].username;case"ig":return"http://instagram.com/"+a.info[e.service].username}}(),setTimeout(function(){return c.appendEl(f)},0)}}(this))):(e={judgement:b.judgement,caption:this.axe().locale.get(b.caption)},setTimeout(function(a){return function(){return a.appendEl(e)}}(this),0)),null},b.prototype.getUserImage=function(a,b){var c,d,e,f,g,h,i;d=[],i=a.info;for(e in i)g=i[e],g.avatar&&(f=function(){switch(!0){case"tw"===e:return g.avatar.replace("_normal","");case"fb"===e:return"http://graph.facebook.com/"+g.username+"/picture?width=9999&height=9999";case"ig"===e:return g.avatar}}(),c=g.avatar_info?g.avatar_info.height:1,h=g.avatar_info?g.avatar_info.width:1,d.push({service:e,src:f,area:c*h}));return this.getLargestImage(d,b),null},b.prototype.getLargestImage=function(a,b){var c,d,e,f;for(d={service:null,src:null,area:0},e=0,f=a.length;f>e;e++){if(c=a[e],"fb"===c.service)return d=c,b.resolve(d);c.area>d.area&&(d=c)}return b.resolve(d),null},b.prototype.getUserName=function(a,b){var c;return c={name:a?a.name:"",username:a?"fb"!==b?"@"+a.username:null:"",service:b}},b}(d),mc=function(a){function b(){return this.updateStats=Vd(this.updateStats,this),this.onStatsChange=Vd(this.onStatsChange,this),this.setCities=Vd(this.setCities,this),this.setListeners=Vd(this.setListeners,this),this.onStartDataReceived=Vd(this.onStartDataReceived,this),this.stop=Vd(this.stop,this),this.start=Vd(this.start,this),this.bindEvents=Vd(this.bindEvents,this),this.begin=Vd(this.begin,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.templateVars.i10n.title=this.axe().locale.get("country_header"),this.contentVars={country:"usa",label_tth:this.axe().locale.get("deepview_comparecities_tth_label"),label_el:this.axe().locale.get("deepview_comparecities_eff_label"),label_nth:this.axe().locale.get("deepview_comparecities_nth_label")},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.templateVars={i10n:{},name:"location-stats",grid:{size:"2-2",x:"1",y:"5"}},b.prototype.locationStats=null,b.prototype.activeCities=null,b.prototype.$priName=null,b.prototype.$secName=null,b.prototype.$tth_primary=null,b.prototype.$el_primary=null,b.prototype.$nth_primary=null,b.prototype.$tth_secondary=null,b.prototype.$el_secondary=null,b.prototype.$nth_secondary=null,b.prototype.disableOnConnectionDown=!0,b.prototype.connectionErrorVars={titleKey:"country_header"},b.prototype.EVENTS_ON=!1,b.prototype.init=function(){var a;return a=_.template(this.axe().templates.get("location-stats-module-content")),this.addChild(a(this.contentVars)),this.$priName=this.$el.find('[data-name="primary"]'),this.$secName=this.$el.find('[data-name="secondary"]'),this.$tth_primary=this.$el.find('[data-tth="primary"]'),this.$el_primary=this.$el.find('[data-el="primary"]'),this.$nth_primary=this.$el.find('[data-nth="primary"]'),this.$tth_secondary=this.$el.find('[data-tth="secondary"]'),this.$el_secondary=this.$el.find('[data-el="secondary"]'),this.$nth_secondary=this.$el.find('[data-nth="secondary"]'),this.axe().appData.on("startDataReceived",this.onStartDataReceived),this.axe().cities.fetched?this.begin():this.axe().cities.on("ready",this.begin),null},b.prototype.setup=function(){return this.$el.find("[data-numtransition]").each(function(a,b){return Hc.setup($(b))}),null},b.prototype.begin=function(){return this.locationStats=this.axe().appData.LOCATION_STATS.model,this.activeCities=this.axe().cities.activeCities,this.bindEvents(),this.setup(),this.axe().appView.dashboardVisible&&this.start(),null},b.prototype.bindEvents=function(){return this.axe().appView.on("showDashboardEnd",this.start),this.axe().appView.on("hideDashboardStart",this.stop),null},b.prototype.start=function(){return this.EVENTS_ON?void 0:(this.setCities(),this.onStatsChange(),this.setListeners("on"),this.EVENTS_ON=!0,null)},b.prototype.stop=function(){return this.EVENTS_ON?(this.setListeners("off"),this.EVENTS_ON=!1,null):void 0},b.prototype.onStartDataReceived=function(){return"uk"===this.axe().countries.getUserCountry()&&this.$el.find(".map").removeClass("usa").addClass("uk"),this.axe().appData.off("startDataReceived",this.onStartDataReceived),null},b.prototype.setListeners=function(a){return this.locationStats[a]("change",this.onStatsChange),null},b.prototype.setCities=function(){return Hc.update(this.$priName,this.activeCities.get("primary").get("name")),Hc.update(this.$secName,this.activeCities.get("secondary").get("name")),null},b.prototype.onStatsChange=function(){return this.updateStats("primary"),this.updateStats("secondary"),null},b.prototype.updateStats=function(a){var b;return b=this.locationStats.toJSON(),(b=b[this.activeCities.get(a).get("woeid")])?(0===b.averages.tth&&(b.averages.tth="0%"),Hc.update(this["$tth_"+a],b.averages.tth),0===b.averages.el&&(b.averages.el="0%"),Hc.update(this["$el_"+a],b.averages.el),0===b.averages.nth&&(b.averages.nth="0%"),Hc.update(this["$nth_"+a],b.averages.nth),null):void 0},b}(d),c=function(a){function b(a){return this.service=a.service,this.userModel=a.model,this.removePlaceholder=Vd(this.removePlaceholder,this),this.addPlaceholder=Vd(this.addPlaceholder,this),this.onDataChange=Vd(this.onDataChange,this),this.onScoreChange=Vd(this.onScoreChange,this),this.onLoggedChange=Vd(this.onLoggedChange,this),this.bindEvents=Vd(this.bindEvents,this),this.init=Vd(this.init,this),this.buildFriends=Vd(this.buildFriends,this),this.buildGraphs=Vd(this.buildGraphs,this),this.activeGraph=new i,this.templateVars={service:this.service},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="graph-container",b.prototype.className="graph-container",b.prototype.bullseye=null,b.prototype.linegraph=null,b.prototype.bubbles=null,b.prototype.graphControls=null,b.prototype.friendSelector=null,b.prototype.placeholder=null,b.prototype.activeGraph=null,b.prototype.service=null,b.prototype.userModel=null,b.prototype.buildGraphs=function(){return"fb"===this.service?(this.bubbles=new p(this.service),this.graphControls=new Db(this,this.service,this.activeGraph),this.addChild(this.bubbles).addChild(this.graphControls),this.activeGraph.set("active",this.bubbles)):(this.bullseye||(this.bullseye=new z(this.service)),this.linegraph=new Eb(this.service),this.graphControls=new Db(this,this.service,this.activeGraph),this.addChild(this.bullseye).addChild(this.linegraph).addChild(this.graphControls),this.activeGraph.set({active:this.bullseye,inactive:this.linegraph})),null},b.prototype.buildFriends=function(){var a;return a={service:this.service,activeGraph:this.activeGraph,container:this},this.friendSelector=this.axe().IS_MOBILE?new pb(a):new mb(a),this.addChild(this.friendSelector),null},b.prototype.init=function(){return this.buildGraphs(),this.buildFriends(),this.bindEvents(),this.onLoggedChange(),this.onScoreChange(),null},b.prototype.bindEvents=function(){return this.userModel.on("change:logged."+this.service,this.onLoggedChange),this.userModel.on("change:scores."+this.service,this.onScoreChange),null},b.prototype.onLoggedChange=function(){var a,b,c,d;for(d=this.children,b=0,c=d.length;c>b;b++)a=d[b],"function"==typeof a.onLoggedUpdate&&a.onLoggedUpdate();return this.onDataChange(),null},b.prototype.onScoreChange=function(){var a,b,c,d;for(d=this.children,b=0,c=d.length;c>b;b++)a=d[b],"function"==typeof a.onScoreUpdate&&a.onScoreUpdate();return this.onDataChange(),null},b.prototype.onDataChange=function(){var a,b;return a=this.userModel.get("logged."+this.service),b=this.userModel.get("scores."+this.service+".judgement"),this.placeholder&&this.removePlaceholder(),a?a&&!b&&this.addPlaceholder("returning"):this.addPlaceholder("initial"),null},b.prototype.addPlaceholder=function(a){return this.placeholder=new Kb({service:this.service,visit:a}),this.addChild(this.placeholder),this.$el.removeClass("remove-placeholder").addClass("show-placeholder"),null},b.prototype.removePlaceholder=function(){return this.$el.removeClass("show-placeholder").addClass("remove-placeholder"),this.remove(this.placeholder),this.placeholder=null,null},b}(g),Bb=function(a){function b(a,c){this.size=a,this.pinScale=c,this.printUserLine=Vd(this.printUserLine,this),this.initUserLine=Vd(this.initUserLine,this),this.smoothDistribution=Vd(this.smoothDistribution,this),this.onShow=Vd(this.onShow,this),this.onResize=Vd(this.onResize,this),this.addLegend=Vd(this.addLegend,this),this.getEffortLevel=Vd(this.getEffortLevel,this),this.getScoreStr=Vd(this.getScoreStr,this),this.addLineLegendElement=Vd(this.addLineLegendElement,this),this.getScoreColour=Vd(this.getScoreColour,this),this.initLegend=Vd(this.initLegend,this),this.initCurve=Vd(this.initCurve,this),this.getLoggedUserInfo=Vd(this.getLoggedUserInfo,this),this.getY=Vd(this.getY,this),this.getX=Vd(this.getX,this),this.printPins=Vd(this.printPins,this),this.loadData=Vd(this.loadData,this),this.initLoadData=Vd(this.initLoadData,this),this.setup=Vd(this.setup,this),b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.data=null,b.prototype.colors=null,b.prototype.stripesBackground=null,b.prototype.scale=null,b.prototype.points=null,b.prototype.curve=null,b.prototype.distribution=null,b.prototype.distributionRangesNum=19,b.prototype.smoothFactor=3,b.prototype.style={legend:{height:30,colors:{tth:"#D3444A",tthLineLegend:"#f8dedf",neutral:"#8F649D",neutralLineLegend:"#ebe6ee",nth:"#74C5DC",nthLineLegend:"#d1eff9"},elements:[-500,-400,-300,-200,-200,-100,0,100,200,300,400,500]},stripes:[{bgColor:"#e2f5fc",bottomLineColor:"#a1d9ea",range:[-500,-200]},{bgColor:"#ece7ee",bottomLineColor:"#896b9d",range:[-200,200]},{bgColor:"#f8dedf",bottomLineColor:"#da4445",range:[200,500]}],scale:{height:4},plot:{margin:{top:50,bottom:40,left:30,right:30}}},b.prototype.setup=function(){var a;if(!this.scene)return this.$el.addClass("breakdown-graph"),a=_.template(this.axe().templates.get("graph-line-legend")),this.legendHTML=$(a({graph_label_tth:this.axe().locale.get("graph_label_tth"),graph_label_el:this.axe().locale.get("graph_label_effortless"),graph_label_nth:this.axe().locale.get("graph_label_nthe")})),this.initGraph(this.size[0],this.size[1]),this.el.appendChild(this.scene.canvasEl),this.container=new cjs.Container,this.scene.addChild(this.container),this.initStripes(),this.initLegend(),this.initUserLine(),this.axe().appData.USER.isLogged()?this.initLoadData():this.axe().appData.USER.model.on("updateUserData",this.initLoadData),this.scene.update(),this.render(),null},b.prototype.initLoadData=function(){var a,b,c;if(!this.data){a=this.axe().appData.FRIENDS.model.toJSON();for(c in a)b=a[c],a[c]=_.map(b.toJSON(),function(a){return a.ID});return $.post(""+window.config.hostname+"/api/call/users/graph",a,this.loadData,"json"),null}},b.prototype.initStripes=function(){var a,b,c,d,e,f,g,h;for(c=this.scene.height,this.stripesBackground=new createjs.Shape,this.scale=new createjs.Shape,h=this.style.stripes,b=f=0,g=h.length;g>f;b=++f)a=h[b],this.stripesBackground.graphics.beginFill(a.bgColor),d=0===b?0:this.getX(a.range[0]),e=2===b?this.scene.width:this.getX(a.range[1]),this.stripesBackground.graphics.drawRect(d,0,e-d,c),this.stripesBackground.graphics.endFill(),this.scale.graphics.beginFill(a.bottomLineColor),this.scale.graphics.drawRect(d,this.style.scale.height,e-d,this.style.scale.height),this.scale.graphics.endFill();return this.container.addChild(this.stripesBackground),this.scale.y=this.size[1]-2*this.style.scale.height,this.container.addChild(this.scale),null},b.prototype.loadData=function(a){return this.data=a,this.initCurve(),this.scene.update()},b.prototype.printPins=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;if(this.distribution){if(null!=(k=this.pinsArr)?k.length:void 0)for(l=this.pinsArr,g=0,i=l.length;i>g;g++)d=l[g],d.removeEvents(),this.pins.removeChild(d.el);for(this.pinsArr=[],a=this.axe().appData.FRIENDS.scores.toJSON(),a.push(this.getLoggedUserInfo()),m=this.distribution,n=[],h=0,j=m.length;j>h;h++)b=m[h],f=_.filter(a,function(){return function(a){var c;return c=parseInt(a.score.total,10),(c>b.from||-500===c&&-500===b.from)&&c<=b.to}}(this)),f.length?(c=!1,e=_.find(f,function(a){return function(b){return c|=b.name===a.getLoggedUserInfo().name}}(this))||_.sample(f),d=new Cb(e.avatar,Math.round(e.score.total),this.pinScale,this.scene.update,c),d.el.x=this.getX(b.center),d.el.y=this.getY(b.value),this.pins.addChild(d.el),this.pinsArr.push(d),c?n.push(this.userLineShape.x=d.el.x):n.push(void 0)):n.push(void 0);return n}},b.prototype.initPins=function(){return this.pins=new cjs.Container,this.container.addChild(this.pins),this.printPins(),null},b.prototype.getX=function(a){return Ic.map(a,-500,500,this.style.plot.margin.left,this.scene.width-this.style.plot.margin.right)},b.prototype.getY=function(a){return Ic.map(a,0,this.maxValue,this.scene.height-this.style.scale.height-this.style.plot.margin.bottom,this.style.plot.margin.top)},b.prototype.getLoggedUserInfo=function(){var a,b,c,d,e;if(this.usrData)return this.usrData;d=this.axe().appData.USER.model.toJSON(),a=null,e=d.logged;for(c in e)if(b=e[c]){a=c;break}return this.usrData={score:{total:d.scores.total.score},name:d.info[a].name,avatar:d.info[a].avatar,is_friend:!0},this.usrData},b.prototype.initCurve=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(!this.distribution){for(this.distribution=[],a=1e3/(this.distributionRangesNum+1),b=f=0,k=this.distributionRangesNum;k>=0?k>=f:f>=k;b=k>=0?++f:--f)this.distribution.push({from:-500+a*b,to:-500+a*(b+1),center:-500+a*(b+.5)});for(l=this.distribution,c=g=0,i=l.length;i>g;c=++g)b=l[c],this.distribution[c].users=_.filter(this.data,function(){return function(a){return(a.score>b.from||-500===a.score&&-500===b.from)&&a.score<=b.to}}(this))}for(this.curve=new createjs.Shape,this.curve.graphics.setStrokeStyle(2).beginStroke("#40cba4").beginFill("rgba(64, 203, 164, 0.2)"),this.smoothDistribution(),this.maxValue=_.max(this.distribution,function(){return function(a){return a.value}}(this)).value,e=[0,this.scene.height-this.style.plot.margin.bottom],m=this.distribution,h=0,j=m.length;j>h;h++)d=m[h],e.push(this.getX(d.center)),e.push(this.getY(d.value));return e.push(this.scene.width),e.push(this.getY(_.last(this.distribution).value/2)),e=e.concat([this.scene.width+500,_.last(e),this.scene.width+500,this.scene.height+300,-500,this.scene.height+300]),this.curve.graphics.curveArray(e,.4),this.curve.graphics.endFill().endStroke(),this.curve.cache(0,0,this.scene.width,this.scene.height),this.container.addChildAt(this.curve,this.container.getChildIndex(this.scale)),this.printUserLine(),this.initPins(),this.scene.update(),null},b.prototype.initLegend=function(){var a,b,c,d,e;for(this.legend=new cjs.Container,e=this.style.legend.elements,c=0,d=e.length;d>c;c++)a=e[c],b=new cjs.Text(this.getScoreStr(a),"10px Arial",this.getScoreColour(a)),b.textAlign="center",b.lineHeight=this.style.scale.height,this.legend.addChild(b),b.x=this.getX(a);return this.container.addChild(this.legend),this.legend.y=this.scene.height-this.style.scale.height-this.style.legend.height/2-5,null},b.prototype.getScoreColour=function(a){switch(!0){case-200>a:return this.style.legend.colors.nth;case a>=-200&&200>=a:return this.style.legend.colors.neutral;case a>200:return this.style.legend.colors.tth}},b.prototype.addLineLegendElement=function(a,b,c,d,e){var f,g,h;return f=new createjs.Container,h=new cjs.Shape,h.graphics.beginFill(b).drawRect(0,0,12,12).endFill(),f.addChild(h),g=new cjs.Text(c,"15px tungstensemibold",a),g.lineHeight=14,f.addChild(g),g.x=20,f.x=d,f.y=e,f},b.prototype.getScoreStr=function(a){return 0>a?""+a:"+"+a},b.prototype.getEffortLevel=function(a){if(null===a)return"-";switch(!0){case-200>a:return this.axe().locale.get("graph_label_nthe");case a>-200&&200>a:return this.axe().locale.get("graph_label_effortless");case a>200:return this.axe().locale.get("graph_label_tth")}},b.prototype.addLegend=function(){var a,b;return a=new cjs.Container,b=this.addLineLegendElement(this.style.legend.colors.tth,this.style.legend.colors.tthLineLegend,this.getEffortLevel(500).toUpperCase(),5*this.size[0]/6-48,5),a.addChild(b),b=this.addLineLegendElement(this.style.legend.colors.neutral,this.style.legend.colors.neutralLineLegend,this.getEffortLevel(0).toUpperCase(),.5*this.size[0]-35,5),a.addChild(b),b=this.addLineLegendElement(this.style.legend.colors.nth,this.style.legend.colors.nthLineLegend,this.getEffortLevel(-500).toUpperCase(),this.size[0]/6-65,5),a.addChild(b),this.container.addChild(a),a},b.prototype.onResize=function(){return b.__super__.onResize.call(this),this.size?(this.size=this.axe().IS_MOBILE?[Math.min(window.innerWidth,1140),240]:[Math.min(window.innerWidth,1140),480],this.scene&&this.pins&&(this.scene.resize(this.size[0],this.size[1]),this.scene.removeAllChild(),this.container=new cjs.Container,this.scene.addChild(this.container),this.initStripes(),this.initLegend(),this.initCurve(),this.scene.update()),null):void 0},b.prototype.onShow=function(){return this.printPins()},b.prototype.smoothDistribution=function(a){var b,c,d,e,f,g,h,i;for(null==a&&(a=2),i=[],f=h=1;a>=1?a>=h:h>=a;f=a>=1?++h:--h)i.push(function(){var a,f,h,i,j,k;for(i=this.distribution,k=[],e=a=0,h=i.length;h>a;e=++a)if(d=i[e],g=e-Math.floor(this.smoothFactor/2),g>=0){for(c=0,b=0,e=f=0,j=this.smoothFactor-1;j>=0?j>=f:f>=j;e=j>=0?++f:--f)g+e<this.distribution.length&&(c+=this.distribution[g+e].value||this.distribution[g+e].users.length,b++);k.push(d.value=c/b)}else k.push(d.value=d.users.length);return k}.call(this));return i},b.prototype.initUserLine=function(){return this.userLineShape?void 0:(this.userLineShape=new cjs.Container,this.userLineBg=new createjs.Shape,this.lineColor=new createjs.Shape,this.lineColor.x=this.lineColor.y=-.5,this.userLineShape.addChild(this.userLineBg),this.userLineShape.addChild(this.lineColor),this.container.addChild(this.userLineShape))},b.prototype.printUserLine=function(){var a;return a=this.lineColor.graphics,a.clear(),a.beginFill(createjs.Graphics.getRGB(5692089)),a.drawRect(0,0,1,this.size[1]),a=this.userLineBg.graphics.clear(),a.clear(),a.beginFill(createjs.Graphics.getRGB(16777215,.5)),a.drawRect(-5,0,10,this.size[1])},b}(b),Cb=function(){function a(a,b,c,d,e){var f,g,h;this.sceneUpdate=d,this.isUser=null!=e?e:!1,this.closeScore=Vd(this.closeScore,this),this.openScore=Vd(this.openScore,this),this.toggle=Vd(this.toggle,this),this.el=new createjs.Container,this.isUser||(this.radius=13),this.score=b,"undefined"==typeof c&&(c=100),c/=100,this.radius2=this.radius,this.radius*=c,this.border=new createjs.Shape,this.border.graphics.beginFill("#fff"),this.border.graphics.drawCircle(0,0,this.radius),this.border.graphics.endFill(),this.border.alpha=.7,this.border.x=0,this.border.y=0,h=new Image,h.onload=function(a){return function(){var b,c;return a.img=new cjs.Container,c=new cjs.Bitmap(h),c.x=c.image.width/-2,c.y=c.image.height/-2,a.img.addChild(c),a.img.scaleX=a.img.scaleY=2*a.radius/Math.min(c.image.width,c.image.height),b=a.img.addChild(new cjs.Shape),b.graphics.f("#000").drawCircle(0,0,Math.min(c.image.width,c.image.height)/2),b.compositeOperation="destination-in",a.img.cache(c.image.width/-2,c.image.height/-2,c.image.width,c.image.height),a.img.x=0,a.img.y=0,a.img.cursor="pointer",a.img.mouseEnabled=!0,a.el.addChild(a.img),a.initScore(),a.initEvents(),d()}}(this),(f=/https?\:\/\/graph.facebook.com\/(\d+)\/picture\?type=large/.exec(a))?(g=ib.getUserAvatar(f[1]),g.done(function(){return function(a){return h.src=""+window.config.hostname+"/image.php?img="+a}}(this))):h.src=""+window.config.hostname+"/image.php?img="+a,this.el.addChild(this.border)}return a.prototype.el=null,a.prototype.pin=null,a.prototype.border=null,a.prototype.score=0,a.prototype.scoreBackground=null,a.prototype.scoreTxt=null,a.prototype.radius=27,a.prototype.isOpen=!1,a.prototype.sceneUpdate=null,a.prototype.initScore=function(){var a,b;return a=function(){switch(!0){case this.score<-200:return"#a1d9ea";case this.score<200:return"#896b9d";default:return"#da4445"}}.call(this),this.scoreBackground=new createjs.Shape,this.scoreBackground.graphics.beginFill(a),this.isUser?this.scoreBackground.graphics.drawCircle(this.radius,this.radius/2,13):this.scoreBackground.graphics.drawCircle(this.radius,this.radius,13),this.scoreBackground.graphics.endFill(),this.scoreBackground.alpha=0,this.scoreBackground.scaleX=this.scoreBackground.scaleY=.6,this.score<0?b="-":this.score>0&&(b="+"),this.scoreTxt=new createjs.Text(""+b+this.score,"12px tungstenmedium","#fff"),this.isUser?window.axe.IS_MOBILE?(this.scoreTxt.x=this.scoreBackground.x+20,this.scoreTxt.y=this.scoreBackground.y+15):(this.scoreTxt.x=this.scoreBackground.x+26,this.scoreTxt.y=this.scoreBackground.y+18):window.axe.IS_MOBILE?(this.scoreTxt.x=this.radius,this.scoreTxt.y=this.scoreBackground.y+14):(this.scoreTxt.x=this.radius,this.scoreTxt.y=this.scoreBackground.y+18),this.scoreTxt.textBaseline="alphabetic",this.scoreTxt.alpha=0,this.scoreTxt.textAlign="center",this.el.addChild(this.scoreBackground),this.el.addChild(this.scoreTxt),this.isUser&&this.openScore(),null},a.prototype.initEvents=function(){return this.el.on("pressup",this.toggle),null},a.prototype.removeEvents=function(){return this.el.off("pressup",this.toggle),null},a.prototype.toggle=function(){return this.isOpen=!this.isOpen,this.isOpen?(TweenLite.to(this.border,.2,{scaleX:1.5,scaleY:1.5,alpha:1,onUpdate:this.sceneUpdate}),this.isUser||this.openScore()):(TweenLite.to(this.border,.2,{scaleX:1,scaleY:1,alpha:0,onUpdate:this.sceneUpdate}),this.isUser||this.closeScore()),this.sceneUpdate()},a.prototype.dispose=function(){return this.removeEvents(),null},a.prototype.openScore=function(){return TweenLite.to(this.scoreBackground,.2,{scaleX:1,scaleY:1,alpha:1,delay:.2,onUpdate:this.sceneUpdate}),TweenLite.to(this.scoreTxt,.2,{alpha:1,delay:.4,onUpdate:this.sceneUpdate})},a.prototype.closeScore=function(){return TweenLite.to(this.scoreBackground,.2,{scaleX:.6,scaleY:.6,alpha:0,onUpdate:this.sceneUpdate}),TweenLite.to(this.scoreTxt,.2,{alpha:0,onUpdate:this.sceneUpdate})},a}(),p=function(a){function b(a){return this.service=a,this.getShareableData=Vd(this.getShareableData,this),this.getLegendData=Vd(this.getLegendData,this),this.getBubbleImage=Vd(this.getBubbleImage,this),this.getShareableImage=Vd(this.getShareableImage,this),this.getBubbleBounds=Vd(this.getBubbleBounds,this),this.onGraphResize=Vd(this.onGraphResize,this),this.unMute=Vd(this.unMute,this),this.mute=Vd(this.mute,this),this.onTicker=Vd(this.onTicker,this),this.initEvents=Vd(this.initEvents,this),this.resetUser=Vd(this.resetUser,this),this.changeUser=Vd(this.changeUser,this),this.updateInfos=Vd(this.updateInfos,this),this.init=Vd(this.init,this),this.userModel=new x,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.GRAPH_TYPE="bubbles",b.prototype.service=null,b.prototype.className="graph bubble-graph",b.prototype.graph=null,b.prototype.infos=null,b.prototype.userModel=null,b.prototype.userImageData=null,b.prototype.areEventsInit=!1,b.prototype.init=function(){return this.graph=new u(this),this.infos=new v(this),this.graph.canUpdateUserInfos=this.updateInfos,this.graph.hasChangedOfUser=this.updateInfos,this.graph.resized=this.onGraphResize,this.el.appendChild(this.infos.el),this.axe().IS_MOBILE&&$(this.el).addClass("is-mobile"),null},b.prototype.updateInfos=function(){var a,b,c;if(this.graph.currentSystem){this.infos.reset(),c=this.graph.currentSystem.data;for(b in c)a=c[b],("share"===b||"statusUpdate"===b||"addedFriend"===b||"addedPhoto"===b||"taggedInPhoto"===b||"like"===b||"wallPost"===b)&&this.infos.updateGlobalInfos(a.judgement);return null}},b.prototype.onScoreUpdate=function(){return this.graph.onScoreUpdate(),this.updateInfos(),null},b.prototype.changeUser=function(a){return this.savedLegendData||(this.savedLegendData=this.getLegendData()),this.userModel.set(a.user),this.axe().IS_MOBILE?this.graph.changeCurrentSystem(a):this.graph.friendSystem&&this.graph.friendSystem.isVisible?this.graph.switchFriend(a):this.graph.initFriendSystem(a),null},b.prototype.resetUser=function(){return this.graph.resetUser(),this.updateInfos(),null},b.prototype.initEvents=function(){return!this.areEventsInit&&this.graph?(this.areEventsInit=!0,this.axe().appView.on("updateDims",this.graph.onResize),createjs.Ticker.addEventListener("tick",this.onTicker),null):void 0},b.prototype.removeEvents=function(){return this.areEventsInit=!1,this.axe().appView.off("updateDims",this.graph.onResize),createjs.Ticker.removeEventListener("tick",this.onTicker),null},b.prototype.onTicker=function(){var a;return this.graph.update(),null!=(a=this.graph.scene)&&a.update(),null},b.prototype.mute=function(){return this.removeEvents(),null},b.prototype.unMute=function(){return this.initEvents(),this.graph.userSystem?(this.axe().appData.USER.status.get("fb")&&this.graph.userSystem.attractor.updateScore(Ic.getNiceScore(this.axe().appData.USER.model.get("scores.fb.total"))),null):void 0
},b.prototype.onGraphResize=function(){return this.axe().IS_MOBILE&&(window.innerHeight>window.innerWidth?this.infos.hide():this.infos.show()),null},b.prototype.getBubbleBounds=function(a,b,c){var d,e,f,g,h,i,j,k,l;for(g=b,f=0,i=c,h=0,l=a.statBubbles,j=0,k=l.length;k>j;j++)e=l[j],e.el.x-e.radius<g&&(g=e.el.x-e.radius),e.el.x+2*e.radius>f&&(f=e.el.x+2*e.radius),e.el.y-e.radius<i&&(i=e.el.y-e.radius),e.el.y+2*e.radius>h&&(h=e.el.y+2*e.radius);return d={x:g,y:i,w:f-g,h:h-i}},b.prototype.getShareableImage=function(a){switch(a){case"user":return this.getBubbleImage(this.graph.userSystem);case"friend":return this.graph.friendSystem?this.getBubbleImage(this.graph.friendSystem):this.getBubbleImage(this.graph.currentSystem)}},b.prototype.getBubbleImage=function(a){var b,c,d,e,f,g;return f=$.Deferred(),d=a.el,g=d.parent.canvas.width,e=d.parent.canvas.height,b=this.getBubbleBounds(a,g,e),d.cache(b.x,b.y,b.w,b.h),c=d.getCacheDataURL(),d.uncache(),Xb.trimCanvasData(c,g,e).done(function(){return function(a){return f.resolve(a)}}(this)),f},b.prototype.getLegendData=function(){var a;return a={tth:(parseInt(this.infos.tooHardPercentField.innerHTML)||0)/100,neutral:(parseInt(this.infos.effortlessPercentField.innerHTML)||0)/100,nth:(parseInt(this.infos.notTryingPercentField.innerHTML)||0)/100}},b.prototype.getShareableData=function(){var a,b,c,d,e,f,g;return f=$.Deferred(),d=$.Deferred(),b=$.Deferred(),c=$.Deferred(),e=this.axe().appData.USER.model,g=e.get("scores"),a={loggedUser:{name:e.get("info."+this.service+".name"),username:e.get("info."+this.service+".username"),scores:{total:g.total.score,tw:Math.round(g.tw.total),fb:Math.round(g.fb.total),ig:Math.round(g.ig.total)},avatar:e.get("info."+this.service+".avatar"),post:!1},legend:[this.getLegendData()]},this.getShareableImage("user").done(function(){return function(b){return a.image=b,d.resolve()}}(this)),this.graph.friendVisible?(a.imageDisplayType=_c.ImageDisplayType.DoubleEqual,this.getShareableImage("friend").done(function(){return function(c){return a.imageSec=c,b.resolve()}}(this)),a.comparedUser={id:this.userModel.get("id"),name:this.userModel.get("name"),username:this.userModel.get("username"),scores:{total:parseInt(this.userModel.get("score.total"),10),tw:null,fb:null,ig:null}},a.comparedUser.scores[this.service]=a.comparedUser.scores.total,a.legend=[this.savedLegendData,this.getLegendData()],ib.getUserAvatar(this.userModel.get("avatar").split("facebook.com/")[1].split("/picture")[0]).done(function(){return function(b){return a.comparedUser.avatar=b,c.resolve()}}(this))):(a.imageDisplayType=_c.ImageDisplayType.Single,b.resolve(),c.resolve()),$.when(d,b,c).done(function(){return function(){return f.resolve(a)}}(this)),f},b}(g),q=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.position=null,b.prototype.velocity=null,b.prototype.acceleration=null,b.prototype.physics=null,b.prototype.mass=2,b.prototype.force=null,b.prototype.b2Vec2=Box2D.Common.Math.b2Vec2,b.prototype.b2AABB=Box2D.Collision.b2AABB,b.prototype.b2BodyDef=Box2D.Dynamics.b2BodyDef,b.prototype.b2Body=Box2D.Dynamics.b2Body,b.prototype.b2FixtureDef=Box2D.Dynamics.b2FixtureDef,b.prototype.b2Fixture=Box2D.Dynamics.b2Fixture,b.prototype.b2World=Box2D.Dynamics.b2World,b.prototype.b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,b.prototype.b2DebugDraw=Box2D.Dynamics.b2DebugDraw,b.prototype.tween=null,b.prototype.initialize=function(a){return this.b2Vec2=Box2D.Common.Math.b2Vec2,this.b2AABB=Box2D.Collision.b2AABB,this.b2BodyDef=Box2D.Dynamics.b2BodyDef,this.b2Body=Box2D.Dynamics.b2Body,this.b2FixtureDef=Box2D.Dynamics.b2FixtureDef,this.b2Fixture=Box2D.Dynamics.b2Fixture,this.b2World=Box2D.Dynamics.b2World,this.b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,this.b2DebugDraw=Box2D.Dynamics.b2DebugDraw,this.el=new createjs.Container,this.el.alpha=0,this.position={x:0,y:0},this.physics={parentWorld:a,el:null,fixtureDef:new this.b2FixtureDef,bodyDef:new this.b2BodyDef,b2worldScale:30},null},b.prototype.transitionIn=function(){return this.tween=new TweenLite(this.el,.3,{alpha:1,delay:Math.random()}),null},b.prototype.transitionOut=function(){return null},b.prototype.update=function(){return null},b.prototype.dispose=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return k=null,o=null,q=null,a=null,n=null,m=0,l=null,i=null,b=null,d=null,c=null,g=null,f=null,j=null,h=null,e=null,p=null,null},b}(g),r=function(){function a(a,b,c,d){this.dispose=Vd(this.dispose,this),this.onScaleUpComplete=Vd(this.onScaleUpComplete,this),this.scaleUp=Vd(this.scaleUp,this),this.onScaleDownComplete=Vd(this.onScaleDownComplete,this),this.onTransitionOutComplete=Vd(this.onTransitionOutComplete,this),this.transitionOut=Vd(this.transitionOut,this),this.transitionInComplete=Vd(this.transitionInComplete,this),this.onPress=Vd(this.onPress,this),this.load=Vd(this.load,this),this.parent=a,this.scene=b,this.attractorImgPath=c,this.isUser=d,this.movers=[],this.statBubbles=[],this.physicWorld=new this.b2World(new this.b2Vec2(0,0),!0),this.el=new createjs.Container,this.el.setBounds(0,0,650,650),this.scene.addChild(this.el)}return a.prototype.b2World=null,a.prototype.b2worldScale=100,a.prototype.b2Vec2=Box2D.Common.Math.b2Vec2,a.prototype.b2AABB=Box2D.Collision.b2AABB,a.prototype.b2BodyDef=Box2D.Dynamics.b2BodyDef,a.prototype.b2Body=Box2D.Dynamics.b2Body,a.prototype.b2FixtureDef=Box2D.Dynamics.b2FixtureDef,a.prototype.b2Fixture=Box2D.Dynamics.b2Fixture,a.prototype.b2World=Box2D.Dynamics.b2World,a.prototype.b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,a.prototype.b2DebugDraw=Box2D.Dynamics.b2DebugDraw,a.prototype.data=null,a.prototype.parent=null,a.prototype.scene=null,a.prototype.el=null,a.prototype.physicsWorld=null,a.prototype.attractor=null,a.prototype.attractorImgPath="",a.prototype.attractorRadius=170,a.prototype.attractorShape=null,a.prototype.attractorDistance=null,a.prototype.movers=null,a.prototype.nbDecorations=40,a.prototype.statBubbles=null,a.prototype.moverPosition=null,a.prototype.finalDistance=null,a.prototype.vecSum=null,a.prototype.isUpdatable=!1,a.prototype.physicsEnabled=!0,a.prototype.isVisible=!1,a.prototype.isUser=!1,a.prototype.load=function(a,b,c){return this.data=a,this.attractorImgPath=b,this.scoreTotal=c,this.initAttractor(),null},a.prototype.initAttractor=function(){var a;return this.offset=1===this.parent.nbVisibleUser?0:100,a={x:this.scene.width/2-this.offset,y:this.scene.height/2},this.attractor=new s(null,this.attractorImgPath,this.scoreTotal,a,this.physicWorld,this.isUser,this.scoreTotal),this.attractor.update(),this.el.addChild(this.attractor.el),null},a.prototype.initDecorations=function(){var a,b,c,d;for(b=c=0,d=this.nbDecorations;d>=0?d>c:c>d;b=d>=0?++c:--c)a=new t(this.physicWorld,this.attractor.physics.el.GetWorldCenter()),this.movers.push(a),this.el.addChild(a.el);return null},a.prototype.initBubbleStats=function(){return this.addedFriendsdBubble=new w(null,"ADDED FRIEND",this.data.addedFriend,0,this.physicWorld,this.attractor.physics.el.GetWorldCenter()),this.movers.push(this.addedFriendsdBubble),this.statBubbles.push(this.addedFriendsdBubble),this.addedPhotosdBubble=new w(null,"ADDED PHOTOS",this.data.addedPhoto,52,this.physicWorld,this.attractor.physics.el.GetWorldCenter()),this.movers.push(this.addedPhotosdBubble),this.statBubbles.push(this.addedPhotosdBubble),this.sharesBubble=new w(null,"SHARES",this.data.share,156,this.physicWorld,this.attractor.physics.el.GetWorldCenter()),this.movers.push(this.sharesBubble),this.statBubbles.push(this.sharesBubble),this.statusUpdatesdBubble=new w(null,"STATUS UPDATES",this.data.statusUpdate,208,this.physicWorld,this.attractor.physics.el.GetWorldCenter()),this.movers.push(this.statusUpdatesdBubble),this.statBubbles.push(this.statusUpdatesdBubble),this.taggedInPhotosBubble=new w(null,"TAGGED IN PHOTOS",this.data.taggedInPhoto,260,this.physicWorld,this.attractor.physics.el.GetWorldCenter()),this.movers.push(this.taggedInPhotosBubble),this.statBubbles.push(this.taggedInPhotosBubble),this.wallPostBubble=new w(null,"WALL POST",this.data.wallPost,312,this.physicWorld,this.attractor.physics.el.GetWorldCenter()),this.movers.push(this.wallPostBubble),this.statBubbles.push(this.wallPostBubble),this.likeBubble=new w(null,"LIKES",this.data.like,104,this.physicWorld,this.attractor.physics.el.GetWorldCenter()),this.movers.push(this.likeBubble),this.statBubbles.push(this.likeBubble),this.el.addChild(this.addedFriendsdBubble.el),this.el.addChild(this.addedPhotosdBubble.el),this.el.addChild(this.sharesBubble.el),this.el.addChild(this.statusUpdatesdBubble.el),this.el.addChild(this.taggedInPhotosBubble.el),this.el.addChild(this.wallPostBubble.el),this.el.addChild(this.likeBubble.el),null},a.prototype.initEvents=function(){return this.el.on("pressup",this.onPress,null,!0),this.el.cursor="pointer",null},a.prototype.onPress=function(){return null},a.prototype.removeEvents=function(){return this.el.off("pressup",this.onPress),this.el.cursor=null,null},a.prototype.transitionIn=function(a){return null==a&&(a=1.5),this.isVisible=!0,this.isUpdatable=!0,this.el.alpha=1,this.attractor.transitionIn(.5,a,this.transitionInComplete),null},a.prototype.transitionInComplete=function(){return setTimeout(function(a){return function(){return a.initBubbleStats(),a.initDecorations(),a.addedFriendsdBubble.transitionIn(.3),a.addedPhotosdBubble.transitionIn(.3),a.sharesBubble.transitionIn(.3),a.statusUpdatesdBubble.transitionIn(.3),a.taggedInPhotosBubble.transitionIn(.3),a.wallPostBubble.transitionIn(.3),a.addedFriendsdBubble.transitionIn(.3),a.likeBubble.transitionIn(.3)}}(this),1e3),null},a.prototype.transitionOut=function(a){return this.isUpdatable=!1,this.visible=!1,TweenLite.to(this.el,.3,{alpha:0,onComplete:this.onTransitionOutComplete,onCompleteParams:[a]}),null},a.prototype.onTransitionOutComplete=function(a){return this.dispose(),"function"==typeof a&&a(),null},a.prototype.scaleDown=function(){return TweenLite.to(this.el,.5,{scaleX:.35,scaleY:.35,x:this.scene.width-300,y:10,onComplete:this.onScaleDownComplete}),this.attractor.scaleUpImg(),null},a.prototype.onScaleDownComplete=function(){return this.isUpdatable=!1,this.initEvents(),null},a.prototype.scaleUp=function(a){var b;return this.removeEvents(),b=1===this.parent.nbVisibleUser?0+this.offset:-100+this.offset,TweenLite.to(this.el,.5,{scaleX:1,scaleY:1,x:b,y:0,onComplete:this.onScaleUpComplete,onCompleteParams:[a]}),this.attractor.scaleDownImg(),null},a.prototype.onScaleUpComplete=function(a){return this.isUpdatable=!0,"function"==typeof a&&a(),null},a.prototype.update=function(){var a,b,c,d;if(this.physicsEnabled){for(this.physicWorld.Step(1/60,10,10),this.physicWorld.ClearForces(),d=this.movers,b=0,c=d.length;c>b;b++){if(a=d[b],!a.physics.el)return;this.moverPosition=a.physics.el.GetWorldCenter(),this.attractorShape=this.attractor.physics.el.GetFixtureList().GetShape(),this.attractorRadius=100*this.attractorShape.GetRadius(),this.attractorPosition=this.attractor.physics.el.GetWorldCenter(),this.tempAttractorDistance=new this.b2Vec2(0,0),this.tempAttractorDistance.Add(this.moverPosition),this.tempAttractorDistance.Subtract(this.attractorPosition),this.finalDistance=this.tempAttractorDistance.Length(),this.tempAttractorDistance.NegativeSelf(),this.vecSum=Math.abs(this.tempAttractorDistance.x)+Math.abs(this.tempAttractorDistance.y),this.tempAttractorDistance.Multiply(1/this.vecSum*(a.mass/this.finalDistance)),a.physics.el.ApplyForce(this.tempAttractorDistance,a.physics.el.GetWorldCenter()),a.update()}return null}},a.prototype.dispose=function(){var a,b,c,d;for(d=this.movers,b=0,c=d.length;c>b;b++)a=d[b],this.physicWorld.DestroyBody(a.physics.el),a.dispose(),a=null;return this.b2World=null,this.b2worldScale=0,this.b2Vec2=null,this.b2AABB=null,this.b2BodyDef=null,this.b2Body=null,this.b2FixtureDef=null,this.b2Fixture=null,this.b2World=null,this.b2PolygonShape=null,this.b2DebugDraw=null,this.parent=null,this.scene=null,this.physicsWorld=null,this.attractor=null,this.attractorShape=null,this.attractorDistance=null,this.movers=null,this.moverPosition=null,this.finalDistance=null,this.vecSum=null,this.isUpdatable=!1,this.isVisible=!1,null},a}(),s=function(a){function b(){return this.updateScore=Vd(this.updateScore,this),this.transitionInBorder=Vd(this.transitionInBorder,this),this.transitionInImg=Vd(this.transitionInImg,this),this.transitionIn=Vd(this.transitionIn,this),this.initImg=Vd(this.initImg,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.img=null,b.prototype.imgMask=null,b.prototype.imgContainer=null,b.prototype.imgWidth=0,b.prototype.imgHeight=0,b.prototype.imgScale=1,b.prototype.border=null,b.prototype.borderRadius=90,b.prototype.borderColor="#EBEBEB",b.prototype.score=0,b.prototype.scoreBg=null,b.prototype.scoreBgColor="",b.prototype.scoreTxt=null,b.prototype.position=null,b.prototype.mass=100,b.prototype.transitionInCallback=null,b.prototype.initialize=function(a,c,d,e,f,g,h){return this.scoreTotal=h,b.__super__.initialize.call(this,f),this.el=new createjs.Container,this.imgPath=c,this.isUser=g,this.physics.position=new this.b2Vec2(1e3,260),this.position=e,this.scoreTotal<=500&&this.scoreTotal>200?this.scoreBgColor="#d24649":this.scoreTotal<=200&&this.scoreTotal>-200?this.scoreBgColor="#886d9c":this.scoreTotal<=-200&&this.scoreTotal>=-500&&(this.scoreBgColor="#9fd8e9"),this.scoreTotal=Ic.getNiceScore(this.scoreTotal),this.initBorder(),this.initImgContainer(),this.initPhysics(),null},b.prototype.initImg=function(){var a,b;return this.imgMask=new createjs.Shape,this.imgMask.graphics.beginFill("#000"),this.imgMask.graphics.drawCircle(0,0,45),this.imgMask.graphics.endFill(),b=axe.BASE_PATH+"/image.php?img="+this.imgPath,a=new Image,a.onload=function(b){return function(){b.imgScale=a.width>a.height?90/a.height:90/a.width,b.imgWidth=a.width,b.imgHeight=a.height,b.img=new createjs.Bitmap(a),b.img.x=-(a.width/2*b.imgScale),b.img.y=-(a.height/2*b.imgScale),b.img.scaleX=b.imgScale,b.img.scaleY=b.imgScale,b.img.mask=b.imgMask,b.img.alpha=0,b.img.cursor="pointer",b.img.mouseEnabled=!0,b.el.addChild(b.img),b.initArcBorder(),b.initScore(),b.transitionInImg()}}(this),a.src=b,null},b.prototype.initImgContainer=function(){return this.imgContainer=new createjs.Shape,this.imgContainer.graphics.beginStroke("#fff"),this.imgContainer.graphics.setStrokeStyle(3),this.imgContainer.graphics.beginFill("#D3D3D3"),this.imgContainer.graphics.drawCircle(0,0,45),this.imgContainer.graphics.endFill(),this.imgContainer.scaleX=this.imgContainer.scaleY=0,this.el.addChild(this.imgContainer),null},b.prototype.initArcBorder=function(){return this.arc=new createjs.Shape,this.arc.graphics.beginStroke("#fff"),this.arc.graphics.setStrokeStyle(3),this.arc.graphics.arc(0,0,45,0,2*Math.PI,!0),this.el.addChild(this.arc),null},b.prototype.initBorder=function(){return this.border=new createjs.Shape,this.border.graphics.beginFill(this.borderColor),this.border.graphics.drawCircle(0,0,this.borderRadius),this.border.graphics.endFill(),this.border.scaleX=this.border.scaleY=0,this.el.addChild(this.border),null},b.prototype.initScore=function(){return this.scoreBg=new createjs.Shape,this.scoreBg.graphics.beginFill(this.scoreBgColor),this.scoreBg.graphics.drawCircle(0,0,20),this.scoreBg.graphics.endFill(),this.scoreBg.x=30,this.scoreBg.y=30,this.el.addChild(this.scoreBg),this.scoreTxt=new createjs.Text(""+this.scoreTotal,"20px tungstensemibold","#fff"),this.scoreTxt.x=30,this.scoreTxt.y=20,this.scoreTxt.regX=Math.floor(this.scoreTxt.getMeasuredWidth()/2),this.el.addChild(this.scoreTxt),null},b.prototype.initPhysics=function(){return this.physics.bodyDef.type=Box2D.Dynamics.b2Body.b2_staticBody,this.physics.bodyDef.position.Set(this.position.x/this.physics.b2worldScale,this.position.y/this.physics.b2worldScale),this.polygonShape=new Box2D.Collision.Shapes.b2CircleShape,this.polygonShape.SetRadius(90/this.physics.b2worldScale),this.physics.fixtureDef.density=10,this.physics.fixtureDef.friction=.5,this.physics.fixtureDef.restitution=.7,this.physics.fixtureDef.shape=this.polygonShape,this.physics.el=this.physics.parentWorld.CreateBody(this.physics.bodyDef),this.physics.el.CreateFixture(this.physics.fixtureDef),null},b.prototype.transitionIn=function(a,b,c){return null==b&&(b=0),this.transitionInCallback=c,TweenLite.to(this.imgContainer,a,{scaleX:1,scaleY:1,delay:b,onComplete:function(a){return function(){var b;return a.isUser?a.initImg():(b=ib.getUserAvatar(a.imgPath.split("facebook.com/")[1].split("/picture")[0]),b.done(function(b){return a.imgPath=b,a.initImg()})),a.transitionInBorder()}}(this)}),null},b.prototype.transitionInImg=function(){return TweenLite.to(this.img,.3,{alpha:1,onComplete:function(a){return function(){return a.el.removeChild(a.imgContainer)}}(this)}),null},b.prototype.transitionInBorder=function(){return TweenLite.to(this.border,.3,{scaleX:1,scaleY:1,delay:.5,onComplete:this.transitionInCallback}),null},b.prototype.transitionOut=function(){return null},b.prototype.scaleUpImg=function(){return this.arc?null:void 0},b.prototype.scaleDownImg=function(){return this.arc?null:void 0},b.prototype.update=function(){return this.el.x=this.position.x,this.el.y=this.position.y,null},b.prototype.updateScore=function(a){return this.scoreTxt?(this.scoreTotal=a,this.scoreTxt.text=Math.round(a),this.scoreTxt.regX=Math.floor(this.scoreTxt.getMeasuredWidth()/2),this.scoreTotal<=500&&this.scoreTotal>200?this.scoreBgColor="#d24649":this.scoreTotal<=200&&this.scoreTotal>-200?this.scoreBgColor="#886d9c":this.scoreTotal<=-200&&this.scoreTotal>=-500&&(this.scoreBgColor="#9fd8e9"),this.scoreBg.graphics.c().f(this.scoreBgColor).dc(0,0,20).ef(),null):void 0},b}(q),t=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.color="#EBEBEB",b.prototype.mass=0,b.prototype.position=null,b.prototype.radius=0,b.prototype.attractorCenter=null,b.prototype.initialize=function(a,c){return b.__super__.initialize.call(this,a),this.position={x:0,y:0},this.radius=Math.floor(8*Math.random())+3,this.mass=Ic.map(this.radius,3,8,200,600),this.attractorCenter=c,this.el=new createjs.Shape,this.el.graphics.beginFill(this.color),this.el.graphics.drawCircle(0,0,this.radius),this.el.graphics.endFill(),this.physics.bodyDef.type=Box2D.Dynamics.b2Body.b2_dynamicBody,this.physics.bodyDef.position.Set(((Math.floor(250*Math.random())+150)*Math.cos(Ic.toRadians(360*Math.random()))+this.attractorCenter.x*this.physics.b2worldScale)/this.physics.b2worldScale,((Math.floor(250*Math.random())+150)*Math.sin(Ic.toRadians(360*Math.random()))+this.attractorCenter.y*this.physics.b2worldScale)/this.physics.b2worldScale),this.polygonShape=new Box2D.Collision.Shapes.b2CircleShape,this.polygonShape.SetRadius(this.radius/this.physics.b2worldScale),this.physics.fixtureDef.density=20,this.physics.fixtureDef.friction=.5,this.physics.fixtureDef.restitution=.3,this.physics.fixtureDef.shape=this.polygonShape,this.physics.el=this.physics.parentWorld.CreateBody(this.physics.bodyDef),this.physics.el.CreateFixture(this.physics.fixtureDef),null},b.prototype.update=function(){return this.position.x=this.physics.el.GetPosition().x,this.position.y=this.physics.el.GetPosition().y,this.el.x=this.position.x*this.physics.b2worldScale,this.el.y=this.position.y*this.physics.b2worldScale,this.el.rotation=this.physics.el.GetAngle(),null},b}(q),u=function(a){function b(a){this.onResize=Vd(this.onResize,this),this.canUpdateUserInfos=Vd(this.canUpdateUserInfos,this),this.hasChangedOfUser=Vd(this.hasChangedOfUser,this),this.resetUser=Vd(this.resetUser,this),this.changeCurrentSystem=Vd(this.changeCurrentSystem,this),this.switchSystem=Vd(this.switchSystem,this),this.initUserSystem=Vd(this.initUserSystem,this),this.setup=Vd(this.setup,this),this.onScoreUpdate=Vd(this.onScoreUpdate,this),this.setupHeights=Vd(this.setupHeights,this),this.parent=a,b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.GRAPH_TYPE="bubbles",b.prototype.parent=null,b.prototype.userSystem=null,b.prototype.friendSystem=null,b.prototype.currentSystem=null,b.prototype.nbVisibleUser=0,b.prototype.friendVisible=!1,b.prototype.statBubbles=null,b.prototype.elDims=null,b.prototype.setupWhenReady=!1,b.prototype.graphDims={},b.prototype.headerHeight=30,b.prototype.controlsHeight=90,b.prototype.baseSize=650,b.prototype.baseWidth=650,b.prototype.baseHeight=650,b.prototype.initialize=function(){return b.__super__.initialize.call(this),this.model=this.axe().appData.USER.model,this.axe().appView.on("elDimsReceived",this.setupHeights),null},b.prototype.setupHeights=function(a){return this.elDims=a,this.setupWhenReady&&this.onScoreUpdate(),null},b.prototype.onScoreUpdate=function(){if(!this.elDims)return this.setupWhenReady=!0;if(this.model.get("scores.fb.judgement")&&!this.userSystem)return this.setup(),this.initUserSystem(),this.userSystem.transitionIn(),this.currentSystem=this.userSystem,this.canUpdateUserInfos(),null},b.prototype.setup=function(){var a,b,c;if(!this.scene&&this.elDims)return b=this.elDims.h.graphs+this.elDims.h.controls,c=.75*$(window).innerWidth(),a=c/1.853061224,this.innerSize=[c,a],this.graphDims=this.axe().IS_MOBILE?{width:window.innerWidth,height:window.innerHeight-this.headerHeight-this.controlsHeight}:{width:1030,height:605},this.size=[1030,605],this.initGraph(1030,605),this.parent.el.appendChild(this.scene.canvasEl),this.render(),this.onResize(),null},b.prototype.initUserSystem=function(){var a,b,c;if(!this.userSystem)return this.nbVisibleUser=1,c=axe.appData.USER.model.get("scores.fb.sampleData.actions"),a=axe.appData.USER.model.get("info.fb.avatar"),b=Math.round(axe.appData.USER.model.get("info.fb.score")),this.userSystem=new r(this,this.scene,axe.appData.USER.model.get("info.fb.avatar"),!0),this.userSystem.onPress=this.switchSystem,this.userSystem.load(c,a,b),this.currentSystem=this.userSystem,this.hasChangedOfUser(),this.onResize(),null},b.prototype.initFriendSystem=function(a){var b,c,d;return this.nbVisibleUser=2,d=a.user.score.sampleData.actions,b=a.user.avatar,c=a.user.score.total,this.userSystem.scaleDown(),this.friendSystem=new r(this,this.scene,null,!1),this.friendSystem.onPress=this.switchSystem,this.friendSystem.load(d,b,c),this.friendSystem.transitionIn(.5),this.currentSystem=this.friendSystem,this.hasChangedOfUser(),this.friendVisible=!0,null},b.prototype.switchFriend=function(a){return this.friendSystem.isUpdatable?this.friendSystem.transitionOut(function(b){return function(){var c,d;return c=a.user.avatar,d=a.user.score.total,b.friendSystem=new r(b,b.scene),b.friendSystem.onPress=b.switchSystem,b.friendSystem.load(a.user.score.sampleData.actions,c,d),b.friendSystem.transitionIn(0),b.currentSystem=b.friendSystem,b.hasChangedOfUser()}}(this)):this.switchSystem(function(b){return function(){var c,d;return b.friendSystem.transitionOut(function(){}),c=a.user.avatar,d=a.user.score.total,b.friendSystem=new r(b,b.scene),b.friendSystem.onPress=b.switchSystem,b.friendSystem.load(a.user.score.sampleData.actions,c,d),b.friendSystem.transitionIn(0),b.currentSystem=b.friendSystem,b.hasChangedOfUser()}}(this)),null},b.prototype.switchSystem=function(a){return this.userSystem.isUpdatable?(this.currentSystem=this.friendSystem,this.userSystem.scaleDown(),"function"==typeof a?this.friendSystem.scaleUp(a):this.friendSystem.scaleUp()):(this.currentSystem=this.userSystem,this.friendSystem.scaleDown(),"function"==typeof a?this.userSystem.scaleUp(a):this.userSystem.scaleUp()),this.hasChangedOfUser(),null},b.prototype.changeCurrentSystem=function(a,b){return null==b&&(b=!1),this.currentSystem.transitionOut(function(c){return function(){var d,e,f;return b?(f=axe.appData.USER.model.get("scores.fb.sampleData.actions"),d=axe.appData.USER.model.get("info.fb.avatar"),e=Ic.getNiceScore(c.axe().appData.USER.model.get("scores.fb.total")),c.currentSystem=new r(c,c.scene,axe.appData.USER.model.get("info.fb.avatar"),!0)):(f=a.user.score.sampleData.actions,d=a.user.avatar,e=a.user.score.total,c.currentSystem=new r(c,c.scene),c.friendVisible=!0),c.currentSystem.load(f,d,e),c.currentSystem.transitionIn(0),c.hasChangedOfUser(),c.onResize()}}(this)),null},b.prototype.resetUser=function(){var a;return this.axe().IS_MOBILE?this.changeCurrentSystem(null,!0):(this.nbVisibleUser=1,this.currentSystem=this.userSystem,this.userSystem.scaleUp(),null!=(a=this.friendSystem)&&a.transitionOut()),this.friendVisible=!1,null},b.prototype.update=function(){var a;return this.currentSystem&&this.currentSystem.isUpdatable&&this.currentSystem.update(),null!=(a=this.scene)&&a.update(),null},b.prototype.hasChangedOfUser=function(){return console.log("to override"),null},b.prototype.canUpdateUserInfos=function(){return console.log("to override"),null},b.prototype.onResize=function(){var a,c,d;return b.__super__.onResize.call(this),this.graphDims&&this.userSystem?(this.graphDims=this.axe().IS_MOBILE?window.innerWidth<window.innerHeight?{width:window.innerWidth,height:window.innerHeight-this.headerHeight-this.controlsHeight}:{width:window.innerWidth,height:window.innerHeight}:{width:1140,height:605},this.axe().IS_MOBILE&&(this.graphDims.height>this.graphDims.width?(this.scene.stage.canvas.style.width="",this.scene.stage.canvas.style.height="",this.scene.stage.canvas.style.marginLeft="",this.scene.stage.canvas.style.marginTop="",d=1.5*this.graphDims.width,this.scene.stage.canvas.style.width=d+"px",this.scene.stage.canvas.style.marginLeft=-d/2+"px",a=this.scene.stage.canvas.clientHeight,this.scene.stage.canvas.style.marginTop=(this.graphDims.height-a)/2+"px"):(this.scene.stage.canvas.style.width="",this.scene.stage.canvas.style.height="",this.scene.stage.canvas.style.marginLeft="",this.scene.stage.canvas.style.marginTop="",a=this.graphDims.height,this.scene.stage.canvas.style.height=a+"px",c=this.scene.stage.canvas.clientWidth,this.scene.stage.canvas.style.marginLeft=-this.graphDims.width/2+40+"px",this.axe().appView.header.hideByScroll())),this.resized(),null):void 0},b.prototype.resized=function(){return null},b}(b),v=function(a){function b(){return this.reset=Vd(this.reset,this),this.init=Vd(this.init,this),this.initialize=Vd(this.initialize,this),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="bullseye-infos",b.prototype.tooHardPercentField=null,b.prototype.effortlessPercentField=null,b.prototype.notTryingPercentField=null,b.prototype.nbTweetsTooHard=0,b.prototype.nbTweetsEffortless=0,b.prototype.nbTweetsNotTrying=0,b.prototype.currentTweetTotal=0,b.prototype.graphTooHard=null,b.prototype.graphEffortless=null,b.prototype.graphNotTrying=null,b.prototype.graphTooHardStage=null,b.prototype.graphEffortlessStage=null,b.prototype.graphNotTryingStage=null,b.prototype.initialize=function(){b.__super__.initialize.call(this),this.tooHardPercentField=this.el.getElementsByClassName(" tooHard ")[0].getElementsByClassName("percent")[0],this.effortlessPercentField=this.el.getElementsByClassName(" effortless ")[0].getElementsByClassName("percent")[0],this.notTryingPercentField=this.el.getElementsByClassName(" notTrying ")[0].getElementsByClassName("percent")[0],this.scoreField=this.el.getElementsByClassName(" score ")[0],this.textField=this.el.getElementsByClassName(" desc ")[0],this.graphTooHard=new C(null,"#db5656"),this.graphEffortless=new C(null,"#795693"),this.graphNotTrying=new C(null,"#78c7de"),this.el.getElementsByClassName(" tooHard ")[0].insertBefore(this.graphTooHard.el.canvasEl,this.el.getElementsByClassName(" tooHard ")[0].firstChild),this.el.getElementsByClassName(" effortless ")[0].insertBefore(this.graphEffortless.el.canvasEl,this.el.getElementsByClassName(" effortless ")[0].firstChild),this.el.getElementsByClassName(" notTrying ")[0].insertBefore(this.graphNotTrying.el.canvasEl,this.el.getElementsByClassName(" notTrying ")[0].firstChild),this.axe().IS_MOBILE&&$(this.el).addClass("is-mobile")},b.prototype.init=function(){return this.$globalInfos=this.$el.find(".globalInfos"),this.$tweetInfos=this.$el.find(".bullseye-tweetsInfos"),null},b.prototype.reset=function(){return this.nbTweetsTooHard=0,this.nbTweetsEffortless=0,this.nbTweetsNotTrying=0,this.currentTweetTotal=0,this.graphTooHard.update(0),this.graphEffortless.update(0),this.graphNotTrying.update(0),this.tooHardPercentField.innerHTML="-",this.effortlessPercentField.innerHTML="-",this.notTryingPercentField.innerHTML="-",null},b.prototype.updateGlobalInfos=function(a){var b;this.currentTweetTotal++,b=0,"tryingTooHard"===a?(this.nbTweetsTooHard++,b=(100*(this.nbTweetsTooHard/7)).toFixed(0),this.tooHardPercentField.innerHTML=b+"%",this.graphTooHard.update(b)):"effortless"===a?(this.nbTweetsEffortless++,b=(100*(this.nbTweetsEffortless/7)).toFixed(0),this.effortlessPercentField.innerHTML=b+"%",this.graphEffortless.update(b)):(this.nbTweetsNotTrying++,b=(100*(this.nbTweetsNotTrying/7)).toFixed(0),this.notTryingPercentField.innerHTML=b+"%",this.graphNotTrying.update(b))},b.prototype.show=function(){return $(this.el).removeClass("hide"),null},b.prototype.hide=function(){return $(this.el).addClass("hide"),null},b}(g),w=function(a){function b(){return this.update=Vd(this.update,this),this.initPhysics=Vd(this.initPhysics,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.data=null,b.prototype.label="",b.prototype.labelTxt=null,b.prototype.labelFontSize=0,b.prototype.frequency=0,b.prototype.frequencyTxt=null,b.prototype.frequencyFontSize=0,b.prototype.background=null,b.prototype.backgroundColor="",b.prototype.backgroundAlpha=1,b.prototype.img=null,b.prototype.imgMask=null,b.prototype.radius=80,b.prototype.startAngle=0,b.prototype.mass=1e4,b.prototype.attractorCenter=null,b.prototype.initialize=function(a,c,d,e,f,g){var h;return b.__super__.initialize.call(this,f),this.label=c,this.data=d,this.frequency=this.data.frequency,this.startAngle=e,this.attractorCenter=g,this.mass=1e4*Ic.map(this.frequency,0,1,1,3),this.radius=Ic.map(this.frequency,0,1,60,110),this.labelFontSize=Ic.map(this.frequency,0,1,18,25),7*this.labelFontSize<.3&&(this.radius*=1.2),this.frequencyFontSize=Ic.map(this.frequency,0,1,26,40),7*this.frequencyFontSize<.3&&(this.radius*=1.2),"tryingTooHard"===this.data.judgement?this.backgroundColor="#d24649":"effortless"===this.data.judgement?this.backgroundColor="#886d9c":"notHardEnough"===this.data.judgement&&(this.backgroundColor="#9fd8e9"),h=this.data.pictures[Math.floor(Math.random()*this.data.pictures.length)],h?(this.backgroundAlpha=.6,"Adding new friends"===this.data.name?(h=ib.getUserAvatar(h.split("facebook.com/")[1].split("/picture")[0]),h.done(function(a){return function(b){return a.initImage(b)}}(this))):this.initImage(h)):(this.initBackground(),this.initTexts()),this.initPhysics(),this.update(),null},b.prototype.initPhysics=function(){return this.physics.bodyDef.type=Box2D.Dynamics.b2Body.b2_dynamicBody,this.physics.bodyDef.position.Set((200*Math.cos(Ic.toRadians(this.startAngle))+this.attractorCenter.x*this.physics.b2worldScale)/this.physics.b2worldScale,(200*Math.sin(Ic.toRadians(this.startAngle))+this.attractorCenter.y*this.physics.b2worldScale)/this.physics.b2worldScale),this.polygonShape=new Box2D.Collision.Shapes.b2CircleShape,this.polygonShape.SetRadius(this.radius/this.physics.b2worldScale),this.physics.fixtureDef.density=5,this.physics.fixtureDef.friction=.5,this.physics.fixtureDef.restitution=.7,this.physics.fixtureDef.shape=this.polygonShape,this.physics.el=this.physics.parentWorld.CreateBody(this.physics.bodyDef),this.physics.el.CreateFixture(this.physics.fixtureDef),this.update(),null},b.prototype.initBackground=function(){return this.background=new createjs.Shape,this.background.graphics.beginFill(this.backgroundColor),this.background.graphics.drawCircle(0,0,this.radius),this.background.graphics.endFill(),this.background.alpha=this.backgroundAlpha,this.el.addChild(this.background),null},b.prototype.initTexts=function(){return this.labelTxt=new createjs.Text(this.label,""+this.labelFontSize+"px tungstenmedium","#fff"),this.labelTxt.x=0,this.labelTxt.y=-25,this.labelTxt.regX=Math.floor(this.labelTxt.getMeasuredWidth()/2),this.frequencyTxt=new createjs.Text(""+(7*this.data.frequency).toFixed(3)+"/WEEK",""+this.frequencyFontSize+"px tungstenmedium","#fff"),this.frequencyTxt.x=0,this.frequencyTxt.y=-5,this.frequencyTxt.regX=Math.floor(this.frequencyTxt.getMeasuredWidth()/2),this.el.addChild(this.labelTxt),this.el.addChild(this.frequencyTxt),null
},b.prototype.initImage=function(a){var b;return a=this.axe().BASE_PATH+"/image.php?img="+a,this.imgMask=new createjs.Shape,this.imgMask.graphics.beginFill(this.color),this.imgMask.graphics.drawCircle(0,0,this.radius),this.imgMask.graphics.endFill(),this.imgMask.alpha=.6,b=new Image,b.onload=function(a){return function(){a.imgScale=b.width>b.height?2*a.radius/b.height:2*a.radius/b.width,a.imgWidth=b.width,a.imgHeight=b.height,a.img=new createjs.Bitmap(b),a.img.x=-(b.width/2*a.imgScale),a.img.y=-(b.height/2*a.imgScale),a.img.scaleX=a.imgScale,a.img.scaleY=a.imgScale,a.img.mask=a.imgMask,a.el.addChild(a.img),a.initBackground(),a.initTexts()}}(this),b.onerror=b.onabort=function(a){return function(){return a.backgroundAlpha=1,a.initBackground(),a.initTexts()}}(this),b.src=a,null},b.prototype.update=function(){return b.__super__.update.call(this),this.position.x=this.physics.el.GetPosition().x,this.position.y=this.physics.el.GetPosition().y,this.el.x=this.position.x*this.physics.b2worldScale,this.el.y=this.position.y*this.physics.b2worldScale,this.el.rotation=this.physics.el.GetAngle(),null},b}(q),y=function(a){function b(){return this.onUserPicReady=Vd(this.onUserPicReady,this),this.openLink=Vd(this.openLink,this),this.initUserPic=Vd(this.initUserPic,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.marks=null,b.prototype.userPic=null,b.prototype.center=null,b.prototype.circleMarks=null,b.prototype.marksRange=null,b.prototype.service=null,b.prototype.initialize=function(a,b,c,d,e,f){var g;this.scene=a,this.center=c,this.service=e,this.username=f,this.marks=[],this.bubbles=[],this.el=new createjs.Container,this.circleMarks=new createjs.Shape,this.circleMarks.graphics.setStrokeStyle(1,"round"),this.circleMarks.graphics.beginStroke("#CCCCCC"),g=d.get("info")?d.get("info."+this.service+".avatar"):d.get("avatar"),this.initUserPic(g),this.initMarks()},b.prototype.initUserPic=function(a){var b,c,d,e,f;a&&(c=new Image,f=this.scene,b=this.center,e=this.openLink,d=this.onUserPicReady,c.onload=function(){var a,c,d;c=62/this.width,d=62/this.height,this.userPic=new createjs.Container,this.userPic.addChild(new createjs.Bitmap(this)),this.userPic.x=b.x-this.width/2*c,this.userPic.y=b.y-this.height/2*d,this.userPic.scaleX=c,this.userPic.scaleY=d,a=this.userPic.addChild(new createjs.Shape),a.graphics.f("#F00").drawCircle(this.width/2,this.height/2,this.width/2),a.compositeOperation="destination-in",this.userPic.cache(0,0,this.width,this.height),this.userPic.on("pressup",e),this.userPic.cursor="pointer",this.userPic.mouseEnabled=!0,f.addChild(this.userPic)},c.src=this.axe().BASE_PATH+"/image.php?img="+a)},b.prototype.initMarks=function(){var a,b,c,d,e,f;for(b=258.333333335,a=f=5;f>-1;a=--f)d=0,1===a?(d=51,this.circleMarks.graphics.beginFill("#ffffff")):2===a?(d=b,this.circleMarks.graphics.beginStroke("#f2f0f5"),this.circleMarks.graphics.beginFill("#f2f0f5")):(d=b,this.circleMarks.graphics.beginStroke("#cccccc")),this.circleMarks.graphics.drawCircle(this.center.x,this.center.y,d),this.circleMarks.graphics.endFill(),(0===a||5===a)&&(0===a?(e=0,c=0):(e=500,c=3),this.scoreMark=new createjs.Container,this.scoreMark.x=this.center.x,this.scoreMark.y=this.center.y-b,this.scoreMarkBg=new createjs.Bitmap("/static/images/modules/bullseye-scoreMarkBg.png"),this.scoreMarkBg.alpha=.6,this.scoreMarkBg.x=0,this.scoreMarkBg.y=0,this.scoreMarkBg.regX=15,this.scoreMarkBg.regY=9,this.scoreMarkValue=new createjs.Text(""+e,"bold 12px Arial","#000"),this.scoreMarkValue.x=c,this.scoreMarkValue.y=0,this.scoreMarkValue.regX=Math.floor(this.scoreMarkValue.getMeasuredWidth()/2),this.scoreMarkValue.regY=Math.floor(this.scoreMarkValue.getMeasuredHeight()/2),this.scoreMark.addChild(this.scoreMarkBg),this.scoreMark.addChild(this.scoreMarkValue),this.marks.push({label:this.scoreMark})),b-=41.666666667},b.prototype.openLink=function(){var a,b;return this.axe().IS_MOBILE||(a="tw"===this.service?"twitter":"instagram",b="http://"+a+".com/"+this.username,window.open(b,"_blank")),null},b.prototype.onUserPicReady=function(){return null},b.prototype.initLabels=function(){},b.prototype.update=function(){},b}(g),L=function(a){function b(){return this.onInteractionEnd=Vd(this.onInteractionEnd,this),this.onInteractionMove=Vd(this.onInteractionMove,this),this.onInteractionStart=Vd(this.onInteractionStart,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.img=null,b.prototype.borderCircle=null,b.prototype.percent=null,b.prototype.canDrag=!1,b.prototype.rad=0,b.prototype.angle=0,b.prototype.x=0,b.prototype.y=0,b.prototype.circleAnchor=null,b.prototype.range=null,b.prototype.onFocus=null,b.prototype.onMove=null,b.prototype.config=null,b.prototype.upArrow=null,b.prototype.bottomArrow=null,b.prototype.upArrowRotation=0,b.prototype.bottomArrowRotation=0,b.prototype.tweenUpArrow=null,b.prototype.tweenBottomArrow=null,b.prototype.linkBar=null,b.prototype.initialize=function(a,b){this.bullseye=b,this.el=new createjs.Container,this.el.regX=27,this.el.regY=27,this.el.cursor="pointer",this.el.mouseEnabled=!0,this.config=a,this.circleAnchor=this.config.circleAnchor,this.range=this.config.range,this.scaleOnInteractionStart=this.config.scaleOnInteractionStart||!0,this.x=this.config.circleAnchor.radius*Ic.MATH_COS(Ic.toRadians(this.config.startAngle))+this.config.circleAnchor.center.x,this.y=this.config.circleAnchor.radius*Ic.MATH_SIN(Ic.toRadians(this.config.startAngle))+this.config.circleAnchor.center.y,this.el.x=this.x,this.el.y=this.y,this.initBorderCircle(),a.imgOnlyMode?this.initImg(1):a.txtOnlyMode?this.initTxt():(this.initTxt(),this.initImg(0)),this.initEvents(),this.initArrows()},b.prototype.initBorderCircle=function(){this.borderCircle=new createjs.Shape,this.borderCircle.graphics.setStrokeStyle(2,"round"),this.borderCircle.graphics.beginStroke("#999999"),this.borderCircle.graphics.beginFill("rgba(255, 255, 255, 1)"),this.borderCircle.graphics.drawCircle(0,0,27),this.borderCircle.graphics.endFill(),this.borderCircle.regX=this.borderCircle.regY=-27,this.el.addChild(this.borderCircle)},b.prototype.initImg=function(a){var b;b=new Image,b.onload=function(b){return function(){return b.img=new createjs.Bitmap(b.config.img),b.img.x=27,b.img.y=15,b.img.regX=10,b.img.regy=13,b.img.alpha=a,b.el.addChild(b.img)}}(this),b.src=this.config.img},b.prototype.initTxt=function(){this.percent=new createjs.Text("100","bold 20px Arial","#333"),this.percent.x=(54-this.percent.getMeasuredWidth())/2,this.percent.y=34,this.percent.textBaseline="alphabetic",this.el.addChild(this.percent)},b.prototype.initEvents=function(){this.el.on("mousedown",this.onInteractionStart),this.el.on("pressmove",this.onInteractionMove),this.el.on("pressup",this.onInteractionEnd)},b.prototype.removeEvents=function(){this.el.off("mousedown",this.onInteractionStart),this.el.off("pressmove",this.onInteractionMove),this.el.off("pressup",this.onInteractionEnd)},b.prototype.initArrows=function(){return this.upArrow=new createjs.Bitmap("/static/images/modules/bullseyes-dragger-arrow.png"),this.upArrow.x=20,this.upArrow.y=-30,this.upArrow.alpha=0,this.bottomArrow=new createjs.Bitmap("/static/images/modules/bullseyes-dragger-arrow.png"),this.bottomArrow.x=31,this.bottomArrow.y=85,this.bottomArrow.rotation=198,this.bottomArrow.alpha=0,this.el.addChild(this.upArrow),this.el.addChild(this.bottomArrow),null},b.prototype.onInteractionStart=function(a){a.preventDefault(),this.canDrag=!0,this.onFocus(),!this.scaleOnInteractionStart},b.prototype.onInteractionMove=function(a){var b,c;a.preventDefault(),a.stageX&&(b=a.stageX,c=a.stageY,this.canDrag&&(this.rad=Ic.MATH_ATAN2(c-this.circleAnchor.center.y,b-this.circleAnchor.center.x),this.angle=Ic.toDegree(this.rad),this.updateRotation(),this.x=this.circleAnchor.radius*Ic.MATH_COS(this.rad)+this.circleAnchor.center.x,this.y=this.circleAnchor.radius*Ic.MATH_SIN(this.rad)+this.circleAnchor.center.y,Ic.isInRange(this.angle,this.range.min,this.range.max,!1)?(this.el.x=this.x,this.el.y=this.y,this.onMove(this.angle)):(this.angle<=this.range.min?(this.angle=this.range.min,this.x=this.circleAnchor.radius*Ic.MATH_COS(Ic.toRadians(this.range.min))+this.circleAnchor.center.x,this.y=this.circleAnchor.radius*Ic.MATH_SIN(Ic.toRadians(this.range.min))+this.circleAnchor.center.y,this.el.x=this.x,this.el.y=this.y,this.onMove(this.range.min)):this.angle>=this.range.max&&(this.angle=this.range.max,this.x=this.circleAnchor.radius*Ic.MATH_COS(Ic.toRadians(this.range.max))+this.circleAnchor.center.x,this.y=this.circleAnchor.radius*Ic.MATH_SIN(Ic.toRadians(this.range.max))+this.circleAnchor.center.y,this.el.x=this.x,this.el.y=this.y,this.onMove(this.range.max)),this.onInteractionMove)))},b.prototype.onInteractionEnd=function(){TweenLite.to(this.el,.15,{scaleX:1,scaleY:1}),this.canDrag=!1},b.prototype.updateRotation=function(){return this.config.rotateText?this.upArrow.alpha=this.bottomArrow.alpha=0:Ic.isInRange(this.angle,this.range.min,this.range.max,!1)?(this.el.rotation=this.angle,0===this.upArrow.alpha&&this.fadeUpArrow(1),0===this.bottomArrow.alpha&&this.fadeBottomArrow(1)):this.angle<=this.range.min?this.fadeUpArrow(0):this.angle>=this.range.max&&this.fadeBottomArrow(0),null},b.prototype.moveToAngle=function(){this.x=this.circleAnchor.radius*Ic.MATH_COS(Ic.toRadians(this.angle))+this.circleAnchor.center.x,this.y=this.circleAnchor.radius*Ic.MATH_SIN(Ic.toRadians(this.angle))+this.circleAnchor.center.y,this.el.x=this.x,this.el.y=this.y},b.prototype.fadeInImg=function(){TweenLite.to(this.img,.3,{alpha:.5,onUpdate:function(a){return function(){var b;return null!=(b=a.bullseye)?b.scene.update():void 0}}(this)}),this.fadeBottomArrow(1),this.updateRotation(),this.upArrow.alpha=0},b.prototype.fadeOutTxt=function(){TweenLite.to(this.percent,.3,{alpha:0,onUpdate:function(a){return function(){var b;return null!=(b=a.bullseye)?b.scene.update():void 0}}(this)})},b.prototype.updatePercent=function(a){this.percent.text=a>0?"+"+a:a,this.percent.x=(54-this.percent.getMeasuredWidth())/2},b.prototype.updateTextColor=function(a){this.percent.color=a},b.prototype.fadeUpArrow=function(a){return this.tweenUpArrow=new TweenLite(this.upArrow,.3,{alpha:a,onUpdate:function(a){return function(){var b;return null!=(b=a.bullseye)&&b.scene.update(),"function"==typeof a.onAnimUpdate?a.onAnimUpdate():void 0}}(this)}),null},b.prototype.fadeBottomArrow=function(a){return this.tweenBottomArrow=new TweenLite(this.bottomArrow,.3,{alpha:a,onUpdate:function(a){return function(){var b;return null!=(b=a.bullseye)&&b.scene.update(),"function"==typeof a.onAnimUpdate?a.onAnimUpdate():void 0}}(this)}),null},b.prototype.onFocus=function(){},b.prototype.onMove=function(){},b.prototype.onRelease=function(){},b}(Backbone.View),B=function(a){function b(){return this.hide=Vd(this.hide,this),this.show=Vd(this.show,this),this.closeAll=Vd(this.closeAll,this),this.onBubbleTouchTransitionComplete=Vd(this.onBubbleTouchTransitionComplete,this),this.onBubbleTouch=Vd(this.onBubbleTouch,this),this.onBubbleOut=Vd(this.onBubbleOut,this),this.onBubbleOver=Vd(this.onBubbleOver,this),this.onCompleteIntroAnimation=Vd(this.onCompleteIntroAnimation,this),this.onUpdateIntroAnimation=Vd(this.onUpdateIntroAnimation,this),this.playIntroAnimation=Vd(this.playIntroAnimation,this),this.initDateFrom=Vd(this.initDateFrom,this),this.onDraggerRelease=Vd(this.onDraggerRelease,this),this.onDraggerMove=Vd(this.onDraggerMove,this),this.onDraggerFocus=Vd(this.onDraggerFocus,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.dragger=null,b.prototype.bullseye=null,b.prototype.tweets=null,b.prototype.mask=null,b.prototype.tweetReferenceCircle=null,b.prototype.currentTweet=null,b.prototype.state="intro",b.prototype.minLimitBar=null,b.prototype.maxLimitBar=null,b.prototype.linkBar=null,b.prototype.date=null,b.prototype.dateTxt=null,b.prototype.nowTxt=null,b.prototype.onBubbleTouchTransitionCompleteTimer=null,b.prototype.initialize=function(a,c,d,e,f,g){this.bullseye=a,this.currentService=f,this.date=g,b.__super__.initialize.call(this),Ic.MATH_SIN=Math.sin,Ic.MATH_COS=Math.cos,this.tweets=[],this.el=new createjs.Container,this.tweetReferenceCircle={radius:400,center:{x:d/2,y:e/2}},this.initDragger(),this.initTweets(c),this.initLinkBar(),this.initDraggerMarkLimits(),this.initDateFrom(),this.initMask()},b.prototype.initEvents=function(){var a,b,c,d;if(!this.areEventsInit)for(this.areEventsInit=!0,this.dragger.onFocus=this.onDraggerFocus,this.dragger.onMove=this.onDraggerMove,this.dragger.onRelease=this.onDraggerRelease,d=this.tweets,b=0,c=d.length;c>b;b++)a=d[b],a.on("onBubbleOverEvent",this.onBubbleOver),a.on("onBubbleTouchEvent",this.onBubbleTouch)},b.prototype.removeEvents=function(){var a,b,c,d;if(this.areEventsInit)for(this.areEventsInit=!1,this.dragger.onFocus=null,this.dragger.onMove=null,this.dragger.onRelease=null,this.dragger.removeEvents(),d=this.tweets,b=0,c=d.length;c>b;b++)a=d[b],a.off("onBubbleOverEvent",this.onBubbleOver),a.off("onBubbleTouchEvent",this.onBubbleTouch)},b.prototype.onDraggerFocus=function(){},b.prototype.onDraggerMove=function(a){var b,c,d,e;for(this.currentTweet&&this.onTweetChange&&this.onTweetChange(this.currentTweet),e=this.tweets,c=0,d=e.length;d>c;c++)b=e[c],b.update(a,this);this.currentTweet&&(this.bullseye.$el.find(".bullseye-detail-infos").hasClass("show")||(this.hideGlobalInfos(),this.showDetailPostInfos()),this.updateDetailsInfos()),this.updateLinkBar(),this.bullseye.scene.update()},b.prototype.onDraggerRelease=function(){var a,b,c,d;for(d=this.tweets,b=0,c=d.length;c>b;b++)a=d[b],a.turnOnBubble();this.currentTweet&&this.currentTweet.scaleDownBubble(),this.bullseye.$el.find(".bullseye-detail-infos").hasClass("show")&&(this.hideDetailPostInfos(),this.showGlobalInfos())},b.prototype.initDragger=function(){var a;a={img:"/static/images/placeholders/modules/time.png",startAngle:0,circleAnchor:{radius:this.tweetReferenceCircle.radius+65,center:{x:this.tweetReferenceCircle.center.x,y:this.tweetReferenceCircle.center.y}},range:{min:-30,max:30}},this.dragger=new L(a,this.bullseye),this.el.addChild(this.dragger.el)},b.prototype.initDraggerMarkLimits=function(){var a,b;return a=(this.tweetReferenceCircle.radius+8)*Ic.MATH_COS((this.dragger.config.range.min-.7)*(Math.PI/180))+this.tweetReferenceCircle.center.x,b=(this.tweetReferenceCircle.radius+8)*Ic.MATH_SIN((this.dragger.config.range.min-.7)*(Math.PI/180))+this.tweetReferenceCircle.center.y,this.minLimitBar=new createjs.Shape,this.minLimitBar.graphics.setStrokeStyle(2,"round"),this.minLimitBar.graphics.beginStroke("#0x000000"),this.minLimitBar.graphics.moveTo(this.tweetReferenceCircle.center.x,this.tweetReferenceCircle.center.y),this.minLimitBar.graphics.lineTo(a,b),this.minLimitBar.alpha=1,a=(this.tweetReferenceCircle.radius+8)*Ic.MATH_COS((this.dragger.config.range.max+.8)*(Math.PI/180))+this.tweetReferenceCircle.center.x,b=(this.tweetReferenceCircle.radius+8)*Ic.MATH_SIN((this.dragger.config.range.max+.8)*(Math.PI/180))+this.tweetReferenceCircle.center.y,this.maxLimitBar=new createjs.Shape,this.maxLimitBar.graphics.setStrokeStyle(2,"round"),this.maxLimitBar.graphics.beginStroke("#0x000000"),this.maxLimitBar.graphics.moveTo(this.tweetReferenceCircle.center.x,this.tweetReferenceCircle.center.y),this.maxLimitBar.graphics.lineTo(a,b),this.maxLimitBar.alpha=1,this.el.addChild(this.minLimitBar),this.el.addChild(this.maxLimitBar),null},b.prototype.initLinkBar=function(){var a,b,c,d;return c=(this.tweetReferenceCircle.radius+5)*Ic.MATH_COS(0*(Math.PI/180))+this.tweetReferenceCircle.center.x,d=(this.tweetReferenceCircle.radius+5)*Ic.MATH_SIN(0*(Math.PI/180))+this.tweetReferenceCircle.center.y,a=(this.tweetReferenceCircle.radius+30)*Ic.MATH_COS(0*(Math.PI/180))+this.tweetReferenceCircle.center.x,b=(this.tweetReferenceCircle.radius+30)*Ic.MATH_SIN(0*(Math.PI/180))+this.tweetReferenceCircle.center.y,this.linkBar=new createjs.Shape,this.linkBar.graphics.setStrokeStyle(1,"round"),this.linkBar.graphics.beginStroke("#333"),this.linkBar.graphics.moveTo(c,d),this.linkBar.graphics.lineTo(a,b),this.el.addChild(this.linkBar),null},b.prototype.updateLinkBar=function(){var a,b,c,d;return c=(this.tweetReferenceCircle.radius+5)*Ic.MATH_COS(this.dragger.angle*(Math.PI/180))+this.tweetReferenceCircle.center.x,d=(this.tweetReferenceCircle.radius+5)*Ic.MATH_SIN(this.dragger.angle*(Math.PI/180))+this.tweetReferenceCircle.center.y,a=(this.tweetReferenceCircle.radius+30)*Ic.MATH_COS(this.dragger.angle*(Math.PI/180))+this.tweetReferenceCircle.center.x,b=(this.tweetReferenceCircle.radius+30)*Ic.MATH_SIN(this.dragger.angle*(Math.PI/180))+this.tweetReferenceCircle.center.y,this.linkBar.graphics.c(),this.linkBar.graphics.setStrokeStyle(1,"round"),this.linkBar.graphics.beginStroke("#333"),this.linkBar.graphics.moveTo(c,d),this.linkBar.graphics.lineTo(a,b),null},b.prototype.initTweets=function(a){var b,c,d,e,f,g,h,i,j,k,l;for(b=60.7/a.length,d=-30,c=null,l=a.models,j=0,k=l.length;k>j;j++)g=l[j],h=(this.tweetReferenceCircle.radius-20)*Ic.MATH_SIN(d*(Math.PI/180))+this.tweetReferenceCircle.center.y,f=(this.tweetReferenceCircle.radius-20)*Ic.MATH_SIN(d*(Math.PI/180))+this.tweetReferenceCircle.center.y,e=this.tweetReferenceCircle.radius*Ic.MATH_COS(d*(Math.PI/180))+this.tweetReferenceCircle.center.x,f=this.tweetReferenceCircle.radius*Ic.MATH_SIN(d*(Math.PI/180))+this.tweetReferenceCircle.center.y,c={model:g,manager:this,judgement:g.attributes.judgement,score:g.attributes.score,originPoint:{x:this.tweetReferenceCircle.center.x,y:this.tweetReferenceCircle.center.y},destinationPoint:{x:e,y:f}},i=new F(c,this.bullseye),this.el.addChild(i.bar),this.tweets.push(i),d+=b},b.prototype.initMask=function(){this.mask=new createjs.Shape,this.mask.graphics.beginFill("#ffffff"),this.mask.graphics.drawCircle(this.tweetReferenceCircle.center.x,this.tweetReferenceCircle.center.y,this.tweetReferenceCircle.radius-20),this.mask.graphics.endFill(),this.el.addChild(this.mask)},b.prototype.initBubbles=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(b=360/this.tweets.length,c=-90,e=l=0,m=this.tweets.length;m>=0?m>l:l>m;e=m>=0?++l:--l)i=this.tweets[e],g=Ic.MATH_ABS(i.model.attributes.score),Ic.MATH_ABS(i.model.attributes.score)>=200&&(g=Ic.MATH_ABS(i.model.attributes.score)+5),h=Ic.map(Ic.MATH_ABS(i.model.attributes.score),0,500,10,40),f=Ic.map(g,0,500,50,250),j=f*Ic.MATH_COS(Ic.toRadians(c))+a.center.x,k=f*Ic.MATH_SIN(Ic.toRadians(c))+a.center.y,d=.02*e,i.initBubble(j,k,h,d),c+=b},b.prototype.initDateFrom=function(){return this.date?(this.nowTxt=new createjs.Text("NOW","20px tungstensemibold","#a8a8a8"),this.nowTxt.x=885,this.nowTxt.y=50,this.dateTxt=new createjs.Text(""+this.date.toUpperCase(),"20px tungstensemibold","#a8a8a8"),this.dateTxt.x=920,this.dateTxt.y=535,this.dateTxt.textAlign="right",this.el.addChild(this.nowTxt),this.el.addChild(this.dateTxt),null):void 0},b.prototype.playIntroAnimation=function(a){var b,c,d,e,f;for(this.dragger.angle=this.dragger.config.range.max+10,TweenLite.to(this.dragger,3,{angle:this.dragger.config.range.min,delay:a,onUpdate:this.onUpdateIntroAnimation,onComplete:this.onCompleteIntroAnimation}),b=c=d=this.tweets.length-1;0>=d?0>c:c>0;b=0>=d?++c:--c)null!=(e=this.tweets[b])&&e.on("onBubbleStartAnimationComplete",this.onDraggerPlayingAnimation),null!=(f=this.tweets[b])&&f.playStartAnimation(.025*this.tweets.length-.025*b+a)},b.prototype.onUpdateIntroAnimation=function(){var a,b,c,d,e;for(this.dragger.moveToAngle(),this.dragger.updateRotation(),"intro"===this.state&&(a=Ic.MATH_ABS(Math.floor(Ic.map(this.dragger.angle,-30,30,0,100))-100)),this.dragger.updatePercent(a),e=this.tweets,c=0,d=e.length;d>c;c++)b=e[c],b.update(this.dragger.angle);this.updateLinkBar(),this.bullseye.scene.update()},b.prototype.onCompleteIntroAnimation=function(){this.state="dragging",this.initEvents(),this.dragger.fadeInImg(),this.dragger.fadeOutTxt(),this.hasStartOnce=!0,this.bullseye.saveUserImage(),this.bullseye.update(),this.bullseye.playScoreAnimation()},b.prototype.onBubbleOver=function(a){var b,c,d,e;for(a.on("onBubbleOutEvent",this.onBubbleOut),e=this.tweets,c=0,d=e.length;d>c;c++)b=e[c],b===a&&b.scaleUpBubble(0,null,!0)},b.prototype.onBubbleOut=function(a){a.off("onBubbleOutEvent",this.onBubbleOut),a.scaleDownBubble(0,null,!0)},b.prototype.onBubbleTouch=function(a){this.onTweetChange&&this.onTweetChange(a),a.isBubbleOpen?this.closeAll():(this.bullseye.scene.removeChild(a.bubble),this.bullseye.scene.addChild(a.bubble),this.hideGlobalInfos(),this.showDetailPostInfos(),this.currentTweet=a,this.updateDetailsInfos(),TweenLite.to(this.dragger,.5,{angle:a.angle,onUpdate:this.onUpdateIntroAnimation,onComplete:this.onBubbleTouchTransitionComplete}),this.axe().analytics.track("dashboard_bullseye_ind_post"))},b.prototype.onBubbleTouchTransitionComplete=function(){return this.onBubbleTouchTransitionCompleteTimer=setTimeout(function(a){return function(){return a.bullseye.scene.update()}}(this),100),null},b.prototype.closeAll=function(){var a,b,c,d;for(this.currentTweet=null,a=c=0,d=this.tweets.length;d>=0?d>c:c>d;a=d>=0?++c:--c)b=a===this.tweets.length-1?!0:!1,this.tweets[a].turnOnBubble(0,null,b);return this.hideDetailPostInfos(),this.showGlobalInfos(),null},b.prototype.show=function(){return this.el.alpha=1,null},b.prototype.hide=function(){return this.el.alpha=0,null},b.prototype.showGlobalInfos=function(){this.bullseye.$el.find(".globalInfos").addClass("show")},b.prototype.showDetailPostInfos=function(){this.bullseye.postOpen=!0,this.bullseye.$el.find(".bullseye-detail-infos").addClass("show")},b.prototype.hideGlobalInfos=function(){this.bullseye.$el.find(".globalInfos").removeClass("show")},b.prototype.hideDetailPostInfos=function(){this.bullseye.postOpen=!1,this.bullseye.$el.find(".bullseye-detail-infos").removeClass("show")},b.prototype.updateDetailsInfos=function(){},b.prototype.onDraggerPlayingAnimation=function(){},b.prototype.onTweetChange=function(){},b}(g),C=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.background=null,b.prototype.foreground=null,b.prototype.mask=null,b.prototype.color="",b.prototype.radius=17,b.prototype.initialize=function(a,b){this.color=b,this.el=new Mb(34,34),this.background=new createjs.Shape,this.background.graphics.beginFill(this.color),this.background.graphics.drawCircle(0,0,this.radius),this.background.graphics.endFill(),this.background.alpha=.6,this.background.regX=this.background.regY=-this.radius,this.el.addChild(this.background),this.foreground=new createjs.Shape,this.foreground.graphics.beginStroke(this.color),this.foreground.graphics.setStrokeStyle(10),this.foreground.graphics.arc(0,0,this.radius,0,Math.PI,!0),this.foreground.alpha=1,this.foreground.regX=this.foreground.regY=-17,this.el.addChild(this.foreground),this.update()},b.prototype.update=function(a){this.foreground.graphics.clear(),this.foreground.graphics.moveTo(0,0).beginFill(this.color).arc(0,0,this.radius,-Math.PI/2,Math.PI*Ic.map(a,0,100,0,2)-Math.PI/2,!1).endFill(),this.el.update()},b}(Backbone.View),G=function(a){function b(a,c,d){return this.bullseye=a,this.bullseyeUserModel=c,this.service=d,this.onModalShowComplete=Vd(this.onModalShowComplete,this),this.listenForShow=Vd(this.listenForShow,this),this.share=Vd(this.share,this),this.onShareClick=Vd(this.onShareClick,this),this.openMediaModal=Vd(this.openMediaModal,this),this.setupListeners=Vd(this.setupListeners,this),this.loadImage=Vd(this.loadImage,this),this.onCloseClick=Vd(this.onCloseClick,this),this.hideTweet=Vd(this.hideTweet,this),this.hide=Vd(this.hide,this),this.showTweet=Vd(this.showTweet,this),this.show=Vd(this.show,this),this.init=Vd(this.init,this),this.userModel=this.axe().appData.USER.model,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="bullseye-detail-infos",b.prototype.postModel=null,b.prototype.postTmpl=null,b.prototype.bullseyeUserModel=null,b.prototype.userModel=null,b.prototype.service=null,b.prototype.events={"click [data-close-btn]":"onCloseClick","click [data-share]":"onShareClick"},b.prototype.init=function(){return this.postTmpl=_.template(this.axe().templates.get("graph-info")),null},b.prototype.show=function(a,b){var c,d,e,f,g,h,i;return null==b&&(b=!1),a!==this.postModel?this.postModel?(this.postModel=null,TweenLite.to(this.$el.find("[data-postinfo]"),.15,{opacity:0,ease:Cubic.easeInOut,onComplete:function(b){return function(){return b.show(a,!0)}}(this)}),void 0):(this.postModel=a,f=Modernizr.svg?"svg":"jpg",i=a.get("type"),g=function(){switch(!0){case"twitter"===i:return"tw";case"facebook"===i:return"fb";case"instagram"===i:return"ig"}}(),d=$.extend({},a.toJSON()),h="tw"===g?d.user.screen_name.toLowerCase()===this.axe().appData.USER.model.get("info."+g+".username").toLowerCase()?!1:!0:"ig"===g?d.user.username.toLowerCase()===this.axe().appData.USER.model.get("info."+g+".username").toLowerCase()?!1:!0:!1,c=this.bullseyeUserModel.get("info")?this.bullseyeUserModel.get("info."+this.service+".avatar"):this.bullseyeUserModel.get("avatar"),e=_.extend(d,{graph_label_tth:this.axe().locale.get("graph_label_tth"),graph_label_el:this.axe().locale.get("graph_label_effortless"),graph_label_nth:this.axe().locale.get("graph_label_nthe"),txt_share:this.axe().locale.get("graph_post_share"),nameLink:Pc.getNameLink(i,d),usernameLink:Pc.getUsernameLink(i,d),dateLink:Pc.getDateLink(i,d),text:Pc.getRichText(i,d.text),logoSRC:this.axe().locale.getLocaleImage("logo_AME."+f),logoURL:this.axe().locale.get("home_tips_cta_url"),logoLabel:this.axe().locale.get("graph_logo_label"),showUser:h,avatar:c,shareable:!0,fadeIn:b}),this.$el.html(this.postTmpl(e)),b?TweenLite.to(this.$el.find("[data-postinfo]"),.15,{opacity:1,ease:Cubic.easeInOut,onComplete:this.loadImage}):this.loadImage(),this.bullseye.postOpen=!0,null):void 0},b.prototype.showTweet=function(){return null},b.prototype.hide=function(){return this.bullseye.postOpen=!1,this.$el.removeClass("show"),null},b.prototype.hideTweet=function(){return null},b.prototype.onCloseClick=function(a){return a.preventDefault(),this.setupListeners("off"),this.hide(),this.onClose(),null},b.prototype.onClose=function(){return null},b.prototype.loadImage=function(){var a,b,c;return(b=null!=(c=this.postModel)?c.get("photo"):void 0)?(this.imageHolder=this.$el.find("[data-image-holder]"),a=new Image,a.onload=a.onerror=a.onabort=function(a){return function(){return a.imageHolder.addClass("image-loaded"),a.setupListeners("on")}}(this),a.src=b,null):void 0},b.prototype.setupListeners=function(a){var b;return null!=(b=this.imageHolder)?b[a]("click",this.openMediaModal):void 0},b.prototype.openMediaModal=function(){return this.axe().appView.postMediaModal?void 0:this.axe().appView.postMediaModal=new Oc(this.postModel.toJSON())},b.prototype.onShareClick=function(a){return this.$shareBtn=$(a.currentTarget),this.$shareBtn.addClass("loading"),this.share(),this.listenForShow(),null},b.prototype.share=function(){return this.axe().appView.shareModal=new Zc({service:this.service,shareTo:this.service,postData:this.postModel.toJSON()}),null},b.prototype.listenForShow=function(){return this.axe().appView.shareModal.on("onShowComplete",this.onModalShowComplete),null},b.prototype.onModalShowComplete=function(){return this.$shareBtn.removeClass("loading"),this.axe().appView.shareModal.off("onShowComplete",this.onModalShowComplete),null},b}(g),H=function(a){function b(a,c,d){return this.bullseye=a,this.bullseyeUserModel=c,this.service=d,this.updateTweetDetails=Vd(this.updateTweetDetails,this),this.reset=Vd(this.reset,this),this.hideGlobalInfos=Vd(this.hideGlobalInfos,this),this.showGlobalInfos=Vd(this.showGlobalInfos,this),this.onDetailInfosClose=Vd(this.onDetailInfosClose,this),this.init=Vd(this.init,this),this.initialize=Vd(this.initialize,this),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="bullseye-infos",b.prototype.bullseye=null,b.prototype.bullseyeUserModel=null,b.prototype.service=null,b.prototype.$globalInfos=null,b.prototype.$tweetInfos=null,b.prototype.isGlobalInfosVisible=!0,b.prototype.tooHardPercentField=null,b.prototype.effortlessPercentField=null,b.prototype.notTryingPercentField=null,b.prototype.nbTweetsTooHard=0,b.prototype.nbTweetsEffortless=0,b.prototype.nbTweetsNotTrying=0,b.prototype.currentTweetTotal=1,b.prototype.graphTooHard=null,b.prototype.graphEffortless=null,b.prototype.graphNotTrying=null,b.prototype.graphTooHardStage=null,b.prototype.graphEffortlessStage=null,b.prototype.graphNotTryingStage=null,b.prototype.detailInfos=null,b.prototype.isInteractive=!1,b.prototype.initialize=function(){b.__super__.initialize.call(this),this.tooHardPercentField=this.el.getElementsByClassName(" tooHard ")[0].getElementsByClassName("percent")[0],this.effortlessPercentField=this.el.getElementsByClassName(" effortless ")[0].getElementsByClassName("percent")[0],this.notTryingPercentField=this.el.getElementsByClassName(" notTrying ")[0].getElementsByClassName("percent")[0],this.scoreField=this.el.getElementsByClassName(" score ")[0],this.textField=this.el.getElementsByClassName(" desc ")[0],this.graphTooHard=new C(null,"#db5656"),this.graphEffortless=new C(null,"#795693"),this.graphNotTrying=new C(null,"#78c7de"),this.el.getElementsByClassName(" tooHard ")[0].insertBefore(this.graphTooHard.el.canvasEl,this.el.getElementsByClassName(" tooHard ")[0].firstChild),this.el.getElementsByClassName(" effortless ")[0].insertBefore(this.graphEffortless.el.canvasEl,this.el.getElementsByClassName(" effortless ")[0].firstChild),this.el.getElementsByClassName(" notTrying ")[0].insertBefore(this.graphNotTrying.el.canvasEl,this.el.getElementsByClassName(" notTrying ")[0].firstChild),this.detailInfos=new G(this.bullseye,this.bullseyeUserModel,this.service),this.detailInfos.onClose=this.onDetailInfosClose,this.addChild(this.detailInfos),this.axe().IS_MOBILE&&$(this.el).addClass("is-mobile")},b.prototype.init=function(){return this.$globalInfos=this.$el.find(".globalInfos"),this.$tweetInfos=this.$el.find(".bullseye-tweetsInfos"),null},b.prototype.onDetailInfosClose=function(){var a,b;return null!=(a=this.bullseye.dragZone)&&null!=(b=a.currentTweet)&&b.close(),null},b.prototype.show=function(){return $(this.el).removeClass("hide"),null},b.prototype.hide=function(){return $(this.el).addClass("hide"),null},b.prototype.setInteractive=function(){return null},b.prototype.interactive=function(){return this.isInteractive||(console.log("make it interactive !"),this.isInteractive=!0,$(this.el).css("z-index",1)),null},b.prototype.uninteractive=function(){return this.isInteractive&&(console.log("no more interactive"),this.isInteractive=!1,$(this.el).css("z-index",-1)),null},b.prototype.showGlobalInfos=function(){this.$globalInfos.addClass("show")},b.prototype.hideGlobalInfos=function(){this.$globalInfos.removeClass("show")},b.prototype.reset=function(){return this.nbTweetsTooHard=0,this.nbTweetsEffortless=0,this.nbTweetsNotTrying=0,this.currentTweetTotal=1,null},b.prototype.updateGlobalInfos=function(a){var b;this.currentTweetTotal++,b=0,"tryingTooHard"===a.model.attributes.judgement?(this.nbTweetsTooHard++,b=(100*(this.nbTweetsTooHard/100)).toFixed(0),this.tooHardPercentField.innerHTML=b+"%",this.graphTooHard.update(b)):"effortless"===a.model.attributes.judgement?(this.nbTweetsEffortless++,b=Math.round(100*((this.currentTweetTotal-(this.nbTweetsTooHard+this.nbTweetsNotTrying))/100)),this.effortlessPercentField.innerHTML=b+"%",this.graphEffortless.update(b)):(this.nbTweetsNotTrying++,b=(100*(this.nbTweetsNotTrying/100)).toFixed(0),this.notTryingPercentField.innerHTML=b+"%",this.graphNotTrying.update(b))},b.prototype.showTweetDetails=function(){this.isGlobalInfosVisible&&(console.log("hey"),this.$tweetInfos.addClass("show"))},b.prototype.hideTweetDetails=function(){this.isGlobalInfosVisible||this.$tweetInfos.removeClass("show")},b.prototype.updateTweetDetails=function(a){this.detailInfos.show(a.model)},b}(g),F=function(a){function b(){return this.update=Vd(this.update,this),this.renderGraph=Vd(this.renderGraph,this),this.close=Vd(this.close,this),this.onBubbleTouch=Vd(this.onBubbleTouch,this),this.onBubbleOut=Vd(this.onBubbleOut,this),this.onBubbleOver=Vd(this.onBubbleOver,this),this.scaleDownBubble=Vd(this.scaleDownBubble,this),this.scaleUpBubble=Vd(this.scaleUpBubble,this),this.onStartAnimationComplete=Vd(this.onStartAnimationComplete,this),b.__super__.constructor.apply(this,arguments)
}return Ud(b,a),b.prototype.el=null,b.prototype.id=0,b.prototype.bar=null,b.prototype.barPreviousAlpha=null,b.prototype.bubble=null,b.prototype.originPoint=null,b.prototype.destinationPoint=null,b.prototype.angle=0,b.prototype.textarea=null,b.prototype.alpha=1,b.prototype.tweetId=null,b.prototype.manager=null,b.prototype.isOver=!1,b.prototype.isBubbleOpen=!1,b.prototype.animationStartDelay=0,b.prototype.hasStartedAnimation=!1,b.prototype.config=null,b.prototype.initialize=function(a,b){this.bullseye=b,this.config=a,this.originPoint=this.config.originPoint,this.destinationPoint=this.config.destinationPoint,this.classification=this.config.classification,this.manager=this.config.manager,this.angle=Math.atan2(this.destinationPoint.y-this.originPoint.y,this.destinationPoint.x-this.originPoint.x)*(180/Math.PI),this.id=this.model.attributes.id,this.el=new createjs.Container,this.alpha=0,this.hotness=Math.floor(4*Math.random()-1),this.drawBar()},b.prototype.drawBar=function(){this.bar=new createjs.Shape,this.bar.graphics.setStrokeStyle(1,"round"),this.bar.graphics.beginStroke("#0x999999"),this.bar.graphics.moveTo(this.originPoint.x,this.originPoint.y),this.bar.graphics.lineTo(this.destinationPoint.x,this.destinationPoint.y),this.bar.alpha=1,this.el.addChild(this.bar)},b.prototype.initBubble=function(a,b,c){var d;switch(this.model.attributes.judgement){case"effortless":d="#8F649D";break;case"tryingTooHard":d="#D3444A";break;case"notHardEnough":d="#74C5DC"}this.bubble=new createjs.Shape,this.bubble.graphics.beginFill(d),this.bubble.graphics.drawCircle(0,0,c),this.bubble.graphics.endFill(),this.bubble.x=a,this.bubble.y=b,this.bubble.regX=0,this.bubble.regY=0,this.bubble.alpha=0,this.bubble.cursor="pointer",this.bubble.mouseEnabled=!0,this.initBubblesEvents()},b.prototype.playStartAnimation=function(a){this.hasStartedAnimation||(this.hasStartedAnimation=!0,this.turnOnBubble(a,this.onStartAnimationComplete),this.scaleUpBubble(a,this.scaleDownBubble))},b.prototype.onStartAnimationComplete=function(){this.trigger("onBubbleStartAnimationComplete",this)},b.prototype.scaleUpBubble=function(a,b,c){null==a&&(a=0),null==c&&(c=!1),"function"==typeof b&&c&&TweenLite.to(this.bubble,.2,{scaleX:1.4,scaleY:1.4,delay:a,onComplete:b,onUpdate:this.renderGraph}),"function"==typeof b?TweenLite.to(this.bubble,.2,{scaleX:1.4,scaleY:1.4,delay:a,onComplete:b}):c?TweenLite.to(this.bubble,.2,{scaleX:1.4,scaleY:1.4,delay:a,onUpdate:this.renderGraph}):TweenLite.to(this.bubble,.2,{scaleX:1.4,scaleY:1.4,delay:a})},b.prototype.scaleDownBubble=function(a,b,c){null==a&&(a=0),null==c&&(c=!1),"function"==typeof b&&c&&TweenLite.to(this.bubble,.2,{scaleX:1,scaleY:1,delay:a,onComplete:b,onUpdate:this.renderGraph}),"function"==typeof b&&TweenLite.to(this.bubble,.2,{scaleX:1,scaleY:1,delay:a,onComplete:b}),c?TweenLite.to(this.bubble,.2,{scaleX:1,scaleY:1,delay:a,onUpdate:this.renderGraph}):TweenLite.to(this.bubble,.2,{scaleX:1,scaleY:1,delay:a})},b.prototype.turnOnBubble=function(a,b,c,d){null==a&&(a=0),null==c&&(c=!1),null==d&&(d=.75),this.bubble&&.8===this.bubble.alpha||("function"==typeof b&&c&&TweenLite.to(this.bubble,.2,{alpha:d,delay:a,onComplete:b,onUpdate:this.renderGraph}),"function"==typeof b?TweenLite.to(this.bubble,.2,{alpha:d,delay:a,onComplete:b}):c?TweenLite.to(this.bubble,.2,{alpha:d,delay:a,onUpdate:this.renderGraph}):TweenLite.to(this.bubble,.2,{alpha:d,delay:a}),this.bar.alpha=1)},b.prototype.turnOffBubble=function(){this.bubble&&.2===this.bubble.alpha||TweenLite.to(this.bubble,.2,{alpha:.35})},b.prototype.initBubblesEvents=function(){this.areEventsInit||(this.areEventsInit=!0,Modernizr.touch||(this.bubble.on("mouseover",this.onBubbleOver),this.bubble.on("mouseout",this.onBubbleOut)),this.bubble.on("mousedown",this.onBubbleTouch))},b.prototype.removeBubblesEvents=function(){this.areEventsInit&&(this.areEventsInit=!1,Modernizr.touch||(this.bubble.off("mouseover",this.onBubbleOver),this.bubble.off("mouseout",this.onBubbleOut)),this.bubble.off("mousedown",this.onBubbleTouch))},b.prototype.onBubbleOver=function(){0!==this.bubble.alpha&&(this.trigger("onBubbleOverEvent",this),this.isOver=!0)},b.prototype.onBubbleOut=function(){0!==this.bubble.alpha&&(this.trigger("onBubbleOutEvent",this),this.isOver=!1)},b.prototype.onBubbleTouch=function(){0!==this.bubble.alpha&&(this.trigger("onBubbleTouchEvent",this),this.isBubbleOpen=!this.isBubbleOpen)},b.prototype.close=function(){return this.onBubbleOver(),this.onBubbleOut(),this.onBubbleTouch(),null},b.prototype.renderGraph=function(){return this.bullseye.scene.update(),null},b.prototype.update=function(a){if(a>=this.angle-.3&&a<=this.angle+.3){if("intro"===this.manager.state)return;this.turnOnBubble(0,this.renderGraph,!0,1),this.scaleUpBubble(),this.manager.currentTweet=this,this.isBubbleOpen=!0}else{if("intro"===this.manager.state)return;this.turnOffBubble(0,this.renderGraph,!0),this.scaleDownBubble(),this.isBubbleOpen=!1}},b.prototype.onBubbleStartAnimationComplete=function(){},b}(Backbone.View),A=function(a){function b(){return this.hide=Vd(this.hide,this),this.show=Vd(this.show,this),this.shouldOpenOrientationMessage=Vd(this.shouldOpenOrientationMessage,this),this.resize=Vd(this.resize,this),this.closeAll=Vd(this.closeAll,this),this.onBubbleTouch=Vd(this.onBubbleTouch,this),this.onBubbleOut=Vd(this.onBubbleOut,this),this.onBubbleOver=Vd(this.onBubbleOver,this),this.onCompleteIntroAnimation=Vd(this.onCompleteIntroAnimation,this),this.onUpdateIntroAnimation=Vd(this.onUpdateIntroAnimation,this),this.playIntroAnimation=Vd(this.playIntroAnimation,this),this.initDateFrom=Vd(this.initDateFrom,this),this.onDraggerRelease=Vd(this.onDraggerRelease,this),this.onDraggerMove=Vd(this.onDraggerMove,this),this.onDraggerFocus=Vd(this.onDraggerFocus,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.dragger=null,b.prototype.bullseye=null,b.prototype.tweets=null,b.prototype.tweetBarsContainerDims=null,b.prototype.mask=null,b.prototype.tweetReferenceCircle=null,b.prototype.currentTweet=null,b.prototype.state="intro",b.prototype.minLimitBar=null,b.prototype.maxLimitBar=null,b.prototype.date=null,b.prototype.dateTxt=null,b.prototype.nowTxt=null,b.prototype.initialize=function(a,c,d,e,f,g){this.bullseye=a,this.widthContainer=d,this.heightContainer=e,this.currentService=f,this.date=g,b.__super__.initialize.call(this),this.tweetBarsContainerDims={width:30,height:this.heightContainer*(515/640)},this.tweets=[],this.el=new createjs.Container,this.el.regX=15,this.el.regY=this.tweetBarsContainerDims.height/2,this.el.y=this.heightContainer/2,this.el.alpha=0,this.initTweets(c),this.initDraggerMarkLimits(),this.initDragger()},b.prototype.initEvents=function(){var a,b,c,d;for(this.dragger.onFocus=this.onDraggerFocus,this.dragger.onMove=this.onDraggerMove,this.dragger.onRelease=this.onDraggerRelease,d=this.tweets,b=0,c=d.length;c>b;b++)a=d[b],a.on("onBubbleOverEvent",this.onBubbleOver),a.on("onBubbleTouchEvent",this.onBubbleTouch)},b.prototype.removeEvents=function(){var a,b,c,d;for(this.dragger.onFocus=null,this.dragger.onMove=null,this.dragger.onRelease=null,d=this.tweets,b=0,c=d.length;c>b;b++)a=d[b],a.off("onBubbleOverEvent",this.onBubbleOver),a.off("onBubbleTouchEvent",this.onBubbleTouch)},b.prototype.onDraggerFocus=function(){},b.prototype.onDraggerMove=function(a){var b,c,d,e;for(this.currentTweet&&this.onTweetChange(this.currentTweet),e=this.tweets,c=0,d=e.length;d>c;c++)b=e[c],b.update(a,this);this.currentTweet&&(this.bullseye.$el.find(".bullseye-detail-infos").hasClass("show")||(this.hideGlobalInfos(),this.showDetailPostInfos()),this.updateDetailsInfos()),this.bullseye.scene.update()},b.prototype.onDraggerRelease=function(){var a,b,c,d;for(d=this.tweets,b=0,c=d.length;c>b;b++)a=d[b],a.turnOnBubble();this.currentTweet&&this.currentTweet.scaleDownBubble(),this.bullseye.$el.find(".bullseye-detail-infos").hasClass("show")&&(this.hideDetailPostInfos(),this.showGlobalInfos())},b.prototype.initDragger=function(){var a;a={img:"/static/images/placeholders/modules/time.png",startY:0,offsetY:(this.heightContainer-this.tweetBarsContainerDims.height)/2,range:{min:0,max:this.tweetBarsContainerDims.height}},this.dragger=new Kd(a),this.el.addChild(this.dragger.el)},b.prototype.initDraggerMarkLimits=function(){return this.minLimitBar=new createjs.Shape,this.minLimitBar.graphics.beginFill("#0x000000"),this.minLimitBar.graphics.drawRect(0,-4,20,2),this.minLimitBar.graphics.endFill(),this.maxLimitBar=new createjs.Shape,this.maxLimitBar.graphics.beginFill("#0x000000"),this.maxLimitBar.graphics.drawRect(0,this.tweetBarsContainerDims.height+2,20,2),this.maxLimitBar.graphics.endFill(),this.el.addChild(this.minLimitBar),this.el.addChild(this.maxLimitBar),null},b.prototype.initTweets=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(i=this.tweetBarsContainerDims.height/a.length,c=0,b=null,m=a.models,k=0,l=m.length;l>k;k++)f=m[k],g=0,h=c,d=15,e=c,b={model:f,manager:this,judgement:f.attributes.judgement,score:f.attributes.score,stepBetweenTweet:Math.floor(i),originPoint:{x:g,y:h},destinationPoint:{x:d,y:e}},j=new D(b),this.el.addChild(j.bar),this.tweets.push(j),c+=i},b.prototype.initMask=function(){this.mask=new createjs.Shape,this.mask.graphics.beginFill("#ffffff"),this.mask.graphics.drawCircle(this.tweetReferenceCircle.center.x,this.tweetReferenceCircle.center.y,this.tweetReferenceCircle.radius-20),this.mask.graphics.endFill()},b.prototype.initBubbles=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;for(this.callbackForOrientationMessage=b,c=360/this.tweets.length,d=-90,f=m=0,n=this.tweets.length;n>=0?n>m:m>n;f=n>=0?++m:--m)j=this.tweets[f],h=Math.abs(j.model.attributes.score),Math.abs(j.model.attributes.score)>=200&&(h=Math.abs(j.model.attributes.score)+5),i=Ic.map(Math.abs(j.model.attributes.score),0,500,10,40),g=Ic.map(h,0,500,50,250),k=g*Math.cos(Ic.toRadians(d))+a.center.x,l=g*Math.sin(Ic.toRadians(d))+a.center.y,e=.02*f,j.initBubble(k,l,i,e,this.callbackForOrientationMessage),d+=c},b.prototype.initDateFrom=function(){return this.date?(this.nowTxt=new createjs.Text("NOW","20px tungstensemibold","#a8a8a8"),this.nowTxt.x=810,this.nowTxt.y=68,this.dateTxt=new createjs.Text(""+this.date.toUpperCase(),"20px tungstensemibold","#a8a8a8"),this.dateTxt.x=900,this.dateTxt.y=510,this.dateTxt.regX=Math.floor(this.dateTxt.getMeasuredWidth()),null):void 0},b.prototype.playIntroAnimation=function(){var a,b,c,d,e;for(this.dragger.angle=this.dragger.config.range.max+10,TweenLite.to(this.dragger,3,{angle:this.dragger.config.range.min-1,onUpdate:this.onUpdateIntroAnimation,onComplete:this.onCompleteIntroAnimation}),a=b=c=this.tweets.length-1;0>=c?0>b:b>0;a=0>=c?++b:--b)null!=(d=this.tweets[a])&&d.on("onBubbleStartAnimationComplete",this.onDraggerPlayingAnimation),null!=(e=this.tweets[a])&&e.playStartAnimation(.025*this.tweets.length-.025*a)},b.prototype.onUpdateIntroAnimation=function(){var a,b,c,d,e,f,g,h;if(this.dragger.moveToAngle(),"intro"===this.state&&(a=Math.abs(Math.floor(Ic.map(this.dragger.angle,-40,40,0,100))-100)),this.dragger.updatePercent(a),this.axe().IS_MOBILE)for(g=this.tweets,c=0,e=g.length;e>c;c++)b=g[c],b.update(this.dragger.y);else for(h=this.tweets,d=0,f=h.length;f>d;d++)b=h[d],b.update(this.dragger.angle);this.bullseye.scene.update()},b.prototype.onCompleteIntroAnimation=function(){this.state="dragging",this.initEvents(),this.dragger.fadeInImg(),this.dragger.fadeOutTxt(),this.hasStartOnce=!0,this.bullseye.saveUserImage(),this.bullseye.update(),this.bullseye.playScoreAnimation()},b.prototype.onBubbleOver=function(a){var b,c,d,e;for(a.on("onBubbleOutEvent",this.onBubbleOut),e=this.tweets,c=0,d=e.length;d>c;c++)b=e[c],b===a&&b.scaleUpBubble()},b.prototype.onBubbleOut=function(a){a.off("onBubbleOutEvent",this.onBubbleOut),a.scaleDownBubble()},b.prototype.onBubbleTouch=function(a){return this.axe().IS_MOBILE&&"portrait"===axe.appView.dims.o?(this.shouldOpenOrientationMessage(),void 0):(this.onTweetChange(a),a.isBubbleOpen?this.closeAll():(this.hideGlobalInfos(),this.showDetailPostInfos(),this.currentTweet=a,this.updateDetailsInfos(),this.axe().IS_MOBILE?TweenLite.to(this.dragger,.5,{y:a.destinationPoint.y,onUpdate:this.onUpdateIntroAnimation}):TweenLite.to(this.dragger,.5,{angle:a.angle,onUpdate:this.onUpdateIntroAnimation})),void 0)},b.prototype.closeAll=function(){var a,b,c,d;for(this.currentTweet=null,a=c=0,d=this.tweets.length;d>=0?d>c:c>d;a=d>=0?++c:--c)b=a===this.tweets.length-1?!0:!1,this.tweets[a].turnOnBubble(0,null,b);return this.hideDetailPostInfos(),this.showGlobalInfos(),null},b.prototype.resize=function(a){var b,c,d,e,f,g;for(this.heightContainer=a,this.tweetBarsContainerDims.height=this.heightContainer*(515/640),this.minLimitBar.graphics.c(),this.minLimitBar.graphics.beginFill("#0x000000"),this.minLimitBar.graphics.drawRect(0,-4,20,2),this.minLimitBar.graphics.endFill(),this.maxLimitBar.graphics.c(),this.maxLimitBar.graphics.beginFill("#0x000000"),this.maxLimitBar.graphics.drawRect(0,this.tweetBarsContainerDims.height+2,20,2),this.maxLimitBar.graphics.endFill(),this.el.y=this.heightContainer/2,this.el.regY=this.tweetBarsContainerDims.height/2,c=this.tweetBarsContainerDims.height/this.tweets.length,b=0,g=this.tweets,e=0,f=g.length;f>e;e++)d=g[e],d.repositionnateBar(b),b+=c;return null},b.prototype.shouldOpenOrientationMessage=function(){return null},b.prototype.showGlobalInfos=function(){this.bullseye.$el.find(".globalInfos").addClass("show")},b.prototype.showDetailPostInfos=function(){this.bullseye.postOpen=!0,this.bullseye.$el.find(".bullseye-detail-infos").addClass("show"),this.bullseye.tweetsInfos.interactive()},b.prototype.hideGlobalInfos=function(){this.bullseye.$el.find(".globalInfos").removeClass("show")},b.prototype.hideDetailPostInfos=function(){this.bullseye.postOpen=!1,this.bullseye.$el.find(".bullseye-detail-infos").removeClass("show"),this.bullseye.tweetsInfos.uninteractive()},b.prototype.updateDetailsInfos=function(){},b.prototype.onDraggerPlayingAnimation=function(){},b.prototype.onTweetChange=function(){},b.prototype.show=function(){return this.axe().IS_MOBILE&&"portrait"===this.axe().appView.dims.o?void 0:(this.el.alpha=1,this.bullseye.scene.update(),null)},b.prototype.hide=function(){return this.el.alpha=0,this.bullseye.scene.update(),null},b}(g),D=function(a){function b(){return this.close=Vd(this.close,this),this.onBubbleTouch=Vd(this.onBubbleTouch,this),this.onBubbleOut=Vd(this.onBubbleOut,this),this.onBubbleOver=Vd(this.onBubbleOver,this),this.scaleDownBubble=Vd(this.scaleDownBubble,this),this.scaleUpBubble=Vd(this.scaleUpBubble,this),this.onStartAnimationComplete=Vd(this.onStartAnimationComplete,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.id=0,b.prototype.bar=null,b.prototype.barPreviousAlpha=null,b.prototype.bubble=null,b.prototype.textarea=null,b.prototype.alpha=1,b.prototype.tweetId=null,b.prototype.manager=null,b.prototype.isOver=!1,b.prototype.isBubbleOpen=!1,b.prototype.animationStartDelay=0,b.prototype.hasStartedAnimation=!1,b.prototype.config=null,b.prototype.initialize=function(a){this.config=a,this.originPoint=this.config.originPoint,this.destinationPoint=this.config.destinationPoint,this.classification=this.config.classification,this.manager=this.config.manager,this.angle=Math.atan2(this.destinationPoint.y-this.originPoint.y,this.destinationPoint.x-this.originPoint.x)*(180/Math.PI),this.id=this.model.attributes.id,this.el=new createjs.Container,this.alpha=0,this.drawBar()},b.prototype.drawBar=function(){this.bar=new createjs.Shape,this.bar.graphics.beginFill("#b3b3b3"),this.bar.graphics.drawRect(this.originPoint.x,this.destinationPoint.y,15,1),this.bar.graphics.endFill(),this.bar.alpha=1,this.el.addChild(this.bar)},b.prototype.initBubble=function(a,b,c,d,e){var f;switch(this.callbackForOrientationMessage=e,this.model.attributes.judgement){case"effortless":f="#8F649D";break;case"tryingTooHard":f="#D3444A";break;case"notHardEnough":f="#74C5DC"}this.bubble=new createjs.Shape,this.bubble.graphics.beginFill(f),this.bubble.graphics.drawCircle(0,0,c),this.bubble.graphics.endFill(),this.bubble.x=a,this.bubble.y=b,this.bubble.regX=0,this.bubble.regY=0,this.bubble.alpha=0,this.bubble.cursor="pointer",this.bubble.mouseEnabled=!0,this.initBubblesEvents()},b.prototype.playStartAnimation=function(a){this.hasStartedAnimation||(this.hasStartedAnimation=!0,this.turnOnBubble(a,this.onStartAnimationComplete),this.scaleUpBubble(a,this.scaleDownBubble))},b.prototype.onStartAnimationComplete=function(){this.trigger("onBubbleStartAnimationComplete",this)},b.prototype.scaleUpBubble=function(a,b){null==a&&(a=0),"function"==typeof b?(this.bubble.scaleX=this.bubble.scaleY=1.4,b()):this.bubble.scaleX=this.bubble.scaleY=1.4},b.prototype.scaleDownBubble=function(a,b){null==a&&(a=0),"function"==typeof b?(this.bubble.scaleX=this.bubble.scaleY=1,b()):this.bubble.scaleX=this.bubble.scaleY=1},b.prototype.turnOnBubble=function(a,b){null==a&&(a=0),this.bubble&&.8===this.bubble.alpha||!this.bubble||("function"==typeof b?(this.bubble.alpha=.8,b()):this.bubble.alpha=.8,this.bar.alpha=1)},b.prototype.turnOffBubble=function(){this.bubble&&.2===this.bubble.alpha||(this.bubble.alpha=.1)},b.prototype.initBubblesEvents=function(){Modernizr.touch||(this.bubble.on("mouseover",this.onBubbleOver),this.bubble.on("mouseout",this.onBubbleOut)),this.bubble.on("mousedown",this.onBubbleTouch)},b.prototype.removeBubblesEvents=function(){},b.prototype.onBubbleOver=function(){0!==this.bubble.alpha&&(this.trigger("onBubbleOverEvent",this),this.isOver=!0)},b.prototype.onBubbleOut=function(){0!==this.bubble.alpha&&(this.trigger("onBubbleOutEvent",this),this.isOver=!1)},b.prototype.onBubbleTouch=function(){0!==this.bubble.alpha&&(this.axe().IS_MOBILE&&"portrait"===axe.appView.dims.o&&this.callbackForOrientationMessage(),this.trigger("onBubbleTouchEvent",this),this.isBubbleOpen=!this.isBubbleOpen)},b.prototype.update=function(a){if(a>this.destinationPoint.y-(this.config.stepBetweenTweet-.8)&&a<this.destinationPoint.y+(this.config.stepBetweenTweet-.8)){if("intro"===this.manager.state)return;this.turnOnBubble(),this.scaleUpBubble(),this.manager.currentTweet=this,this.isBubbleOpen=!0}else{if("intro"===this.manager.state)return;this.turnOffBubble(),this.scaleDownBubble(),this.isBubbleOpen=!1}},b.prototype.onBubbleStartAnimationComplete=function(){},b.prototype.repositionnateBar=function(a){return this.bar.graphics.c(),this.bar.graphics.beginFill("#b3b3b3"),this.bar.graphics.drawRect(this.originPoint.x,a,15,1),this.bar.graphics.endFill(),null},b.prototype.close=function(){return this.onBubbleOver(),this.onBubbleOut(),this.onBubbleTouch(),null},b}(g),Kd=function(a){function b(){return this.onInteractionEnd=Vd(this.onInteractionEnd,this),this.onInteractionMove=Vd(this.onInteractionMove,this),this.onInteractionStart=Vd(this.onInteractionStart,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.img=null,b.prototype.borderCircle=null,b.prototype.percent=null,b.prototype.canDrag=!1,b.prototype.rad=0,b.prototype.angle=0,b.prototype.x=0,b.prototype.y=0,b.prototype.circleAnchor=null,b.prototype.range=null,b.prototype.onFocus=null,b.prototype.onMove=null,b.prototype.config=null,b.prototype.upArrow=null,b.prototype.downArrow=null,b.prototype.initialize=function(a){this.el=new createjs.Container,this.el.regX=25,this.el.regY=50,this.el.cursor="pointer",this.el.mouseEnabled=!0,this.config=a,this.range=this.config.range,this.scaleOnInteractionStart=this.config.scaleOnInteractionStart||!0,this.x=20,this.y=this.config.startY+this.config.offsetY,this.el.x=this.x,this.el.y=this.y,this.initBorderCircle(),a.imgOnlyMode?this.initImg(1):a.txtOnlyMode?this.initTxt():(this.initTxt(),this.initImg(0)),this.initEvents()},b.prototype.initBorderCircle=function(){this.borderCircle=new createjs.Shape,this.borderCircle.graphics.setStrokeStyle(2,"round"),this.borderCircle.graphics.beginStroke("#999999"),this.borderCircle.graphics.beginFill("#ffffff"),this.borderCircle.graphics.drawCircle(0,0,25),this.borderCircle.graphics.endFill(),this.borderCircle.regX=this.borderCircle.regY=-25,this.el.addChild(this.borderCircle)},b.prototype.initImg=function(a){var b;b=new Image,b.onload=function(b){return function(){return b.img=new createjs.Bitmap(b.config.img),b.img.x=25,b.img.y=12,b.img.regX=10,b.img.regy=13,b.img.alpha=a,b.el.addChild(b.img)}}(this),b.src=this.config.img},b.prototype.initTxt=function(){this.percent=new createjs.Text("100","bold 20px Arial","#333"),this.percent.x=(54-this.percent.getMeasuredWidth())/2,this.percent.y=34,this.percent.textBaseline="alphabetic",this.el.addChild(this.percent)},b.prototype.initEvents=function(){this.el.on("mousedown",this.onInteractionStart),this.el.on("pressmove",this.onInteractionMove),this.el.on("pressup",this.onInteractionEnd)},b.prototype.initArrows=function(){return this.leftArrow=new createjs.Bitmap("/static/images/modules/bullseyes-dragger-arrow.png"),this.leftArrow.x=0,this.leftArrow.y=-15,this.leftArrow.regX=-7,this.leftArrow.regY=9,this.el.addChild(this.leftArrow),null},b.prototype.onInteractionStart=function(a){a.preventDefault(),this.canDrag=!0,this.onFocus(),!this.scaleOnInteractionStart},b.prototype.onInteractionMove=function(a){var b,c;a.preventDefault(),a.stageX&&(b=a.stageX,c=a.stageY,this.canDrag&&(this.y=c,Ic.isInRange(this.y,this.range.min,this.range.max,!1)?(this.el.y=this.y,this.onMove(this.y)):console.log("")))},b.prototype.onInteractionEnd=function(){TweenLite.to(this.el,.15,{scaleX:1,scaleY:1}),this.canDrag=!1},b.prototype.moveToAngle=function(){this.el.x=this.x,this.el.y=this.y},b.prototype.fadeInImg=function(){TweenLite.to(this.img,.3,{alpha:1})},b.prototype.fadeOutTxt=function(){TweenLite.to(this.percent,.3,{alpha:0})},b.prototype.updatePercent=function(a){this.percent.text=a>0?"+"+a:a,this.percent.x=(54-this.percent.getMeasuredWidth())/2},b.prototype.updateTextColor=function(a){this.percent.color=a},b.prototype.onFocus=function(){},b.prototype.onMove=function(){},b.prototype.onRelease=function(){},b}(Backbone.View),z=function(a){function b(a){this.service=a,this.getShareableData=Vd(this.getShareableData,this),this.getLegendData=Vd(this.getLegendData,this),this.getBullseyeImage=Vd(this.getBullseyeImage,this),this.getBullseyeImageData=Vd(this.getBullseyeImageData,this),this.saveUserImage=Vd(this.saveUserImage,this),this.showDraggerUI=Vd(this.showDraggerUI,this),this.hideDraggerUI=Vd(this.hideDraggerUI,this),this.animateInMobileDragZone=Vd(this.animateInMobileDragZone,this),this.onResize=Vd(this.onResize,this),this.onPlayScoreAnimationComplete=Vd(this.onPlayScoreAnimationComplete,this),this.onPlayScoreAnimationUpdate=Vd(this.onPlayScoreAnimationUpdate,this),this.animateIn=Vd(this.animateIn,this),this.updateData=Vd(this.updateData,this),this.unMute=Vd(this.unMute,this),this.mute=Vd(this.mute,this),this.updateTweetsInfosDetails=Vd(this.updateTweetsInfosDetails,this),this.onPlayingStartAnimation=Vd(this.onPlayingStartAnimation,this),this.onLoadDatasComplete=Vd(this.onLoadDatasComplete,this),this.reset=Vd(this.reset,this),this.buildGraph=Vd(this.buildGraph,this),this.setData=Vd(this.setData,this),this.resetUser=Vd(this.resetUser,this),this.changeUser=Vd(this.changeUser,this),this.setup=Vd(this.setup,this),this.onKeyup=Vd(this.onKeyup,this),this.showOrientationMessage=Vd(this.showOrientationMessage,this),this.startFromLoader=Vd(this.startFromLoader,this),this.initEvents=Vd(this.initEvents,this),this.onScoreUpdate=Vd(this.onScoreUpdate,this),this.onLoggedUpdate=Vd(this.onLoggedUpdate,this),this.postCollection=new Q,this.userModel=new I,this.centralGraphContainer=new createjs.Container,this.centralGraphContainer.setBounds(0,0,550,550),b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.GRAPH_TYPE="bullseye",b.prototype.service=null,b.prototype.postCollection=null,b.prototype.colour=65280,b.prototype.size=null,b.prototype.bubbleZone=null,b.prototype.dragZone=null,b.prototype.tweetsInfos=null,b.prototype.postOpen=!1,b.prototype.savedUserData=null,b.prototype.loaderEvent=null,b.prototype.graphDims={},b.prototype.headerHeight=30,b.prototype.controlsHeight=90,b.prototype.baseSize=550,b.prototype.baseWidth=550,b.prototype.baseHeight=550,b.prototype.centralGraphContainer=null,b.prototype.eventsAreInit=!1,b.prototype.isSceneSet=!1,b.prototype.isUserData=!0,b.prototype.isMuted=!0,b.prototype.firstStartFromLoader=!0,b.prototype.isInit=!1,b.prototype.initialize=function(){return this.$window=$(window),this.loaderEvent=this.axe().IS_MOBILE?"loaderHideStart":"loaderHideEnd",b.__super__.initialize.call(this),this.model=this.axe().appData.USER.model,this.isInit=!0,null},b.prototype.onLoggedUpdate=function(){return this.setup(),null},b.prototype.onScoreUpdate=function(){return this.setData({posts:this.model.get("scores."+this.service+".postsData.posts"),user:this.model.get("info."+this.service)}),this.buildGraph(),null},b.prototype.initEvents=function(a){return null==a&&(a=!1),!this.dragZone&&!a||(this.dragZone.onDraggerPlayingAnimation=this.onPlayingStartAnimation,this.dragZone.onTweetChange=this.updateTweetsInfosDetails,this.eventsAreInit)?void 0:(this.dragZone.initEvents(),this.eventsAreInit=!0,this.axe().appView.on("updateDims",this.onResize),this.axe().appView.on(this.loaderEvent,this.startFromLoader),this.$window.on("keyup",this.onKeyup),null)},b.prototype.removeEvents=function(){return this.eventsAreInit=!1,this.dragZone.removeEvents(),this.dragZone.onDraggerPlayingAnimation=null,this.dragZone.onTweetChange=null,this.axe().appView.off("updateDims",this.onResize),this.axe().appView.off(this.loaderEvent,this.startFromLoader),this.$window.off("keyup",this.onKeyup),null},b.prototype.startFromLoader=function(){var a;return console.log("startfromloader"),this.firstStartFromLoader?(this.firstStartFromLoader=!1,a=.75):a=0,this.initEvents(!0),this.animateIn(a),null},b.prototype.showOrientationMessage=function(){return this.axe().appView.showOrientationOverlay(this.animateInMobileDragZone),null},b.prototype.onKeyup=function(a){var b,c,d;if(!(!this.postOpen||27!==a.keyCode&&37!==a.keyCode&&39!==a.keyCode||(b=this.postCollection.indexOf(this.tweetsInfos.detailInfos.postModel),c=this.postCollection.length,0>b)))return 27===a.keyCode?(this.postOpen&&!this.axe().appView.modalOpen()&&this.dragZone.tweets[b].close(),void 0):(37===a.keyCode?d=0===b?c-1:b-1:39===a.keyCode&&(d=b===c-1?0:b+1),this.dragZone.tweets[d].close(),null)},b.prototype.setup=function(){var a,b;if(!this.scene)return this.size=[885,465],b=.75*$(window).innerWidth(),a=b/1.853061224,this.innerSize=[b,a],this.$el.addClass("bullseye"),this.graphDims=this.axe().IS_MOBILE?{width:window.innerWidth,height:window.innerHeight-this.headerHeight-this.controlsHeight}:{width:1140,height:605},this.initGraph(this.graphDims.width,this.graphDims.height),this.el.appendChild(this.scene.canvasEl),this.initTweetsInfos(),this.render(),null},b.prototype.changeUser=function(a){return this.isUserData=!1,this.setData(a),this.buildGraph(),this.animateIn(0),null},b.prototype.resetUser=function(){return this.isUserData=!0,this.onScoreUpdate(),this.animateIn(0),null},b.prototype.setData=function(a){return this.postCollection.reset(a.posts),this.userModel.set(a.user),null},b.prototype.buildGraph=function(){return this.reset(),this.onLoadDatasComplete(),null},b.prototype.reset=function(){return this.postOpen=!1,this.haveShownAnimation=!1,this.tweetsInfos.onDetailInfosClose(),this.scene.removeAllChild(),null},b.prototype.onLoadDatasComplete=function(){return this.centralGraphContainer=new createjs.Container,this.centralGraphContainer.setBounds(0,0,550,550),this.tweetsInfos.reset(),this.initDragZone(),this.initBubblesZone(),this.scene.addChild(this.dragZone.el),this.scene.addChild(this.centralGraphContainer),this.dragZone.el.addChild(this.dragZone.nowTxt),this.dragZone.el.addChild(this.dragZone.dateTxt),this.initEvents(),this.onResize(),null},b.prototype.onLoadDatasError=function(){return null},b.prototype.initDragZone=function(){var a;return a=this.isUserData?this.axe().appData.USER.model.get("scores."+this.service+".sampleData.timeSpan"):this.userModel.get("score.sampleData.timeSpan"),this.axe().IS_MOBILE?(this.dragZone=new A(this,this.postCollection,this.graphDims.width,this.graphDims.height,this.service,a),this.dragZone.el.x=this.graphDims.width-50):this.dragZone=new B(this,this.postCollection,this.scene.width,this.scene.height,this.service,a),null},b.prototype.initBubblesZone=function(){var a,b,c,d,e,f,g,h,i;for(a=this.axe().IS_MOBILE?{x:0,y:0}:{x:this.graphDims.width/2,y:this.graphDims.height/2},this.bubblesZone=new y(this.centralGraphContainer,null,a,this.userModel,this.service,this.userModel.attributes.username),this.centralGraphContainer.addChild(this.bubblesZone.circleMarks),this.dragZone.initBubbles(this.bubblesZone,this.showOrientationMessage),h=this.dragZone.tweets,d=0,f=h.length;f>d;d++)c=h[d],this.centralGraphContainer.addChild(c.bubble);for(i=this.bubblesZone.marks,e=0,g=i.length;g>e;e++)b=i[e],b.label&&this.centralGraphContainer.addChild(b.label);return null},b.prototype.initTweetsInfos=function(){return this.tweetsInfos=new H(this,this.userModel,this.service),this.addChild(this.tweetsInfos.el),null},b.prototype.onPlayingStartAnimation=function(a){return a&&this.tweetsInfos.updateGlobalInfos(a),null},b.prototype.updateTweetsInfosDetails=function(a){return a&&this.tweetsInfos.updateTweetDetails(a),null},b.prototype.mute=function(){return this.isMuted=!0,this.removeEvents(),null},b.prototype.unMute=function(){return this.isMuted=!1,this.initEvents(),null},b.prototype.updateData=function(){return null},b.prototype.animateIn=function(a){return null==a&&(a=2),axe.appView.haveShownOneBullseye&&0!==a&&(a=.4),this.isMuted||(this.postCollection.length||this.buildGraph(),!this.postCollection.length||this.haveShownAnimation)?void 0:(this.haveShownAnimation=!0,axe.appView.haveShownOneBullseye=!0,this.dragZone.playIntroAnimation(a),this)},b.prototype.playScoreAnimation=function(){var a,b;if(!this.axe().IS_MOBILE)return b=this.isUserData?Ic.getNiceScore(this.axe().appData.USER.model.get("scores."+this.service+".total")):this.axe().appData.FRIENDS.model.get(this.service).findWhere({username:this.userModel.get("username")}).get("score.total"),500>=b&&b>200?a="#d24649":200>=b&&b>-200?a="#886d9c":-200>=b&&b>=-500&&(a="#9fd8e9"),this.animatedScore=new createjs.Container,this.foregroundScore=new createjs.Text(b,"80px tungstensemibold","#fff"),this.foregroundScore.x=0,this.foregroundScore.y=0,this.foregroundScore.regX=Math.floor(this.foregroundScore.getMeasuredWidth()/2),this.foregroundScore.regY=40,this.foregroundScore.outline=3,this.backgroundScore=this.foregroundScore.clone(),this.backgroundScore.outline=!1,this.backgroundScore.color=a,this.animatedScore.scaleX=this.animatedScore.scaleY=0,this.animatedScore.x=this.graphDims.width/2,this.animatedScore.y=this.graphDims.height/2,this.animatedScore.addChild(this.foregroundScore,this.backgroundScore),this.scene.addChild(this.animatedScore),TweenLite.to(this.animatedScore,1,{scaleX:2.5,scaleY:2.5,onUpdate:this.onPlayScoreAnimationUpdate,onComplete:this.onPlayScoreAnimationComplete}),this.startRAF(),null},b.prototype.onPlayScoreAnimationUpdate=function(){return this.animatedScore.alpha=Ic.map(this.animatedScore.scaleX,1.5,2.5,1,0),this.scene.update(),null},b.prototype.onPlayScoreAnimationComplete=function(){return this.scene.removeChild(this.animatedScore),null},b.prototype.startRAF=function(){return null},b.prototype.stopRAF=function(){return null},b.prototype.onResize=function(){var a;return b.__super__.onResize.call(this),this.graphDims?(this.graphDims=this.axe().IS_MOBILE?window.innerWidth<window.innerHeight?{width:window.innerWidth,height:window.innerHeight-this.headerHeight-this.controlsHeight}:{width:window.innerWidth,height:window.innerHeight}:{width:1140,height:605},this.axe().IS_MOBILE&&(90===window.orientation||-90===window.orientation?(this.axe().appView.header.hideByScroll(),a=this.graphDims.height/this.baseHeight,this.tweetsInfos.show()):(a=this.graphDims.width/this.baseWidth,this.tweetsInfos.hide()),a>1&&(a=1),this.centralGraphContainer.scaleX=this.centralGraphContainer.scaleY=a,this.centralGraphContainer.x=this.graphDims.width/2,this.centralGraphContainer.y=this.graphDims.height/2,this.scene.resize(this.graphDims.width,this.graphDims.height),this.dragZone&&window.orientation&&(90===window.orientation||-90===window.orientation?(this.dragZone.resize(this.graphDims.height),this.dragZone.el.alpha=1,this.dragZone.el.x=this.graphDims.width-40):(this.dragZone.el.alpha=0,"dragging"===this.dragZone.state&&this.dragZone.closeAll()))),this.scene.update(),null):void 0
},b.prototype.animateInMobileDragZone=function(a){return null==a&&(a=!0),a&&this.onResize(),this.dragZone.el.x=this.graphDims.width-40,TweenLite.to(this.dragZone.el,.3,{alpha:1}),null},b.prototype.hideDraggerUI=function(){var a,b,c,d;for(d=this.dragZone.tweets,b=0,c=d.length;c>b;b++)a=d[b],a.bar.barPreviousAlpha=a.bar.alpha,a.bar.alpha=0;return this.dragZone.hide(),this.scene.update(),null},b.prototype.showDraggerUI=function(){var a,b,c,d;for(this.dragZone.show(),d=this.dragZone.tweets,b=0,c=d.length;c>b;b++)a=d[b],a.bar.alpha=a.bar.barPreviousAlpha;return this.scene.update(),null},b.prototype.saveUserImage=function(){var a;if(!this.savedUserData&&this.axe().appData.USER.isUser(this.service,this.userModel.get("username")))return this.savedUserData=this.getBullseyeImageData(),this.savedLegendData=this.getLegendData(),a=this.scene.canvasEl,this.savedUserDataDims={w:a.width,h:a.height},null},b.prototype.getBullseyeImageData=function(){var a,b;return a=this.scene.canvasEl,this.hideDraggerUI(),this.scene.update(),b=a.toDataURL(),this.showDraggerUI(),b},b.prototype.getBullseyeImage=function(a){var b,c,d,e,f;return e=$.Deferred(),b=this.scene.canvasEl,f=b.width,c=b.height,"saved"===a&&(f=this.savedUserDataDims.w,c=this.savedUserDataDims.h),d="saved"===a?this.savedUserData:this.getBullseyeImageData(),Xb.trimCanvasData(d,f,c).done(function(){return function(a){return e.resolve(a)}}(this)),e},b.prototype.getLegendData=function(){var a;return a={tth:(parseInt(this.tweetsInfos.tooHardPercentField.innerHTML)||0)/100,neutral:(parseInt(this.tweetsInfos.effortlessPercentField.innerHTML)||0)/100,nth:(parseInt(this.tweetsInfos.notTryingPercentField.innerHTML)||0)/100}},b.prototype.getShareableData=function(){var a,b,c,d,e,f;return e=$.Deferred(),c=$.Deferred(),d=$.Deferred(),b=this.axe().appData.USER,f=b.model.get("scores"),a={loggedUser:{name:b.model.get("info."+this.service+".name"),username:b.model.get("info."+this.service+".username"),scores:{total:f.total.score,tw:Math.round(f.tw.total),fb:Math.round(f.fb.total),ig:Math.round(f.ig.total)},avatar:b.model.get("info."+this.service+".avatar"),post:null},legend:[]},this.postOpen&&this.tweetsInfos.detailInfos.postModel&&(a.post=$.extend({},this.tweetsInfos.detailInfos.postModel.toJSON())),b.isUser(this.service,this.userModel.get("username"))?(a.imageDisplayType=_c.ImageDisplayType.Single,a.post?this.getBullseyeImage().done(function(){return function(b){return a.image=b,c.resolve()}}(this)):this.getBullseyeImage("saved").done(function(){return function(b){return a.image=b,c.resolve()}}(this)),d.resolve(),a.legend.push(this.getLegendData())):(this.getBullseyeImage("saved").done(function(){return function(b){return a[a.post?"imageSec":"image"]=b,c.resolve()}}(this)),this.getBullseyeImage().done(function(){return function(b){return a[a.post?"image":"imageSec"]=b,d.resolve()}}(this)),a.comparedUser={id:this.userModel.get("id"),name:this.userModel.get("name"),username:this.userModel.get("username"),scores:{total:parseInt(this.userModel.get("score.total"),10),tw:null,fb:null,ig:null},avatar:this.userModel.get("avatar")},a.comparedUser.scores[this.service]=a.comparedUser.scores.total,a.post?(a.imageDisplayType=_c.ImageDisplayType.DoubleBiased,a.legend.push(this.getLegendData())):(a.imageDisplayType=_c.ImageDisplayType.DoubleEqual,a.legend.push(this.savedLegendData),a.legend.push(this.getLegendData()))),$.when(c,d).done(function(){return function(){return e.resolve(a)}}(this)),e},b}(b),mb=function(a){function b(a){return this.service=a.service,this.activeGraph=a.activeGraph,this.container=a.container,this.hideProtectedModal=Vd(this.hideProtectedModal,this),this.hideSearchError=Vd(this.hideSearchError,this),this.showSearchError=Vd(this.showSearchError,this),this.userLoadFail=Vd(this.userLoadFail,this),this.userLoadDone=Vd(this.userLoadDone,this),this.loadNonFriend=Vd(this.loadNonFriend,this),this.onhideSearchResultsComplete=Vd(this.onhideSearchResultsComplete,this),this.hideSearchResults=Vd(this.hideSearchResults,this),this.showNoResultsMsg=Vd(this.showNoResultsMsg,this),this.showNonFriendSearch=Vd(this.showNonFriendSearch,this),this.showSearchResults=Vd(this.showSearchResults,this),this.getNonFriendHandle=Vd(this.getNonFriendHandle,this),this.searchFriends=Vd(this.searchFriends,this),this.onSearchInputKey=Vd(this.onSearchInputKey,this),this.toggleSearchInput=Vd(this.toggleSearchInput,this),this.onSearchClick=Vd(this.onSearchClick,this),this._updateBubbles=Vd(this._updateBubbles,this),this._updateLinegraph=Vd(this._updateLinegraph,this),this._updateBullseye=Vd(this._updateBullseye,this),this.updateGraph=Vd(this.updateGraph,this),this.updateActiveUser=Vd(this.updateActiveUser,this),this.isFriendActive=Vd(this.isFriendActive,this),this.onOtherUsersChange=Vd(this.onOtherUsersChange,this),this.onActiveUsersChange=Vd(this.onActiveUsersChange,this),this.onActiveGraphChange=Vd(this.onActiveGraphChange,this),this.onCrunchComplete=Vd(this.onCrunchComplete,this),this.removeFixedUser=Vd(this.removeFixedUser,this),this.showFixedUser=Vd(this.showFixedUser,this),this._updateFixedUsersLinegraph=Vd(this._updateFixedUsersLinegraph,this),this._updateFixedUsersSingle=Vd(this._updateFixedUsersSingle,this),this.updateFixedUsers=Vd(this.updateFixedUsers,this),this._onFriendClickLinegraph=Vd(this._onFriendClickLinegraph,this),this.onFriendClick=Vd(this.onFriendClick,this),this.getSet=Vd(this.getSet,this),this.showShowMoreBtn=Vd(this.showShowMoreBtn,this),this.hideShowMoreBtn=Vd(this.hideShowMoreBtn,this),this.loadFriendAvatar=Vd(this.loadFriendAvatar,this),this.getFriend=Vd(this.getFriend,this),this.addFriend=Vd(this.addFriend,this),this.showNewFriends=Vd(this.showNewFriends,this),this.addFriends=Vd(this.addFriends,this),this.resetFriends=Vd(this.resetFriends,this),this.onShowFriendsComplete=Vd(this.onShowFriendsComplete,this),this.showFriends=Vd(this.showFriends,this),this.showUser=Vd(this.showUser,this),this.show=Vd(this.show,this),this.updateScrollDims=Vd(this.updateScrollDims,this),this.updateDims=Vd(this.updateDims,this),this.setListeners=Vd(this.setListeners,this),this.userDataReady=Vd(this.userDataReady,this),this.mute=Vd(this.mute,this),this.unMute=Vd(this.unMute,this),this.createFuse=Vd(this.createFuse,this),this.refreshScroller=Vd(this.refreshScroller,this),this.destroyScrollers=Vd(this.destroyScrollers,this),this.buildScrollers=Vd(this.buildScrollers,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.userModel=this.axe().appData.USER.model,this.friendCollection=this.axe().appData.FRIENDS.model.get(this.service),this.serviceModel=this.axe().appView.activeService,this.activeUsers=new nb,this.container.linegraph&&(this.linegraphComparisons=this.container.linegraph.comparisonCollection,this.linegraphSets=this.container.linegraph.sets),this.friendTmpl=_.template(this.axe().templates.get("friend-selector-friend")),this.templateVars={loading_msg:this.axe().locale.get("friends_loading_message"),is_mobile:!1},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="friend-selector",b.prototype.muted=!0,b.prototype.service=null,b.prototype.activeGraph=null,b.prototype.userModel=null,b.prototype.friendCollection=null,b.prototype.serviceModel=null,b.prototype.activeUsers=null,b.prototype.container=null,b.prototype.containerWidth=null,b.prototype.linegraphComparisons=null,b.prototype.friendTmpl=null,b.prototype.$loader=null,b.prototype.$fixed=null,b.prototype.$scrollWrappers=null,b.prototype.$friendsWrapper=null,b.prototype.$friendsHolder=null,b.prototype.$friends=null,b.prototype.$showMoreBtn=null,b.prototype.$searchInput=null,b.prototype.$searchLabel=null,b.prototype.$searchResultsWrap=null,b.prototype.$searchResults=null,b.prototype.fuse=null,b.prototype.searchableFields=["name","username"],b.prototype.previousQuery=null,b.prototype.originalSearchLabel=null,b.prototype.scrollerFriends=null,b.prototype.scrollerSearch=null,b.prototype.haveShown=!1,b.prototype.searchOpen=!1,b.prototype.friendsVisible=0,b.prototype.FRIEND_LOAD_INC=20,b.prototype.FRIEND_WIDTH=97,b.prototype.SEARCH_OPEN_WIDTH=213,b.prototype.init=function(){return this.$loader=this.$el.find("[data-loader]"),this.$fixedWrapper=this.$el.find("[data-fixed]"),this.$fixedFriends=this.$fixedWrapper.find("[data-friend]"),this.$scrollWrappers=this.$el.find("[data-scroll-wrapper]"),this.$friendsWrapper=this.$el.find("[data-friends-wrapper]"),this.$friendsHolder=this.$friendsWrapper.find("[data-friends]"),this.$friends=this.$friendsHolder.find("[data-friend]"),this.$showMoreBtn=this.$el.find("[data-show-more]"),this.$searchInput=this.$el.find("[data-search-input]"),this.$searchLabel=this.$el.find("[data-search-label]"),this.$searchResultsWrap=this.$el.find("[data-search-results-wrapper]"),this.$searchResults=this.$searchResultsWrap.find("[data-search-results]"),null},b.prototype.setup=function(){return setTimeout(function(a){return function(){return a.containerWidth=a.$el.width(),a.updateScrollDims()}}(this),0),null},b.prototype.buildScrollers=function(){var a,b;return a=Modernizr.touch?!1:!0,b={scrollX:!0,scrollY:!1,mouseWheel:!1,tap:!0},Modernizr.touch||(b.scrollbars=!0,b.interactiveScrollbars=!0),this.scrollerFriends=new IScroll(this.$friendsWrapper[0],b),this.scrollerSearch=new IScroll(this.$searchResultsWrap[0],b),null},b.prototype.destroyScrollers=function(){return this.scrollerFriends.destroy(),this.scrollerSearch.destroy(),this.scrollerFriends=null,this.scrollerSearch=null,null},b.prototype.refreshScroller=function(a){return setTimeout(function(){return function(){return null!=a?a.refresh():void 0}}(this),500),null},b.prototype.createFuse=function(){return this.fuse=new Fuse(_.pluck(this.friendCollection.models,"attributes"),{keys:this.searchableFields,id:"id"}),null},b.prototype.unMute=function(){return this.muted?(this.muted=!1,this.buildScrollers(),this.setListeners("on"),this.setup(),null):void 0},b.prototype.mute=function(){return this.muted?void 0:(this.muted=!0,this.scrollerFriends.scrollTo(0,0,0),this.destroyScrollers(),this.setListeners("off"),setTimeout(function(a){return function(){return a.friendsVisible>a.FRIEND_LOAD_INC?a.resetFriends():void 0}}(this),1e3),null)},b.prototype.userDataReady=function(){return this.userModel.get("info."+this.service+".name")&&!this.muted&&this.setListeners("on",!0),null},b.prototype.setListeners=function(a,b){return null==b&&(b=!1),this.userModel.get("info."+this.service+".name")?(b&&this.userModel.off("updateUserData",this.userDataReady),this.friendCollection[a]("crunchComplete",this.onCrunchComplete),this.friendCollection[a]("add",this.createFuse),this.activeGraph[a]("change",this.onActiveGraphChange),this.activeUsers[a]("change",this.onActiveUsersChange),this.$el[a]("tap","[data-show-more]",this.addFriends),this.$scrollWrappers[a]("tap","[data-friend]",this.onFriendClick),this.$fixedWrapper[a]("click","[data-friend]",this.onFriendClick),this.$el[a]("click","[data-search]",this.onSearchClick),this.$el[a]("keyup","[data-search-input]",this.onSearchInputKey),this.axe().appView[a]("updateDims",this.setup),this.container.linegraph&&this.linegraphComparisons[a]("change",this.updateFixedUsers),"on"!==a||this.haveShown||(this.friendCollection.HAVE_FRIENDS?this.show(!1):this.friendCollection.on("showFriends",this.show)),null):this.userModel.on("updateUserData",this.userDataReady)},b.prototype.updateDims=function(a,b){return b-=this.$fixedWrapper.find("[data-friend]").length,a.css({width:this.FRIEND_WIDTH*(b+1)}),null},b.prototype.updateScrollDims=function(){var a,b,c;return a=this.$fixedWrapper.find("[data-friend]").length,b=parseInt(this.$fixedWrapper.css("left"),10),c=this.searchOpen?this.SEARCH_OPEN_WIDTH:0,this.$scrollWrappers.css({width:this.containerWidth-(a+1)*this.FRIEND_WIDTH-b-c+10}),null},b.prototype.show=function(a){return this.haveShown?void 0:(this.showUser(),this.showFriends(),this.setup(),this.createFuse(),this.haveShown=!0,a&&this.friendCollection.off("showFriends",this.show),null)},b.prototype.showUser=function(){var a;if(!this.$el.find('[data-userid="user"]').length)return a=new lb(this.userModel.get("info."+this.service)),a.set({score:this.userModel.get("scores."+this.service),id:"user",IS_USER:!0}),this.addFriend(a,"fixed"),this.$fixedFriends=this.$fixedWrapper.find("[data-friend]"),null},b.prototype.showFriends=function(){return this.hideShowMoreBtn(),TweenLite.to(this.$loader,.3,{opacity:0,ease:Cubic.easeInOut,onComplete:this.onShowFriendsComplete}),null},b.prototype.onShowFriendsComplete=function(){return this.$loader.remove(),TweenLite.to(this.$el.find("[data-container]"),.3,{opacity:1,ease:Cubic.easeInOut,onComplete:function(a){return function(){return a.addFriends({count:a.FRIEND_LOAD_INC,animateIn:!0,animateScroll:!1}),a.showShowMoreBtn()}}(this)}),null},b.prototype.resetFriends=function(){return this.$friendsHolder.find("[data-friend]").remove(),this.$friends=this.$el.find("[data-friend]"),this.friendsVisible=0,this.haveShown&&(this.addFriends({count:this.FRIEND_LOAD_INC,animateIn:!1,animateScroll:!1}),this.showShowMoreBtn(),this.onActiveUsersChange()),null},b.prototype.addFriends=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(!((null!=(k=this.scrollerFriends)?k.isInTransition:void 0)||(null!=(l=this.scrollerSearch)?l.isInTransition:void 0))){for(this.$el.addClass("adding-friends"),e=a.count||this.FRIEND_LOAD_INC,c=a.hasOwnProperty("animateIn")?a.animateIn:!0,d=a.hasOwnProperty("animateScroll")?a.animateScroll:!0,h=function(){var a,b,d,h;for(h=[],g=a=b=this.$friends.length,d=this.$friends.length+e;d>=b?d>a:a>d;g=d>=b?++a:--a)this.friendCollection.models[g-1]?h.push(f=this.getFriend(this.friendCollection.models[g-1],"friends",c)):h.push(void 0);return h}.call(this),h=_.compact(h),this.friendsVisible+=h.length,b=h[0]?h[0].$el:!1,i=0,j=h.length;j>i;i++)f=h[i],g>0&&(b=b.add(f.$el));return b&&b.insertBefore(this.$showMoreBtn),this.$friends=this.$el.find("[data-friend]"),this.showNewFriends(h),this.updateDims(this.$friendsHolder,this.$friends.length),(this.friendCollection.models.length===this.friendsVisible||e>=this.friendCollection.models.length)&&this.hideShowMoreBtn(),d&&setTimeout(function(a){return function(){return a.scrollerFriends.scrollBy(-400,0,1e3,IScroll.utils.ease.circular)}}(this),10),setTimeout(function(a){return function(){return a.$el.removeClass("adding-friends")}}(this),d?450:50),this.refreshScroller(this.scrollerFriends),null}},b.prototype.showNewFriends=function(a){var b,c,d,e,f;for(d=function(a){return function(b,c){return setTimeout(function(){return b.model.get("animateIn")&&b.$el.removeClass("not-visible"),a.loadFriendAvatar(b.$el,b.model.get("avatar"))},100*c)}}(this),c=e=0,f=a.length;f>e;c=++e)b=a[c],d(b,c);return null},b.prototype.addFriend=function(a,b,c,d){var e;return null==c&&(c=!1),null==d&&(d=0),e=this.getFriend(a),"fixed"===b?(this.$fixedWrapper.append(e.$el),this.$friends=this.$el.find("[data-friend]")):"search"===b?this.$searchResults.append(e.$el):e.$el.insertBefore(this.$showMoreBtn),setTimeout(function(b){return function(){return c&&e.$el.removeClass("not-visible"),b.loadFriendAvatar(e.$el,a.get("avatar"))}}(this),d),e.$el},b.prototype.getFriend=function(a,b,c){var d,e;return null==c&&(c=!1),a.set({animateIn:c,IS_ACTIVE:this.isFriendActive(a)}),a.get("score")&&a.get("score.judgement")?(e=Ic.getNiceScore(a.get("score.total")),a.set("score.total",e)):a.set("score",{total:"",judgement:""}),d=new ob(a)},b.prototype.loadFriendAvatar=function(a,b){var c;return b?(c=new Image,c.onload=c.onerror=c.onabort=function(){return a.addClass("avatar-loaded")},c.src=b,null):a.addClass("avatar-loaded")},b.prototype.hideShowMoreBtn=function(){return this.$showMoreBtn.css("display","none"),null},b.prototype.showShowMoreBtn=function(){return this.$showMoreBtn.css("display","block"),null},b.prototype.getSet=function(a){var b,c,d,e;for(e=this.linegraphSets,c=0,d=e.length;d>c;c++)if(b=e[c],b.model.get("user")&&b.model.get("user.username").toLowerCase()===a.toLowerCase())return b;return null},b.prototype.onFriendClick=function(a,b){var c,d;return this.axe().analytics.track("dashboard_compare_click_friend"),this.scrollerFriends.isInTransition||this.scrollerSearch.isInTransition?void 0:(c=b||$(a.currentTarget),c.hasClass("not-friend")?this.loadNonFriend(c):"linegraph"===this.activeGraph.get("active").GRAPH_TYPE?(this._onFriendClickLinegraph(c),void 0):(c.hasClass("user")?this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user","user"):(d=this.friendCollection.findWhere({id:c.attr("data-userid")}),d.get("score")&&d.get("score.judgement")?this.activeUsers.get(this.activeGraph.get("active").GRAPH_TYPE).user===d?this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user","user"):this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user",d):d.getAllData()),null))},b.prototype._onFriendClickLinegraph=function(a){var b;return a.hasClass("user")?(this.updateActiveUser("user"),this.activeGraph.get("active").mainLine.setActive(!0)):a.hasClass("active")?(this.updateActiveUser("user"),this.linegraphComparisons.deactivateModel(this.getSet(a.data("username")).model),this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user","user"),this.onOtherUsersChange(),this.updateFixedUsers()):""!==a.attr("data-colorscheme")?(this.updateActiveUser(a.data("userid")),this.getSet(a.data("username")).line.setActive(!0)):(b=this.friendCollection.findWhere({id:a.attr("data-userid")}),this.linegraphComparisons.maxCountReached()||(b.get("score")&&b.get("score.judgement")?this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user",b):b.getAllData())),!1},b.prototype.updateFixedUsers=function(){if(this.searchOpen)return this.toggleSearchInput(!1,this.updateFixedUsers);switch(this.activeGraph.get("active").GRAPH_TYPE){case"bullseye":this._updateFixedUsersSingle();break;case"linegraph":this._updateFixedUsersLinegraph();break;case"bubbles":this._updateFixedUsersSingle()}return null},b.prototype._updateFixedUsersSingle=function(){var a,b,c;return this.$fixedFriends=this.$fixedWrapper.find("[data-friend]"),b=this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),c=!1,this.$fixedFriends.each(function(a){return function(d,e){var f,g;return f=$(e),g=f.attr("data-userid"),"user"!==g?"user"!==b&&g===b.get("id")?c=!0:a.removeFixedUser(f):void 0}}(this)),"user"===b||c||(a=this.addFriend(b,"fixed"),this.showFixedUser(a)),setTimeout(function(a){return function(){return a.updateDims(a.$friendsHolder,a.$friends.length-("user"!==b?1:0)),a.updateScrollDims(),a.refreshScroller(a.scrollerFriends)}}(this),350),null},b.prototype._updateFixedUsersLinegraph=function(){var a,b,c,d,e,f,g;if(this.$fixedFriends=this.$fixedWrapper.find("[data-friend]"),b=this.linegraphComparisons.pluck("user.id"),this.linegraphComparisons.length>2&&this.axe().appView.milestones.completeTask("compare_multi_friends"),c=[],this.$fixedFriends.each(function(a){return function(d,e){var f,g;return f=$(e),g=f.attr("data-userid"),"user"!==g?b.indexOf(g)>-1?c.push(g):a.removeFixedUser(f):void 0}}(this)),c.length!==b.length)for(e=_.filter(b,function(a){return!(c.indexOf(a)>-1)}),f=0,g=e.length;g>f;f++)d=e[f],a=this.addFriend(this.friendCollection.findWhere({id:d}),"fixed"),this.showFixedUser(a);return setTimeout(function(a){return function(){return a.updateDims(a.$friendsHolder,a.$friends.length-(b.length-1)),a.updateScrollDims(),a.refreshScroller(a.scrollerFriends)}}(this),350),null},b.prototype.showFixedUser=function(a){return a.addClass("showing"),setTimeout(function(){return a.addClass("show")},300),null},b.prototype.removeFixedUser=function(a){return a.removeClass("showing show"),setTimeout(function(){return a.remove()},300),null},b.prototype.onCrunchComplete=function(a){return this.$friends.filter('[data-userid="'+a.get("id")+'"]').attr("data-judgement",a.get("score.judgement")).find("[data-score]").text(Ic.getNiceScore(a.get("score.total"))),this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user",a),null},b.prototype.onActiveGraphChange=function(){return this.onActiveUsersChange(!1),null},b.prototype.onActiveUsersChange=function(a){var b,c;return null==a&&(a=!0),this.updateFixedUsers(),b=b||this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),c="user"===b?"user":b.get("id"),this.updateActiveUser(c),a&&this.updateGraph(),this.onOtherUsersChange(),null},b.prototype.onOtherUsersChange=function(){var a,b,c,d,e,f;if("linegraph"===this.activeGraph.get("active").GRAPH_TYPE)for(this.$friends.filter(".user").attr("data-colorscheme",this.userModel.get("scores."+this.service+".judgement")).end().not(".user").attr("data-colorscheme",""),f=this.linegraphComparisons.models,d=0,e=f.length;e>d;d++)b=f[d],c=b.get("user.id"),a=this.linegraphComparisons.colorSchemes[b.get("colorScheme")].name,this.$friends.filter('[data-userid="'+c+'"]').attr("data-colorscheme",a);else this.$friends.attr("data-colorscheme","");return null},b.prototype.isFriendActive=function(a){var b;return b=this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),"user"===b&&a.get("IS_USER")?!0:a.get("IS_USER")||"user"===b||a.get("id")!==b.get("id")?!1:!0},b.prototype.updateActiveUser=function(a){return this.$friends.filter(".active").removeClass("active").end().filter('[data-userid="'+a+'"]').addClass("active"),null},b.prototype.updateGraph=function(){if(!this.muted){switch(this.activeGraph.get("active").GRAPH_TYPE){case"bullseye":this._updateBullseye();break;case"linegraph":this._updateLinegraph();break;case"bubbles":this._updateBubbles()}return null}},b.prototype._updateBullseye=function(){var a;return a=this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),"user"===a?this.activeGraph.get("active").resetUser():this.activeGraph.get("active").changeUser({user:a.toJSON(),posts:a.get("score.postsData.posts")}),null},b.prototype._updateLinegraph=function(){var a,b;return b=this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),"user"!==b?(a=this.activeGraph.get("active").comparisonCollection.addUser({user:b.toJSON(),data:b.get("score.postsData.posts")}),this.$friends.filter('[data-userid="'+b.get("id")+'"]').attr("data-colorscheme",a.name),null):void 0},b.prototype._updateBubbles=function(){var a;return a=this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),"user"===a?this.activeGraph.get("active").resetUser():this.activeGraph.get("active").changeUser({user:a.toJSON()}),null},b.prototype.onSearchClick=function(a){return this.hideProtectedModal(),$(a.target).data("search-input")||this.toggleSearchInput(!this.searchOpen),null},b.prototype.toggleSearchInput=function(a,b){return a?(this.searchOpen=!0,this.$el.addClass("search-open"),setTimeout(function(a){return function(){return a.$searchInput.focus(),a.refreshScroller(a.scrollerFriends),"function"==typeof b?b():void 0}}(this),400)):(this.searchOpen=!1,this.$el.removeClass("search-open"),this.hideSearchResults(),setTimeout(function(a){return function(){return a.$searchInput.blur().val(""),"function"==typeof b?b():void 0}}(this),400)),this.updateScrollDims(),null},b.prototype.onSearchInputKey=function(a){return this.hideProtectedModal(),27===a.keyCode?this.toggleSearchInput(!1):(this.searchFriends(this.$searchInput.val().toLowerCase().replace("@","")),null)},b.prototype.searchFriends=function(a){var b,c;return a===this.previousQuery?!1:a?(this.previousQuery=a,c=this.fuse.search(a),b=this.getNonFriendHandle(a),c.length?this.showSearchResults(c,b):b?this.showSearchResults([],b):this.showNoResultsMsg(),null):this.hideSearchResults()},b.prototype.getNonFriendHandle=function(a){return"fb"!==this.service&&!this.friendCollection.findWhere({username:a})&&a.match(/^[a-z0-9_]+$/i)?a:!1},b.prototype.showSearchResults=function(a,b){var c,d,e,f,g;for(this.$searchResultsWrap.addClass("is-searching"),this.$searchResults.empty(),e=0,b&&(e++,this.showNonFriendSearch(b)),c=g=0;10>g;c=++g)d=a[c],d&&(e++,f=this.friendCollection.findWhere({id:d}),this.addFriend(f,"search"));return this.updateDims(this.$searchResults,e),this.refreshScroller(this.scrollerSearch),this.scrollerSearch.scrollTo(0,0),null},b.prototype.showNonFriendSearch=function(a){var b;return b=new lb({username:a,nonFriend:!0}),this.addFriend(b,"search"),null},b.prototype.showNoResultsMsg=function(){return this.$searchResultsWrap.addClass("is-searching"),this.$searchResults.empty(),null},b.prototype.hideSearchResults=function(){return this.$searchResultsWrap.removeClass("is-searching"),this.previousQuery=null,setTimeout(function(a){return function(){return a.onhideSearchResultsComplete()}}(this),300),null},b.prototype.onhideSearchResultsComplete=function(){return this.$searchResults.empty(),null},b.prototype.loadNonFriend=function(a){var b,c;return a.addClass("loading"),b=new lb({username:a.attr("data-username"),service:this.service}),c=b._getProfile(!1),c.done(function(c){return function(){return b.isProtected()?(c.protectedModal&&c.protectedModal.close(),c.protectedModal=new qb(b,a),a.removeClass("loading"),a.addClass("protected"),a.find(".friend-avatar").css({"background-image":"url("+b.get("avatar")+")"}),void 0):c.userLoadDone(b,a)}}(this)),c.fail(function(b){return function(){return b.userLoadFail(a)}}(this)),null},b.prototype.userLoadDone=function(a,b){var c;return a.set("score",{total:"",judgement:""}),a.setInfo(a.get("data.userProfile")),c=new ob(a),b.replaceWith(c.$el),this.loadFriendAvatar(c.$el,a.get("avatar")),this.friendCollection.add(a,{at:this.friendsVisible}),this.addFriends({count:1,animateIn:!1,animateScroll:!1}),a.getAllData(),null},b.prototype.userLoadFail=function(a){var b;return a.removeClass("loading"),b=function(){switch(this.service){case"tw":return"Twitter";case"ig":return"Instagram"}}.call(this),this.showSearchError(this.axe().locale.get("friends_search_error").replace("{{ service }}",b)),null},b.prototype.showSearchError=function(a){return this.originalSearchLabel=this.originalSearchLabel||this.$searchLabel.html(),TweenLite.to(this.$searchLabel,.3,{opacity:"0",onComplete:function(b){return function(){return b.$searchLabel.addClass("error").html(a),TweenLite.to(b.$searchLabel,.3,{opacity:"1",onComplete:b.hideSearchError})}}(this)}),null},b.prototype.hideSearchError=function(){return TweenLite.to(this.$searchLabel,.3,{delay:3,opacity:"0",onComplete:function(a){return function(){return a.$searchLabel.removeClass("error").html(a.originalSearchLabel),TweenLite.to(a.$searchLabel,.3,{opacity:"1"})}}(this)}),null},b.prototype.hideProtectedModal=function(){return this.protectedModal?(this.protectedModal.close(),this.protectedModal=null):void 0},b}(g),ob=function(a){function b(a){return this.model=a,this.removeLoaderDom=Vd(this.removeLoaderDom,this),this.setCircleAngle=Vd(this.setCircleAngle,this),this.getCircleSpeed=Vd(this.getCircleSpeed,this),this.updateCircle=Vd(this.updateCircle,this),this.onCrunchComplete=Vd(this.onCrunchComplete,this),this.onCrunchProgress=Vd(this.onCrunchProgress,this),this.onCrunchEnd=Vd(this.onCrunchEnd,this),this.onCrunchBegin=Vd(this.onCrunchBegin,this),this.setCrunchEvents=Vd(this.setCrunchEvents,this),this.init=Vd(this.init,this),this.templateVars=this.model.toJSON(),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.model=null,b.prototype.circle=null,b.prototype.currentAngle=0,b.prototype.targetAngle=0,b.prototype.PI=Math.PI,b.prototype.template="friend-selector-friend",b.prototype.SCORE_RECEIVED=!1,b.prototype.init=function(){return this.circle=this.$el.find("[data-friend-progress]")[0],this.setCrunchEvents("on"),null},b.prototype.setCrunchEvents=function(a){return this.model[a]("beginCrunch",this.onCrunchBegin),this.model[a]("change:crunchProgress",this.onCrunchProgress),this.model[a]("crunchComplete",this.onCrunchComplete),null},b.prototype.onCrunchBegin=function(){return this.$el.addClass("loading"),createjs.Ticker.addEventListener("tick",this.updateCircle),null},b.prototype.onCrunchEnd=function(){return this.$el.removeClass("loading"),createjs.Ticker.removeEventListener("tick",this.updateCircle),setTimeout(function(a){return function(){return a.removeLoaderDom()}}(this),500),null},b.prototype.onCrunchProgress=function(){return this.targetAngle=360*(this.model.get("crunchProgress")/100),null},b.prototype.onCrunchComplete=function(){return this.SCORE_RECEIVED=!0,this.setCrunchEvents("off"),null},b.prototype.updateCircle=function(){return this.targetAngle===Math.round(this.currentAngle)?this.SCORE_RECEIVED?this.onCrunchEnd():void 0:(this.currentAngle+=this.getCircleSpeed(this.targetAngle,this.currentAngle),this.setCircleAngle(this.currentAngle),null)},b.prototype.getCircleSpeed=function(a,b){return(a-b)/5},b.prototype.setCircleAngle=function(a,b){var c,d,e,f,g;return null==b&&(b=this.circle),a%=360,e=a*this.PI/180,f=36*Math.sin(e),g=-36*Math.cos(e),d=a>180?1:0,c="M 0 0 v -36 A 36 36 1 "+d+" 1 "+f+" "+g+" z",b.setAttribute("d",c),null},b.prototype.removeLoaderDom=function(){return this.$el.find(".friend-loader, .friend-loader-overlay").remove(),null},b}(g),pb=function(a){function b(a){return this.service=a.service,this.activeGraph=a.activeGraph,this.container=a.container,this.hideSearchError=Vd(this.hideSearchError,this),this.showSearchError=Vd(this.showSearchError,this),this.userLoadFail=Vd(this.userLoadFail,this),this.userLoadDone=Vd(this.userLoadDone,this),this.loadNonFriend=Vd(this.loadNonFriend,this),this.onhideSearchResultsComplete=Vd(this.onhideSearchResultsComplete,this),this.hideSearchResults=Vd(this.hideSearchResults,this),this.showNoResultsMsg=Vd(this.showNoResultsMsg,this),this.showNonFriendSearch=Vd(this.showNonFriendSearch,this),this.showSearchResults=Vd(this.showSearchResults,this),this.getNonFriendHandle=Vd(this.getNonFriendHandle,this),this.searchFriends=Vd(this.searchFriends,this),this.onSearchInputKey=Vd(this.onSearchInputKey,this),this.toggleSearchInput=Vd(this.toggleSearchInput,this),this.onSearchClick=Vd(this.onSearchClick,this),this._updateBubbles=Vd(this._updateBubbles,this),this._updateLinegraph=Vd(this._updateLinegraph,this),this._updateBullseye=Vd(this._updateBullseye,this),this.updateGraph=Vd(this.updateGraph,this),this.updateActiveUser=Vd(this.updateActiveUser,this),this.isFriendActive=Vd(this.isFriendActive,this),this.onOtherUsersChange=Vd(this.onOtherUsersChange,this),this.onActiveUsersChange=Vd(this.onActiveUsersChange,this),this.onActiveGraphChange=Vd(this.onActiveGraphChange,this),this.onCrunchComplete=Vd(this.onCrunchComplete,this),this.removeFixedUser=Vd(this.removeFixedUser,this),this.showFixedUser=Vd(this.showFixedUser,this),this._updateFixedUsersLinegraph=Vd(this._updateFixedUsersLinegraph,this),this._updateFixedUsersSingle=Vd(this._updateFixedUsersSingle,this),this.updateFixedUsers=Vd(this.updateFixedUsers,this),this._onFriendClickLinegraph=Vd(this._onFriendClickLinegraph,this),this.onFriendClick=Vd(this.onFriendClick,this),this.onFixedWrapperClick=Vd(this.onFixedWrapperClick,this),this.getSet=Vd(this.getSet,this),this.showShowMoreBtn=Vd(this.showShowMoreBtn,this),this.hideShowMoreBtn=Vd(this.hideShowMoreBtn,this),this.loadFriendAvatar=Vd(this.loadFriendAvatar,this),this.getFriend=Vd(this.getFriend,this),this.addFriend=Vd(this.addFriend,this),this.showNewFriends=Vd(this.showNewFriends,this),this.addFriends=Vd(this.addFriends,this),this.resetFriends=Vd(this.resetFriends,this),this.onShowFriendsComplete=Vd(this.onShowFriendsComplete,this),this.showFriends=Vd(this.showFriends,this),this.showUser=Vd(this.showUser,this),this.show=Vd(this.show,this),this.updateScrollDims=Vd(this.updateScrollDims,this),this.updateDims=Vd(this.updateDims,this),this.setListeners=Vd(this.setListeners,this),this.userDataReady=Vd(this.userDataReady,this),this.mute=Vd(this.mute,this),this.unMute=Vd(this.unMute,this),this.createFuse=Vd(this.createFuse,this),this.refreshScroller=Vd(this.refreshScroller,this),this.destroyScrollers=Vd(this.destroyScrollers,this),this.buildScrollers=Vd(this.buildScrollers,this),this.close=Vd(this.close,this),this.open=Vd(this.open,this),this.onUpdateDims=Vd(this.onUpdateDims,this),this.setup=Vd(this.setup,this),this.rearrangeDom=Vd(this.rearrangeDom,this),this.init=Vd(this.init,this),this.userModel=this.axe().appData.USER.model,this.friendCollection=this.axe().appData.FRIENDS.model.get(this.service),this.serviceModel=this.axe().appView.activeService,this.activeUsers=new nb,this.container.linegraph&&(this.linegraphComparisons=this.container.linegraph.comparisonCollection,this.linegraphSets=this.container.linegraph.sets),this.friendTmpl=_.template(this.axe().templates.get("friend-selector-friend")),this.templateVars={loading_msg:this.axe().locale.get("friends_loading_message"),is_mobile:!0,close_btn_txt:this.axe().locale.get("friends_selector_mobile_close_btn_txt")},b.__super__.constructor.call(this),null
}return Ud(b,a),b.prototype.template="friend-selector",b.prototype.muted=!0,b.prototype.service=null,b.prototype.activeGraph=null,b.prototype.userModel=null,b.prototype.friendCollection=null,b.prototype.serviceModel=null,b.prototype.activeUsers=null,b.prototype.container=null,b.prototype.linegraphComparisons=null,b.prototype.friendTmpl=null,b.prototype.$loader=null,b.prototype.$fixedWrapper=null,b.prototype.$scrollWrappers=null,b.prototype.$friendsWrapper=null,b.prototype.$friendsHolder=null,b.prototype.$friends=null,b.prototype.$showMoreBtn=null,b.prototype.$searchWrapper=null,b.prototype.$searchInput=null,b.prototype.$searchLabel=null,b.prototype.$searchResultsWrap=null,b.prototype.$searchResults=null,b.prototype.fuse=null,b.prototype.searchableFields=["name","username"],b.prototype.previousQuery=null,b.prototype.originalSearchLabel=null,b.prototype.scrollerFriends=null,b.prototype.scrollerSearch=null,b.prototype.haveShown=!1,b.prototype.searchOpen=!1,b.prototype.friendsVisible=0,b.prototype.FRIEND_LOAD_INC=20,b.prototype.FRIEND_HEIGHT=78,b.prototype.FIXED_HEIGHT=133,b.prototype.init=function(){return this.$loader=this.$el.find("[data-loader]"),this.$fixedWrapper=this.$el.find("[data-fixed]"),this.$fixedFriends=this.$fixedWrapper.find("[data-friend]"),this.$scrollWrappers=this.$el.find("[data-scroll-wrapper]"),this.$friendsWrapper=this.$el.find("[data-friends-wrapper]"),this.$friendsHolder=this.$friendsWrapper.find("[data-friends]"),this.$friends=this.$friendsHolder.find("[data-friend]"),this.$showMoreBtn=this.$el.find("[data-show-more]"),this.$searchWrapper=this.$el.find("[data-search]"),this.$searchInput=this.$el.find("[data-search-input]"),this.$searchLabel=this.$el.find("[data-search-label]"),this.$searchResultsWrap=this.$el.find("[data-search-results-wrapper]"),this.$searchResults=this.$searchResultsWrap.find("[data-search-results]"),this.rearrangeDom(),null},b.prototype.rearrangeDom=function(){return this.$searchWrapper.detach(),this.$searchWrapper.insertBefore(this.$fixedWrapper),this.$fixedWrapper.detach(),this.container.$el.append(this.$fixedWrapper),null},b.prototype.setup=function(){return this.updateScrollDims(),this.onActiveGraphChange(),this.close(),null},b.prototype.onUpdateDims=function(){return this.updateScrollDims(),this.onActiveGraphChange(),null},b.prototype.open=function(){return this.$el.css("display","block"),this.axe().appView.header.hide(),setTimeout(function(a){return function(){return a.$el.addClass("open"),a.refreshScroller(a.scrollerFriends)}}(this),10),null},b.prototype.close=function(){return this.$el.removeClass("open"),this.axe().appView.header.unHide(),setTimeout(function(a){return function(){return a.$el.css("display","none")}}(this),300),null},b.prototype.buildScrollers=function(){return this.scrollerFriends=new IScroll(this.$friendsWrapper[0],{scrollX:!1,scrollY:!0,tap:!0}),this.scrollerSearch=new IScroll(this.$searchResultsWrap[0],{scrollX:!1,scrollY:!0,tap:!0}),null},b.prototype.destroyScrollers=function(){return this.scrollerFriends.destroy(),this.scrollerSearch.destroy(),this.scrollerFriends=null,this.scrollerSearch=null,null},b.prototype.refreshScroller=function(a){return setTimeout(function(){return function(){return null!=a?a.refresh():void 0}}(this),500),null},b.prototype.createFuse=function(){return this.fuse=new Fuse(_.pluck(this.friendCollection.models,"attributes"),{keys:this.searchableFields,id:"id"}),null},b.prototype.unMute=function(){return this.muted?(this.muted=!1,this.setup(),this.buildScrollers(),this.setListeners("on"),null):void 0},b.prototype.mute=function(){return this.muted?void 0:(this.muted=!0,this.scrollerFriends.scrollTo(0,0,0),this.destroyScrollers(),this.setListeners("off"),setTimeout(function(a){return function(){return a.friendsVisible>a.FRIEND_LOAD_INC?a.resetFriends():void 0}}(this),1e3),null)},b.prototype.userDataReady=function(){return this.userModel.get("info."+this.service+".name")&&!this.muted&&this.setListeners("on",!0),null},b.prototype.setListeners=function(a,b){return null==b&&(b=!1),this.userModel.get("info."+this.service+".name")?(b&&this.userModel.off("updateUserData",this.userDataReady),this.friendCollection[a]("crunchComplete",this.onCrunchComplete),this.friendCollection[a]("add",this.createFuse),this.activeGraph[a]("change",this.onActiveGraphChange),this.activeUsers[a]("change",this.onActiveUsersChange),this.$el[a]("tap","[data-show-more]",this.addFriends),this.$scrollWrappers[a]("tap","[data-friend]",this.onFriendClick),this.$fixedWrapper[a]("click","[data-friend]",this.onFriendClick),this.$fixedWrapper[a]("click",this.onFixedWrapperClick),this.$el[a]("click","[data-search]",this.onSearchClick),this.$el[a]("click","[data-close-overlay]",this.close),this.$el[a]("keyup","[data-search-input]",this.onSearchInputKey),this.axe().appView[a]("updateDims",this.onUpdateDims),this.container.linegraph&&this.linegraphComparisons[a]("change",this.updateFixedUsers),"on"!==a||this.haveShown||(this.friendCollection.HAVE_FRIENDS?this.show(!1):this.friendCollection.on("showFriends",this.show)),null):this.userModel.on("updateUserData",this.userDataReady)},b.prototype.updateDims=function(a,b){return a.css({height:this.FRIEND_HEIGHT*b}),null},b.prototype.updateScrollDims=function(){var a,b;return a=this.$fixedWrapper.find("[data-friend]").length,b=this.searchOpen?this.SEARCH_OPEN_WIDTH:0,this.$scrollWrappers.css({height:this.axe().appView.dims.h-this.FIXED_HEIGHT}),null},b.prototype.show=function(a){return this.showUser(),this.showFriends(),this.setup(),this.createFuse(),this.haveShown=!0,a&&this.friendCollection.off("showFriends",this.show),null},b.prototype.showUser=function(){var a;if(!this.$fixedWrapper.find('[data-userid="user"]').length)return a=new lb(this.userModel.get("info."+this.service)),a.set({score:this.userModel.get("scores."+this.service),id:"user",IS_USER:!0}),this.addFriend(a,"fixed"),this.$fixedFriends=this.$fixedWrapper.find("[data-friend]"),null},b.prototype.showFriends=function(){return this.addFriends({count:this.FRIEND_LOAD_INC,animateIn:!0,animateScroll:!1}),TweenLite.to(this.$loader,.3,{opacity:0,ease:Cubic.easeInOut,onComplete:this.onShowFriendsComplete}),null},b.prototype.onShowFriendsComplete=function(){return this.$loader.remove(),TweenLite.to(this.$el.find("[data-container]"),.3,{opacity:1,ease:Cubic.easeInOut}),null},b.prototype.resetFriends=function(){return this.$friendsHolder.find("[data-friend]").remove(),this.$friends=this.$el.find("[data-friend]"),this.friendsVisible=0,this.haveShown&&(this.addFriends({count:this.FRIEND_LOAD_INC,animateIn:!1,animateScroll:!1}),this.showShowMoreBtn(),this.onActiveUsersChange()),null},b.prototype.addFriends=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(!((null!=(k=this.scrollerFriends)?k.isInTransition:void 0)||(null!=(l=this.scrollerSearch)?l.isInTransition:void 0))){for(e=a.count||this.FRIEND_LOAD_INC,c=a.hasOwnProperty("animateIn")?a.animateIn:!0,d=a.hasOwnProperty("animateScroll")?a.animateScroll:!0,h=function(){var a,b,d,h;for(h=[],g=a=b=this.$friends.length,d=this.$friends.length+e;d>=b?d>a:a>d;g=d>=b?++a:--a)this.friendCollection.models[g-1]?h.push(f=this.getFriend(this.friendCollection.models[g-1],"friends",c)):h.push(void 0);return h}.call(this),h=_.compact(h),this.friendsVisible+=h.length,b=h[0]?h[0].$el:!1,i=0,j=h.length;j>i;i++)f=h[i],g>0&&(b=b.add(f.$el));return b&&b.insertBefore(this.$showMoreBtn),this.$friends=this.$friendsHolder.find("[data-friend]").add(this.$fixedWrapper.find("[data-friend]")),this.showNewFriends(h),(this.friendCollection.models.length===this.friendsVisible||e>=this.friendCollection.models.length)&&this.hideShowMoreBtn(),d&&setTimeout(function(a){return function(){return a.scrollerFriends.scrollBy(0,-400,1e3,IScroll.utils.ease.circular)}}(this),10),this.refreshScroller(this.scrollerFriends),null}},b.prototype.showNewFriends=function(a){var b,c,d,e,f;for(d=function(a){return function(b,c){return setTimeout(function(){return b.model.get("animateIn")&&b.$el.removeClass("not-visible"),a.loadFriendAvatar(b.$el,b.model.get("avatar"))},100*c)}}(this),c=e=0,f=a.length;f>e;c=++e)b=a[c],d(b,c);return null},b.prototype.addFriend=function(a,b,c,d){var e;return null==c&&(c=!1),null==d&&(d=0),e=this.getFriend(a),"fixed"===b?(this.$fixedWrapper.append(e.$el),this.$friends=this.$friendsHolder.find("[data-friend]").add(this.$fixedWrapper.find("[data-friend]"))):"search"===b?this.$searchResults.append(e.$el):e.$el.insertBefore(this.$showMoreBtn),setTimeout(function(b){return function(){return c&&e.$el.removeClass("not-visible"),b.loadFriendAvatar(e.$el,a.get("avatar"))}}(this),d),e.$el},b.prototype.getFriend=function(a,b,c){var d,e;return null==c&&(c=!1),a.set({animateIn:c,IS_ACTIVE:this.isFriendActive(a)}),a.get("score")&&a.get("score.judgement")?(e=Ic.getNiceScore(a.get("score.total")),a.set("score.total",e)):a.set("score",{total:"",judgement:""}),d=new ob(a)},b.prototype.loadFriendAvatar=function(a,b){var c;return b?(c=new Image,c.onload=c.onerror=c.onabort=function(){return a.addClass("avatar-loaded")},c.src=b,null):a.addClass("avatar-loaded")},b.prototype.hideShowMoreBtn=function(){return this.$showMoreBtn.css("display","none"),null},b.prototype.showShowMoreBtn=function(){return this.$showMoreBtn.css("display","block"),null},b.prototype.getSet=function(a){var b,c,d,e;for(e=this.linegraphSets,c=0,d=e.length;d>c;c++)if(b=e[c],b.model.get("user")&&b.model.get("user.username").toLowerCase()===a.toLowerCase())return b;return null},b.prototype.onFixedWrapperClick=function(a){return a.target===a.currentTarget&&this.open(),null},b.prototype.onFriendClick=function(a,b){var c,d;if(!this.scrollerFriends.isInTransition&&!this.scrollerSearch.isInTransition)return c=b||$(a.currentTarget),c.hasClass("not-friend")?this.loadNonFriend(c):"linegraph"===this.activeGraph.get("active").GRAPH_TYPE?(this._onFriendClickLinegraph(c),void 0):(c.hasClass("user")?this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user","user"):(d=this.friendCollection.findWhere({id:c.attr("data-userid")}),d.get("score")&&d.get("score.judgement")?this.activeUsers.get(this.activeGraph.get("active").GRAPH_TYPE).user===d?this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user","user"):this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user",d):d.getAllData()),null)},b.prototype._onFriendClickLinegraph=function(a){var b;return a.hasClass("user")?(this.updateActiveUser("user"),this.activeGraph.get("active").mainLine.setActive(!0)):a.hasClass("active")?(this.updateActiveUser("user"),this.linegraphComparisons.deactivateModel(this.getSet(a.data("username")).model),this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user","user"),this.onOtherUsersChange(),this.updateFixedUsers()):""!==a.attr("data-colorscheme")?(this.updateActiveUser(a.data("userid")),this.getSet(a.data("username")).line.setActive(!0)):(b=this.friendCollection.findWhere({id:a.attr("data-userid")}),this.linegraphComparisons.maxCountReached()||(b.get("score")&&b.get("score.judgement")?this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user",b):b.getAllData())),!1},b.prototype.updateFixedUsers=function(){if(this.searchOpen)return this.toggleSearchInput(!1,this.updateFixedUsers);switch(this.activeGraph.get("active").GRAPH_TYPE){case"bullseye":this._updateFixedUsersSingle();break;case"linegraph":this._updateFixedUsersLinegraph();break;case"bubbles":this._updateFixedUsersSingle()}return null},b.prototype._updateFixedUsersSingle=function(){var a,b,c;return this.$fixedFriends=this.$fixedWrapper.find("[data-friend]"),b=this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),c=!1,this.$fixedFriends.each(function(a){return function(d,e){var f,g;return f=$(e),g=f.attr("data-userid"),"user"!==g?"user"!==b&&g===b.get("id")?c=!0:a.removeFixedUser(f):void 0}}(this)),"user"===b||c||(a=this.addFriend(b,"fixed"),this.showFixedUser(a)),setTimeout(function(a){return function(){return a.refreshScroller(a.scrollerFriends)}}(this),350),null},b.prototype._updateFixedUsersLinegraph=function(){var a,b,c,d,e,f,g;if(this.$fixedFriends=this.$fixedWrapper.find("[data-friend]"),b=this.linegraphComparisons.pluck("user.id"),c=[],this.$fixedFriends.each(function(a){return function(d,e){var f,g;return f=$(e),g=f.attr("data-userid"),"user"!==g?b.indexOf(g)>-1?c.push(g):a.removeFixedUser(f):void 0}}(this)),c.length!==b.length)for(e=_.filter(b,function(a){return!(c.indexOf(a)>-1)}),f=0,g=e.length;g>f;f++)d=e[f],a=this.addFriend(this.friendCollection.findWhere({id:d}),"fixed"),this.showFixedUser(a);return setTimeout(function(a){return function(){return a.refreshScroller(a.scrollerFriends)}}(this),350),null},b.prototype.showFixedUser=function(a){return this.close(),a.addClass("showing"),setTimeout(function(){return a.addClass("show")},300),null},b.prototype.removeFixedUser=function(a){return a.removeClass("showing show"),setTimeout(function(){return a.remove()},300),null},b.prototype.onCrunchComplete=function(a){return this.$friends.filter('[data-userid="'+a.get("id")+'"]').attr("data-judgement",a.get("score.judgement")).find("[data-score]").text(Ic.getNiceScore(a.get("score.total"))),this.activeUsers.set(""+this.activeGraph.get("active").GRAPH_TYPE+".user",a),null},b.prototype.onActiveGraphChange=function(){return"linegraph"===this.activeGraph.get("active").GRAPH_TYPE?this.$fixedWrapper.addClass("linegraph-active").removeClass("not-linegraph-active"):this.$fixedWrapper.removeClass("linegraph-active").addClass("not-linegraph-active"),this.onActiveUsersChange(!1),null},b.prototype.onActiveUsersChange=function(a){var b,c;return null==a&&(a=!0),this.updateFixedUsers(),b=b||this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),c="user"===b?"user":b.get("id"),this.updateActiveUser(c),a&&this.updateGraph(),this.onOtherUsersChange(),null},b.prototype.onOtherUsersChange=function(){var a,b,c,d,e,f;if("linegraph"===this.activeGraph.get("active").GRAPH_TYPE)for(this.$friends.filter(".user").attr("data-colorscheme",this.userModel.get("scores."+this.service+".judgement")).end().not(".user").attr("data-colorscheme",""),f=this.linegraphComparisons.models,d=0,e=f.length;e>d;d++)b=f[d],c=b.get("user.id"),a=this.linegraphComparisons.colorSchemes[b.get("colorScheme")].name,this.$friends.filter('[data-userid="'+c+'"]').attr("data-colorscheme",a);else this.$friends.attr("data-colorscheme","");return null},b.prototype.isFriendActive=function(a){var b;return b=this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),"user"===b&&a.get("IS_USER")?!0:a.get("IS_USER")||"user"===b||a.get("id")!==b.get("id")?!1:!0},b.prototype.updateActiveUser=function(a){return this.$friends.filter(".active").removeClass("active").end().filter('[data-userid="'+a+'"]').addClass("active"),null},b.prototype.updateGraph=function(){if(!this.muted){switch(this.activeGraph.get("active").GRAPH_TYPE){case"bullseye":this._updateBullseye();break;case"linegraph":this._updateLinegraph();break;case"bubbles":this._updateBubbles()}return null}},b.prototype._updateBullseye=function(){var a;return a=this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),"user"===a?this.activeGraph.get("active").resetUser():this.activeGraph.get("active").changeUser({user:a.toJSON(),posts:a.get("score.postsData.posts")}),null},b.prototype._updateLinegraph=function(){var a,b;return b=this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),"user"!==b?(a=this.activeGraph.get("active").comparisonCollection.addUser({user:b.toJSON(),data:b.get("score.postsData.posts")}),this.$friends.filter('[data-userid="'+b.get("id")+'"]').attr("data-colorscheme",a.name),null):void 0},b.prototype._updateBubbles=function(){var a;return a=this.activeUsers.get(""+this.activeGraph.get("active").GRAPH_TYPE+".user"),"user"===a?this.activeGraph.get("active").resetUser():this.activeGraph.get("active").changeUser({user:a.toJSON()}),null},b.prototype.onSearchClick=function(a){return $(a.target).data("search-input")||this.toggleSearchInput(!this.searchOpen),null},b.prototype.toggleSearchInput=function(a,b){return a?(this.searchOpen=!0,this.$el.addClass("search-open"),setTimeout(function(a){return function(){return a.$searchInput.focus(),a.refreshScroller(a.scrollerFriends),"function"==typeof b?b():void 0}}(this),400)):(this.searchOpen=!1,this.$el.removeClass("search-open"),this.hideSearchResults(),setTimeout(function(a){return function(){return a.$searchInput.blur().val(""),"function"==typeof b?b():void 0}}(this),400)),null},b.prototype.onSearchInputKey=function(a){return 27===a.keyCode?this.toggleSearchInput(!1):(this.searchFriends(this.$searchInput.val().toLowerCase().replace("@","")),null)},b.prototype.searchFriends=function(a){var b,c;return a===this.previousQuery?!1:a?(this.previousQuery=a,c=this.fuse.search(a),b=this.getNonFriendHandle(a),c.length?this.showSearchResults(c,b):b?this.showSearchResults([],b):this.showNoResultsMsg(),null):this.hideSearchResults()},b.prototype.getNonFriendHandle=function(a){return"fb"!==this.service&&!this.friendCollection.findWhere({username:a})&&a.match(/^[a-z0-9_]+$/i)?a:!1},b.prototype.showSearchResults=function(a,b){var c,d,e,f,g;for(this.$searchResultsWrap.addClass("is-searching"),this.$searchResults.empty(),e=0,b&&(e++,this.showNonFriendSearch(b)),c=g=0;10>g;c=++g)d=a[c],d&&(e++,f=this.friendCollection.findWhere({id:d}),this.addFriend(f,"search"));return this.refreshScroller(this.scrollerSearch),this.scrollerSearch.scrollTo(0,0),null},b.prototype.showNonFriendSearch=function(a){var b;return b=new lb({username:a,nonFriend:!0}),this.addFriend(b,"search"),null},b.prototype.showNoResultsMsg=function(){return this.$searchResultsWrap.addClass("is-searching"),this.$searchResults.empty(),null},b.prototype.hideSearchResults=function(){return this.$searchResultsWrap.removeClass("is-searching"),this.previousQuery=null,setTimeout(function(a){return function(){return a.onhideSearchResultsComplete()}}(this),300),null},b.prototype.onhideSearchResultsComplete=function(){return this.$searchResults.empty(),null},b.prototype.loadNonFriend=function(a){var b,c;return a.addClass("loading"),b=new lb({username:a.attr("data-username"),service:this.service}),c=b._getProfile(!1),c.done(function(c){return function(){return b.isProtected()?(c.protectedModal&&c.protectedModal.close(),c.protectedModal=new rb(b,a),a.removeClass("loading"),a.addClass("protected"),a.find(".friend-avatar").css({"background-image":"url("+b.get("avatar")+")"}),void 0):c.userLoadDone(b,a)}}(this)),c.fail(function(b){return function(){return b.userLoadFail(a)}}(this)),null},b.prototype.userLoadDone=function(a,b){var c;return a.set("score",{total:"",judgement:""}),a.setInfo(a.get("data.userProfile")),c=new ob(a),b.replaceWith(c.$el),this.loadFriendAvatar(c.$el,a.get("avatar")),this.friendCollection.add(a,{at:this.friendsVisible}),this.addFriends({count:1,animateIn:!1,animateScroll:!1}),a.getAllData(),null},b.prototype.userLoadFail=function(a){var b;return a.removeClass("loading"),b=function(){switch(this.service){case"tw":return"Twitter";case"ig":return"Instagram"}}.call(this),this.showSearchError(this.axe().locale.get("friends_search_error").replace("{{ service }}",b)),null},b.prototype.showSearchError=function(a){return this.originalSearchLabel=this.originalSearchLabel||this.$searchLabel.html(),TweenLite.to(this.$searchLabel,.3,{opacity:"0",onComplete:function(b){return function(){return b.$searchLabel.addClass("error").html(a),TweenLite.to(b.$searchLabel,.3,{opacity:"1",onComplete:b.hideSearchError})}}(this)}),null},b.prototype.hideSearchError=function(){return TweenLite.to(this.$searchLabel,.3,{delay:3,opacity:"0",onComplete:function(a){return function(){return a.$searchLabel.removeClass("error").html(a.originalSearchLabel),TweenLite.to(a.$searchLabel,.3,{opacity:"1"})}}(this)}),null},b}(g),qb=function(a){function b(a,c){this.model=a,this.friendEl=c,this.onKeyUp=Vd(this.onKeyUp,this),this.setPositionByElement=Vd(this.setPositionByElement,this),this.close=Vd(this.close,this),this.animateOut=Vd(this.animateOut,this),this.animateIn=Vd(this.animateIn,this),this.setListeners=Vd(this.setListeners,this),this.populateVars=Vd(this.populateVars,this),this.init=Vd(this.init,this),this.populateVars(),b.__super__.constructor.call(this),this.axe().appView.addChild(this),this.setPosition&&this.setPositionByElement()}return Ud(b,a),b.prototype.template="friend-selector-protected-modal",b.prototype.setPosition=!0,b.prototype.events={"click .close":"close"},b.prototype.init=function(){return this.setListeners("on"),this.animateIn(),null},b.prototype.populateVars=function(){var a;return a=function(){switch(this.model.get("service")){case"tw":return"twitter";case"fb":return"facebook";case"ig":return"instagram"}}.call(this),this.templateVars={usernameLink:Pc.getUsernameLink(a,{user:this.model.get("data.userProfile")}),avatar:this.model.get("avatar"),back_txt:this.axe().locale.get("friends_selector_mobile_back_btn_txt"),message:this.axe().locale.get("friends_selector_protected_user_message")}},b.prototype.setListeners=function(a){return $(window)[a]("keyup",this.onKeyUp),null},b.prototype.animateIn=function(){return TweenLite.to(this.$el,.3,{visibility:"visible",opacity:1,ease:Quad.easeOut}),TweenLite.to(this.$el.find(".inner"),.3,{delay:.15,transform:"scale(1)",visibility:"visible",opacity:1,ease:Back.easeOut}),null},b.prototype.animateOut=function(a){return TweenLite.to(this.$el,.3,{delay:.15,opacity:0,ease:Quad.easeOut,onComplete:a}),TweenLite.to(this.$el.find(".inner"),.3,{transform:"scale(0.8)",opacity:0,ease:Back.easeIn}),null},b.prototype.close=function(){return this.setListeners("off"),this.animateOut(function(a){return function(){return a.axe().appView.remove(a),a.onClose?a.onClose():void 0}}(this))},b.prototype.setPositionByElement=function(a){var b,c,d,e;return null==a&&(a=this.friendEl),c=a.offset(),b=a.outerWidth(),d=c.left+b/2,e=c.top-30-this.$el.outerHeight(),this.$el.css({top:e,left:d})},b.prototype.onKeyUp=function(a){return 27===a.keyCode&&this.close(),null},b}(g),rb=function(a){function b(a,c){this.model=a,this.friendEl=c,this.init=Vd(this.init,this),b.__super__.constructor.call(this,this.model,this.friendEl)}return Ud(b,a),b.prototype.template="friend-selector-protected-mobile-modal",b.prototype.setPosition=!1,b.prototype.init=function(){return this.setListeners("on"),this.animateIn(),null},b}(qb),Db=function(a){function b(a,c,d){return this.graphContainer=a,this.service=c,this.activeGraph=d,this.mute=Vd(this.mute,this),this.unMute=Vd(this.unMute,this),this.showFriendSelector=Vd(this.showFriendSelector,this),this.refreshData=Vd(this.refreshData,this),this.setListeners=Vd(this.setListeners,this),this.addLegend=Vd(this.addLegend,this),this.addFriendBtn=Vd(this.addFriendBtn,this),this.init=Vd(this.init,this),this.HAS_TOGGLE="fb"===this.service?!1:!0,this.userData=this.axe().appData.USER,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="graph-controls",b.prototype.graphContainer=null,b.prototype.activeGraph=null,b.prototype.service=null,b.prototype.userData=null,b.prototype.$friendBtn=null,b.prototype.$refreshBtn=null,b.prototype.shareControls=null,b.prototype.listening=null,b.prototype.HAS_TOGGLE=null,b.prototype.init=function(){return this.shareControls=new Xc(this.service),this.addChild(this.shareControls),this.HAS_TOGGLE&&(this.toggle=new Ob(this.activeGraph),this.addChild(this.toggle)),this.axe().IS_MOBILE?(this.addFriendBtn(),this.addLegend()):this.$refreshBtn=this.$el.find("[data-refresh]"),null},b.prototype.addFriendBtn=function(){return this.$friendBtn=$('<span class="friend-btn"></span>'),this.addChild(this.$friendBtn),null},b.prototype.addLegend=function(){var a,b;return a={graph_label_tth:this.axe().locale.get("graph_label_tth"),graph_label_el:this.axe().locale.get("graph_label_effortless"),graph_label_nth:this.axe().locale.get("graph_label_nthe")},b=_.template(this.axe().templates.get("graph-line-legend")),this.addChild($(b(a))),null},b.prototype.setListeners=function(a){return this.listening!==a?(this.listening=a,this.axe().IS_MOBILE?this.$friendBtn[a]("click",this.showFriendSelector):this.$refreshBtn[a]("click",this.refreshData),this.shareControls.setListeners(a),null):void 0},b.prototype.refreshData=function(){return this.userData.getAllData(this.service),null},b.prototype.showFriendSelector=function(){return this.graphContainer.friendSelector.open(),null},b.prototype.unMute=function(){return this.setListeners("on"),null},b.prototype.mute=function(){return this.setListeners("off"),null},b}(g),Eb=function(a){function b(a){return this.service=a,this.getShareableData=Vd(this.getShareableData,this),this.getShareableImage=Vd(this.getShareableImage,this),this.onLoggedUpdate=Vd(this.onLoggedUpdate,this),this.scoreDataAvailable=Vd(this.scoreDataAvailable,this),this.getLogged=Vd(this.getLogged,this),this.unMute=Vd(this.unMute,this),this.mute=Vd(this.mute,this),this.updateClickableArea=Vd(this.updateClickableArea,this),this.initClickableArea=Vd(this.initClickableArea,this),this.onMouseEvent=Vd(this.onMouseEvent,this),this.onLineActiveChange=Vd(this.onLineActiveChange,this),this.removeSingleSet=Vd(this.removeSingleSet,this),this.addNewSingleSet=Vd(this.addNewSingleSet,this),this.hideTweetInfo=Vd(this.hideTweetInfo,this),this.showTweetInfo=Vd(this.showTweetInfo,this),this.setInitDims=Vd(this.setInitDims,this),this.__onResize=Vd(this.__onResize,this),this.onResize=Vd(this.onResize,this),this.drawBgRanges=Vd(this.drawBgRanges,this),this.initBgRanges=Vd(this.initBgRanges,this),this.drawLegend=Vd(this.drawLegend,this),this.initLegend=Vd(this.initLegend,this),this.calculateYPosition=Vd(this.calculateYPosition,this),this.calculateDotPosition=Vd(this.calculateDotPosition,this),this.drawMainGridLine=Vd(this.drawMainGridLine,this),this.initMainGridLine=Vd(this.initMainGridLine,this),this.drawGridLine=Vd(this.drawGridLine,this),this.animateOut=Vd(this.animateOut,this),this.animateIn=Vd(this.animateIn,this),this.loadUserData=Vd(this.loadUserData,this),this.buildGraph=Vd(this.buildGraph,this),this.onScoreUpdate=Vd(this.onScoreUpdate,this),this.setListeners=Vd(this.setListeners,this),this.initLineGraph=Vd(this.initLineGraph,this),this.setup=Vd(this.setup,this),this.updateScene=Vd(this.updateScene,this),this.userModel=this.axe().appData.USER.model,this.sets=[],this.comparisonCollection=new U,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.GRAPH_TYPE="linegraph",b.prototype.className="graph line-graph",b.prototype.legendWidth=55*(window.devicePixelRatio||1),b.plotMargin=50*(window.devicePixelRatio||1),b.prototype.datasetLength=100,b.prototype.updatable=!1,b.prototype.GRAPH_BUILT=!1,b.prototype.maxSize=[1140,478],b.prototype.shareableSize=[800,564],b.bgRanges=[{color:16309983,lineBgColor:16042444,lineColor:15038849,range:[200,500],dotColor:15038849},{color:15460078,lineBgColor:14735076,lineColor:12032444,range:[-200,200],dotColor:12032444},{color:14808571,lineBgColor:13758457,lineColor:9623279,range:[-200,-500],dotColor:9623279}],b.prototype.mainLineColors={tryingTooHard:{lineColor:createjs.Graphics.getRGB(15038849),pointerColor:15038849},effortless:{lineColor:createjs.Graphics.getRGB(9397405),pointerColor:9397405},notHardEnough:{lineColor:createjs.Graphics.getRGB(7652828),pointerColor:7652828}},b.prototype.legendLabels=[{label:"+500",value:500,color:13909567},{label:"+200",value:200,color:8940956},{label:"0",value:0,color:8940956},{label:"-200",value:-200,color:8940956},{label:"-500",value:-500,color:10475753}],b.prototype.gridLines=[{value:167,color:15194843},{value:-167,color:14542056}],b.prototype.mobileMargins={landscape:{top:0,bottom:76},portrait:{top:40,bottom:176}},b.prototype.updateScene=function(){return this.scene?this.scene.update():void 0},b.prototype.setup=function(){var a;return this._onResize=_.debounce(this.__onResize,20),this.devicePixelRatio=window.devicePixelRatio||1,this.userModel=this.axe().appData.USER.model,this.muted=!1,a=this.canvas.get(0),this.setInitDims(),a.width=this.innerSize[0],a.height=this.innerSize[1],this.initGraph(this.innerSize[0],this.innerSize[1]),this.scene.stage.enableMouseOver(),null},b.prototype.initLineGraph=function(){return this.initialized?void 0:(this.initialized=!0,this.initBgRanges(),this.initMainGridLine(),this.pointer=new Ib(this.innerSize[1]),this.pointer.animUpdateCallback=this.updateScene,this.shapesContainer=new createjs.Container,this.scene.stage.addChild(this.shapesContainer),this.comparisonCollection.on("activated",this.addNewSingleSet,this),this.comparisonCollection.on("deactivated",this.removeSingleSet,this),this.onScoreUpdate())},b.prototype.setListeners=function(a){return this.axe().appView[a]("updateDims",this.onResize)},b.prototype.onScoreUpdate=function(){var a;if(this.initialized)return this.scoreDataAvailable()&&((null!=(a=this.info)?a.opened:void 0)&&this.hideTweetInfo(),this.loadUserData(),this.buildGraph()),null},b.prototype.buildGraph=function(){var a;return this.clickableArea&&this.scene.stage.removeChild(this.clickableArea),this.initClickableArea(),this.GRAPH_BUILT?void 0:(this.GRAPH_BUILT=!0,this.initLegend(),this.scene.stage.addChild(this.pointer.container),this.info=new Lb,this.addChild(this.info),this.info.onUpdate=this.updateScene,this.info.on("beforeClose",function(a){return function(b){var c,d;return c=.3,d=Power4.easeOutQuad,b.to([a.shapesContainer,a.clickableArea,a.pointer.container],c,{scaleX:1,x:0,ease:d},"main"),b.to([a.pointer.dot,a.pointer.line],c,{scaleX:1,ease:d},"main"),b.to(a.legend,c,{css:{left:"0"},ease:d},"main"),a.axe().IS_MOBILE?b.to(a.axe().appView.wrapper.dashboard.mainGraphsModule.viz._tw.friendSelector.$fixedWrapper.get(0),c,{css:{width:"100%",left:"0",paddingLeft:"20px"},ease:d},"main"):void 0}}(this)),this.addChild(this.scene.canvasEl),a=_.template(this.axe().templates.get("graph-line-legend")),this.legend=$(a({graph_label_tth:this.axe().locale.get("graph_label_tth"),graph_label_el:this.axe().locale.get("graph_label_effortless"),graph_label_nth:this.axe().locale.get("graph_label_nthe")})),this.addChild(this.legend),this.render(),null)},b.prototype.loadUserData=function(a){var b;if(this.initialized)return a=a||this.userModel.get("scores."+this.service+".postsData.posts"),b=this.userModel.get("scores."+this.service+".judgement"),this.mainSet?(this.mainSet.model.set(this.axe().appData.USER.model.get("info."+this.service)),this.mainLine.setColors(this.mainLineColors[b],!1),void 0):(this.mainLine=new Jb(a,this.plotSize,!0,this.pointer,!0),this.mainLine.setColors(this.mainLineColors[b]),this.mainLine.animUpdateCallback=this.updateScene,this.pointer.setColor(this.mainLine.colors.pointerColor),this.pointer.index=this.mainLine.emptyOffset+this.mainLine.data.length-1,this.pointer.setPath(this.mainLine.getPointerPath(),this.mainLine.emptyOffset),this.mainSet={line:this.mainLine,model:new Hb(this.userModel.get("info."+this.service))},this.sets.push(this.mainSet),this.mainLine.on("active:change",this.onLineActiveChange),this.shapesContainer.addChild(this.mainLine.container))},b.prototype.animateIn=function(){var a,b,c,d,e;if(this.axe().IS_MOBILE&&(null!=(d=this.info)?d.opened:void 0)&&this.info.postData&&TweenLite.to(this.axe().appView.wrapper.dashboard.mainGraphsModule.viz._tw.friendSelector.$fixedWrapper.get(0),.5,{css:{width:"75%",left:"25%",paddingLeft:"20px"},ease:Power4.easeOutQuad}),!this.haveShownAnimation){for(this.initLineGraph(),e=this.sets,b=0,c=e.length;c>b;b++)a=e[b],a.line.playAnim(!this.haveShownAnimation&&a===this.mainLine);return this.haveShownAnimation=!0,null}},b.prototype.animateOut=function(){return this.axe().appView.wrapper.dashboard.mainGraphsModule.viz._tw.friendSelector.$fixedWrapper.removeAttr("style")},b.prototype.drawGridLine=function(a,b){var c;return c=this.gridShape.graphics,c.clear(),c.beginStroke(createjs.Graphics.getRGB(b)),c.setStrokeStyle(this.devicePixelRatio),c.moveTo(.5,this.calculateYPosition(a)),c.lineTo(this.innerSize[0]-.5,this.calculateYPosition(a)),c.endStroke()
},b.prototype.initMainGridLine=function(){return this.gridShape=new createjs.Shape,this.gridShape.snapToPixel=!0,this.scene.stage.addChild(this.gridShape),this.drawMainGridLine()},b.prototype.drawMainGridLine=function(){return this.gridShape.graphics.clear(),this.drawGridLine(.5,10789286)},b.prototype.calculateDotPosition=function(a,b){return null==b&&(b=0),{x:Math.round(this.plotSize[0]/this.datasetLength*b),y:Math.round(this.calculateYPosition(a))}},b.prototype.calculateYPosition=function(a){return Math.round(b.plotMargin+this.plotSize[1]-(500+a)/1e3*this.plotSize[1])-.5},b.prototype.initLegend=function(){return this.legendContainer=new cjs.Container,this.drawLegend(),this.scene.stage.addChild(this.legendContainer)},b.prototype.drawLegend=function(){var a,b,c,d,e;if(this.legendContainer){for(this.legendContainer.removeAllChildren(),e=this.legendLabels,c=0,d=e.length;d>c;c++)a=e[c],b=new createjs.Text(a.label,""+12*this.devicePixelRatio+"px Arial","#"+a.color.toString(16)),b.textAlign="right",b.y=this.calculateYPosition(a.value)-8*this.devicePixelRatio,b.lineWidth=this.legendWidth-15*this.devicePixelRatio,this.legendContainer.addChild(b);return this.legendContainer.x=this.innerSize[0]-15*this.devicePixelRatio}},b.prototype.initBgRanges=function(){return this.rangesShape=new createjs.Shape,this.scene.stage.addChild(this.rangesShape),this.drawBgRanges()},b.prototype.drawBgRanges=function(){var a;return a=this.rangesShape.graphics,a.clear(),_.each(b.bgRanges,function(c){return function(d,e){var f,g;return g=c.calculateDotPosition(d.range[0]),f=c.calculateDotPosition(d.range[1]),a.beginFill(createjs.Graphics.getRGB(d.color)),a.drawRect(g.x,g.y,c.innerSize[0],f.y-g.y-(0===e?b.plotMargin:0)+(e===b.bgRanges.length-1?b.plotMargin:0)),a.endFill()}}(this))},b.prototype.onResize=function(a){return this.muted||this._onResize(!1,a),null},b.prototype.__onResize=function(a,c){var d,e,f,g,h,i,j,k;if(null==a&&(a=!1),null==c&&(c=null),c&&"portrait"===c.o&&null!=(j=this.info)&&j.hide(),a===!0)this.innerSize=_.clone(this.shareableSize),this.info&&this.info.opened&&this.info.postData&&(this.innerSize[0]-=220),this.sets.length>1&&(this.innerSize[1]-=96),this.devicePixelRatio=1;else if(this.devicePixelRatio=window.devicePixelRatio||1,this.axe().IS_MOBILE){if(f=_.clone(this.innerSize),e=window.innerWidth*this.devicePixelRatio,this.innerSize[0]=e,this.innerSize[1]=window.innerWidth<window.innerHeight?window.innerHeight-this.mobileMargins.portrait.top-this.mobileMargins.portrait.bottom:window.innerHeight-this.mobileMargins.landscape.top-this.mobileMargins.landscape.bottom,this.innerSize[1]<200&&(this.innerSize[1]=200),this.innerSize[1]*=this.devicePixelRatio,e===f[0]&&this.innerSize[1]===f[1])return}else{if(e=$("body").width()>1024?this.maxSize[0]:1024,e===this.innerSize[0])return;this.innerSize[0]=e*this.devicePixelRatio,this.innerSize[1]=478*this.devicePixelRatio}if(b.plotMargin=.08*this.innerSize[1],this.legendWidth=55*this.devicePixelRatio,this.plotSize=[this.innerSize[0]-this.legendWidth,this.innerSize[1]-2*b.plotMargin],d=this.scene.canvasEl,d.width=this.innerSize[0],d.height=this.innerSize[1],this.initialized){for(this.drawBgRanges(),this.drawMainGridLine(),this.updateClickableArea(),this.drawLegend(),k=this.sets,h=0,i=k.length;i>h;h++)g=k[h],g.line.resize(this.plotSize,this.devicePixelRatio);return this.pointer.resize(this.innerSize[1],this.devicePixelRatio),!a&&this.info?setTimeout(function(a){return function(){var b,c;return a.info.onResize(),a.info.opened&&a.info.postData?(c=a.info.$el.outerWidth(),b=(a.plotSize[0]-c*a.devicePixelRatio)/a.plotSize[0],_.each([a.shapesContainer,a.clickableArea,a.pointer.container],function(a){return a.scaleX=b,a.x=c*this.devicePixelRatio}),_.each([a.pointer.dot,a.pointer.line],function(a){return a.scaleX=1/b})):void 0}}(this),0):a&&(_.each([this.shapesContainer,this.clickableArea,this.pointer.container],function(a){return a.scaleX=1,a.x=0}),_.each([this.pointer.dot,this.pointer.line],function(a){return a.scaleX=1})),this.updateScene(),null}},b.prototype.setInitDims=function(){var a;return this.devicePixelRatio=window.devicePixelRatio||1,this.innerSize=_.clone(this.maxSize),this.axe().IS_MOBILE?(this.innerSize[0]=window.innerWidth*this.devicePixelRatio,this.innerSize[1]=window.innerWidth<window.innerHeight?window.innerHeight-this.mobileMargins.portrait.top-this.mobileMargins.portrait.bottom:window.innerHeight-this.mobileMargins.landscape.top-this.mobileMargins.landscape.bottom,this.innerSize[1]<200&&(this.innerSize[1]=200),this.innerSize[1]*=this.devicePixelRatio):(a=$("body").width()>1024?this.maxSize[0]:1024,this.innerSize[0]=a*this.devicePixelRatio,this.innerSize[1]=478*this.devicePixelRatio),b.plotMargin=.08*this.innerSize[1]*this.devicePixelRatio,this.plotSize=[this.innerSize[0]-this.legendWidth,this.innerSize[1]-2*b.plotMargin]},b.prototype.showTweetInfo=function(a){var b,c;return c=this.info.$el.outerWidth(),b=(this.plotSize[0]-c*this.devicePixelRatio)/this.plotSize[0],this.info.setContent(a,!0),this.info.show(function(a){return function(d){var e,f;return e=.3,f=Power4.easeOutQuad,d.to([a.shapesContainer,a.clickableArea,a.pointer.container],e,{scaleX:b,x:c*a.devicePixelRatio,ease:f},"main"),d.to([a.pointer.dot,a.pointer.line],e,{scaleX:1/b,ease:f},"main"),d.to(a.legend,e,{css:{left:"25%"},ease:f},"main"),a.axe().IS_MOBILE?d.to(a.axe().appView.wrapper.dashboard.mainGraphsModule.viz._tw.friendSelector.$fixedWrapper.get(0),e,{css:{width:"75%",left:"25%",paddingLeft:"20px"},ease:f},"main"):void 0}}(this))},b.prototype.hideTweetInfo=function(){return this.info?this.info.hide():void 0},b.prototype.addNewSingleSet=function(a,b){var c;return this.info.hide(),c=new Jb(a.get("data"),this.plotSize,!1,this.pointer),c.setColors(b),c.animUpdateCallback=this.updateScene,c.playAnim(),c.on("active:change",this.onLineActiveChange),this.shapesContainer.addChild(c.container),this.sets.push({line:c,model:a})},b.prototype.removeSingleSet=function(a){var b,c;return this.info.hide(),c=_.find(this.sets,function(){return function(b){return b.model===a}}(this)),c?(c.line.active&&this.sets[0].line.setActive(!0),TweenLite.to(c.line.container,.5,{alpha:0,ease:Power2.easeInOut,onComplete:function(a){return function(){return a.shapesContainer.removeChild(c.line.container)}}(this),onUpdate:this.updateScene}),b=this.sets.indexOf(c),this.sets.splice(b,1),this.comparisonCollection.remove(a)):void 0},b.prototype.onLineActiveChange=function(a){return this.info.hide(),_.each(this.sets,function(b){return function(c){return a!==c.line?(c.line.setActive(!1),b.shapesContainer.setChildIndex(c.line,4)):void 0}}(this)),this.shapesContainer.setChildIndex(a,5)},b.prototype.onMouseEvent=function(a){var b,c,d,e;return"portrait"===this.axe().appView.dims.o&&this.axe().appView.dims.w<768?(this.axe().appView.showOrientationOverlay(function(a){return function(){return a.axe().appView.header.hideByScroll()}}(this)),void 0):(e=(a.rawX-this.clickableArea.x)/this.clickableArea.scaleX,d=Math.round(e/(this.plotSize[0]/100)),d!==this.pointer.index?(b=_.find(this.sets,function(a){return a.line.active}).line,d<b.emptyOffset&&(d=b.emptyOffset),d>=100&&(d=99),c=d-100+b.data.length,this.showTweetInfo(b.data[c]),this.pointer.animateTo(d)):void 0)},b.prototype.initClickableArea=function(){return this.clickableArea=new createjs.Shape,this.clickableArea.y=b.plotMargin,this.clickableHitArea=new createjs.Shape,this.updateClickableArea(),this.clickableArea.hitArea=this.clickableHitArea,this.clickableArea.addEventListener("click",_.debounce(this.onMouseEvent,20)),this.clickableArea.addEventListener("pressmove",_.debounce(this.onMouseEvent,20)),this.scene.stage.addChild(this.clickableArea)},b.prototype.updateClickableArea=function(){return this.clickableHitArea?(this.clickableArea.y=b.plotMargin,this.clickableHitArea.graphics.clear().beginFill(createjs.Graphics.getRGB(0)).drawRect(0,0,this.plotSize[0],this.plotSize[1])):void 0},b.prototype.mute=function(){return this.muted=!0,this.setListeners("off")},b.prototype.unMute=function(){return this.muted=!1,this.setListeners("on"),this.updateScene()},b.prototype.getLogged=function(){return this.userModel.get("logged."+this.service)},b.prototype.scoreDataAvailable=function(){return this.userModel.get("scores."+this.service+".judgement")},b.prototype.onLoggedUpdate=function(){var a;return a=this.getLogged(),a?void 0:(this.$el.hide(),this.mute())},b.prototype.getShareableImage=function(){var a,b,c,d,e,f,g,h,i,j,k,l;if(g=document.createElement("img"),g.width=this.innerSize[0],g.height=this.innerSize[1],g.className="tmpImg",a=this.$el.find("canvas"),g.src=a.get(0).toDataURL("image/png"),b=$(g).insertAfter(a),a.detach(),d=[],this.sets.length>2)for(l=this.sets,h=0,j=l.length;j>h;h++)f=l[h],f.line.active||f.line===this.mainLine||(d.push(f.line),f.line.container.alpha=0);for(this.__onResize(!0),c=a.get(0).toDataURL("image/png"),i=0,k=d.length;k>i;i++)e=d[i],e.container.alpha=e.disabledAlpha;return this.__onResize(),a.insertAfter(b),b.remove(),c},b.prototype.getShareableData=function(){var a,b,c,d,e,f;return c=$.Deferred(),e=this.axe().appData.USER.model,d=e.get("info."+this.service),f=e.get("scores"),b={image:this.getShareableImage(),imageDisplayType:_c.ImageDisplayType.Single,useImageMargins:!1,loggedUser:{name:d.name,username:d.username,scores:{total:f.total.score,tw:Math.round(f.tw.total),fb:Math.round(f.fb.total),ig:Math.round(f.ig.total)},border:this.mainLine.colors.lineColor,avatar:d.avatar},legend:null},this.info.opened&&this.info.postData&&(b.post=$.extend({},this.info.postData)),this.sets.length>1&&(a=_.find(this.sets,function(a){return function(b){return b.line.active&&b.line!==a.mainLine}}(this)),a&&(b.comparedUser={id:a.model.get("user").id,name:a.model.get("user").name,username:a.model.get("user").username,scores:{total:parseInt(a.model.get("user").score.total),tw:null,fb:null,ig:null},border:a.line.colors.lineColor,avatar:a.model.get("user").avatar},b.comparedUser.scores[this.service]=b.comparedUser.scores.total)),c.resolve(b),c},b}(b),Kb=function(a){function b(a){return this.service=a.service,this.visit=a.visit,this.templateVars={service:this.service},"initial"===this.visit?(this.templateVars.btn_text=this.axe().locale.get("login_"+this.service),this.templateVars.placeholder_text=this.axe().locale.get("graph_"+this.service+"_placeholder")):(this.templateVars.btn_text=this.axe().locale.get("login_"+this.service+"_returning"),this.templateVars.placeholder_text=this.axe().locale.get("graph_"+this.service+"_placeholder_returning")),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="graph-placeholder",b}(g),Lb=function(a){function b(){return this.onModalShowComplete=Vd(this.onModalShowComplete,this),this.listenForShow=Vd(this.listenForShow,this),this.share=Vd(this.share,this),this.onShareClick=Vd(this.onShareClick,this),this.onResize=Vd(this.onResize,this),this.openMediaModal=Vd(this.openMediaModal,this),this.setupListeners=Vd(this.setupListeners,this),this.loadImage=Vd(this.loadImage,this),this.close=Vd(this.close,this),this.render=Vd(this.render,this),this.hide=Vd(this.hide,this),this.show=Vd(this.show,this),this.setContent=Vd(this.setContent,this),this.initialize=Vd(this.initialize,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.className="graph-post",b.prototype.opened=!1,b.prototype.fadeIn=!1,b.prototype.events={"click [data-close-btn]":"close","click [data-share]":"onShareClick"},b.prototype.initialize=function(){return b.__super__.initialize.call(this),this.template="graph-info"},b.prototype.setContent=function(a,b){var c,d,e,f,g,h;return this.fadeIn=null!=b?b:!1,a!==this.postData?this.postData?(this.postData=null,TweenLite.to(this.$el.find("[data-postinfo]"),.15,{opacity:0,ease:Cubic.easeInOut,onComplete:function(b){return function(){return b.setContent(a,!0)}}(this)}),void 0):(this.postData=a,e=Modernizr.svg?"svg":"jpg",h=this.postData.type,this.service=f=function(){switch(!0){case"twitter"===h:return"tw";case"facebook"===h:return"fb";case"instagram"===h:return"ig"}}(),d=$.extend({},this.postData),"tw"===f?(g=d.user.screen_name.toLowerCase()===this.axe().appData.USER.model.get("info."+f+".username").toLowerCase()?!1:!0,c=d.user.profile_image_url):"ig"===f?(g=d.user.username.toLowerCase()===this.axe().appData.USER.model.get("info."+f+".username").toLowerCase()?!1:!0,c=d.user.profile_picture):(g=!1,c=""),this.templateVars=_.extend(d,{graph_label_tth:this.axe().locale.get("graph_label_tth"),graph_label_el:this.axe().locale.get("graph_label_effortless"),graph_label_nth:this.axe().locale.get("graph_label_nthe"),txt_share:this.axe().locale.get("graph_post_share"),nameLink:Pc.getNameLink(h,d),usernameLink:Pc.getUsernameLink(h,d),dateLink:Pc.getDateLink(h,d),text:Pc.getRichText(h,d.text),logoSRC:this.axe().locale.getLocaleImage("logo_AME."+e),logoURL:this.axe().locale.get("home_tips_cta_url"),logoLabel:this.axe().locale.get("graph_logo_label"),showUser:g,avatar:c,shareable:!0,fadeIn:this.fadeIn}),this.render()):void 0},b.prototype.show=function(a){var b;if(!this.opened)return this.render(),this.opened=!0,b=new TimelineLite({paused:!0,onUpdate:function(a){return function(){return a.onUpdate?a.onUpdate():void 0}}(this)}),b.to(this.el,.3,{css:{left:0},ease:Power4.easeOutQuad},"main"),a&&a(b),b.play()},b.prototype.hide=function(){var a,b;return this.opened=!1,b=this.$el.outerWidth(),a=new TimelineLite({paused:!0,onUpdate:function(a){return function(){return a.onUpdate?a.onUpdate():void 0}}(this)}),a.to(this.el,.3,{css:{left:"-25%"},ease:Power4.easeOutQuad},"main"),this.trigger("beforeClose",a),a.play()},b.prototype.render=function(){var a,b;if(this.postData)return a=this.$el.parent(),this.$el.remove(),b=_.template(this.axe().templates.get(this.template)),this.setElement(b(this.templateVars)),a.append(this.$el),this.$el.addClass(this.className).css("left",this.opened?0:"").attr("data-judgement",this.templateVars.judgement),this.axe().IS_MOBILE&&this.$el.css("height",window.innerHeight),this.fadeIn?TweenLite.to(this.$el.find("[data-postinfo]"),.15,{opacity:1,ease:Cubic.easeInOut,onComplete:this.loadImage}):this.loadImage(),null},b.prototype.close=function(){return this.opened?(this.setupListeners("off"),this.hide()):void 0},b.prototype.loadImage=function(){var a,b;return(b=this.postData.photo)?(this.imageHolder=this.$el.find("[data-image-holder]"),a=new Image,a.onload=a.onerror=a.onabort=function(a){return function(){return a.imageHolder.addClass("image-loaded"),a.setupListeners("on")}}(this),a.src=b,null):void 0},b.prototype.setupListeners=function(a){var b;return null!=(b=this.imageHolder)?b[a]("click",this.openMediaModal):void 0},b.prototype.openMediaModal=function(){return this.axe().appView.postMediaModal?void 0:this.axe().appView.postMediaModal=new Oc(this.postData)},b.prototype.onResize=function(){return this.postData?(this.opened||this.$el.css({left:"-25%"}),this.axe().IS_MOBILE?this.$el.css("height",window.innerHeight):void 0):void 0},b.prototype.onShareClick=function(a){return this.$shareBtn=$(a.currentTarget),this.$shareBtn.addClass("loading"),this.share(),this.listenForShow(),null},b.prototype.share=function(){return this.axe().appView.shareModal=new Zc({service:this.service,shareTo:this.service,postData:this.postData}),null},b.prototype.listenForShow=function(){return this.axe().appView.shareModal.on("onShowComplete",this.onModalShowComplete),null},b.prototype.onModalShowComplete=function(){return this.$shareBtn.removeClass("loading"),this.axe().appView.shareModal.off("onShowComplete",this.onModalShowComplete),null},b}(g),Nb=function(a){function b(){return this.resize=Vd(this.resize,this),this.onSpiroServiceSelectorChange=Vd(this.onSpiroServiceSelectorChange,this),this.showOrientationMessage=Vd(this.showOrientationMessage,this),this.updateUI=Vd(this.updateUI,this),this.onPostChange=Vd(this.onPostChange,this),this.onPostsManagerPostTransitionInEnded=Vd(this.onPostsManagerPostTransitionInEnded,this),this.onPostsManagerCompleteIntroAnimation=Vd(this.onPostsManagerCompleteIntroAnimation,this),this.onPostsManagerUpdateIntroAnimation=Vd(this.onPostsManagerUpdateIntroAnimation,this),this.initEmptyCircle=Vd(this.initEmptyCircle,this),this.initPostsManager=Vd(this.initPostsManager,this),this.reload=Vd(this.reload,this),this.setup=Vd(this.setup,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.colour=15793935,b.prototype.currentService="",b.prototype.postsManager=null,b.prototype.scoreManager=null,b.prototype.linksManager=null,b.prototype.classificationsData=null,b.prototype.classificationNames=null,b.prototype.classificationsManager=null,b.prototype.dotsContainer=null,b.prototype.emptyCircle=null,b.prototype.logoUsernameContainer=null,b.prototype.logo=null,b.prototype.usernameTxt=null,b.prototype.twitterImgPreloaded=null,b.prototype.facebookImgPreloaded=null,b.prototype.instagramImgPreloaded=null,b.prototype.setup=function(){return this.$el.addClass("spirograph"),this.initGraph(580,490),this.el.appendChild(this.scene.canvasEl),this.render(),this.firstInit(),this.resize(),null},b.prototype.firstInit=function(){return this.axe().appData.USER.model.get("scores.tw.judgement")?this.currentService="tw":this.axe().appData.USER.model.get("scores.fb.judgement")?this.currentService="fb":this.axe().appData.USER.model.get("scores.ig.judgement")&&(this.currentService="tw"),this.postsData=this.getPostsDataForService(this.currentService),this.classificationNames=this.getClassificationsNameForService(this.currentService),this.initComposants(),null},b.prototype.initComposants=function(){return this.postsData?(this.initPostsManager(this.postsData,this.scene,this.currentService),this.initDraggerMarkLimits(),this.initEmptyCircle(),this.initDots(),this.initScoreManager(),this.initClassificationsManager(),this.initLinksManager(),this.preloadLogo(),this.update(),null):void 0},b.prototype.reload=function(a,b){return null==b&&(b=!0),this.currentService=a,this.postsData=this.getPostsDataForService(this.currentService),this.classificationNames=this.getClassificationsNameForService(this.currentService),this.initComposants(),b&&this.transitionIn(),null},b.prototype.initDots=function(){var a,b,c,d,e,f,g;for(this.dotsContainer=new createjs.Container,a=1,b=40,d=g=0;281>g;d=++g)e=215*Math.cos(b*(Math.PI/180))+this.scene.width/2,f=215*Math.sin(b*(Math.PI/180))+this.scene.height/2,c=new createjs.Shape,c.graphics.beginFill("a4a4a4"),c.graphics.drawCircle(e,f,1),this.dotsContainer.addChild(c),b+=a;return this.dotsContainer.cache(68,25,440,440),this.scene.addChild(this.dotsContainer),null},b.prototype.initPostsManager=function(a){var b,c,d,e,f,g,h;for(this.postsManager&&this.reset(),d=[],g=0,h=a.length;h>g;g++)c=a[g],e=null,f={},void 0!==c.source?(e=c.source,b=c.source.twitter,f.screen_name=c.user.screen_name):c.content&&(b=c.content),d.push(new ld({id:c.id||null,judgement:c.judgement||null,text:c.text||null,classification:c.classification||c.action||null,score:c.score||null,photo:c.photo||null,action:c.action||null,type:this.currentService,created:c.created,link:b,source:e,user:f}));return this.collection=new W(d),this.postsManager=new nd(this.collection,this.scene,this.currentService),this.postsManager.postTransitionInEnded=this.onPostsManagerPostTransitionInEnded,this.postsManager.onUpdateIntroAnimation=this.onPostsManagerUpdateIntroAnimation,this.postsManager.onCompleteIntroAnimation=this.onPostsManagerCompleteIntroAnimation,this.postsManager.dragger.cantDragCauseOfOrientation=this.showOrientationMessage,this.postsManager.dragger.onPicLoaded=this.updateServicesSelectorUserPic,this.scene.addChild(this.postsManager.postsContainer),this.scene.addChild(this.postsManager.dragger.el),null},b.prototype.initEmptyCircle=function(){return this.emptyCircle=new createjs.Shape,this.emptyCircle.graphics.beginFill("#fff"),this.emptyCircle.graphics.drawCircle(this.scene.width/2,this.scene.height/2,210),this.scene.addChild(this.emptyCircle),null},b.prototype.initDraggerMarkLimits=function(){var a,b;return a=228*Math.cos(this.postsManager.dragger.config.range.min*(Math.PI/180)-.004)+this.postsManager.dragger.config.circleAnchor.center.x,b=228*Math.sin(this.postsManager.dragger.config.range.min*(Math.PI/180)-.004)+this.postsManager.dragger.config.circleAnchor.center.y,this.minLimitBar=new createjs.Shape,this.minLimitBar.graphics.setStrokeStyle(2,"round"),this.minLimitBar.graphics.beginStroke("#0x000000"),this.minLimitBar.graphics.moveTo(this.postsManager.dragger.config.circleAnchor.center.x,this.postsManager.dragger.config.circleAnchor.center.y),this.minLimitBar.graphics.lineTo(a,b),this.minLimitBar.alpha=1,a=228*Math.cos(this.postsManager.dragger.config.range.max*(Math.PI/180))+this.postsManager.dragger.config.circleAnchor.center.x,b=228*Math.sin(this.postsManager.dragger.config.range.max*(Math.PI/180))+this.postsManager.dragger.config.circleAnchor.center.y,this.maxLimitBar=new createjs.Shape,this.maxLimitBar.graphics.setStrokeStyle(2,"round"),this.maxLimitBar.graphics.beginStroke("#0x000000"),this.maxLimitBar.graphics.moveTo(this.postsManager.dragger.config.circleAnchor.center.x,this.postsManager.dragger.config.circleAnchor.center.y),this.maxLimitBar.graphics.lineTo(a,b),this.maxLimitBar.alpha=1,this.scene.addChild(this.minLimitBar),this.scene.addChild(this.maxLimitBar),null},b.prototype.initClassificationsManager=function(){return this.classificationsManager=new O(this.classificationNames,this.scene,this.currentService),this.scene.addChild(this.classificationsManager.el),null},b.prototype.initLinksManager=function(){return this.linksManager=new id(this.postsManager,this.classificationsManager,this.scoreManager,this.scene,this.currentService),this.scene.addChild(this.linksManager.links),this.scene.addChild(this.linksManager.currentLink),this.postsManager.onPostChange=function(a){return function(b){a.onPostChange(b),a.linksManager.update(b),a.classificationsManager.update(b),a.update()}}(this),this.postsManager.onDraggerFocus=function(a){return function(){return a.postsManager.currentPost&&a.linksManager.activateCurrentLink(),a.scene.update()}}(this),this.postsManager.onDraggerRelease=function(a){return function(){a.linksManager.activateAllLinks(),a.linksManager.desactivateCurrentLink(),a.classificationsManager.removeAllTints(),a.update()}}(this),null},b.prototype.initScoreManager=function(){return this.scoreManager=new od(this.scene),this.scene.addChild(this.scoreManager.el),null},b.prototype.preloadLogo=function(){var a,b,c;return"tw"===this.currentService?(c="/static/images/deepviews/profile/scoreBreakdownTwitter.png",b=44,this.twitterImgPreloaded?this.initLogo(this.twitterImgPreloaded,b):(a=new Image,a.onload=function(c){return function(){return c.twitterImgPreloaded=a,c.initLogo(c.twitterImgPreloaded,b)}}(this),a.src=c)):"fb"===this.currentService?(c="/static/images/deepviews/profile/scoreBreakdownFacebook.png",b=17,this.facebookImgPreloaded?this.initLogo(this.facebookImgPreloaded,b):(a=new Image,a.onload=function(c){return function(){return c.facebookImgPreloaded=a,c.initLogo(c.facebookImgPreloaded,b)}}(this),a.src=c)):"ig"===this.currentService&&(c="/static/images/deepviews/profile/scoreBreakdownInstagram.png",b=35,this.instagramImgPreloaded?this.initLogo(this.instagramImgPreloaded,b):(a=new Image,a.onload=function(c){return function(){return c.instagramImgPreloaded=a,c.initLogo(c.instagramImgPreloaded,b)}}(this),a.src=c)),null},b.prototype.initLogo=function(a,b){return this.logoUsernameContainer=new createjs.Container,this.logoUsernameContainer.alpha=0,this.logo=new createjs.Bitmap(a),this.logo.x=this.scene.width/2,this.logo.y=this.scene.height/2-35,this.logo.regX=b,this.logo.regY=35,this.logoUsernameContainer.addChild(this.logo),this.initUsername(),null},b.prototype.initUsername=function(){var a,b,c;return c=axe.appData.USER.model.get("info."+this.currentService+".username"),this.usernameTxt=new createjs.Text(""+c,"30px tungstensemibold","#a8a8a8"),this.usernameTxt.x=this.scene.width/2,this.usernameTxt.y=this.scene.height/2+35,this.usernameTxt.regX=Math.floor(this.usernameTxt.getMeasuredWidth()/2),this.logoUsernameContainer.addChild(this.usernameTxt),b=this.scene.width/2-this.usernameTxt.getMeasuredWidth()/2,a=this.usernameTxt.getMeasuredWidth()+5,this.logoUsernameContainer.cache(b,175,a,140),this.scene.addChild(this.logoUsernameContainer),this.transitionInLogoUsername(),null},b.prototype.onPostsManagerUpdateIntroAnimation=function(){return this.postsManager.dragger.moveToAngle(),this.update(),null},b.prototype.onPostsManagerCompleteIntroAnimation=function(){return this.postsManager.dragger.state="dragging",this.postsManager.initEvents(),this.postsManager.dragger.hasStartOnce=!0,this.axe.IS_MOBILE||this.onPostChange(this.postsManager.posts[0]),null},b.prototype.transitionInLogoUsername=function(){return TweenLite.to(this.logoUsernameContainer,.3,{alpha:1,delay:1}),null},b.prototype.getPostsDataForService=function(a){var b;return b="tw"===a?this.axe().appData.USER.model.get("scores.tw.postsData.posts"):"fb"===a?this.axe().appData.USER.model.get("scores.fb.sampleData.posts"):this.axe().appData.USER.model.get("scores.ig.postsData.posts")},b.prototype.getClassificationsNameForService=function(a){var b,c,d;b=[],c="tw"===a?this.axe().algorithm.get("behaviours.twitter.methods.classifyTweets.tests"):"fb"===a?this.axe().algorithm.get("behaviours.facebook.methods.crunchSampleData.tests"):this.axe().algorithm.get("behaviours.instagram.methods.classifyPosts.tests");for(d in c)b.push(d);return b},b.prototype.transitionIn=function(){return this.postsManager.transitionIn(),null},b.prototype.onPostsManagerPostTransitionInEnded=function(){return this.linksManager.drawAllLinks(),null},b.prototype.onPostChange=function(){return null},b.prototype.update=function(){return this.scene.update(),null},b.prototype.updateUI=function(a){return this.postInfos.update(a),null},b.prototype.dispose=function(){return null},b.prototype.reset=function(){return this.emptyCircle=null,this.dotsContainer=null,this.scene.removeAllChild(),null},b.prototype.clean=function(){return this.logoUsernameContainer.alpha=0,this.logoUsernameContainer.updateCache(),this.postsManager.clean(),this.linksManager.clean(),this.scene.update(),null},b.prototype.showOrientationMessage=function(){return this.axe().appView.showOrientationOverlay(function(a){return function(){return a.axe().appData.USER.status.getLoggedCount()>1?a.axe().appView.spiroServiceSelector.animateIn():void 0}}(this)),null},b.prototype.onSpiroServiceSelectorChange=function(a){return this.reload(a),this.onServiceChange(a),null},b.prototype.resize=function(a){var b,c;return this.axe().IS_MOBILE&&(a?"portrait"===a.o?(this.scene.stage.canvas.style.width="100%",this.scene.stage.canvas.style.height="auto"):(this.scene.stage.canvas.style.width="auto",this.scene.stage.canvas.style.height=a.h+"px","function"==typeof(b=this.axe().appView.header).hideByScroll&&b.hideByScroll()):window.innerHeight>window.innerWidth?(this.scene.stage.canvas.style.width="100%",this.scene.stage.canvas.style.height="auto"):(this.scene.stage.canvas.style.width="auto",this.scene.stage.canvas.style.height=window.innerHeight+"px","function"==typeof(c=this.axe().appView.header).hideByScroll&&c.hideByScroll())),null},b.prototype.onServiceChange=function(){return null},b}(b),Ob=function(a){function b(a){return this.activeGraph=a,this.onChangeComplete=Vd(this.onChangeComplete,this),this.onActiveGraphChange=Vd(this.onActiveGraphChange,this),this.toggleGraphs=Vd(this.toggleGraphs,this),this.setListeners=Vd(this.setListeners,this),this.mute=Vd(this.mute,this),this.unMute=Vd(this.unMute,this),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="graph-toggle",b.prototype.activeGraph=null,b.prototype.listening=null,b.prototype.unMute=function(){return this.setListeners("on"),this.onActiveGraphChange(),null},b.prototype.mute=function(){return this.setListeners("off"),null},b.prototype.setListeners=function(a){return this.listening!==a?(this.listening=a,this.$el[a]("click",this.toggleGraphs),this.activeGraph[a]("change",this.onActiveGraphChange),null):void 0},b.prototype.toggleGraphs=function(){var a,b,c;return null!=(c=this.axe().appView.milestones)&&c.completeTask("friend_click"),a=this.activeGraph.get("active"),b=this.activeGraph.get("inactive"),this.activeGraph.set({active:b,inactive:a}),this.$el.find("[data-toggle-switch]").toggleClass("single line"),this.axe().analytics.track("dashboard_click_versus"),null},b.prototype.onActiveGraphChange=function(){var a,b,c;return a=this.activeGraph.get("active"),b=this.activeGraph.get("inactive"),"function"==typeof(c=this.activeGraph.get("inactive")).animateOut&&c.animateOut(),a.$el.show(),TweenLite.to(a.$el,.3,{delay:.15,opacity:1,transform:"none",ease:Cubic.easeInOut}),TweenLite.to(b.$el,.3,{opacity:0,transform:"translate(0, 25px)",ease:Cubic.easeInOut,onComplete:this.onChangeComplete}),null},b.prototype.onChangeComplete=function(){return this.activeGraph.get("active").animateIn(),this.activeGraph.get("inactive").$el.hide(),null},b}(g),Fb=function(a){function b(a){return this.model=a.model,this.collection=a.collection,this.changeActive=Vd(this.changeActive,this),this.toggle=Vd(this.toggle,this),this.initialize=Vd(this.initialize,this),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="graph-line-comparison-item",b.prototype.className="line-graph-comparison-item",b.prototype.events={"click a":"toggle"},b.prototype.initialize=function(){return this.templateVars={name:this.model.get("name")},b.__super__.initialize.call(this),this.model.on("change:active",this.changeActive),null},b.prototype.toggle=function(a){return a.preventDefault(),this.model.trigger(this.$el.hasClass("active")?"deactivate":"activate",this.model)},b.prototype.changeActive=function(){return this.model.get("active")?(this.$el.addClass("active"),this.$el.css({"background-color":"#"+this.collection.colorSchemes[this.model.get("colorScheme")].thumbBgColor.toString(16)})):(this.$el.removeClass("active"),this.$el.css({"background-color":"transparent"}))},b}(g),Gb=function(a){function b(){return this.addItemView=Vd(this.addItemView,this),this.initialize=Vd(this.initialize,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.className="line-graph-comparison",b.prototype.initialize=function(a){return b.__super__.initialize.call(this,a),this.collection=a.collection,this.collection.each(function(a){return function(b){return a.addItemView(b)}}(this)),this.collection.on("add",function(a){return function(b){return a.addItemView(b)}}(this)),this.collection.on("remove",function(a){return function(b){return a.removeChild(_.find(a.children,function(a){return a.model===b}))}}(this)),this.collection.on("reset",function(a){return function(){return _.each(a.children,function(b){return a.removeChild(b)})}}(this))},b.prototype.addItemView=function(a){var b;return b=new Fb({model:a,collection:this.collection}),this.listenTo(b,"activate",this.activate)},b}(g),Ib=function(){function a(a){this.canvasHeight=a,this.resize=Vd(this.resize,this),this.onAnimUpdate=Vd(this.onAnimUpdate,this),this.updateProgress=Vd(this.updateProgress,this),this.setPath=Vd(this.setPath,this),this.animateLine=Vd(this.animateLine,this),this.animateTo=Vd(this.animateTo,this),this.getProgressForIndex=Vd(this.getProgressForIndex,this),this.drawDot=Vd(this.drawDot,this),this.initDot=Vd(this.initDot,this),this.drawBgCircle=Vd(this.drawBgCircle,this),this.initBgCircle=Vd(this.initBgCircle,this),this.printColorLine=Vd(this.printColorLine,this),this.drawLine=Vd(this.drawLine,this),this.initLine=Vd(this.initLine,this),this.setColor=Vd(this.setColor,this),this.changeActiveLine=Vd(this.changeActiveLine,this),this.container=new createjs.Container,this.devicePixelRatio=window.devicePixelRatio||1,this.initLine(),this.line.scaleY=0,this.initDot()}return a.prototype.color=0,a.prototype.animateToDuration=1,a.prototype.tween=null,a.prototype.timeline=null,a.prototype.smoothPoints=6*(window.devicePixelRatio||1),a.prototype.changeActiveLine=function(a,b){return this.setColor(b),TweenLite.to(this.dot,.5,{y:a,ease:Power2.easeInOut,onComplete:this.updateProgress,onUpdate:this.onAnimUpdate()})
},a.prototype.setColor=function(a){return this.color=a,this.printColorLine(),this.drawDot(),null},a.prototype.initLine=function(){return this.lineBg=new createjs.Shape,this.lineColor=new createjs.Shape,this.lineColor.x=this.lineColor.y=-.5,this.line=new createjs.Container,this.line.addChild(this.lineBg),this.line.addChild(this.lineColor),this.drawLine(),this.container.addChild(this.line)},a.prototype.drawLine=function(){var a;return a=this.lineBg.graphics.clear(),a.beginFill(createjs.Graphics.getRGB(16777215,.5)),a.drawRect(-7*this.devicePixelRatio,this.canvasHeight/-2,14*this.devicePixelRatio,this.canvasHeight)},a.prototype.printColorLine=function(){var a;return a=this.lineColor.graphics,a.clear(),a.beginFill(createjs.Graphics.getRGB(this.color)),a.drawRect(0,this.canvasHeight/-2,this.devicePixelRatio,this.canvasHeight)},a.prototype.initBgCircle=function(){return this.circle=new createjs.Shape,this.dot.addChild(this.circle),this.drawBgCircle()},a.prototype.drawBgCircle=function(){return this.circle.graphics.clear().beginFill(createjs.Graphics.getRGB(16777215,.5)).drawCircle(.5,.5,20*this.devicePixelRatio)},a.prototype.initDot=function(){return this.dot=new createjs.Container,this.dotColor=new createjs.Shape,this.initBgCircle(),this.dot.addChild(this.dotColor),this.container.addChild(this.dot)},a.prototype.drawDot=function(){var a;return a=this.dotColor.graphics,a.clear(),a.setStrokeStyle(2*this.devicePixelRatio),a.beginStroke(createjs.Graphics.getRGB(this.color)).beginFill(createjs.Graphics.getRGB(16777215)).drawCircle(.5,.5,5*this.devicePixelRatio)},a.prototype.getProgressForIndex=function(a){return(this.timeline.getLabelTime("step"+a)+this.stepDuration)/this.timeline.totalDuration()},a.prototype.animateTo=function(a){var b,c;if(this.timeline)return this.tween&&this.tween.isActive()&&this.tween.kill(),this.timeline.pause(),c=this.getProgressForIndex(a),c<this.timeline.progress()&&this.timeline.reversed(!this.timeline.reversed()),b={progress:this.timeline.progress()},this.tween=TweenLite.to(b,1,{progress:c,ease:Power2.easeOut,onUpdate:function(a){return function(){return a.timeline.progress(b.progress),a.onAnimUpdate()}}(this)}),this.index=a,null},a.prototype.animateLine=function(){return this.line.y=this.dot.y,TweenLite.to(this.line,1,{scaleY:2,ease:Power2.easeInOut})},a.prototype.setPath=function(a,b){var c,d,e,f,g,h;for(this.path=a,this.emptyOffset=b,null===this.timeline&&(this.timeline=new TimelineLite({paused:!0,onUpdate:function(a){return function(){return a.line.x=a.dot.x}}(this)})),this.timeline.clear(!0),this.stepDuration=this.animateToDuration/100,d=this.path[0],c=g=1,h=this.path.length-1;h>=1?h>=g:g>=h;c=h>=1?++g:--g)f=this.path[c],e=[],e.push({x:d.x,y:d.y}),e.push({x:d.x+this.smoothPoints,y:d.y}),e.push({x:f.x-this.smoothPoints,y:f.y}),e.push({x:f.x,y:f.y}),d=f,this.timeline.to(this.dot,this.stepDuration,{bezier:{type:"cubic",values:e,autoRotate:!1},ease:Linear.easeNone},"step"+c);return null},a.prototype.updateProgress=function(){return this.index?this.timeline.progress(this.getProgressForIndex(this.index)):void 0},a.prototype.onAnimUpdate=function(){return this.animUpdateCallback?this.animUpdateCallback():void 0},a.prototype.resize=function(a,b){return this.canvasHeight=a,this.devicePixelRatio=b,this.smoothPoints=6*b,this.drawLine(),this.drawBgCircle(),this.printColorLine(),this.drawDot(),this.timeline&&this.timeline.progress(this.getProgressForIndex(this.index)),null},a}(),Jb=function(){function a(a,b,c,d){this.data=a,this.plotSize=b,this.active=c,this.pointer=d,this.resize=Vd(this.resize,this),this.onAnimUpdate=Vd(this.onAnimUpdate,this),this.getPointerPath=Vd(this.getPointerPath,this),this.getScores=Vd(this.getScores,this),this.setActive=Vd(this.setActive,this),this.drawSingleLineShape=Vd(this.drawSingleLineShape,this),this.calculateYPosition=Vd(this.calculateYPosition,this),this.calculateDotPosition=Vd(this.calculateDotPosition,this),this.playAnim=Vd(this.playAnim,this),this.printShape=Vd(this.printShape,this),this.setColors=Vd(this.setColors,this),this.shapeContainer=new createjs.Container,this.container=new createjs.Container,this.active||(this.container.alpha=this.disabledAlpha),this.container.addChild(this.shapeContainer),this.devicePixelRatio=window.devicePixelRatio||1,_.extend(this,Backbone.Events),this.data&&(this.data=this.data.slice(0).reverse(),this.emptyOffset=100-this.data.length)}return a.prototype.disabledAlpha=.4,a.prototype.showDuration=2,a.prototype.smoothPoints=.006,a.prototype.setColors=function(a,b){return this.colors=a,null==b&&(b=!0),this.data?(this.printShape(b),null):void 0},a.prototype.printShape=function(a){var b,c;return null==a&&(a=!0),this.shapeContainer.removeAllChildren(),c=this.drawSingleLineShape(this.data,this.colors.lineColor),this.mask=new createjs.Shape,b=this.mask.graphics,b.beginFill(createjs.Graphics.getRGB(0)),b.drawRect(0,0,this.plotSize[0],this.plotSize[1]),this.mask.y=Eb.plotMargin,this.mask.x=a?-this.plotSize[0]:0,c.mask=this.mask,this.shapeContainer.addChild(c)},a.prototype.playAnim=function(a){var b,c,d,e,f,g,h,i,j;if(null==a&&(a=!0),this.data){if(e=this.calculateDotPosition(this.data[0],0),c={x:e.x,y:e.y},this.active){if(h=new TimelineLite({paused:!0,onComplete:function(a){return function(){return a.pointer.animateLine(),a.pointer.updateProgress()}}(this),onUpdate:function(a){return function(){return a.mask.x=-a.plotSize[0]+a.pointer.dot.x+3,a.pointer.line.x=a.pointer.dot.x,a.onAnimUpdate()}}(this)}),g=this.showDuration/100,f=this.smoothPoints*this.plotSize[0],this.data.length>1)for(b=i=1,j=this.data.length-1;j>=1?j>=i:i>=j;b=j>=1?++i:--i)e=this.calculateDotPosition(this.data[b].score,this.emptyOffset+b),d=[],d.push({x:c.x,y:c.y}),d.push({x:c.x+f,y:c.y}),d.push({x:e.x-f,y:e.y}),d.push({x:e.x,y:e.y}),c=e,h.to(this.pointer.dot,g,{bezier:{type:"cubic",values:d,autoRotate:!1},ease:Linear.easeNone});return h.play()}return this.mask.x=-this.plotSize[0],TweenLite.to(this.mask,this.showDuration,{x:0,ease:Linear.easeNone,onUpdate:this.onAnimUpdate,onComplete:function(b){return function(){return a?b.setActive(!0):void 0}}(this)})}},a.prototype.calculateDotPosition=function(a,b){return null==b&&(b=0),{x:this.plotSize[0]/100*b,y:this.calculateYPosition(a)}},a.prototype.calculateYPosition=function(a){return Math.round(Eb.plotMargin+this.plotSize[1]-(500+a)/1e3*this.plotSize[1])},a.prototype.drawSingleLineShape=function(a,b){var c,d,e,f,g,h,i,j;for(g=new createjs.Shape,c=g.graphics,c.setStrokeStyle(2*this.devicePixelRatio),c.beginStroke(b),e=this.calculateDotPosition(0,this.emptyOffset-1),c.moveTo(e.x,e.y),h=this.smoothPoints*this.plotSize[0],d=i=1,j=a.length;j>=1?j>=i:i>=j;d=j>=1?++i:--i)f=this.calculateDotPosition(a[d-1].score,this.emptyOffset+d-1),c.bezierCurveTo(e.x+h,e.y,f.x-h,f.y,f.x,f.y),e=f;return g.cache(0,0,this.plotSize[0],Eb.plotMargin+this.plotSize[1]),g},a.prototype.setActive=function(a){var b,c,d;return this.active=a,this.active&&(this.trigger("active:change",this),c=this.pointer.index-this.emptyOffset,d=this.calculateYPosition(c>=0?this.data[c].score:0),this.pointer.changeActiveLine(d,this.colors.pointerColor),this.pointer.setPath(this.getPointerPath(),this.emptyOffset)),b=1,this.active||(b=this.disabledAlpha),TweenLite.to(this.container,1,{alpha:b,ease:Linear.easeNone,onUpdate:this.onAnimUpdate})},a.prototype.getScores=function(){return _.map(this.data,function(a){return function(b,c){return a.calculateDotPosition(b.score,a.emptyOffset+c)}}(this))},a.prototype.getPointerPath=function(){var a,b,c,d;if(b=[],this.emptyOffset>0)for(a=c=0,d=this.emptyOffset-1;d>=0?d>=c:c>=d;a=d>=0?++c:--c)b.push(this.calculateDotPosition(0,a));return b.concat(this.getScores())},a.prototype.onAnimUpdate=function(){return this.animUpdateCallback?this.animUpdateCallback():void 0},a.prototype.resize=function(a,b){return this.plotSize=a,this.devicePixelRatio=b,this.data?(this.printShape(!1),this.active&&this.pointer.setPath(this.getPointerPath(),this.emptyOffset),null):void 0},a}(),Xc=function(a){function b(a){var c;return this.service=a,this.hideBtns=Vd(this.hideBtns,this),this.showBtns=Vd(this.showBtns,this),this.onModalShowComplete=Vd(this.onModalShowComplete,this),this.listenForShow=Vd(this.listenForShow,this),this.share=Vd(this.share,this),this.onCtaClick=Vd(this.onCtaClick,this),this.onShareClick=Vd(this.onShareClick,this),this.setListeners=Vd(this.setListeners,this),this.init=Vd(this.init,this),this.userModel=this.axe().appData.USER.model,c=this.axe().IS_MOBILE?this.axe().locale.get("graph_share_mobile"):this.axe().locale.get("graph_share"),this.templateVars={share_cta:c},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.service=null,b.prototype.$cta=null,b.prototype.userModel=null,b.prototype.btnsDisplayed=!1,b.prototype.template="share-controls",b.prototype.listening=null,b.prototype.init=function(){return this.$cta=this.$el.find("[data-cta]"),null},b.prototype.setListeners=function(a){return this.listening!==a?(this.listening=a,this.$el[a]("click","[data-share]",this.onShareClick),this.axe().IS_MOBILE&&this.$el[a]("click","[data-cta]",this.onCtaClick),null):void 0},b.prototype.onShareClick=function(a){var b;return b=$(a.currentTarget),this.$el.addClass("loading"),b.addClass("show-loader"),this.share(b.data("share")),this.listenForShow(),null},b.prototype.onCtaClick=function(){return this.btnsDisplayed?this.hideBtns():this.showBtns(),null},b.prototype.share=function(a){return this.axe().appView.shareModal=new Zc({service:this.service,shareTo:a}),null},b.prototype.listenForShow=function(){return this.axe().appView.shareModal.on("onShowComplete",this.onModalShowComplete),null},b.prototype.onModalShowComplete=function(){return this.axe().IS_MOBILE&&this.hideBtns(),this.$el.removeClass("loading").find(".show-loader").removeClass("show-loader"),this.axe().appView.shareModal.off("onShowComplete",this.onModalShowComplete),null},b.prototype.showBtns=function(){return this.$el.addClass("show-btns"),this.btnsDisplayed=!0,null},b.prototype.hideBtns=function(){return this.$el.removeClass("show-btns"),this.btnsDisplayed=!1,null},b}(g),N=function(a){function b(){return this.scaleDown=Vd(this.scaleDown,this),this.scaleUp=Vd(this.scaleUp,this),this.updateTint=Vd(this.updateTint,this),this.transitionIn=Vd(this.transitionIn,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.classificationId="",b.prototype.el=null,b.prototype.circle=null,b.prototype.circleCenter=null,b.prototype.textField=null,b.prototype.radius=0,b.prototype.text="",b.prototype.position=null,b.prototype.config=null,b.prototype.tween=null,b.prototype.redLevel=0,b.prototype.greenLevel=0,b.prototype.blueLevel=0,b.prototype.radius=15,b.prototype.initialize=function(a,b){this.config=b,this.classificationId=this.config.classificationId,this.text=this.config.text,this.position=this.config.position,this.score=this.config.score,this.linkColor=this.config.linkColor,this.frequency=this.config.frequency,this.radius=30,this.el=new createjs.Container,this.initCircle(),this.initCircleCenter(),this.initLabel()},b.prototype.initCircle=function(){this.circle=new createjs.Shape,this.circle.graphics.beginFill("#fff"),this.circle.graphics.drawCircle(this.position.x,this.position.y,15),this.circle.alpha=.7,this.removeTint(),this.el.addChild(this.circle)},b.prototype.initCircleCenter=function(){this.circleCenter=new createjs.Shape,this.circleCenter.graphics.beginFill("#fff"),this.circleCenter.graphics.drawCircle(this.position.x,this.position.y,3),this.circleCenter.alpha=.9,this.el.addChild(this.circleCenter)},b.prototype.initLabel=function(){return this.labelTxt=new createjs.Text(""+this.getClassificationCopy(this.classificationId),"15px tungstensemibold","#a8a8a8"),this.labelTxt.x=this.position.x-18,this.labelTxt.y=this.position.y-25,this.labelTxt.textAlign="right",this.labelTxt.alpha=0,this.el.addChild(this.labelTxt),null},b.prototype.transitionIn=function(){return this.tween=new TweenLite(this.circle,.2,{alpha:.7}),null},b.prototype.tint=function(a){var b;return this.removeTint(),null!=(b=this.labelTxt)&&(b.alpha=1),"tryingTooHard"===a?(this.redLevel=Ic.map(210,0,255,0,1),this.greenLevel=Ic.map(70,0,255,0,1),this.blueLevel=Ic.map(73,0,255,0,1)):"effortless"===a?(this.redLevel=Ic.map(135,0,255,0,1),this.greenLevel=Ic.map(109,0,255,0,1),this.blueLevel=Ic.map(155,0,255,0,1)):(this.redLevel=Ic.map(161,0,255,0,1),this.greenLevel=Ic.map(215,0,255,0,1),this.blueLevel=Ic.map(232,0,255,0,1)),this.updateTint(),null},b.prototype.removeTint=function(){var a;return null!=(a=this.labelTxt)&&(a.alpha=0),this.redLevel=Ic.map(127,0,255,0,1),this.greenLevel=Ic.map(232,0,255,0,1),this.blueLevel=Ic.map(127,0,255,0,1),this.updateTint(),null},b.prototype.updateTint=function(){return this.tintFilter=new createjs.ColorFilter(this.redLevel,this.greenLevel,this.blueLevel,1),this.circle.cache(this.position.x-15,this.position.y-15,30,30),this.circle.filters=[this.tintFilter],this.circle.updateCache()},b.prototype.scaleUp=function(){return this.tween=new TweenLite(this.circle,.3,{scaleX:1.2,scaleY:1.2}),null},b.prototype.scaleDown=function(){return 1!==this.circle.scaleX?(this.tween=new TweenLite(this.circle,.3,{scaleX:1,scaleY:1}),null):void 0},b.prototype.getClassificationCopy=function(){var a;return"tw"===this.config.service?a="twitter":"fb"===this.config.service?a="facebook":"ig"===this.config.service&&(a="instagram"),this.axe().locale.get("scorebreakdown_spirograph_"+a+"_"+this.classificationId)},b}(g),gd=function(a){function b(){return this.update=Vd(this.update,this),this.hide=Vd(this.hide,this),this.show=Vd(this.show,this),b.__super__.constructor.call(this),this.categoryField=this.el.getElementsByClassName("share")[0].getElementsByClassName("big-label")[0],this.frequencyField=this.el.getElementsByClassName("frequency")[0].getElementsByClassName("big-label")[0],this.effortField=this.el.getElementsByClassName("effort")[0],null}return Ud(b,a),b.prototype.template="spirograph-facebook-detail-infos",b.prototype.currentPost=null,b.prototype._refClassificationsManager=null,b.prototype.icon=null,b.prototype.frequencyField=null,b.prototype.effortField=null,b.prototype.contentVars=null,b.prototype.currentCategory="",b.prototype.show=function(){return this.isVisible=!0,$(this.el).addClass("show"),null},b.prototype.hide=function(){return this.isVisible=!1,$(this.el).removeClass("show"),null},b.prototype.update=function(a,b){return this.isVisible||this.show(),this.icon||(this.icon=this.el.getElementsByClassName("data-block")[0].getElementsByClassName("ss")[0]),"tryingTooHard"===this.effort?this.judgementHTML="TRYING<br/>TOO HARD":"effortless"===this.effort?this.judgementHTML="EFFORTLESS":"notHardEnough"===this.effort&&(this.judgementHTML="NOT TRYING<br/>HARD ENOUGH"),this.frequencyField.innerHTML=this._refClassificationsManager.getClassificationFrequency(a.classification)+"/WEEK",this.effort=this._refClassificationsManager.getClassificationEffort(a.classification),"tryingTooHard"===this.effort?this.judgementHTML="TRYING<br/>TOO HARD":"effortless"===this.effort?this.judgementHTML="EFFORTLESS":"notHardEnough"===this.effort&&(this.judgementHTML="NOT TRYING<br/>HARD ENOUGH"),this.effortField.innerHTML=this.judgementHTML,this.effortField.className="effort "+this.effort,b&&(this.categoryField.innerHTML=this.axe().locale.get("scorebreakdown_spirograph_facebook_"+b).toUpperCase(),$(this.icon).removeClass(this.currentCategory),this.currentCategory="ss-fb-"+b,$(this.icon).addClass(this.currentCategory)),null},b}(g),hd=function(a){function b(){this.openMediaModal=Vd(this.openMediaModal,this),this.setupListeners=Vd(this.setupListeners,this),this.loadImage=Vd(this.loadImage,this),this.update=Vd(this.update,this),this.hide=Vd(this.hide,this),this.show=Vd(this.show,this),b.__super__.constructor.call(this),this.scoreContainer=this.el.getElementsByClassName("score")[0],this.scoreNum=this.el.getElementsByClassName("score")[0].getElementsByClassName("scoreNum")[0],this.scoreDesc=this.el.getElementsByClassName("score")[0].getElementsByClassName("scoreDesc")[0],this.figure=this.el.getElementsByTagName("figure")[0],this.figureStyle=this.figure.style,this.figureImgContainer=this.el.getElementsByTagName("figure")[0].getElementsByClassName("post-image")[0],this.figureImgContainerStyle=this.figureImgContainer.style,this.figureLoader=this.el.getElementsByTagName("figure")[0].getElementsByClassName("loader-animation")[0],this.text=this.el.getElementsByClassName("txt")[0],this.textStyle=this.text.style,this.time=this.el.getElementsByTagName("time")[0],this.timeLink=this.time.getElementsByTagName("a")[0],this.initEvents()}return Ud(b,a),b.prototype.template="spirograph-instagram-detail-infos",b.prototype.currentPost=null,b.prototype.scoreContainer=null,b.prototype.scoreNum=null,b.prototype.scoreDesc=null,b.prototype.judgementHTML="",b.prototype.figure=null,b.prototype.figureStyle=null,b.prototype.figureImgContainer=null,b.prototype.figureImgContainerStyle=null,b.prototype.figureLoader=null,b.prototype.text=null,b.prototype.textStyle=null,b.prototype.time=null,b.prototype.timeout=null,b.prototype.currentJudgement="",b.prototype.show=function(){return this.isVisible=!0,$(this.el).addClass("show"),null},b.prototype.hide=function(){return this.isVisible=!1,$(this.el).removeClass("show"),null},b.prototype.initEvents=function(){return $(this.figureImgContainer).on("click",this.openMediaModal),null},b.prototype.update=function(a){var b,c,d;return this.postData=a,this.isVisible||this.show(),b=Pc.getDateLink("instagram",this.postData),d=Pc.getRichText("instagram",this.postData.text),this.postData.photo?(this.figure.className="post-image-holder",this.figureStyle.display="inline-block",c=new Image,c.onload=function(a){return function(){return a.figureImgContainerStyle.backgroundImage="url("+a.postData.photo+")",a.figure.className="post-image-holder image-loaded"}}(this),c.src=this.postData.photo,this.text.innerHTML=d,this.axe().IS_MOBILE&&(this.textStyle.display="none")):(this.figureStyle.display="none","none"!==this.figureImgContainerStyle.backgroundImage&&(this.figureImgContainerStyle.backgroundImage="none"),this.axe().IS_MOBILE&&(this.textStyle.display="block"),this.text.innerHTML=d),"tryingTooHard"===this.postData.judgement?this.judgementHTML="TRYING<br/>TOO HARD":"effortless"===this.postData.judgement?this.judgementHTML="EFFORTLESS":"notHardEnough"===this.postData.judgement&&(this.judgementHTML="NOT TRYING<br/>HARD ENOUGH"),this.scoreContainer.setAttribute("data-judgement",this.postData.judgement),this.scoreNum.innerHTML=Ic.getNiceScore(this.postData.score),this.scoreDesc.innerHTML=this.judgementHTML,$(this.scoreContainer).removeClass(this.currentJudgement),this.currentJudgement=this.postData.judgement,$(this.scoreContainer).addClass(this.currentJudgement),this.timeLink.innerHTML=b,null},b.prototype.loadImage=function(){var a,b;return(b=this.postData.photo)?(this.imageHolder=this.$el.find("[data-image-holder]"),a=new Image,a.onload=a.onerror=a.onabort=function(a){return function(){return a.imageHolder.addClass("image-loaded"),a.setupListeners("on")}}(this),a.src=b,null):void 0},b.prototype.setupListeners=function(a){var b;return null!=(b=$(this.figureImgContainer))?b[a]("click",this.openMediaModal):void 0},b.prototype.openMediaModal=function(){return this.axe().appView.postMediaModal?void 0:this.axe().appView.postMediaModal=new Oc(this.postData)},b}(g),jd=function(a){function b(){return b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="spirograph-detail-infos-footer",b.prototype.currentPost=null,b}(g),kd=function(a){function b(){this.update=Vd(this.update,this),this.switchPanel=Vd(this.switchPanel,this),b.__super__.constructor.call(this),this.axe().IS_MOBILE&&$(this.el).addClass("is-mobile"),this.twitterInfos=new rd,this.facebookInfos=new gd,this.instagramInfos=new hd,this.footer=new jd,this.el.appendChild(this.twitterInfos.el),this.el.appendChild(this.facebookInfos.el),this.el.appendChild(this.instagramInfos.el),this.el.appendChild(this.footer.el),this.currentInfos=this.twitterInfos}return Ud(b,a),b.prototype.template="spirograph-detail-infos",b.prototype.twitterInfos=null,b.prototype.facebookInfos=null,b.prototype.instagramInfos=null,b.prototype.footer=null,b.prototype.currentInfos=null,b.prototype.postContentTxt=null,b.prototype.scoreTxt=null,b.prototype.effortTxt=null,b.prototype.effortParsed="",b.prototype.currentPost=null,b.prototype.initialize=function(){return b.__super__.initialize.call(this),null},b.prototype.switchPanel=function(a){return this.currentInfos.hide(),this.currentInfos="tw"===a?this.twitterInfos:"fb"===a?this.facebookInfos:this.instagramInfos,null},b.prototype.update=function(a,b){return"tw"===a.attributes.type?this.twitterInfos.update(a.attributes):"fb"===a.attributes.type?this.facebookInfos.update(a.attributes,b):this.instagramInfos.update(a.attributes),null},b.prototype.reset=function(){return null},b}(g),rd=function(a){function b(){this.openMediaModal=Vd(this.openMediaModal,this),this.setupListeners=Vd(this.setupListeners,this),this.loadImage=Vd(this.loadImage,this),this.update=Vd(this.update,this),this.hide=Vd(this.hide,this),this.show=Vd(this.show,this),b.__super__.constructor.call(this),this.scoreContainer=this.el.getElementsByClassName("score")[0],this.scoreNum=this.el.getElementsByClassName("score")[0].getElementsByClassName("scoreNum")[0],this.scoreDesc=this.el.getElementsByClassName("score")[0].getElementsByClassName("scoreDesc")[0],this.figure=this.el.getElementsByTagName("figure")[0],this.figureStyle=this.figure.style,this.figureImgContainer=this.el.getElementsByTagName("figure")[0].getElementsByClassName("post-image")[0],this.figureImgContainerStyle=this.figureImgContainer.style,this.figureLoader=this.el.getElementsByTagName("figure")[0].getElementsByClassName("loader-animation")[0],this.text=this.el.getElementsByClassName("txt")[0],this.textStyle=this.text.style,this.time=this.el.getElementsByTagName("time")[0],this.timeLink=this.time.getElementsByTagName("a")[0],this.initEvents()}return Ud(b,a),b.prototype.template="spirograph-twitter-detail-infos",b.prototype.currentPost=null,b.prototype.scoreContainer=null,b.prototype.scoreNum=null,b.prototype.scoreDesc=null,b.prototype.judgementHTML="",b.prototype.figure=null,b.prototype.figureStyle=null,b.prototype.figureImgContainer=null,b.prototype.figureImgContainerStyle=null,b.prototype.figureLoader=null,b.prototype.text=null,b.prototype.textStyle=null,b.prototype.time=null,b.prototype.timeout=null,b.prototype.currentJudgement="",b.prototype.show=function(){return this.isVisible=!0,$(this.el).addClass("show"),null},b.prototype.hide=function(){return this.isVisible=!1,$(this.el).removeClass("show"),null},b.prototype.initEvents=function(){return $(this.figureImgContainer).on("click",this.openMediaModal),null},b.prototype.update=function(a){var b,c,d;return this.postData=a,this.isVisible||this.show(),b=Pc.getDateLink("twitter",this.postData),d=Pc.getRichText("twitter",this.postData.text),this.postData.photo?(this.figure.className="post-image-holder",this.figureStyle.display="inline-block",c=new Image,c.onload=function(a){return function(){return a.figureImgContainerStyle.backgroundImage="url("+a.postData.photo+")",a.figure.className="post-image-holder image-loaded"}}(this),c.src=this.postData.photo,this.axe().IS_MOBILE&&(this.textStyle.display="none")):(this.figureStyle.display="none","none"!==this.figureImgContainerStyle.backgroundImage&&(this.figureImgContainerStyle.backgroundImage="none"),this.axe().IS_MOBILE&&(this.textStyle.display="block"),this.text.innerHTML=d),"tryingTooHard"===this.postData.judgement?this.judgementHTML="TRYING<br/>TOO HARD":"effortless"===this.postData.judgement?this.judgementHTML="EFFORTLESS":"notHardEnough"===this.postData.judgement&&(this.judgementHTML="NOT TRYING<br/>HARD ENOUGH"),this.scoreContainer.setAttribute("data-judgement",this.postData.judgement),this.scoreNum.innerHTML=Ic.getNiceScore(this.postData.score),this.scoreDesc.innerHTML=this.judgementHTML,$(this.scoreContainer).removeClass(this.currentJudgement),this.currentJudgement=this.postData.judgement,$(this.scoreContainer).addClass(this.currentJudgement),this.timeLink.innerHTML=b,null},b.prototype.loadImage=function(){var a,b;return(b=this.postData.photo)?(this.imageHolder=this.$el.find("[data-image-holder]"),a=new Image,a.onload=a.onerror=a.onabort=function(a){return function(){return a.imageHolder.addClass("image-loaded"),a.setupListeners("on")}}(this),a.src=b,null):void 0},b.prototype.setupListeners=function(a){var b;return null!=(b=$(this.figureImgContainer))?b[a]("click",this.openMediaModal):void 0},b.prototype.openMediaModal=function(){return this.axe().appView.postMediaModal?void 0:this.axe().appView.postMediaModal=new Oc(this.postData)},b}(g),O=function(){function a(a,b,c){var d,e,f,g,h,i;this.data=a,this._refScene=b,this.service=c,this.getClassificationEffort=Vd(this.getClassificationEffort,this),this.getClassificationFrequency=Vd(this.getClassificationFrequency,this),this.getClassificationScore=Vd(this.getClassificationScore,this),this.getClassificationPosition=Vd(this.getClassificationPosition,this),this.classifications=[],this.el=new createjs.Container,this.initClassifications(),h=90,i=-15,f=0,g=0,e=this.lastClassificationPosition.x+18,d=this.firstClassificationPosition.y-i+3,this.el.cache(f,g,e,d)}return a.prototype._refScene=null,a.prototype.el=null,a.prototype.classifications=null,a.prototype.currentFbClassification=null,a.prototype.service=null,a.prototype.firstClassificationPosition=null,a.prototype.lastClassificationPosition=null,a.prototype.initClassifications=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(a=60/this.data.length,d="fb"===this.service?223:210,"fb"!==this.service&&this.data.push("noCategory"),f=l=0,n=this.data.length;n>=0?n>l:l>n;f=n>=0?++l:--l)"checkActivityFreq"===this.data[f]&&this.data.splice(f,1);for(f=m=o=this.data.length-1;-1>=o?-1>m:m>-1;f=-1>=o?++m:--m){if(j=215*Math.cos(d*(Math.PI/180))+this._refScene.width/2,k=215*Math.sin(d*(Math.PI/180))+this._refScene.height/2,i=null,0===f?this.lastClassificationPosition={x:Math.floor(j),y:Math.floor(k)}:f===this.data.length-1&&(this.firstClassificationPosition={x:Math.floor(j),y:Math.floor(k)}),"fb"===this.service){p=axe.appData.USER.model.get("scores.fb.sampleData.actions");for(g in p)h=p[g],this.data[f]===g&&(i=h.score,e=h.frequency)}c={classificationId:this.data[f],text:this.data[f],score:i,frequency:e,service:this.service,position:{x:j,y:k}},b=new N(null,c),this.el.addChild(b.el),this.classifications.push(b),d+=a}},a.prototype.update=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(this.removeAllTints(),"object"==typeof a.attributes.classification)for(j=this.classifications,d=0,g=j.length;g>d;d++)for(b=j[d],k=a.attributes.classification.types,e=0,h=k.length;h>e;e++)c=k[e],b.classificationId===c.test&&b.tint(a.attributes.judgement);else for(l=this.classifications,f=0,i=l.length;i>f;f++)b=l[f],b.classificationId===a.attributes.classification?b.tint(this.getClassificationEffort(b.classificationId)):b.removeTint();return this.el.updateCache(),null},a.prototype.removeAllTints=function(){var a,b,c,d;for(d=this.classifications,b=0,c=d.length;c>b;b++)a=d[b],a.removeTint();return this.el.updateCache(),null},a.prototype.getClassification=function(a){var b,c,d,e;for(e=this.classifications,c=0,d=e.length;d>c;c++)if(b=e[c],b.classificationId===a)return b.position;return null},a.prototype.getClassificationPosition=function(a){var b,c,d,e;for(e=this.classifications,c=0,d=e.length;d>c;c++)if(b=e[c],b.classificationId===a)return b.position;return null},a.prototype.getClassificationScore=function(a){var b,c,d,e;for(e=this.classifications,c=0,d=e.length;d>c;c++)if(b=e[c],b.classificationId===a)return b.score;return null},a.prototype.getClassificationFrequency=function(a){var b,c,d;d=axe.appData.USER.model.get("scores.fb.sampleData.actions");for(b in d)if(c=d[b],b===a)return(7*c.frequency).toFixed(3)},a.prototype.getClassificationEffort=function(a){var b,c,d;d=axe.appData.USER.model.get("scores.fb.sampleData.actions");for(b in d)if(c=d[b],b===a)return c.judgement},a}(),id=function(){function a(a,b,c,d,e){this.update=Vd(this.update,this),this.drawCurrentLink=Vd(this.drawCurrentLink,this),this.drawAllLinks=Vd(this.drawAllLinks,this),this._refPostsManager=a,this._refClassificationsManager=b,this._refScoreManager=c,this._refScene=d,this.service=e,this.initLinks(),this.initCurrentLink()}return a.prototype._refPostsManager=null,a.prototype._refClassificationsManager=null,a.prototype._refScoreManager=null,a.prototype._refScene=null,a.prototype.el=null,a.prototype.posts=null,a.prototype.currentPost=null,a.prototype.links=null,a.prototype.currentLink=null,a.prototype.classificationsPosition=null,a.prototype.scorePosition=null,a.prototype.service="",a.prototype.initLinks=function(){this.links=new createjs.Shape,this.links.cache(0,0,520,470),this.links.alpha=.4},a.prototype.initCurrentLink=function(){this.currentLink=new createjs.Shape,this.currentLink.cache(68,25,440,440)},a.prototype.drawAllLinks=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(this.links.graphics.c(),this.links.graphics.beginStroke("#ccc"),k=this._refPostsManager.posts,e=0,h=k.length;h>e;e++)if(b=k[e],b.canShowLink)if("object"==typeof b.model.attributes.classification)for(0===b.model.attributes.classification.types.length&&(b.model.attributes.classification.types[0]={test:"noCategory"}),l=b.model.attributes.classification.types,f=0,i=l.length;i>f;f++)c=l[f],this.classificationsPosition=this._refClassificationsManager.getClassificationPosition(c.test),this.classificationsPosition&&(this.links.graphics.moveTo(b.destinationPoint.x,b.destinationPoint.y),this.links.graphics.quadraticCurveTo(290,240,this.classificationsPosition.x,this.classificationsPosition.y)),d=this._refScoreManager.getPositionForScore(b.model.attributes.score),this.links.graphics.moveTo(b.destinationPoint.x,b.destinationPoint.y),this.links.graphics.quadraticCurveTo(290,240,d.x,d.y);else this.classificationsPosition=this._refClassificationsManager.getClassificationPosition(b.model.attributes.classification),this.classificationsPosition&&(this.links.graphics.moveTo(b.destinationPoint.x,b.destinationPoint.y),this.links.graphics.quadraticCurveTo(290,240,this.classificationsPosition.x,this.classificationsPosition.y));if("object"!=typeof b.model.attributes.classification&&b.canShowLink)for(m=this._refClassificationsManager.classifications,g=0,j=m.length;j>g;g++)a=m[g],d=this._refScoreManager.getPositionForScore(a.score),this.links.graphics.moveTo(a.position.x,a.position.y),this.links.graphics.quadraticCurveTo(290,240,d.x,d.y);return this.links.graphics.endStroke(),this.links.updateCache(),null},a.prototype.drawCurrentLink=function(){var a,b,c,d,e,f,g,h,i,j;if(this.currentLink.graphics.c(),this.currentLink.graphics.setStrokeStyle(2),"tw"===this.service||"ig"===this.service?this.currentLink.graphics.beginStroke(this.currentPost.color):this.currentLink.graphics.beginStroke(this._refScoreManager.getColorForScore(this._refClassificationsManager.getClassificationScore(this.currentPost.attributes.classification))),"tw"===this.service||"ig"===this.service){for(j=this.currentPost.model.attributes.classification.types,f=0,h=j.length;h>f;f++){if(c=j[f],this.classificationsPosition=this._refClassificationsManager.getClassificationPosition(c.test),!this.classificationsPosition)return;this.currentLink.graphics.moveTo(this.currentPost.destinationPoint.x,this.currentPost.destinationPoint.y),this.currentLink.graphics.quadraticCurveTo(290,240,this.classificationsPosition.x,this.classificationsPosition.y)}this.scorePosition=this._refScoreManager.getPositionForScore(this.currentPost.model.attributes.score),this.currentLink.graphics.moveTo(this.currentPost.destinationPoint.x,this.currentPost.destinationPoint.y),this.currentLink.graphics.quadraticCurveTo(290,240,this.scorePosition.x,this.scorePosition.y)}else if(this.classificationsPosition=this._refClassificationsManager.getClassificationPosition(this.currentPost.model.attributes.classification),a=this.currentPost.attributes.classification,d=this._refPostsManager.getAllPostsWithClassification(a),this.currentFbClassificationName=a,this.classificationsPosition){for(g=0,i=d.length;i>g;g++)b=d[g],this.currentLink.graphics.moveTo(b.destinationPoint.x,b.destinationPoint.y),this.currentLink.graphics.quadraticCurveTo(290,240,this.classificationsPosition.x,this.classificationsPosition.y);
e=this._refScoreManager.getPositionForScore(this._refClassificationsManager.getClassificationScore(a)),this.currentLink.graphics.moveTo(this.classificationsPosition.x,this.classificationsPosition.y),this.currentLink.graphics.quadraticCurveTo(290,240,e.x,e.y)}this.currentLink.graphics.endStroke(),this.currentLink.updateCache()},a.prototype.activateAllLinks=function(){axe.IS_MOBILE?this._refScene.addChild(this.links):this.links.alpha=.4},a.prototype.desactivateAllLinks=function(){axe.IS_MOBILE?this._refScene.removeChild(this.links):this.links.alpha=.2},a.prototype.activateCurrentLink=function(){this.drawCurrentLink(),this._refScene.addChild(this.currentLink)},a.prototype.desactivateCurrentLink=function(){this._refScene.removeChild(this.currentLink),this.currentLink.renderable=!1},a.prototype.clean=function(){var a;return null!=(a=this.links)&&a.graphics.c(),this.links.updateCache(),null},a.prototype.update=function(a){var b,c,d,e;for(this.links&&this.links.updateCache(),e=this._refPostsManager.posts,c=0,d=e.length;d>c;c++)b=e[c],b.id===a.id&&(this.currentPost=a,this.desactivateAllLinks(),this.activateCurrentLink())},a}(),nd=function(){function a(a,b,c){this.cantDragCauseOfOrientation=Vd(this.cantDragCauseOfOrientation,this),this.onPostChange=Vd(this.onPostChange,this),this.initEvents=Vd(this.initEvents,this),this.onCompleteIntroAnimation=Vd(this.onCompleteIntroAnimation,this),this.onUpdateIntroAnimation=Vd(this.onUpdateIntroAnimation,this),this.playIntroAnimation=Vd(this.playIntroAnimation,this),this.update=Vd(this.update,this),this.postTransitionInEnded=Vd(this.postTransitionInEnded,this),this.transitionIn=Vd(this.transitionIn,this),this.initDragger=Vd(this.initDragger,this),this._refScene=b,this.data=a,this.currentService=c,this.posts=[],this.postsContainer=new createjs.Container,this.initPosts(),this.initDragger()}return a.prototype._refScene=null,a.prototype.data=null,a.prototype.postsContainer=null,a.prototype.posts=null,a.prototype.currentPost=null,a.prototype.dragger=null,a.prototype.minAngle=-40,a.prototype.maxAngle=40,a.prototype.currentService="",a.prototype.initPosts=function(a){var b,c,d,e,f,g,h,i,j,k;for(b=(this.maxAngle-this.minAngle)/this.data.length,d=this.minAngle,g=j=0,k=this.data.models.length;k>=0?k>j:j>k;g=k>=0?++j:--j)h=this.data.models[g],e=220*Math.cos(d*(Math.PI/180))+this._refScene.width/2,f=220*Math.sin(d*(Math.PI/180))+this._refScene.height/2,c={color:a,originPoint:{x:this._refScene.width/2,y:this._refScene.height/2},destinationPoint:{x:e,y:f}},i=new md(h,c),this.postsContainer.addChild(i.el),this.posts.push(i),d+=b},a.prototype.initDragger=function(a){var b,c,d;"tw"===this.currentService?b=axe.appData.USER.model.get("info.tw.avatar"):"fb"===this.currentService?b=axe.appData.USER.model.get("info.fb.avatar"):"ig"===this.currentService&&(b=axe.appData.USER.model.get("info.ig.avatar")),a={img:b,range:{min:-40,max:40},startAngle:-40,circleAnchor:{radius:263,center:{x:this._refScene.width/2,y:this._refScene.height/2}},imgOnlyMode:!0,externalImg:!0,service:this.currentService},d=a.circleAnchor.radius*Math.sin(a.startAngle)+this._refScene["with"]/2,c=a.circleAnchor.radius*Math.cos(a.startAngle)+this._refScene.height/2,this.dragger=new fd(a),this.dragger.state="intro"},a.prototype.getAllPostsWithClassification=function(a){var b,c,d,e,f;for(b=[],f=this.posts,d=0,e=f.length;e>d;d++)c=f[d],c.attributes.classification===a&&b.push(c);return b},a.prototype.transitionIn=function(){var a,b,c,d,e;for(this.playIntroAnimation(),a=b=c=this.posts.length-1;0>=c?0>b:b>0;a=0>=c?++b:--b)null!=(d=this.posts[a])&&(d.transitionEnded=this.postTransitionInEnded),null!=(e=this.posts[a])&&e.transitionIn(.01*(this.posts.length-a));return null},a.prototype.postTransitionInEnded=function(){return null},a.prototype.update=function(){var a,b,c,d;for(d=this.posts,b=0,c=d.length;c>b;b++)a=d[b],a.update(this.dragger.angle,this)},a.prototype.playIntroAnimation=function(){this.dragger.angle=this.dragger.config.range.max+10,TweenLite.to(this.dragger,1.33,{angle:this.dragger.config.range.min-1,onUpdate:this.onUpdateIntroAnimation,onComplete:this.onCompleteIntroAnimation}),TweenLite.to(this.dragger.el,.7,{alpha:1})},a.prototype.onUpdateIntroAnimation=function(){},a.prototype.onCompleteIntroAnimation=function(){this.dragger.state="dragging",this.initEvents(),this.dragger.hasStartOnce=!0},a.prototype.initEvents=function(){return this.dragger.onFocus=function(a){return function(){return a.update(a.dragger.angle)}}(this),this.dragger.onMove=this.update,this.dragger.onRelease=function(a){return function(){a.onDraggerRelease()}}(this),null},a.prototype.clean=function(){var a,b,c,d;for(this.dragger.el.alpha=0,d=this.posts,b=0,c=d.length;c>b;b++)a=d[b],a.hide();return null},a.prototype.onPostChange=function(){},a.prototype.onDraggerFocus=function(){},a.prototype.onDraggerMove=function(){},a.prototype.onDraggerRelease=function(){},a.prototype.cantDragCauseOfOrientation=function(){},a}(),od=function(){function a(a){this._refScene=a,this.el=new createjs.Container,this.drawScoreMarkers(),this.drawLegend(),this.el.cache(68,250,260,260)}return a.prototype._refScene=null,a.prototype.el=null,a.prototype.curve=null,a.prototype.legend=null,a.prototype.radius=215,a.prototype.drawScoreMarkers=function(){return this.curve=new createjs.Shape,this.curve.graphics.setStrokeStyle(10,"square"),this.curve.graphics.beginStroke("#a1d7e8"),this.curve.graphics.arc(this._refScene.width/2,this._refScene.height/2,this.radius,Ic.toRadians(90),Ic.toRadians(120),!1),this.curve.graphics.beginStroke("#d24649"),this.curve.graphics.arc(this._refScene.width/2,this._refScene.height/2,this.radius,Ic.toRadians(150),Ic.toRadians(180),!1),this.curve.graphics.beginStroke("#876d9b"),this.curve.graphics.arc(this._refScene.width/2,this._refScene.height/2,this.radius,Ic.toRadians(120),Ic.toRadians(150),!1),this.el.addChild(this.curve),null},a.prototype.drawLegend=function(){var a,b,c,d;return this.legend=new createjs.Container,d=new createjs.Text("-500","20px tungstenmedium","#a1d7e8"),d.x=(this.radius+10)*Math.cos(Ic.toRadians(90))+this._refScene.width/2,d.y=(this.radius+10)*Math.sin(Ic.toRadians(90))+this._refScene.height/2,c=new createjs.Text("-200","20px tungstenmedium","#876d9b"),c.x=(this.radius+22)*Math.cos(Ic.toRadians(123))+this._refScene.width/2,c.y=(this.radius+22)*Math.sin(Ic.toRadians(123))+this._refScene.height/2,a=new createjs.Text("+200","20px tungstenmedium","#876d9b"),a.x=(this.radius+35)*Math.cos(Ic.toRadians(155))+this._refScene.width/2,a.y=(this.radius+35)*Math.sin(Ic.toRadians(155))+this._refScene.height/2,b=new createjs.Text("+500","20px tungstenmedium","#d24649"),b.x=(this.radius+38)*Math.cos(Ic.toRadians(183))+this._refScene.width/2,b.y=(this.radius+38)*Math.sin(Ic.toRadians(183))+this._refScene.height/2,this.legend.addChild(d),this.legend.addChild(c),this.legend.addChild(a),this.legend.addChild(b),this.el.addChild(this.legend),null},a.prototype.getPositionForScore=function(a){var b,c;return b={x:0,y:0},c=Ic.map(a,-500,500,90,183),b.x=this.radius*Math.cos(Ic.toRadians(c))+this._refScene.width/2,b.y=this.radius*Math.sin(Ic.toRadians(c))+this._refScene.height/2,b},a.prototype.getColorForScore=function(a){return this.c=500>=a&&a>200?"#d24649":200>=a&&a>-200?"#886d9c":"#9fd8e9",this.c},a}(),ed=function(a){function b(){this.onDimsUpdate=Vd(this.onDimsUpdate,this),this.update=Vd(this.update,this),this.updatePostInfos=Vd(this.updatePostInfos,this),this.reload=Vd(this.reload,this),this.render=Vd(this.render,this),b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.GRAPH_TYPE="spirograph",b.prototype.className="graph spirograph-graph",b.prototype.postInfos=null,b.prototype.graph=null,b.prototype.scorePanel=null,b.prototype.isInit=!1,b.prototype.currentService="",b.prototype.initialize=function(){if(b.__super__.initialize.call(this),this.axe().appData.USER.model.get("scores.ig.judgement")||this.axe().appData.USER.model.get("scores.tw.judgement")||this.axe().appData.USER.model.get("scores.fb.judgement")){if(this.isInit)return;this.isInit=!0,this.initPostInfos(),this.initGraph(),this.initScorePanel()}else this.axe().appView.on("showDashboardStart",function(a){return function(){return a.isInit?void 0:(a.isInit=!0,a.initPostInfos(),a.initGraph(),a.initScorePanel())}}(this));return null},b.prototype.render=function(){return b.__super__.render.call(this),null},b.prototype.updateOnShow=function(){var a,b;return null!=(a=this.postInfos.currentInfos)&&a.hide(),this.scorePanel.updateUI(this.graph.currentService),null!=(b=this.graph)&&b.clean(),null},b.prototype.initPostInfos=function(){return this.postInfos=new kd,this.el.appendChild(this.postInfos.el),null},b.prototype.initGraph=function(){return this.graph=new Nb,this.el.appendChild(this.graph.scene.canvasEl),this.graph.onPostChange=this.updatePostInfos,this.graph.onServiceChange=this.postInfos.switchPanel,this.postInfos.facebookInfos._refClassificationsManager=this.graph.classificationsManager,null},b.prototype.initScorePanel=function(){return this.scorePanel=new pd,this.el.appendChild(this.scorePanel.el),this.scorePanel.onServiceChange=this.reload,this.postInfos.switchPanel(this.scorePanel.currentService),null},b.prototype.initEvents=function(){return this.axe().appView.on("updateDims",this.onDimsUpdate),this.scorePanel.initEvents(),null},b.prototype.removeEvents=function(){return this.axe().appView.off("updateDims",this.onDimsUpdate),this.scorePanel.removeEvents(),null},b.prototype.reload=function(){return this.postInfos.switchPanel(this.scorePanel.currentService),this.graph.reload(this.scorePanel.currentService),null},b.prototype.updatePostInfos=function(a){return this.postInfos.update(a,this.graph.linksManager.currentFbClassificationName),null},b.prototype.update=function(){return console.log("hey"),this.graph.update(),null},b.prototype.mute=function(){return console.log("[Spirograph] mute"),this.removeEvents(),null},b.prototype.unMute=function(){return console.log("[Spirograph] unmute"),this.initEvents(),null},b.prototype.onDimsUpdate=function(a){var b;return null!=(b=this.graph)&&b.resize(a),null},b.prototype.onSpiroServiceSelectorChange=function(a){return this.graph.onSpiroServiceSelectorChange(a),null},b}(g),fd=function(a){function b(){return this.cantDragCauseOfOrientation=Vd(this.cantDragCauseOfOrientation,this),this.onInteractionEnd=Vd(this.onInteractionEnd,this),this.onInteractionMove=Vd(this.onInteractionMove,this),this.onInteractionStart=Vd(this.onInteractionStart,this),this.transitionInImg=Vd(this.transitionInImg,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.img=null,b.prototype.borderCircle=null,b.prototype.percent=null,b.prototype.canDrag=!1,b.prototype.rad=0,b.prototype.angle=0,b.prototype.x=0,b.prototype.y=0,b.prototype.circleAnchor=null,b.prototype.range=null,b.prototype.onFocus=null,b.prototype.onMove=null,b.prototype.config=null,b.prototype.profileSection=null,b.prototype.userPic=null,b.prototype.initialize=function(a,b){this.profileSection=b,this.el=new createjs.Container,this.el.regX=27,this.el.regY=27,this.el.cursor="pointer",this.el.mouseEnabled=!0,this.config=a,this.circleAnchor=this.config.circleAnchor,this.range=this.config.range,this.scaleOnInteractionStart=this.config.scaleOnInteractionStart||!0,this.x=this.config.circleAnchor.radius*Math.cos(Ic.toRadians(this.config.startAngle))+this.config.circleAnchor.center.x,this.y=this.config.circleAnchor.radius*Math.sin(Ic.toRadians(this.config.startAngle))+this.config.circleAnchor.center.y,this.el.x=this.x,this.el.y=this.y,this.initBorderCircle(),a.imgOnlyMode?this.initImg(1):a.txtOnlyMode?this.initTxt():(this.initTxt(),this.initImg(0)),this.el.alpha=0,this.initEvents()},b.prototype.initBorderCircle=function(){this.borderCircle=new createjs.Shape,this.borderCircle.graphics.setStrokeStyle(2,"round"),this.borderCircle.graphics.beginStroke("#999999"),this.borderCircle.graphics.beginFill("rgba(255, 255, 255, 1)"),this.borderCircle.graphics.drawCircle(0,0,27),this.borderCircle.graphics.endFill(),this.borderCircle.regX=this.borderCircle.regY=-27,this.el.addChild(this.borderCircle)},b.prototype.initImg=function(){var a,b;this.imgMask=new createjs.Shape,this.imgMask.graphics.beginFill("#000"),this.imgMask.graphics.drawCircle(27,27,27),this.imgMask.graphics.endFill(),b=axe.BASE_PATH+"/image.php?img="+this.config.img,a=new Image,a.onload=function(c){return function(){var d,e;c.img=new cjs.Container,e=new cjs.Bitmap(a),e.x=e.image.width/-2,e.y=e.image.height/-2,c.img.addChild(e),c.img.scaleX=c.img.scaleY=54/Math.min(e.image.width,e.image.height),d=c.img.addChild(new cjs.Shape),d.graphics.f("#000").drawCircle(0,0,Math.min(e.image.width,e.image.height)/2),d.compositeOperation="destination-in",c.img.cache(e.image.width/-2,e.image.height/-2,e.image.width,e.image.height),c.img.x=27,c.img.y=27,c.img.cursor="pointer",c.img.mouseEnabled=!0,c.el.addChild(c.img),c.transitionInImg(),c.axe().appView.spiroServiceSelector&&c.axe().appView.spiroServiceSelector.updateUserPic(b,a.width,a.height)}}(this),a.src=b},b.prototype.transitionInImg=function(){return TweenLite.to(this.img,.3,{alpha:1}),null},b.prototype.initTxt=function(){this.percent=new createjs.Text("100","bold 20px Arial","#333"),this.percent.x=(54-this.percent.getMeasuredWidth())/2,this.percent.y=34,this.percent.textBaseline="alphabetic",this.el.addChild(this.percent)},b.prototype.initEvents=function(){this.el.on("mousedown",this.onInteractionStart),this.el.on("pressmove",this.onInteractionMove),this.el.on("pressup",this.onInteractionEnd)},b.prototype.onInteractionStart=function(a){a.preventDefault(),this.canDrag=!0,this.onFocus(),!this.scaleOnInteractionStart},b.prototype.onInteractionMove=function(a){var b,c;return a.preventDefault(),this.axe().IS_MOBILE&&"portrait"===this.axe().appView.dims.o||this.axe().IS_TABLET&&"portrait"===this.axe().appView.dims.o?(this.cantDragCauseOfOrientation(),void 0):(a.rawX?(b=a.rawX,c=a.rawY):(b=a.touches[0].clientX,c=a.touches[0].clientY),this.canDrag&&(this.rad=Math.atan2(c-this.circleAnchor.center.y,b-this.circleAnchor.center.x),this.angle=Ic.toDegree(this.rad),this.x=this.circleAnchor.radius*Math.cos(this.rad)+this.circleAnchor.center.x,this.y=this.circleAnchor.radius*Math.sin(this.rad)+this.circleAnchor.center.y,Ic.isInRange(this.angle,this.range.min,this.range.max)?(this.el.x=this.x,this.el.y=this.y,this.onMove(this.angle)):(this.angle<=this.range.min?(this.angle=this.range.min,this.x=this.circleAnchor.radius*Math.cos(Ic.toRadians(this.range.min))+this.circleAnchor.center.x,this.y=this.circleAnchor.radius*Math.sin(Ic.toRadians(this.range.min))+this.circleAnchor.center.y,this.el.x=this.x,this.el.y=this.y,this.onMove(this.range.min)):this.angle>=this.range.max&&(this.angle=this.range.max,this.x=this.circleAnchor.radius*Math.cos(Ic.toRadians(this.range.max))+this.circleAnchor.center.x,this.y=this.circleAnchor.radius*Math.sin(Ic.toRadians(this.range.max))+this.circleAnchor.center.y,this.el.x=this.x,this.el.y=this.y,this.onMove(this.range.max)),this.onInteractionMove)),void 0)},b.prototype.onInteractionEnd=function(){TweenLite.to(this.el,.15,{scaleX:1,scaleY:1}),this.canDrag=!1,this.onRelease()},b.prototype.moveToAngle=function(){this.x=this.circleAnchor.radius*Math.cos(Ic.toRadians(this.angle))+this.circleAnchor.center.x,this.y=this.circleAnchor.radius*Math.sin(Ic.toRadians(this.angle))+this.circleAnchor.center.y,this.el.x=this.x,this.el.y=this.y},b.prototype.fadeInImg=function(){TweenLite.to(this.img,.3,{alpha:1})},b.prototype.fadeOutTxt=function(){TweenLite.to(this.percent,.3,{alpha:0})},b.prototype.updatePercent=function(a){this.percent.text=a>0?"+"+a:a,this.percent.x=(54-this.percent.getMeasuredWidth())/2},b.prototype.updateTextColor=function(a){this.percent.color=a},b.prototype.onFocus=function(){},b.prototype.onMove=function(){},b.prototype.onRelease=function(){},b.prototype.cantDragCauseOfOrientation=function(){},b}(g),md=function(a){function b(){return this.update=Vd(this.update,this),this.transitionEnded=Vd(this.transitionEnded,this),this.onTransitionInComplete=Vd(this.onTransitionInComplete,this),this.onTransitionUpdate=Vd(this.onTransitionUpdate,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.el=null,b.prototype.bar=null,b.prototype.barWidth=2,b.prototype.link=null,b.prototype.id=0,b.prototype.originPoint=null,b.prototype.destinationPoint=null,b.prototype.angle=0,b.prototype.textarea=null,b.prototype.classification=null,b.prototype.isDrawable=!1,b.prototype.tweetId=null,b.prototype.hotness=0,b.prototype.config=null,b.prototype.color="#bbbbbb",b.prototype.canShowLink=!1,b.prototype.initialize=function(a,b){this.model=a,this.config=b,this.originPoint=this.config.originPoint,this.destinationPoint=this.config.destinationPoint,this.angle=Math.atan2(this.destinationPoint.y-this.originPoint.y,this.destinationPoint.x-this.originPoint.x)*(180/Math.PI),this.textarea=document.getElementsByClassName("textArea")[0],this.id=this.model.attributes.id,this.el=new createjs.Container,this.el.alpha=0,"tryingTooHard"===this.model.attributes.judgement?this.color=this.linkColor="#d24649":"effortless"===this.model.attributes.judgement?this.color=this.linkColor="#886d9c":"notHardEnough"===this.model.attributes.judgement&&(this.color=this.linkColor="#9fd8e9"),this.barWidth=this.model.attributes.action?2:4,this.drawBar()},b.prototype.drawBar=function(){this.bar=new createjs.Shape,this.bar.graphics.setStrokeStyle(this.barWidth,"square"),this.bar.graphics.beginStroke(this.color),this.bar.graphics.moveTo(this.originPoint.x,this.originPoint.y),this.bar.graphics.lineTo(this.destinationPoint.x,this.destinationPoint.y),this.el.addChild(this.bar)},b.prototype.transitionIn=function(a){return this.tween=new TweenLite(this.el,.15,{alpha:1,delay:a,onUpdate:this.onTransitionUpdate,onComplete:this.onTransitionInComplete}),null},b.prototype.onTransitionUpdate=function(){return this.el.alpha>=.15&&!this.canShowLink&&(this.canShowLink=!0),null},b.prototype.onTransitionInComplete=function(){return this.transitionEnded(),null},b.prototype.transitionOut=function(){return null},b.prototype.show=function(){return this.el.alpha=1,this.canShowLink=!0,null},b.prototype.hide=function(){return this.el.alpha=0,this.canShowLink=!1,null},b.prototype.transitionEnded=function(){return null},b.prototype.update=function(a,b){a>=this.angle-.45&&a<=this.angle+.45?(this.bar.alpha=1,b.currentPost=this,b.onPostChange(this)):this.bar.alpha=1},b}(Backbone.View),pd=function(a){function b(){this.getScoreLabel=Vd(this.getScoreLabel,this),this.updateUI=Vd(this.updateUI,this),this.switchService=Vd(this.switchService,this),b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.template="section-profile-score-panel",b.prototype.totalScore=0,b.prototype.totalScoreLabel="",b.prototype.twitterScore=0,b.prototype.facebookScore=0,b.prototype.instagramScore=0,b.prototype.totalField=null,b.prototype.twitterField=null,b.prototype.facebookField=null,b.prototype.instagramField=null,b.prototype.arrow=null,b.prototype.currentTab=null,b.prototype.currentService="",b.prototype.initialize=function(){return b.__super__.initialize.call(this),this.totalField=this.el.getElementsByClassName("totalScore")[0].getElementsByClassName("number")[0],this.totalScoreLabel=this.el.getElementsByClassName("totalScore")[0].getElementsByClassName("label")[0],this.twitterField=this.el.getElementsByClassName("twitter")[0].getElementsByClassName("number")[0],this.facebookField=this.el.getElementsByClassName("facebook")[0].getElementsByClassName("number")[0],this.instagramField=this.el.getElementsByClassName("instagram")[0].getElementsByClassName("number")[0],this.update(),null},b.prototype.initEvents=function(){return null},b.prototype.removeEvents=function(){return this.$el.find(".btnMode").off("click",this.switchService),null},b.prototype.switchService=function(a,b){return null==b&&(b=!0),$(a.currentTarget).hasClass("active")?void 0:($(a.currentTarget).hasClass("twitter")?this.currentService="tw":$(a.currentTarget).hasClass("facebook")?this.currentService="fb":$(a.currentTarget).hasClass("instagram")&&(this.currentService="ig"),this.currentTab&&(this.currentTab.removeClass("active"),$(this.currentTab).find(".arrow").removeClass("show")),this.currentTab=$(a.currentTarget),this.currentTab.addClass("active"),$(this.currentTab).find(".arrow").addClass("show"),b&&this.onServiceChange(),this.axe().analytics.track("sbd_toggle_networks"),null)},b.prototype.updateUI=function(a){return this.totalScoreLabel.innerHTML=this.getScoreLabel(),$(this.twitterField).parent().parent().removeClass("active").find(".arrow").removeClass("show"),$(this.facebookField).parent().parent().removeClass("active").find(".arrow").removeClass("show"),$(this.instagramField).parent().parent().removeClass("active").find(".arrow").removeClass("show"),this.currentService=a,this.currentTab="tw"===this.currentService?$(this.twitterField).parent().parent():"fb"===this.currentService?$(this.facebookField).parent().parent():$(this.instagramField).parent().parent(),this.currentTab.addClass("active").find(".arrow").addClass("show"),this.update(),null},b.prototype.update=function(){return this.totalScore=Ic.getNiceScore(this.axe().appData.USER.model.get("scores.total.score")),this.axe().appData.USER.model.get("scores.ig.judgement")&&(this.instagramScore=Ic.getNiceScore(axe.appData.USER.model.get("scores.ig.total")),this.currentService="ig"),this.axe().appData.USER.model.get("scores.fb.judgement")&&(this.facebookScore=Ic.getNiceScore(axe.appData.USER.model.get("scores.fb.total")),this.currentService="fb"),this.axe().appData.USER.model.get("scores.tw.judgement")&&(this.currentService="tw",this.twitterScore=Ic.getNiceScore(axe.appData.USER.model.get("scores.tw.total"))),$(this.totalField).parent().addClass(axe.appData.USER.model.get("scores.total.judgement")),this.totalField.innerHTML=this.totalScore,this.axe().appData.USER.model.get("scores.tw.judgement")?$(this.twitterField).parent().parent().hasClass("btnMode")||($(this.twitterField).parent().parent().addClass(axe.appData.USER.model.get("scores.tw.judgement")+" btnMode").on("click",this.switchService),this.twitterField.innerHTML=this.twitterScore):(this.twitterScore=axe.appData.USER.model.get("scores.tw.total")?Ic.getNiceScore(axe.appData.USER.model.get("scores.tw.total")):"-",this.twitterScore="-"),this.axe().appData.USER.model.get("scores.fb.judgement")?$(this.facebookField).parent().parent().hasClass("btnMode")||($(this.facebookField).parent().parent().addClass(axe.appData.USER.model.get("scores.fb.judgement")+" btnMode").on("click",this.switchService),this.facebookField.innerHTML=this.facebookScore):this.facebookScore=axe.appData.USER.model.get("scores.fb.total")?Ic.getNiceScore(axe.appData.USER.model.get("scores.fb.total")):"-",this.axe().appData.USER.model.get("scores.ig.judgement")?$(this.instagramField).parent().parent().hasClass("btnMode")||($(this.instagramField).parent().parent().addClass(axe.appData.USER.model.get("scores.ig.judgement")+" btnMode").on("click",this.switchService),this.instagramField.innerHTML=this.instagramScore):axe.appData.USER.model.get("scores.ig.total")?this.score=Ic.getNiceScore(axe.appData.USER.model.get("scores.ig.total")):this.instagramScore="-",null},b.prototype.getScoreLabel=function(){var a,b,c,d;a=0,d=this.axe().appData.USER.model.get("logged");for(b in d)c=d[b],c&&a++;return a>1?this.axe().locale.get("header_user_score_average"):this.axe().locale.get("header_user_score_total")},b.prototype.onServiceChange=function(){return null},b}(g),qd=function(a){function b(){return this.invisible=Vd(this.invisible,this),this.visible=Vd(this.visible,this),this.updateUserPic=Vd(this.updateUserPic,this),this.onServiceChanged=Vd(this.onServiceChanged,this),this.updateDims=Vd(this.updateDims,this),this.onServiceClick=Vd(this.onServiceClick,this),this.animateOut=Vd(this.animateOut,this),this.animateIn=Vd(this.animateIn,this),this.setListeners=Vd(this.setListeners,this),this.dispose=Vd(this.dispose,this),this.hide=Vd(this.hide,this),this.init=Vd(this.init,this),this.userModel=this.axe().appData.USER.model,this.userStatus=this.axe().appData.USER.status,this.templateVars={services:{tw:this.userStatus.get("tw"),fb:this.userStatus.get("fb"),ig:this.userStatus.get("ig")},scores:{total:Ic.getNiceScore(this.axe().appData.USER.model.get("scores.total.score")),tw:Ic.getNiceScore(this.axe().appData.USER.model.get("scores.tw.total")),fb:Ic.getNiceScore(this.axe().appData.USER.model.get("scores.fb.total")),ig:Ic.getNiceScore(this.axe().appData.USER.model.get("scores.ig.total"))},judgement:{total:this.axe().appData.USER.model.get("scores.total.judgement"),tw:this.axe().appData.USER.model.get("scores.tw.judgement"),fb:this.axe().appData.USER.model.get("scores.fb.judgement"),ig:this.axe().appData.USER.model.get("scores.ig.judgement")}},b.__super__.constructor.call(this),this.postTmpl=_.template(this.axe().templates.get("spirograph-service-selector-inner")),this.$el.html(this.postTmpl(this.templateVars)),this.userPicStyle=this.el.getElementsByClassName("inner")[0].getElementsByClassName("user")[0].getElementsByClassName("user-pic-holder")[0].style,this.axe().appView.addChild(this),this.setListeners("on"),null}return Ud(b,a),b.prototype.userModel=null,b.prototype.userStatus=null,b.prototype.template="spirograph-service-selector",b.prototype.img=null,b.prototype.init=function(){return this.setListeners("on"),this.animateIn(),null},b.prototype.hide=function(a){return this.animateOut(function(b){return function(){return b.invisible(),b.setListeners("off"),"function"==typeof a?a():void 0}}(this)),null},b.prototype.dispose=function(){return this.setListeners("off"),null},b.prototype.setListeners=function(a){return this.$el.find("[data-service]")[a]("click",this.onServiceClick),this.axe().appView[a]("updateDims",this.updateDims),null},b.prototype.animateIn=function(){return"landscape"===this.axe().appView.dims.o?(this.visible(),this.setListeners("on"),TweenLite.to(this.$el,.3,{visibility:"visible",opacity:1,ease:Quad.easeOut}),TweenLite.to(this.$el.find(".inner"),.3,{delay:.15,transform:"scale(1)",visibility:"visible",opacity:1,ease:Back.easeOut}),null):void 0},b.prototype.animateOut=function(a){return TweenLite.to(this.$el,.3,{delay:.15,opacity:0,ease:Quad.easeOut,onComplete:a}),TweenLite.to(this.$el.find(".inner"),.3,{transform:"scale(0.8)",opacity:0,ease:Back.easeIn}),null},b.prototype.onServiceClick=function(a){return this.hide(),this.onServiceChanged(a.currentTarget.classList[0]),null},b.prototype.updateDims=function(a){return"portrait"===a.o&&this.hide(),null},b.prototype.onServiceChanged=function(){return null},b.prototype.updateUserPic=function(a,b,c){var d,e,f,g;return e=f=50/Math.min(b,c),g=b*e,d=c*f,this.userPicStyle.backgroundImage="url("+a+")",this.userPicStyle.backgroundSize=""+g+"px "+d+"px",null},b.prototype.visible=function(){return this.el.style.display="block",null},b.prototype.invisible=function(){return this.el.style.display="none",null},b.prototype.update=function(){return this.templateVars={services:{tw:this.userStatus.get("tw"),fb:this.userStatus.get("fb"),ig:this.userStatus.get("ig")},scores:{total:Ic.getNiceScore(this.axe().appData.USER.model.get("scores.total.score")),tw:Ic.getNiceScore(this.axe().appData.USER.model.get("scores.tw.total")),fb:Ic.getNiceScore(this.axe().appData.USER.model.get("scores.fb.total")),ig:Ic.getNiceScore(this.axe().appData.USER.model.get("scores.ig.total"))},judgement:{total:this.axe().appData.USER.model.get("scores.total.judgement"),tw:this.axe().appData.USER.model.get("scores.tw.judgement"),fb:this.axe().appData.USER.model.get("scores.fb.judgement"),ig:this.axe().appData.USER.model.get("scores.ig.judgement")}},this.$el.html(this.postTmpl(this.templateVars)),null},b}(g),Gd=function(){function a(a,b,c,d){this.onTweetChange=Vd(this.onTweetChange,this),this._refScene=d,this.data=a,this.tweets=[],this.tweetsRange=b,this.initTweets(c,b)}return a.prototype.tweets=null,a.prototype.tweetsRange=null,a.prototype.canUpdate=!1,a.prototype.currentActiveTweet=null,a.prototype._refScene=null,a.prototype.initTweets=function(a,b){var c,d,e,f,g,h,i,j,k,l;for(c=(b.max-b.min)/this.data.length,e=this.tweetsRange.min,h=k=0,l=this.data.length;l>=0?l>k:k>l;h=l>=0?++k:--k)i=this.data[h],f=220*Math.cos(e*(Math.PI/180))+this._refScene.width/2,g=220*Math.sin(e*(Math.PI/180))+this._refScene.height/2,d={color:a,originPoint:{x:this._refScene.width/2,y:this._refScene.height/2},destinationPoint:{x:f,y:g}},j=new md(i,d),this.tweets.push(j),e+=c},a.prototype.update=function(a){var b,c,d,e;for(e=this.tweets,c=0,d=e.length;d>c;c++)b=e[c],b.update(a,this)},a.prototype.onTweetChange=function(){},a}(),Dd=function(a){function b(a){return this.service=a,this.onTicker=Vd(this.onTicker,this),this.init=Vd(this.init,this),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.className="graph tweet-generator-graph",b.prototype.graph=null,b.prototype.init=function(){return this.graph=new Fd(this),null},b.prototype.onLoggedUpdate=function(){return this.graph.onLoggedUpdate(),null},b.prototype.initEvents=function(){return createjs.Ticker.addEventListener("tick",this.onTicker),null},b.prototype.removeEvents=function(){return createjs.Ticker.removeEventListener("tick",this.onTicker),null},b.prototype.onTicker=function(){return this.graph.scene.update(),null},b.prototype.mute=function(){return console.log("[Bubbles] mute"),this.removeEvents(),null},b.prototype.unMute=function(){return console.log("[Bubbles] unmute"),this.initEvents(),null},b}(g),Ed=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype._refScene=null,b.prototype.el=null,b.prototype.curve=null,b.prototype.legend=null,b.prototype.initialize=function(){return this.el=new createjs.Container,this.initGauge(),null},b.prototype.initGauge=function(){return this.curve=new createjs.Shape,this.curve.graphics.setStrokeStyle(10,"square"),this.curve.graphics.beginStroke("#A1D7E8"),this.curve.graphics.arc(175,-20,110,Ic.toRadians(30),Ic.toRadians(70),!1),this.curve.graphics.beginStroke("#D24649"),this.curve.graphics.arc(175,-20,110,Ic.toRadians(110),Ic.toRadians(150),!1),this.curve.graphics.beginStroke("#876D9B"),this.curve.graphics.arc(175,-20,110,Ic.toRadians(70),Ic.toRadians(110),!1),this.curve.cache(0,0,350,200),this.el.addChild(this.curve),null},b}(Backbone.View),Fd=function(a){function b(a){this.getText=Vd(this.getText,this),this.initDateFrom=Vd(this.initDateFrom,this),this.addTweetText=Vd(this.addTweetText,this),this.getColorFromScore=Vd(this.getColorFromScore,this),this.getScoreFromAngle=Vd(this.getScoreFromAngle,this),this.updateDraggerValue=Vd(this.updateDraggerValue,this),this.onDraggerMove=Vd(this.onDraggerMove,this),this.setup=Vd(this.setup,this),this.begin=Vd(this.begin,this),this.buildTweets=Vd(this.buildTweets,this),this.parent=a,b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.parent=null,b.prototype.collection=null,b.prototype.dragger=null,b.prototype.gauge=null,b.prototype.options=null,b.prototype.$tweetHolder=null,b.prototype.originalText=null,b.prototype.tweets=null,b.prototype.MAX_SCORE=500,b.prototype.initialize=function(){return b.__super__.initialize.call(this),this.tweets=this.buildTweets(),this.begin(),null},b.prototype.buildTweets=function(){var a;return a=[{range_lower:-500,range_upper:-450,text:this.axe().locale.get("generated_tweet_minus450_to_minus500")},{range_lower:-450,range_upper:-300,text:this.axe().locale.get("generated_tweet_minus300_to_minus450")},{range_lower:-300,range_upper:-150,text:this.axe().locale.get("generated_tweet_minus150_to_minus300")},{range_lower:-150,range_upper:-50,text:this.axe().locale.get("generated_tweet_minus50_to_minus150")},{range_lower:-50,range_upper:50,text:"Experiment with the effort slider to generate tweets hither and yonder  across the social effort scale"},{range_lower:50,range_upper:150,text:this.axe().locale.get("generated_tweet_plus50_to_plus150")},{range_lower:150,range_upper:350,text:this.axe().locale.get("generated_tweet_plus150_to_plus300")},{range_lower:300,range_upper:450,text:this.axe().locale.get("generated_tweet_plus300_to_plus450")},{range_lower:450,range_upper:500,text:this.axe().locale.get("generated_tweet_plus450_to_plus500")}]
},b.prototype.begin=function(){return this.$tweetHolder=$(".tweet-generator").find("h3"),this.setup(),this.initGauge(),this.initDateFrom(),this.initDragger(),this.initDraggerMarkLimits(),this.scene.update(),this.initEvent(),window.what=this,null},b.prototype.initEvent=function(){return this.$tweetHolder.length||(this.$tweetHolder=$(".tweet-generator").find("h3")),this.$tweetHolder.on("click",this.onTweetClick),null},b.prototype.onTweetClick=function(){return"true"===$(this).attr("contenteditable")&&(document.execCommand("selectAll",!1,null),console.log("test")),null},b.prototype.initGauge=function(){return this.gauge=new Ed,this.scene.addChild(this.gauge.el),null},b.prototype.initDragger=function(){var a;return a={imgOnlyMode:!1,rotateText:!0,txtOnlyMode:!0,startAngle:89.5,circleAnchor:{radius:160,center:{x:175,y:-20}},range:{min:27,max:152}},this.options=a,this.dragger=new L(a),this.dragger.onAnimUpdate=function(a){return function(){return a.scene.update()}}(this),this.initLinkBar(),this.dragger.angle=this.options.startAngle,this.dragger.onMove=function(a){return function(){return a.onDraggerMove()}}(this),this.dragger.upArrow.alpha=1,this.dragger.bottomArrow.alpha=1,this.scene.addChild(this.dragger.el),this.updateDraggerValue(),this.scene.update(),null},b.prototype.initDraggerMarkLimits=function(){var a,b,c,d;return c=(this.options.circleAnchor.radius-54)*Ic.MATH_COS(this.dragger.config.range.min*(Math.PI/180))+this.options.circleAnchor.center.x,d=(this.options.circleAnchor.radius-54)*Ic.MATH_SIN(this.dragger.config.range.min*(Math.PI/180))+this.options.circleAnchor.center.y,a=(this.options.circleAnchor.radius-35)*Ic.MATH_COS(this.dragger.config.range.min*(Math.PI/180))+this.options.circleAnchor.center.x,b=(this.options.circleAnchor.radius-35)*Ic.MATH_SIN(this.dragger.config.range.min*(Math.PI/180))+this.options.circleAnchor.center.y,this.minLimitBar=new createjs.Shape,this.minLimitBar.graphics.setStrokeStyle(2,"round"),this.minLimitBar.graphics.beginStroke("#0x000000"),this.minLimitBar.graphics.moveTo(c,d),this.minLimitBar.graphics.lineTo(a,b),this.minLimitBar.alpha=1,c=(this.options.circleAnchor.radius-54)*Ic.MATH_COS(this.dragger.config.range.max*(Math.PI/180))+this.options.circleAnchor.center.x,d=(this.options.circleAnchor.radius-54)*Ic.MATH_SIN(this.dragger.config.range.max*(Math.PI/180))+this.options.circleAnchor.center.y,a=(this.options.circleAnchor.radius-35)*Ic.MATH_COS(this.dragger.config.range.max*(Math.PI/180))+this.options.circleAnchor.center.x,b=(this.options.circleAnchor.radius-35)*Ic.MATH_SIN(this.dragger.config.range.max*(Math.PI/180))+this.options.circleAnchor.center.y,this.maxLimitBar=new createjs.Shape,this.maxLimitBar.graphics.setStrokeStyle(2,"round"),this.maxLimitBar.graphics.beginStroke("#0x000000"),this.maxLimitBar.graphics.moveTo(c,d),this.maxLimitBar.graphics.lineTo(a,b),this.maxLimitBar.alpha=1,c=(this.options.circleAnchor.radius-54)*Ic.MATH_COS(89.5*(Math.PI/180))+this.options.circleAnchor.center.x,d=(this.options.circleAnchor.radius-54)*Ic.MATH_SIN(89.5*(Math.PI/180))+this.options.circleAnchor.center.y,a=(this.options.circleAnchor.radius-35)*Ic.MATH_COS(89.5*(Math.PI/180))+this.options.circleAnchor.center.x,b=(this.options.circleAnchor.radius-35)*Ic.MATH_SIN(89.5*(Math.PI/180))+this.options.circleAnchor.center.y,this.middleLimitBar=new createjs.Shape,this.middleLimitBar.graphics.setStrokeStyle(2,"round"),this.middleLimitBar.graphics.beginStroke("#0x000000"),this.middleLimitBar.graphics.moveTo(c,d),this.middleLimitBar.graphics.lineTo(a,b),this.middleLimitBar.alpha=1,this.scene.addChild(this.minLimitBar),this.scene.addChild(this.maxLimitBar),this.scene.addChild(this.middleLimitBar),null},b.prototype.initLinkBar=function(){var a,b,c,d;return c=(this.options.circleAnchor.radius-54)*Ic.MATH_COS(0*(Math.PI/180))+this.options.circleAnchor.center.x,d=(this.options.circleAnchor.radius-54)*Ic.MATH_SIN(0*(Math.PI/180))+this.options.circleAnchor.center.y,a=(this.options.circleAnchor.radius-27)*Ic.MATH_COS(0*(Math.PI/180))+this.options.circleAnchor.center.x,b=(this.options.circleAnchor.radius-27)*Ic.MATH_SIN(0*(Math.PI/180))+this.options.circleAnchor.center.y,this.linkBar=new createjs.Shape,this.linkBar.graphics.setStrokeStyle(2,"round"),this.linkBar.graphics.beginStroke("#999999"),this.linkBar.graphics.moveTo(c,d),this.linkBar.graphics.lineTo(a,b),this.scene.addChild(this.linkBar),null},b.prototype.updateLinkBar=function(){var a,b,c,d;return c=(this.options.circleAnchor.radius-54)*Ic.MATH_COS(this.dragger.angle*(Math.PI/180))+this.options.circleAnchor.center.x,d=(this.options.circleAnchor.radius-54)*Ic.MATH_SIN(this.dragger.angle*(Math.PI/180))+this.options.circleAnchor.center.y,a=(this.options.circleAnchor.radius-27)*Ic.MATH_COS(this.dragger.angle*(Math.PI/180))+this.options.circleAnchor.center.x,b=(this.options.circleAnchor.radius-27)*Ic.MATH_SIN(this.dragger.angle*(Math.PI/180))+this.options.circleAnchor.center.y,this.linkBar.graphics.c(),this.linkBar.graphics.setStrokeStyle(2,"round"),this.linkBar.graphics.beginStroke("#999999"),this.linkBar.graphics.moveTo(c,d),this.linkBar.graphics.lineTo(a,b),null},b.prototype.setup=function(){var a,b;if(!this.scene)return this.size=[350,200],b=.75*$(window).innerWidth(),a=b/1.853061224,this.innerSize=[b,a],this.initGraph(this.size[0],this.size[1]),this.parent.el.appendChild(this.scene.canvasEl),this.render(),null},b.prototype.onDraggerMove=function(){return this.updateDraggerValue(),this.scene.update(),null},b.prototype.updateDraggerValue=function(){var a,b;return b=this.getScoreFromAngle(this.dragger.angle),a=this.getColorFromScore(b),this.dragger.updateRotation(),this.dragger.updatePercent(b),this.dragger.updateTextColor(a),this.updateLinkBar(),this.addTweetText(b,a),null},b.prototype.getScoreFromAngle=function(a){var b;return b=Ic.map(a,this.options.range.min,this.options.range.max,-500,500),Math.round(b)},b.prototype.getColorFromScore=function(a){var b;return b=function(){switch(!0){case a>=200:return"#D24649";case-200>=a:return"#A1D7E8";default:return"#876D9B"}}()},b.prototype.addTweetText=function(a,b){var c,d,e;return this.$tweetHolder.length||(this.$tweetHolder=$(".tweet-generator").find("h3")),b=50>a&&a>-50?"#000000":b,e=this.getText(a),d="#000000"===b?"":"pointer",c="#000000"===b?!1:!0,this.$tweetHolder.css({color:b,cursor:d}).attr("data-generated-tweet",c).attr("contenteditable",c).text(e),null},b.prototype.initDateFrom=function(){return this.nowTxt=new createjs.Text("+500","20px tungstensemibold","#D24649"),this.nowTxt.x=35,this.nowTxt.y=40,this.dateTxt=new createjs.Text("-500","20px tungstensemibold","#A1D7E8"),this.dateTxt.x=315,this.dateTxt.y=40,this.dateTxt.textAlign="right",this.scene.addChild(this.nowTxt),this.scene.addChild(this.dateTxt),null},b.prototype.getText=function(a){var b,c,d,e;for(e=this.tweets,c=0,d=e.length;d>c;c++)if(b=e[c],a>b.range_lower-1&&a<=b.range_upper)return b.text;return null},b}(b),Tb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.template="friends-selector",b.prototype.className="friends-selector",b}(g),Ub=function(a){function b(){return this.showLogout=Vd(this.showLogout,this),this.socialClick=Vd(this.socialClick,this),this.updateService=Vd(this.updateService,this),this.setScoreChange=Vd(this.setScoreChange,this),this.updateUserScores=Vd(this.updateUserScores,this),this.updateUserData=Vd(this.updateUserData,this),this.bindEvents=Vd(this.bindEvents,this),this.setListeners=Vd(this.setListeners,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.getScoreLabel=Vd(this.getScoreLabel,this),this.userModel=this.axe().appData.USER.model,this.serviceModel=this.axe().appView.activeService,this.templateVars={label_score:this.getScoreLabel(),label_effort:this.axe().locale.get("header_user_effort"),label_tth:this.axe().locale.get("graph_label_tth"),label_nth:this.axe().locale.get("graph_label_nthe"),label_el:this.axe().locale.get("graph_label_effortless"),label_prompt:this.axe().locale.get("graph_not_analysed"),user_data:this.userModel.toJSON()},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="home-header",b.prototype.className="home-header",b.prototype.$userInfo=null,b.prototype.$userPics=null,b.prototype.$socialBtns=null,b.prototype.$totalScore=null,b.prototype.$numTrans=null,b.prototype.$scoreLabel=null,b.prototype.userModel=null,b.prototype.serviceModel=null,b.prototype.$userName=null,b.prototype.$userPic=null,b.prototype.getScoreLabel=function(){var a,b,c,d;a=0,d=this.userModel.get("logged");for(b in d)c=d[b],c&&a++;return a>1?this.axe().locale.get("header_user_score_average"):this.axe().locale.get("header_user_score_total")},b.prototype.init=function(){return this.$userInfo=this.$el.find("[data-user-info]"),this.$userPics=this.$el.find("[data-user-pic]"),this.$socialBtns=this.$el.find("[data-social-btn]"),this.$totalScore=this.$el.find("[data-total-score]"),this.$numTrans=this.$el.find("[data-numtransition]"),this.$scoreLabel=this.$el.find("[data-score-label]"),this.$scoreChange=this.$el.find("[data-score-change]"),this.setup(),this.setListeners("on"),null},b.prototype.setup=function(){return this.$numTrans.each(function(a,b){return Hc.setup($(b))}),this.updateUserData(),this.updateService(),null},b.prototype.setListeners=function(a){return this.userModel[a]("updateUserData",this.updateUserData),this.serviceModel[a]("change",this.updateService),this.axe().appView[a]("updateUserScores",this.updateUserScores),this.$el[a]("click","[data-social-btn]",this.socialClick),this.$el[a]("click","[data-user]",this.showLogout),null},b.prototype.bindEvents=function(){return null},b.prototype.updateUserData=function(){var a,b;b=this.serviceModel.get("service");for(b in this.axe().appData.USER.model.get("info"))this.userModel.get("logged."+b)&&(this.$userInfo.filter("[data-user-info='"+b+"']").find(".user-name span").html(this.userModel.get("info."+b+".name")+('<i class="icon icon-'+b+'"></i>')).end().find(".user-handle").text(this.userModel.get("info."+b+".username")?"@"+this.userModel.get("info."+b+".username"):""),a=this.userModel.get("info."+b+".avatar")?"url("+this.userModel.get("info."+b+".avatar")+")":"",this.$userPics.filter("[data-user-pic='"+b+"']").css("background-image",a));return this.$scoreLabel.text(this.getScoreLabel()),this.updateService(),null},b.prototype.updateUserScores=function(){var a,b,c,d,e;if(this.userModel.get("scores.total.score")){a=Ic.getNiceScore(this.userModel.get("scores.total.score")),e=this.userModel.get("scores");for(b in e)d=e[b],this.userModel.get("scores."+b+".total")&&(this.$socialBtns.filter("[data-social-btn='"+b+"']").attr("data-judgement",this.userModel.get("scores."+b+".judgement")||"onlyScoreAvailable"),c=Ic.getNiceScore(this.userModel.get("scores."+b+".total")),Hc.update(this.$socialBtns.filter("[data-social-btn='"+b+"']").find(".value"),c));return this.$el.attr("data-user-judgement",this.userModel.get("scores.total.judgement")),Hc.update(this.$totalScore,a),this.setScoreChange(),null}},b.prototype.setScoreChange=function(){var a,b;return a=this.userModel.get("scores.total.difference"),"number"==typeof a&&0!==a?(b=a>0?"increase":"decrease",a=Math.round(a),a=0>a?-1*a:a,this.$scoreChange.removeClass("increase decrease").addClass(b).html("("+a+' <span class="icon"></span>)'),null):void 0},b.prototype.updateService=function(){var a;return a=this.serviceModel.get("service"),this.$el.attr("data-active-service",a).attr("data-active-service-logged",this.userModel.get("logged."+a)),this.$socialBtns.removeClass("active").filter("[data-social-btn='"+a+"']").addClass("active"),null},b.prototype.socialClick=function(a){var b;return b=$(a.currentTarget).data("social-btn"),this.serviceModel.set("service",b),null},b.prototype.showLogout=function(a){return a.preventDefault(),!this.axe().appView.logoutModal&&this.userModel.get("logged."+this.serviceModel.get("service"))?(this.axe().appView.logoutModal=new pc(this.serviceModel.get("service")),null):void 0},b}(g),Vb=function(a){function b(){return this.serviceMute=Vd(this.serviceMute,this),this.serviceUnMute=Vd(this.serviceUnMute,this),this.updateServiceDoneMobile=Vd(this.updateServiceDoneMobile,this),this.updateServiceMobile=Vd(this.updateServiceMobile,this),this.updateServiceDoneNotMobile=Vd(this.updateServiceDoneNotMobile,this),this.updateServiceNotMobile=Vd(this.updateServiceNotMobile,this),this.startDashboardListeners=Vd(this.startDashboardListeners,this),this.bindEvents=Vd(this.bindEvents,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.userModel=this.axe().appData.USER.model,this.serviceModel=this.axe().appView.activeService,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="home-viz",b.prototype.SERVICE_ORDER=["tw","fb","ig"],b.prototype._tw=null,b.prototype._fb=null,b.prototype._ig=null,b.prototype.$services=null,b.prototype.userModel=null,b.prototype.serviceModel=null,b.prototype.init=function(){return this._tw=new c({service:"tw",model:this.userModel}),this._fb=new c({service:"fb",model:this.userModel}),this._ig=new c({service:"ig",model:this.userModel}),this.addChild(this._tw).addChild(this._fb).addChild(this._ig),this.$services=this._tw.$el.add(this._fb.$el).add(this._ig.$el),this.setup(),null},b.prototype.setup=function(){return this.updateService=this.axe().IS_MOBILE?this.updateServiceMobile:this.updateServiceNotMobile,this.updateServiceDone=this.axe().IS_MOBILE?this.updateServiceDoneMobile:this.updateServiceDoneNotMobile,this.bindEvents(),null},b.prototype.bindEvents=function(){return this.serviceModel.on("change",this.updateService),this.axe().appView.on("start",this.startDashboardListeners),null},b.prototype.startDashboardListeners=function(){return this.axe().appView.off("start",this.startDashboardListeners),this.axe().appView.on("showDashboardEnd",this.serviceUnMute),this.axe().appView.on("hideDashboardStart",this.serviceMute),null},b.prototype.updateServiceNotMobile=function(){var a,b,c;return this.$services.css({display:"block"}),b=this.serviceModel.get("service"),c=this.serviceModel.previous("service")?this.serviceModel.previous("service"):null,this.serviceUnMute(b),a=this.SERVICE_ORDER.indexOf(b),Modernizr.csstransforms3d?TweenLite.fromTo(this.$el,.4,{transform:this.$el.css("transform")},{transform:"translate3d(-"+100/3*a+"%,0,0)",ease:Quart.easeInOut,onComplete:function(a){return function(){return a.updateServiceDone(b,c)}}(this)}):TweenLite.fromTo(this.$el,.4,{transform:this.$el.css("transform")},{transform:"translate(-"+100/3*a+"%,0)",ease:Quart.easeInOut,onComplete:function(a){return function(){return a.updateServiceDone(b,c)}}(this)}),null},b.prototype.updateServiceDoneNotMobile=function(a,b){var c;return c=this.SERVICE_ORDER.indexOf(a),Modernizr.csstransforms3d?this.$el.css({transform:"translate3d(-"+100/3*c+"%,0,0)"}):this.$el.css({transform:"translate(-"+100/3*c+"%,0)"}),b&&this.serviceMute(b),this.$services.not(this["_"+a].$el).css({display:"none"}),null},b.prototype.updateServiceMobile=function(){var a,b,c,d;return this.$services.css({display:"block",visibility:"visible"}),c=this.serviceModel.get("service"),d=this.serviceModel.previous("service")?this.serviceModel.previous("service"):null,this.serviceUnMute(c),a=this["_"+c].$el,b=d?this["_"+d].$el:null,d&&TweenLite.to(b,.5,{opacity:0,ease:Quart.easeInOut}),TweenLite.to(a,.4,{delay:d?.5:.1,opacity:1,ease:Quart.easeInOut,onComplete:function(a){return function(){return a.updateServiceDone(c,d)}}(this)}),null},b.prototype.updateServiceDoneMobile=function(a,b){var c;return c=this["_"+a].$el,c.css({opacity:1}),b&&this.serviceMute(b),this.$services.not(c).css({visibility:"hidden",display:"none"}),null},b.prototype.serviceUnMute=function(a){return a=a||this.serviceModel.get("service"),a&&this["_"+a].unMuteAll(),null},b.prototype.serviceMute=function(a){return a=a||this.serviceModel.get("service"),a&&this["_"+a].muteAll(),null},b}(g),qc=function(a){function b(){return this.setup=Vd(this.setup,this),this.hide=Vd(this.hide,this),this.bindEvents=Vd(this.bindEvents,this),this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.templateVars={i10n:{},name:"main-graphs",grid:{size:"4-4",x:"0",y:"0"}},b.prototype.header=null,b.prototype.viz=null,b.prototype.eventBound=!1,b.prototype.elDims={h:{header:null,graphs:null,controls:null,friends:null},w:{graphs:null}},b.prototype.init=function(){return this.axe().IS_MOBILE||(this.header=new Ub,this.addChild(this.header)),this.viz=new Vb,this.addChild(this.viz),this.setup=_.debounce(this.setup,300),this.bindEvents(),null},b.prototype.bindEvents=function(){return this.axe().appView.on("updateDims",this.setup),this.axe().appView.rendered?this.setup():(this.axe().appView.on("allRendered",this.setup),this.eventBound=!0),null},b.prototype.hide=function(a){return TweenLite.to(this.$el.find(".inner"),.5,{opacity:0,onComplete:a}),null},b.prototype.setup=function(){return this.eventBound&&(this.eventBound=!1,this.axe().appView.off("allRendered",this.setup)),setTimeout(function(a){return function(){var b,c,d;return d=a.header?a.header.$el.height():0,b=a.viz._tw.graphControls.$el.height(),c=a.axe().IS_MOBILE?0:a.viz._tw.friendSelector.$el.height(),a.elDims={h:{header:d,graphs:a.$el.find(".inner").height()-(d+b+c),controls:b,friends:c},w:{graphs:a.$el.width()}},a.axe().appView.trigger("elDimsReceived",a.elDims)}}(this),500),null},b}(d),$c=function(a){function b(){return this.parseBtns=Vd(this.parseBtns,this),this.showButtons=Vd(this.showButtons,this),this.init=Vd(this.init,this),this.templateVars.i10n.title=this.axe().locale.get("shareamongpeers_title"),this.templateVars.i10n.desc=this.axe().locale.get("shareamongpeers_description"),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.templateVars={i10n:{},name:"share",grid:{size:"2-1",x:"1",y:"7"}},b.prototype.init=function(){return this.showButtons(),null},b.prototype.showButtons=function(){var a,b,c;return b='<div class="fb-btn-holder"><div class="fb-like" data-href="'+this.axe().BASE_PATH+'" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></div></div>',c='<div class="tw-btn-holder"><a href="https://twitter.com/share" class="twitter-share-button" data-lang="en" data-url="'+this.axe().BASE_PATH+'">Tweet</a></div>',a=$('<div class="btn-holder" />').append(b).append(c),this.addChild(a),this.axe().appView.dashboardVisible?this.parseBtns(!1):this.axe().appView.on("showDashboardEnd",this.parseBtns),null},b.prototype.parseBtns=function(a){return null==a&&(a=!0),FB.XFBML.parse(),twttr.widgets.load(),a?this.axe().appView.off("showDashboardEnd",this.parseBtns):void 0},b}(d),ad=function(a){function b(){this.onTermsLinksClick=Vd(this.onTermsLinksClick,this),this.showLogout=Vd(this.showLogout,this),this.onLoggedChange=Vd(this.onLoggedChange,this),this.setListeners=Vd(this.setListeners,this),this.stop=Vd(this.stop,this),this.start=Vd(this.start,this),this.bindEvents=Vd(this.bindEvents,this),this.init=Vd(this.init,this);var a,c,d;return this.userModel=this.axe().appData.USER.model,this.serviceModel=this.axe().appView.activeService,c=Modernizr.svg?"svg":"jpg",a={logoSRC:this.axe().locale.getLocaleImage("logo_footer."+c),logoURL:this.axe().locale.get("home_tips_cta_url"),siteTitle:this.axe().locale.get("seo_og_title"),copyright:this.axe().locale.get("footer_copyright"),terms_link:this.axe().locale.get("terms_link"),terms_btn_text:this.axe().locale.get("terms_btn_text"),privacy_policy_link:this.axe().locale.get("privacy_policy_link"),privacy_policy_btn_text:this.axe().locale.get("privacy_policy_btn_text"),logout_btn_text:this.axe().locale.get("footer_logout_btn_text")},b.__super__.constructor.call(this),d=_.template(this.axe().templates.get("footer-module-content")),this.addChild(d(a)),null}return Ud(b,a),b.prototype.templateVars={i10n:{},name:"site-footer",grid:{size:"4-0-3",x:"0",y:"11-5"}},b.prototype.userModel=null,b.prototype.serviceModel=null,b.prototype.EVENTS_ON=!1,b.prototype.init=function(){return this.userModel.on("change:logged.*",this.onLoggedChange),this.onLoggedChange(),this.bindEvents(),null},b.prototype.bindEvents=function(){return this.axe().appView.on("showDashboardEnd",this.start),this.axe().appView.on("hideDashboardStart",this.stop),null},b.prototype.start=function(){return this.EVENTS_ON?void 0:(this.setListeners("on"),this.EVENTS_ON=!0,null)},b.prototype.stop=function(){return this.EVENTS_ON?(this.setListeners("off"),this.EVENTS_ON=!1,null):void 0},b.prototype.setListeners=function(a){return this.$el[a]("click","[data-logout]",this.showLogout),this.$el[a]("click","[data-terms-link]",this.onTermsLinksClick),null},b.prototype.onLoggedChange=function(){var a,b,c;c=this.userModel.get("logged");for(a in c)if(b=c[a],b===!0)return this.$el.addClass("user-logged");return this.$el.removeClass("user-logged"),null},b.prototype.showLogout=function(a){var b,c,d,e;if(a.preventDefault(),!this.axe().appView.logoutModal&&this.userModel.get("logged."+this.serviceModel.get("service"))){if(this.userModel.get("logged."+this.serviceModel.get("service")))c=this.serviceModel.get("service");else{e=this.userModel.get("logged");for(b in e)d=e[b],d===!0&&(c=b)}return this.axe().appView.logoutModal=new pc(c),null}},b.prototype.onTermsLinksClick=function(){return this.axe().analytics.track("footer_terms"),null},b}(d),Ad=function(a){function b(){this.onLinkClick=Vd(this.onLinkClick,this),this.setListeners=Vd(this.setListeners,this),this.stop=Vd(this.stop,this),this.start=Vd(this.start,this),this.bindEvents=Vd(this.bindEvents,this),this.init=Vd(this.init,this);var a,c;return this.templateVars.i10n.title=this.axe().locale.get("home_tips_title"),this.templateVars.i10n.desc=this.axe().locale.get("home_tips_desc"),a={tips_cta_text:this.axe().locale.get("home_tips_cta_text"),tips_cta_url:this.axe().locale.get("home_tips_cta_url")},b.__super__.constructor.call(this),c=_.template(this.axe().templates.get("tips-module-content")),this.addChild(c(a)),null}return Ud(b,a),b.prototype.templateVars={i10n:{},name:"tips",grid:{size:"2-1",x:"0",y:"5"}},b.prototype.init=function(){return this.bindEvents(),null},b.prototype.bindEvents=function(){return this.axe().appView.on("showDashboardEnd",this.start),this.axe().appView.on("hideDashboardStart",this.stop),null},b.prototype.start=function(){return this.EVENTS_ON?void 0:(this.setListeners("on"),this.EVENTS_ON=!0,null)},b.prototype.stop=function(){return this.EVENTS_ON?(this.setListeners("off"),this.EVENTS_ON=!1,null):void 0},b.prototype.setListeners=function(a){return this.$el[a]("click","[data-external-link]",this.onLinkClick),null},b.prototype.onLinkClick=function(){return this.axe().analytics.track("external_click_learn_style"),null},b}(d),Ld=function(a){function b(){return this.init=Vd(this.init,this),this.templateVars.i10n.title=this.axe().locale.get("fun_facts_title"),this.templateVars.i10n.desc=this.axe().locale.get("fun_facts_descr"),b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.templateVars={i10n:{},name:"video",grid:{size:"2-2",x:"0",y:"6"}},b.prototype.init=function(){var a;return a=$('<span class="video-bg" style="background-image: url('+this.axe().locale.getLocaleImage("video_module_bg.jpg")+');"></span>'),this.addChild(a),null},b}(d),e=function(a){function b(){return this.showConnectionMessage=Vd(this.showConnectionMessage,this),this.onConnectionUp=Vd(this.onConnectionUp,this),this.onConnectionDown=Vd(this.onConnectionDown,this),this.listen2Socket=Vd(this.listen2Socket,this),this.hide=Vd(this.hide,this),this.show=Vd(this.show,this),this.init=Vd(this.init,this),this.initialize=Vd(this.initialize,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.template="section-abstract",b.prototype.addToSelector=".inner",b.prototype.$innerEl=null,b.prototype.activeSectionClass="active-section",b.prototype.connectionErrorVars=null,b.prototype.disableOnConnectionDown=!1,b.prototype.initialize=function(){return b.__super__.initialize.call(this),this.on("show",this.show),this.disableOnConnectionDown&&this.listen2Socket("on"),null},b.prototype.init=function(){return this.$innerEl=this.$el.find(".inner").eq(0),this.$innerEl.detach(),null},b.prototype.show=function(){return this.$el.append(this.$innerEl).addClass(this.activeSectionClass),TweenLite.to(this.$el.find(".inner"),.5,{opacity:1}),null},b.prototype.hide=function(a){return this.$el.removeClass(this.activeSectionClass),TweenLite.to(this.$el.find(".inner"),.5,{opacity:0,onComplete:function(b){return function(){return b.$innerEl.detach(),a()}}(this)}),null},b.prototype.listen2Socket=function(a){var b;return b=this.axe().socket,b[a]("connection:up",this.onConnectionUp),b[a]("connection:down",this.onConnectionDown),"on"===a&&b.status===dd.STATUS_DOWN?this.onConnectionDown():void 0},b.prototype.onConnectionDown=function(){return this.showConnectionMessage()},b.prototype.onConnectionUp=function(){},b.prototype.showConnectionMessage=function(){var a;return this.errorMessage?void 0:(a=_.extend({descKey:"real_time_connection_error_desc"},this.connectionErrorVars),this.errorMessage=new Y(a.titleKey,!0,a.descKey),this.addChild(this.errorMessage),this.errorMessage.on("close",function(a){return function(){return a.remove(a.errorMessage),a.errorMessage=null}}(this)),this.errorMessage.show())},b}(g),ub=function(a){function b(){return this.hide=Vd(this.hide,this),this.stopVideo=Vd(this.stopVideo,this),this.onPlayerReady=Vd(this.onPlayerReady,this),this.initYT=Vd(this.initYT,this),this.loadData=Vd(this.loadData,this),this.init=Vd(this.init,this),this.templateVars={name:"fun-facts",funfacts_fact1_title:this.axe().locale.get("funfacts_fact1_title"),funfacts_fact2_title:this.axe().locale.get("funfacts_fact2_title"),funfacts_fact3_title:this.axe().locale.get("funfacts_fact3_title"),funfacts_fact4_title:this.axe().locale.get("funfacts_fact4_title"),funfacts_fact5_title:this.axe().locale.get("funfacts_fact5_title"),funfacts_fact6_title:this.axe().locale.get("funfacts_fact6_title"),funfacts_fact7_title:this.axe().locale.get("funfacts_fact7_title"),funfacts_fact1:this.axe().locale.get("funfacts_fact1"),funfacts_fact2:this.axe().locale.get("funfacts_fact2"),funfacts_fact3:this.axe().locale.get("funfacts_fact3"),funfacts_fact4:this.axe().locale.get("funfacts_fact4"),funfacts_fact5:this.axe().locale.get("funfacts_fact5"),funfacts_fact6:this.axe().locale.get("funfacts_fact6"),funfacts_fact7:this.axe().locale.get("funfacts_fact7"),funfacts_fact7_subtitle:this.axe().locale.get("funfacts_fact6_title"),funfacts_fact7_imageURL:this.axe().locale.get("funfacts_fact7_imageURL")},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.events={"click .btn-play":"initYT"},b.prototype.movieID=null,b.prototype.init=function(){var a,c;return this.header=new hb("funfacts_title","funfacts_description"),this.addChild(this.header),this.movieID=this.axe().locale.get("funfacts_youtube_video_id"),this.loadData(this.templateVars),c=document.createElement("script"),c.src="https://www.youtube.com/iframe_api",a=document.getElementsByTagName("script")[0],a.parentNode.insertBefore(c,a),b.__super__.init.call(this),null},b.prototype.loadData=function(a){var b,c;return b=_.template(this.axe().templates.get("fun-facts-content")),c=$(b(a)),this.addChild(c)},b.prototype.initYT=function(a){var b;return a.preventDefault(),b=this.$el.find(".placeholder"),this.player=new YT.Player(this.$el.find(".facts-video").get(0),{height:b.height(),width:"100%",videoId:this.movieID,events:{onReady:this.onPlayerReady}})},b.prototype.onPlayerReady=function(a){return a.target.playVideo()},b.prototype.stopVideo=function(){return this.player?this.player.stopVideo():void 0},b.prototype.hide=function(a){return this.stopVideo(),b.__super__.hide.call(this,a)},b}(e),Ab=function(a){function b(){return this.hide=Vd(this.hide,this),this.fadeIn=Vd(this.fadeIn,this),this.callChildren=Vd(this.callChildren,this),this.bindEvents=Vd(this.bindEvents,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.statsData=this.axe().appData.GLOBAL_STATS,this.statsModel=this.statsData.model,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.templateVars={name:"global-stats"},b.prototype.statsData=null,b.prototype.statsModel=null,b.prototype.header=null,b.prototype.$children=null,b.prototype.shown=!1,b.prototype.disableOnConnectionDown=!0,b.prototype.connectionErrorVars={titleKey:"global_stats_title"},b.prototype.init=function(){return this.header=new hb("deepview_global_stats_bar_title","deepview_global_stats_bar_description"),this.headerModule=new td(this.statsData,this.statsModel),this.mainModules=new ud(this.statsData,this.statsModel),this.addChild(this.header).addChild(this.headerModule).addChild(this.mainModules),b.__super__.init.call(this),this.setup(),null},b.prototype.setup=function(){var a,b,c,d;for(d=this.children,b=0,c=d.length;c>b;b++)a=d[b],this.$children=this.$children?this.$children.add(a.$el):a.$el;return this.$children.css("opacity",0),this.bindEvents(),null},b.prototype.bindEvents=function(){return this.on("show",function(a){return function(){return a.shown?void 0:(a.shown=!0,a.statsData.DEEPVIEW_VISIBLE=!0,a.fadeIn(a.children),a.axe().analytics.track("open_global_stats_module"))}}(this)),null},b.prototype.callChildren=function(a,b){var c,d,e,f;for(d=e=0,f=b.length;f>e;d=++e)c=b[d],c.trigger(a),c.children.length&&this.callChildren(a,c.children);return null},b.prototype.fadeIn=function(a){var b,c,d,e,f;for(d=function(c){return function(d){var e;return e={delay:.1*d,opacity:1,ease:Cubic.easeInOut},d===a.length-1&&(e.onComplete=function(){return c.callChildren("show",c.children)}),TweenLite.to(b.$el,.3,e)}}(this),c=e=0,f=a.length;f>e;c=++e)b=a[c],d(c);return null},b.prototype.hide=function(a){return this.shown=!1,this.statsData.DEEPVIEW_VISIBLE=!1,TweenLite.to(this.$children,.5,{opacity:0,onComplete:function(b){return function(){return b.$innerEl.detach(),a(),b.callChildren("hide",b.children)}}(this)}),null},b}(e),Yb=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.templateVars={name:"improve-score",placeholder:"/static/images/placeholders/deepviews/improve-score.jpg"},b}(e),$b=function(a){function b(){return this._resize=Vd(this._resize,this),this.initViz=Vd(this.initViz,this),this.getAnimationEnabled=Vd(this.getAnimationEnabled,this),this.updateUserData=Vd(this.updateUserData,this),this.onActiveTagChange=Vd(this.onActiveTagChange,this),this.hide=Vd(this.hide,this),this.show=Vd(this.show,this),this.setListeners=Vd(this.setListeners,this),this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.templateVars={name:"landing",placeholder:"/static/images/placeholders/deepviews/landing.jpg"},b.prototype.loginPanel=null,b.prototype.viz=null,b.prototype.tags=null,b.prototype.init=function(){var a;return this.resize=_.debounce(this._resize,50),this.header=new Zb,this.addChild(this.header),this.loginPanel=new oc,this.addChild(this.loginPanel),this.getAnimationEnabled()&&(this.tagsCol=this.axe().appData.TAGS,this.buffer=new ec(this.tagsCol,this.axe().socket),a=function(a){return function(){return a.buffer.initFill(a.axe().appData.LAST_TWEETS)}}(this),this.axe().appData.LAST_TWEETS?a():this.axe().appData.on("startDataReceived",a),this.activeTags=this.axe().appData.ACTIVE_TAGS),this.updateUserData(),this.getAnimationEnabled()&&this.initViz(),this.on("show",this.onShow),this.axe().appData.USER.model.on("updateUserData",this.updateUserData),b.__super__.init.call(this),null},b.prototype.setListeners=function(a){var b;return this.axe().appView[a]("updateDims",this.resize),null!=(b=this.buffer)?b["on"===a?"wakeup":"sleep"]():void 0},b.prototype.show=function(){return this.logged&&this.axe().IS_MOBILE&&this.axe().router.navigateTo(this.axe().nav.sections.HOME),this.setListeners("on"),this.getAnimationEnabled()&&(this.viz.startLoop(),this.viz.unMute(),this.viz.resize()),b.__super__.show.apply(this,arguments),this.axe().analytics.track("open_trending_hashtags"),null
},b.prototype.hide=function(){return this.setListeners("off"),this.getAnimationEnabled()&&this.viz&&(this.viz.stopLoop(),this.viz.mute()),b.__super__.hide.apply(this,arguments),null},b.prototype.onActiveTagChange=function(a){var b,c;if(!this.activeTags.find(function(b){return _.trim(b.get("name"),"#")===_.trim(a.name,"#")}))return b=Math.round(Math.random()),b?this.activeTags.shift():this.activeTags.pop(),c=this.tagsCol.find(function(){return function(b){return _.trim(b.get("name"),"#")===_.trim(a.name,"#")}}(this)),this.activeTags.add(c,{at:2}),this.axe().analytics.track("change_hashtag"),null},b.prototype.updateUserData=function(){var a,b,c,d,e;b=!1,e=this.axe().appData.USER.model.get("logged");for(c in e)d=e[c],b=b||d;return b?(this.header.$el.hide(),this.getAnimationEnabled()&&this.initViz()):this.header.$el.show(),a=this.$el.find(".close-btn"),b?a.show():a.hide(),this.loginPanel.setLogged(b),this.logged=b},b.prototype.getAnimationEnabled=function(){return!this.axe().IS_MOBILE},b.prototype.initViz=function(){return this.viz?void 0:(this.viz=new _b(this.activeTags,this.buffer),this.addChild(this.viz),this.tags=new wd(this.tagsCol,this.activeTags),this.addChild(this.tags),this.listenTo(this.tags.search,"selectHashtag",this.onActiveTagChange))},b.prototype._resize=function(){return this.viz?this.viz.resize():void 0},b}(e),fc=function(a){function b(){this.attachLinks=Vd(this.attachLinks,this),this.prepareData=Vd(this.prepareData,this),this.hasMedia=Vd(this.hasMedia,this),this.getType=Vd(this.getType,this),this.setColumns=Vd(this.setColumns,this),this.loadPosts=Vd(this.loadPosts,this),this.resize=Vd(this.resize,this),this.setListeners=Vd(this.setListeners,this),this.hide=Vd(this.hide,this),this.onShow=Vd(this.onShow,this),this.bindEvents=Vd(this.bindEvents,this),this.init=Vd(this.init,this),b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.templateVars={name:"latest-posts"},b.prototype.sectionTypes=[{name:"photo",tpl:"section-latest-posts-type-photo"},{name:"post",tpl:"section-latest-posts-type-post"},{name:"composite",tpl:"section-latest-posts-type-composite"}],b.prototype.compositeRatio=.25,b.prototype.mediaRatio=.75,b.prototype.displayCount=32,b.prototype.init=function(){var a,c,d,e,f;for(this.header=new hb("deepview_latest_posts_called_title","deepview_latest_posts_called_description"),this.addChild(this.header),this.addChild($('<span class="dots"></span>')),this.elements=$('<div class="posts cf"></div>'),this.addChild(this.elements),c=Tc.request({url:""+this.axe().BASE_PATH+"/api/callout/120",type:"get"}),c.done(function(a){return function(b){return a.loadPosts(b)}}(this)),f=this.sectionTypes,d=0,e=f.length;e>d;d++)a=f[d],a.tpl=_.template(this.axe().templates.get(a.tpl));return b.__super__.init.call(this),this.bindEvents(),null},b.prototype.bindEvents=function(){return this.on("show",this.onShow),null},b.prototype.onShow=function(){return this.setListeners("on"),this.axe().analytics.track("open_calledout_module"),null},b.prototype.hide=function(){return this.setListeners("off"),b.__super__.hide.apply(this,arguments)},b.prototype.setListeners=function(a){return this.axe().appView[a]("updateDims",this.resize)},b.prototype.resize=function(){return this.setColumns()},b.prototype.loadPosts=function(a){return a=_.map(a,function(a){return function(b){return a.attachLinks(b)}}(this)),this.items=this.prepareData(a),this.els=[],_.each(this.items,function(a){return function(b){var c,d,e;return(d=_.extend(b.data))?(e=a.getType(b.type),c=$(e.tpl({data:d})),c.attr("data-judgement",d.judgement),a.els.push(c)):void 0}}(this)),this.setColumns(!0)},b.prototype.setColumns=function(a){var b,c,d,e;if(null==a&&(a=!1),c=this.numOfCols||0,this.numOfCols=function(){switch(!1){case!this.axe().IS_MOBILE:return 1;case!((this.axe().appView.dims.w||window.innerWidth)<1023):return 2;default:return 3}}.call(this),c!==this.numOfCols||a){for(this.elements.html(""),b=d=1,e=this.numOfCols;e>=1?e>=d:d>=e;b=e>=1?++d:--d)this.elements.append('<div class="posts-col posts-col-'+b+'"></div>');return this.cols=this.elements.find(".posts-col"),_.each(this.els,function(a){return function(b,c){return a.cols.eq(c%a.numOfCols).append(b)}}(this))}},b.prototype.getType=function(a){return _.find(this.sectionTypes,function(b){return b.name===a})},b.prototype.hasMedia=function(a){return!!a.media},b.prototype.prepareData=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(g=_.filter(a,function(a){return function(b){return a.hasMedia(b)}}(this)).length,d=Math.max(1,Math.floor(g*this.compositeRatio/2)),i=g+d-4*d,m=this.displayCount*(1-this.mediaRatio),m=Math.max(m,this.displayCount-i),a.length-g>m&&(l=_.sample(_.reject(a,function(a){return function(b){return a.hasMedia(b)}}(this)),a.length-g-m),a=_.difference(a,l)),c=0,b=function(b){return _.each(b,function(c,d){var e;return e=a.indexOf(c),a.splice(e,1),3===d?a.splice(e,0,b):void 0}),c++},h=[],_.each(a,function(a){return function(e){return a.hasMedia(e)?h.push(e):(h.length>=4&&d>c&&b(_.sample(h,4)),h=[])}}(this));d>c&&a.length-3>=this.displayCount;)f=_.filter(a,function(a){return function(b){return a.hasMedia(b)}}(this)),b(_.sample(f,4));for(k=[],e=n=1,o=Math.min(this.displayCount,a.length);o>=1?o>=n:n>=o;e=o>=1?++n:--n)j=a[e-1],k.push({data:j,type:function(){switch(!0){case _.isArray(j):return"composite";case this.hasMedia(j):return"photo";default:return"post"}}.call(this)});return k},b.prototype.attachLinks=function(a){var b,c;return b=function(){switch(a.social){case 1:return"twitter";case 2:return"instagram";case 3:return"facebook"}}(),c=function(){switch(b){case"twitter":return{name:a.name,screen_name:a.username};case"instagram":return{full_name:a.name,username:a.username};default:return null}}(),a.created=parseInt(a.created),a.source=function(){switch(b){case"twitter":return{twitter:a.link};case"instagram":return{instagram:a.link};default:return null}}(),_.extend(a,{nameLink:Pc.getNameLink(b,{user:c}),usernameLink:Pc.getUsernameLink(b,{user:c}),dateLink:Pc.getDateLink(b,a),text:Pc.getRichText(b,a.status)})},b}(e),nc=function(a){function b(){return this.hide=Vd(this.hide,this),this.fadeIn=Vd(this.fadeIn,this),this.callChildren=Vd(this.callChildren,this),this.bindEvents=Vd(this.bindEvents,this),this.setup=Vd(this.setup,this),this.init=Vd(this.init,this),this.statsData=this.axe().appData.LOCATION_STATS,this.statsModel=this.statsData.model,b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.templateVars={name:"location-stats"},b.prototype.statsData=null,b.prototype.statsModel=null,b.prototype.mapCounter=null,b.prototype.mapModule=null,b.prototype.percModule=null,b.prototype.citySelector=null,b.prototype.trendsModule=null,b.prototype.$children=null,b.prototype.shown=!1,b.prototype.disableOnConnectionDown=!0,b.prototype.connectionErrorVars={titleKey:"country_header"},b.prototype.init=function(){return this.header=new hb("deepview_comparecities_title","deepview_comparecities_description"),this.mapCounter=new zc,this.mapModule=new xc,this.citySelector=new uc,this.percModule=new yc,this.trendsModule=new Ac,this.addChild(this.header).addChild(this.mapCounter).addChild(this.mapModule).addChild(this.citySelector).addChild(this.percModule).addChild(this.trendsModule),b.__super__.init.call(this),this.setup(),null},b.prototype.setup=function(){var a,b,c,d;for(d=this.children,b=0,c=d.length;c>b;b++)a=d[b],this.$children=this.$children?this.$children.add(a.$el):a.$el;return this.$children.css("opacity",0),this.bindEvents(),null},b.prototype.bindEvents=function(){return this.on("show",function(a){return function(){var b;if(!a.shown)return null!=(b=a.axe().appView.milestones)&&b.completeTask("seen_city_compare"),a.shown=!0,a.statsData.DEEPVIEW_VISIBLE=!0,a.fadeIn(a.children),a.axe().analytics.track("open_cities_module")}}(this)),null},b.prototype.callChildren=function(a,b){var c,d,e,f;for(d=e=0,f=b.length;f>e;d=++e)c=b[d],c.trigger(a),c.children.length&&this.callChildren(a,c.children);return null},b.prototype.fadeIn=function(a){var b,c,d,e,f;for(d=function(c){return function(d){var e;return e={delay:.1*d,opacity:1,ease:Cubic.easeInOut},d===a.length-1&&(e.onComplete=function(){return c.callChildren("show",c.children)}),TweenLite.to(b.$el,.3,e)}}(this),c=e=0,f=a.length;f>e;c=++e)b=a[c],d(c);return null},b.prototype.hide=function(a){return this.shown=!1,this.statsData.DEEPVIEW_VISIBLE=!1,TweenLite.to(this.$children,.5,{opacity:0,onComplete:function(b){return function(){return b.$innerEl.detach(),a(),b.callChildren("hide",b.children)}}(this)}),null},b}(e),Qc=function(a){function b(){return this.showSpirographServiceSelector=Vd(this.showSpirographServiceSelector,this),this.onTicker=Vd(this.onTicker,this),this.onShowDone=Vd(this.onShowDone,this),this.updateToggle=Vd(this.updateToggle,this),this.show=Vd(this.show,this),this.init=Vd(this.init,this),this.templateVars={name:"profile",scorebreakdown_you_vs_everyone_else_title:this.axe().locale.get("scorebreakdown_you_vs_everyone_else_title"),scorebreakdown_you_vs_everyone_else_description:this.axe().locale.get("scorebreakdown_you_vs_everyone_else_description"),scorebreakdown_howitworks_title:this.axe().locale.get("scorebreakdown_howitworks_title"),scorebreakdown_howitworks_description:this.axe().locale.get("scorebreakdown_howitworks_description"),scorebreakdown_tweetgenerator_title:this.axe().locale.get("scorebreakdown_tweetgenerator_title"),scorebreakdown_tweetgenerator_description:this.axe().locale.get("scorebreakdown_tweetgenerator_description")},b.__super__.constructor.call(this),null}return Ud(b,a),b.prototype.template="section-profile",b.prototype.spirograph=null,b.prototype.breakdown=null,b.prototype.tweetGenerator=null,b.prototype.spirographServiceSelector=null,b.prototype.toggleServiceSpiro=null,b.prototype.init=function(){return this.header=new hb("scorebreakdown_title","scorebreakdown_description"),this.addChild(this.header,!0),b.__super__.init.call(this),null},b.prototype.initGraphs=function(){return this.spirograph=new ed(this),this.el.getElementsByClassName("breakdown")[0].getElementsByClassName("inner-section")[0].appendChild(this.spirograph.el),this.breakdown=this.axe().IS_MOBILE?new Bb([Math.min(window.innerWidth,1140),210],80):new Bb([Math.min(window.innerWidth,1140),449]),this.el.getElementsByClassName("compare")[0].getElementsByClassName("graph-container")[0].appendChild(this.breakdown.legendHTML.get(0)),this.el.getElementsByClassName("compare")[0].getElementsByClassName("graph-container")[0].appendChild(this.breakdown.scene.canvasEl),this.tweetGenerator=new Dd,this.el.getElementsByClassName("tweet-generator")[0].appendChild(this.tweetGenerator.el),this.axe().IS_MOBILE&&(this.axe().appView.spiroServiceSelector=new qd,this.axe().appView.spiroServiceSelector.onServiceChanged=function(a){return function(b){return a.updateToggle(b),a.spirograph.onSpiroServiceSelectorChange(b)}}(this)),null},b.prototype.show=function(){var a,b;return this.$el.append(this.$innerEl).addClass(this.activeSectionClass),null!=(a=this.axe().appView.milestones)&&a.completeTask("seen_breakdown"),this.toggleServiceSpiro||(this.toggleServiceSpiro=$(".toggle-service-btn").get(0)),axe.appData.USER.status.get(this.axe().appView.activeService.get("service"))?this.currentService=this.axe().appView.activeService.get("service"):axe.appData.USER.status.get("tw")?this.currentService="tw":axe.appData.USER.status.get("fb")?this.currentService="fb":axe.appData.USER.status.get("ig")&&(this.currentService="ig"),this.spirograph?(this.initEvents(),this.spirograph.updateOnShow(),null!=(b=this.spirograph.postInfos.currentInfos)&&b.hide(),this.spirograph.postInfos.switchPanel(this.currentService),this.spirograph.scorePanel.updateUI(this.currentService,!1)):(this.initGraphs(),this.initEvents()),this.breakdown.onShow(),this.updateToggle(this.currentService),TweenLite.to(this.$el.find(".inner"),.5,{opacity:1,onComplete:this.onShowDone}),this.axe().analytics.track("click_scorebreakdown"),null},b.prototype.updateToggle=function(a){return this.toggleServiceSpiro.innerHTML=Ic.getNiceScore(this.axe().appData.USER.model.get("scores."+a+".total")),this.toggleServiceSpiro.className="toggle-service-btn "+this.axe().appData.USER.model.get("scores."+a+".judgement"),null},b.prototype.onShowDone=function(){return this.spirograph.graph.reload(this.currentService,!1),this.spirograph.graph.transitionIn(),this.spirograph.scorePanel.updateUI(this.currentService),null},b.prototype.hide=function(){return this.removeEvents(),b.__super__.hide.apply(this,arguments),null},b.prototype.initEvents=function(){return this.spirograph.initEvents(),this.axe().IS_MOBILE&&$(this.toggleServiceSpiro).on("touchend",this.showSpirographServiceSelector),this.axe().appView.on("updateDims",function(a){return function(){var b,c;return null!=(b=a.breakdown)&&b.onResize(),null!=(c=a.breakdown)?c.scene.update():void 0}}(this)),null},b.prototype.removeEvents=function(){return this.axe().IS_MOBILE&&$(this.toggleServiceSpiro).off("touchend",this.showSpirographServiceSelector),null},b.prototype.onTicker=function(){return this.breakdown.scene.update(),null},b.prototype.showSpirographServiceSelector=function(){return this.axe().appData.USER.status.getLoggedCount()>1&&(this.axe().appView.spiroServiceSelector.update(),this.axe().appView.spiroServiceSelector.animateIn()),null},b}(e),Yc=function(a){function b(){this.goHome=Vd(this.goHome,this),this.userIsLogged=Vd(this.userIsLogged,this),this.userNotLogged=Vd(this.userNotLogged,this),this.onLoggedChange=Vd(this.onLoggedChange,this),this.setListeners=Vd(this.setListeners,this),this.hide=Vd(this.hide,this),this.bindEvents=Vd(this.bindEvents,this),this.showContent=Vd(this.showContent,this),this.init=Vd(this.init,this);var a;this.userData=this.axe().appData.USER,this.userModel=this.userData.model,a=Modernizr.svg?"svg":"jpg",this.contentVars={logoSRC:this.axe().locale.getLocaleImage("logo_header."+a),siteTitle:this.axe().locale.get("seo_og_title"),greeting:this.axe().locale.get("deepview_share_landing_greeting"),message:this.axe().locale.get("deepview_share_landing_message"),please_login:this.axe().locale.get("deepview_share_landing_login_prompt"),login_tw:this.axe().locale.get("login_tw"),login_fb:this.axe().locale.get("login_fb"),login_ig:this.axe().locale.get("login_ig"),return_home:this.axe().locale.get("deepview_share_landing_back_home")},b.__super__.constructor.call(this)}return Ud(b,a),b.prototype.userData=null,b.prototype.userModel=null,b.prototype.contentShown=null,b.prototype.contentVars=null,b.prototype.templateVars={name:"share-landing"},b.prototype.init=function(){return this.bindEvents(),b.__super__.init.call(this),null},b.prototype.showContent=function(){var a;if(!this.contentShown)return this.contentShown=!0,this.contentVars.shareData=this.axe().appData.SHARE_DATA,a=_.template(this.axe().templates.get("share-deepview")),this.addChild(a(this.contentVars)),null},b.prototype.bindEvents=function(){return this.on("show",function(a){return function(){return a.$el.append(a.$innerEl).addClass(a.activeSectionClass),a.showContent(),a.setListeners("on"),a.onLoggedChange()}}(this)),null},b.prototype.hide=function(){return this.setListeners("off"),b.__super__.hide.apply(this,arguments),null},b.prototype.setListeners=function(a){return this.userModel[a]("change:logged*",this.onLoggedChange),this.$el[a]("click","[data-back-home]",this.goHome),null},b.prototype.onLoggedChange=function(){return this.userData.isLogged()?this.userIsLogged():this.userNotLogged(),null},b.prototype.userNotLogged=function(){return this.$el.removeClass("hide-login-btns"),null},b.prototype.userIsLogged=function(){return this.$el.addClass("hide-login-btns"),null},b.prototype.goHome=function(){return this.axe().router.navigateTo(this.axe().nav.sections.HOME),null},b}(e),Fc=function(a){function b(){this.trackAnalytics=Vd(this.trackAnalytics,this),this.isDeepView=Vd(this.isDeepView,this),this.changeView=Vd(this.changeView,this),this.getSection=Vd(this.getSection,this),this.axe().router.on(Uc.EVENT_HASH_CHANGED,this.changeView)}return Ud(b,a),b.prototype.sections={LANDING:"landing",HOME:"home",GLOBAL_STATS:"global",LOCATION_STATS:"country",FUN_FACTS:"fun",PROFILE:"profile",LATEST:"latest",SHARE_DEEPLINK:"view"},b.prototype.currentView=null,b.prototype.previousView=null,b.prototype.getSection=function(a){var b,c,d;if(""===a)return!0;d=this.sections;for(b in d)if(c=d[b],c===a)return b;return!1},b.prototype.changeView=function(a){return this.previousView=this.currentView,this.currentView=a,this.previousView?this.previousView===this.currentView?console.log("trigger event for swtiching sub view"):this.axe().appView.wrapper.transitioner.go(this.previousView,this.currentView):this.axe().appView.wrapper.transitioner.firstViewing(this.currentView),null},b.prototype.isDeepView=function(){var a,b,c;c=this.sections;for(b in c)if(a=c[b],a===this.currentView)return a!==this.sections.HOME&&a!==this.sections.SHARE_DEEPLINK?!0:!1;return null},b.prototype.trackAnalytics=function(){return null},b}(g),Uc=function(a){function b(){return this.axe=Vd(this.axe,this),this.navigateTo=Vd(this.navigateTo,this),this.hashChanged=Vd(this.hashChanged,this),this.viewer=Vd(this.viewer,this),this.start=Vd(this.start,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.FIRST_ROUTE=!0,b.EVENT_HASH_CHANGED="EVENT_HASH_CHANGED",b.prototype.routes={"(/)view/*params":"viewer","(/)(:app)(/)":"hashChanged","*actions":"navigateTo"},b.prototype.start=function(){return Backbone.history.start({pushState:!0,root:"/"}),null},b.prototype.viewer=function(a){return"/"===a.charAt(a.length-1)&&(a=a.substr(0,a.length-2)),this.axe().appData.SHARE_DATA=bb.decode(a),this.trigger(b.EVENT_HASH_CHANGED,"view",null),null},b.prototype.hashChanged=function(a,c){return this.area=null!=a?a:null,this.sub=null!=c?c:null,!this.FIRST_ROUTE||(this.FIRST_ROUTE=!1,!this.area&&this.axe().appData.USER.isLogged()&&this.navigateTo(this.axe().nav.sections.HOME,!0,!0),this.area!==this.axe().nav.sections.HOME&&this.area!==this.axe().nav.sections.PROFILE||this.axe().appData.USER.isLogged())?(this.area||(this.area=this.axe().nav.sections.LANDING),this.trigger(b.EVENT_HASH_CHANGED,this.area,this.sub,this.params),null):this.navigateTo("",!0,!0)},b.prototype.navigateTo=function(a,c,d,e){var f;return null==a&&(a=""),null==c&&(c=!0),null==d&&(d=!1),this.params=e,f=a.replace(/\//g,""),f!==this.axe().nav.sections.HOME&&f!==this.axe().nav.sections.PROFILE||this.axe().appData.USER.isLogged()||(a=""),c?("/"!==a.charAt(a.length-1)&&(a+="/"),this.navigate(a,{trigger:!0,replace:d}),null):(this.trigger(b.EVENT_HASH_CHANGED,a,null,this.params),void 0)},b.prototype.axe=function(){return(window||document).axe},b}(Backbone.Router),n=function(a){function b(){return this.showOrientationOverlay=Vd(this.showOrientationOverlay,this),this.showErrorModal=Vd(this.showErrorModal,this),this.modalOpen=Vd(this.modalOpen,this),this.onKeyup=Vd(this.onKeyup,this),this.loginClick=Vd(this.loginClick,this),this.linkManager=Vd(this.linkManager,this),this.setInitialState=Vd(this.setInitialState,this),this.showGate=Vd(this.showGate,this),this.hidePreloader=Vd(this.hidePreloader,this),this.setDims=Vd(this.setDims,this),this.onHideDashboardEnd=Vd(this.onHideDashboardEnd,this),this.onShowDashboardEnd=Vd(this.onShowDashboardEnd,this),this.begin=Vd(this.begin,this),this.onAllRendered=Vd(this.onAllRendered,this),this.onElDimsReceived=Vd(this.onElDimsReceived,this),this.bindEvents=Vd(this.bindEvents,this),this.render=Vd(this.render,this),this.init=Vd(this.init,this),b.__super__.constructor.apply(this,arguments)}return Ud(b,a),b.prototype.tagName="div",b.prototype.id="main",b.prototype.header=null,b.prototype.wrapper=null,b.prototype.loader=null,b.prototype.gate=null,b.prototype.navigationMobile=null,b.prototype.milestones=null,b.prototype.logoutModal=null,b.prototype.errorModal=null,b.prototype.shareModal=null,b.prototype.orientationOverlay=null,b.prototype.spiroServiceSelector=null,b.prototype.postMediaModal=null,b.prototype.currentView=null,b.prototype.activeService=null,b.prototype.rendered=!1,b.prototype.dashboardVisible=!1,b.prototype.moduleDimsReceived=!1,b.prototype.startWhenDimsReceived=!1,b.prototype.firstDashboardViewing=!0,b.prototype.haveShownOneBullseye=!1,b.prototype.dims={w:null,h:null,o:null},b.prototype.events={"click a":"linkManager","click button[data-login]":"loginClick"},b.prototype.init=function(){return this.axe().socket=new dd(window.config.socket.ws,window.config.socket.longpollingUrl),this.activeService=new j,null},b.prototype.render=function(){return this.bindEvents(),createjs.Ticker.setFPS(30),createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,this.header=this.axe().IS_MOBILE?new Sb:new Rb,this.addChild(this.header),this.wrapper=new Md,this.addChild(this.wrapper),this.loader=new hc,this.addChild(this.loader),this.axe().IS_MOBILE?(this.navigationMobile=new Gc,this.addChild(this.navigationMobile)):this.milestones=new Ec,null},b.prototype.bindEvents=function(){var a;return a=$(window),this.on("elDimsReceived",this.onElDimsReceived),this.on("allRendered",this.onAllRendered),this.on("showDashboardEnd",this.onShowDashboardEnd),this.on("hideDashboardEnd",this.onHideDashboardEnd),this.setDims=_.debounce(this.setDims,300),a.on("resize orientationchange",this.setDims),a.on("keyup",this.onKeyup),null},b.prototype.onElDimsReceived=function(){return this.off("elDimsReceived",this.onElDimsReceived),this.moduleDimsReceived=!0,this.startWhenDimsReceived&&this.onAllRendered(),null},b.prototype.onAllRendered=function(){return this.axe().appData.start(),this.setDims(),this.moduleDimsReceived?($("body").prepend(this.$el),setTimeout(function(a){return function(){return a.rendered=!0,a.wrapper.transitioner.init(),a.setInitialState(),a.begin()}}(this),0),null):(this.startWhenDimsReceived=!0,void 0)},b.prototype.begin=function(){return this.trigger("start"),this.axe().socket.start(),setTimeout(function(a){return function(){return a.hidePreloader(),a.showGate(),a.axe().router.start()}}(this),200),null},b.prototype.onShowDashboardEnd=function(){return this.dashboardVisible=!0,this.firstDashboardViewing&&(this.axe().analytics.track("dashboard_load"),this.firstDashboardViewing=!1),null},b.prototype.onHideDashboardEnd=function(){return this.dashboardVisible=!1,this.wrapper.promptManager&&this.wrapper.promptManager.PROMPT_VISIBLE&&this.wrapper.promptManager.hideMsg(),null},b.prototype.setDims=function(){var a,b;return b=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,this.dims={w:b,h:a,o:a>b?"portrait":"landscape"},this.trigger("updateDims",this.dims),null},b.prototype.hidePreloader=function(){var a;return a=$("#preloader"),TweenLite.to(a.find(".animation"),.7,{delay:.5,transform:"scale(0.8)",ease:Back.easeIn}),TweenLite.to(a,.7,{delay:.5,opacity:0,ease:Back.easeIn,onComplete:function(){return a.remove()}}),null},b.prototype.showGate=function(){return window.localStorage.getItem("accepted_tc")||(this.gate=new vb,this.addChild(this.gate)),null},b.prototype.setInitialState=function(){var a,b,c,d;c=this.axe().appData.USER.model.get("logged");for(a in c)if(b=c[a],b&&this.axe().appData.USER.model.get("scores."+a+".judgement"))return this.activeService.set("service",a),this.trigger("updateUserScores"),void 0;d=this.axe().appData.USER.model.get("logged");for(a in d)if(b=d[a])return this.activeService.set("service",a),this.trigger("updateUserScores"),void 0;return null},b.prototype.linkManager=function(a){var b,c;return(b=$(a.currentTarget).attr("href"))?(c=0===b.indexOf("/")?b.split("/")[1]:b.split(this.axe().BASE_PATH)[1],this.axe().nav.getSection(c)&&(a.preventDefault(),this.axe().router.navigateTo(b)),null):void 0},b.prototype.loginClick=function(a){var b,c;return a.preventDefault(),b=$(a.currentTarget).data("login"),this.axe().auth.login(b,$(a.currentTarget)),c=this.axe().nav.currentView===this.axe().nav.sections.HOME?"home_":"",this.axe().analytics.track(""+c+"connect_"+b),null},b.prototype.onKeyup=function(a){return 27===a.keyCode?(this.modalOpen()||!this.axe().nav.isDeepView()||this.axe().IS_MOBILE||this.axe().router.navigateTo(this.axe().nav.sections.HOME),null):void 0},b.prototype.modalOpen=function(){return this.logoutModal||this.errorModal||this.shareModal||this.orientationOverlay||this.spiroServiceSelector||this.postMediaModal?!0:!1},b.prototype.showErrorModal=function(a){return this.errorModal?void 0:(this.errorModal=new gb(a),null)},b.prototype.showOrientationOverlay=function(a){return this.orientationOverlay?void 0:(this.orientationOverlay=new Jc(a),null)},b}(g),Sd=window||document,Sd.axe={objReady:0,SCORE_BOUND_UPPER:200,SCORE_BOUND_LOWER:-200,SCORE_RANGE_UPPER:500,SCORE_RANGE_LOWER:-500},Od=function(){return function(){return Sd.axe.startData=new sd(Qd),Sd.axe.templates=new zd("/data/templates.xml",Qd),Sd.axe.analytics=new l("/data/tracking.json",Qd),Sd.axe.countries=new Z(Qd),Sd.axe.locale=new ic("/cms/data/locales/en/strings_new.txt",Qd),null}}(this),Qd=function(){return function(){return Sd.axe.objReady++,Sd.axe.objReady>=5&&Nd(),null}}(this),Nd=function(){return function(){return Sd.axe.analytics.track("start_loading"),Rd(),Sd.axe.BASE_PATH=window.config.hostname,Sd.axe.LIVE="socialeffortscale.com"===window.config.HOST,Sd.axe.algorithm=new k,Sd.axe.cities=new R,Sd.axe.cruncher=new ab,Sd.axe.appView=new n,Sd.axe.appData=new m,Sd.axe.router=new Uc,Sd.axe.nav=new Fc,Sd.axe.auth=new o(Sd.config.login),Sd.axe.appData.USER.checkInitialData(),Pd(),null}}(this),Rd=function(){return function(){var a,b;return a=$("html").eq(0),Sd.axe.IS_MOBILE=fb.isMobile(),Sd.axe.IS_SMALL_NON_MOBILE=fb.isSmallNonMobile(Sd.axe.IS_MOBILE),b=Sd.axe.IS_MOBILE?"is-mobile":"not-mobile",b+=Sd.axe.IS_SMALL_NON_MOBILE?" small-non-mobile":"",a.addClass(b),null}}(this),Pd=function(){return function(){return Sd.axe.appView.render(),null}}(this),Od()}).call(this);
//# sourceMappingURL=/js/main.map